/* commit: 2f1b4fae91ffb6ed09ac4bd3c61f69c3c75294c7 */window.Coggle_JS_Version=1730392438;/*!
 * JavaScript Cookie v2.2.1
 * https://github.com/js-cookie/js-cookie
 *
 * Copyright 2006, 2015 Klaus Hartl & Fagner Brack
 * Released under the MIT license
 */

/*! jQuery v3.2.1 | (c) JS Foundation and other contributors | jquery.org/license */

//     Underscore.js 1.13.7
//     https://underscorejs.org
//     (c) 2009-2024 Jeremy Ashkenas, Julian Gonggrijp, and DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.

//     (c) 2010-2016 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Backbone may be freely distributed under the MIT license.
//     For all details and documentation:
//     http://backbonejs.org

/**
 * @preserve
 * Copyright Coggle 2013. All Rights reserved.
 **/

/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */

// encodeji: encode :simple-names: for emoji as unicode codepoints.
// Copyright 2016 Coggle, Licensed under ISC
// Portions from Twemoji: MIT licensed Copyright Twitter Inc. and other contributors.

/**@preserve
 * marked - a markdown parser
 * Copyright (c) 2011-2013, Christopher Jeffrey. (MIT Licensed)
*/

/*!
 * jQuery UI Widget 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

/*!
 * jQuery UI Mouse 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

/*!
 * jQuery UI :data 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

/*!
 * jQuery UI Scroll Parent 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

/*!
 * jQuery UI Draggable 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

/*!
 * jQuery UI Droppable 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

/**
 * Timeago is a jQuery plugin that makes it easy to support automatically
 * updating fuzzy timestamps (e.g. "4 minutes ago" or "about 1 day ago").
 *
 * @name timeago
 * @version 1.6.7
 * @requires jQuery >=1.5.0 <4.0
 * @author Ryan McGeary
 * @license MIT License - http://www.opensource.org/licenses/mit-license.php
 *
 * For usage and examples, visit:
 * http://timeago.yarp.com/
 *
 * Copyright (c) 2008-2019, Ryan McGeary (ryan -[at]- mcgeary [*dot*] org)
 */

/*!
 * jQuery UI Sortable 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

/*
 * jQuery outside events - v1.1 - 3/16/2010
 * http://benalman.com/projects/jquery-outside-events-plugin/
 * 
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */

/**
 * @preserve Copyright Coggle 2014. All Rights reserved.
 **/

/*!
 * jQuery UI Keycode 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

/*!
 * jQuery UI Position 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/position/
 */

/*!
 * jQuery UI Unique ID 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

/*!
 * jQuery UI Menu 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

/*!
 * jQuery UI Autocomplete 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

/*! Copyright Twitter Inc. and other contributors. Licensed under MIT */

/**
 * Copyright (c) 2007 Ariel Flesler - aflesler ○ gmail • com | https://github.com/flesler
 * Licensed under MIT
 * @author Ariel Flesler
 * @version 2.1.3
 */

/*!
 * jQuery UI Disable Selection 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

/*!
 * jQuery UI Resizable 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

/* @preserve emoji from Twemoji project by Twitter: https://github.com/twitter/twemoji, Graphics licensed under CC-BY 4.0 */

/*!
 * jQuery Mousewheel 3.1.13
 *
 * Copyright 2015 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

/*! jquery-textcomplete - v1.8.5 - 2019-02-17 */

/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */

/** @preserve
 * XMLWriter
 * Copyright (c) 2008 Ariel Flesler
 * Licensed under BSD
 */

//(n)ame, (a)ttributes, (c)hildren

// MIT Licensed, Copyright (c) 2010-2012, Joe Walnes

/*!
 * jQuery UI Tooltip 1.12.1
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */

/** @preserve MDN polyfills: Copyright MDN. */

/*!
 * jQuery UI Touch Punch 0.2.3
 *
 * Copyright 2011–2014, Dave Furfero
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Depends:
 *  jquery.ui.widget.js
 *  jquery.ui.mouse.js
 */

function _regeneratorRuntime(){"use strict";function e(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}function t(e,t,n,o){var r=t&&t.prototype instanceof i?t:i,s=Object.create(r.prototype),l=new h(o||[]);return y(s,"_invoke",{value:a(e,n,l)}),s}function n(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function i(){}function o(){}function r(){}function s(t){["next","throw","return"].forEach(function(n){e(t,n,function(e){return this._invoke(n,e)})})}function l(e,t){function i(o,r,s,l){var a=n(e[o],e,r);if("throw"!==a.type){var u=a.arg,d=u.value;return d&&"object"==_typeof(d)&&v.call(d,"__await")?t.resolve(d.__await).then(function(e){i("next",e,s,l)},function(e){i("throw",e,s,l)}):t.resolve(d).then(function(e){u.value=e,s(u)},function(e){return i("throw",e,s,l)})}l(a.arg)}var o;y(this,"_invoke",{value:function(e,n){function r(){return new t(function(t,o){i(e,n,t,o)})}return o=o?o.then(r,r):r()}})}function a(e,t,i){var o=E;return function(r,s){if(o===S)throw new Error("Generator is already running");if(o===C){if("throw"===r)throw s;return{value:f,done:!0}}for(i.method=r,i.arg=s;;){var l=i.delegate;if(l){var a=u(l,i);if(a){if(a===F)continue;return a}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(o===E)throw o=C,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);o=S;var d=n(e,t,i);if("normal"===d.type){if(o=i.done?C:A,d.arg===F)continue;return{value:d.arg,done:i.done}}"throw"===d.type&&(o=C,i.method="throw",i.arg=d.arg)}}}function u(e,t){var i=t.method,o=e.iterator[i];if(o===f)return t.delegate=null,"throw"===i&&e.iterator.return&&(t.method="return",t.arg=f,u(e,t),"throw"===t.method)||"return"!==i&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+i+"' method")),F;var r=n(o,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,F;var s=r.arg;return s?s.done?(t[e.resultName]=s.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=f),t.delegate=null,F):s:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,F)}function d(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function c(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function h(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(d,this),this.reset(!0)}function p(e){if(e||""===e){var t=e[w];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(v.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=f,t.done=!0,t};return i.next=i}}throw new TypeError(_typeof(e)+" is not iterable")}_regeneratorRuntime=function(){return g};var f,g={},m=Object.prototype,v=m.hasOwnProperty,y=Object.defineProperty||function(e,t,n){e[t]=n.value},b="function"==typeof Symbol?Symbol:{},w=b.iterator||"@@iterator",_=b.asyncIterator||"@@asyncIterator",x=b.toStringTag||"@@toStringTag";try{e({},"")}catch(f){e=function(e,t,n){return e[t]=n}}g.wrap=t;var E="suspendedStart",A="suspendedYield",S="executing",C="completed",F={},k={};e(k,w,function(){return this});var T=Object.getPrototypeOf,O=T&&T(T(p([])));O&&O!==m&&v.call(O,w)&&(k=O);var N=r.prototype=i.prototype=Object.create(k);return o.prototype=r,y(N,"constructor",{value:r,configurable:!0}),y(r,"constructor",{value:o,configurable:!0}),o.displayName=e(r,x,"GeneratorFunction"),g.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===o||"GeneratorFunction"===(t.displayName||t.name))},g.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,r):(t.__proto__=r,e(t,x,"GeneratorFunction")),t.prototype=Object.create(N),t},g.awrap=function(e){return{__await:e}},s(l.prototype),e(l.prototype,_,function(){return this}),g.AsyncIterator=l,g.async=function(e,n,i,o,r){void 0===r&&(r=Promise);var s=new l(t(e,n,i,o),r);return g.isGeneratorFunction(n)?s:s.next().then(function(e){return e.done?e.value:s.next()})},s(N),e(N,x,"Generator"),e(N,w,function(){return this}),e(N,"toString",function(){return"[object Generator]"}),g.keys=function(e){var t=Object(e),n=[];for(var i in t)n.push(i);return n.reverse(),function e(){for(;n.length;){var i=n.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},g.values=p,h.prototype={constructor:h,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=f,this.done=!1,this.delegate=null,this.method="next",this.arg=f,this.tryEntries.forEach(c),!e)for(var t in this)"t"===t.charAt(0)&&v.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=f)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){function t(t,i){return r.type="throw",r.arg=e,n.next=t,i&&(n.method="next",n.arg=f),!!i}if(this.done)throw e;for(var n=this,i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],r=o.completion;if("root"===o.tryLoc)return t("end");if(o.tryLoc<=this.prev){var s=v.call(o,"catchLoc"),l=v.call(o,"finallyLoc");if(s&&l){if(this.prev<o.catchLoc)return t(o.catchLoc,!0);if(this.prev<o.finallyLoc)return t(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return t(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return t(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&v.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var r=o?o.completion:{};return r.type=e,r.arg=t,o?(this.method="next",this.next=o.finallyLoc,F):this.complete(r)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),F},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),c(n),F}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var o=i.arg;c(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:p(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=f),F}},g}function asyncGeneratorStep(e,t,n,i,o,r,s){try{var l=e[r](s),a=l.value}catch(e){return void n(e)}l.done?t(a):Promise.resolve(a).then(i,o)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(i,o){function r(e){asyncGeneratorStep(l,i,o,r,s,"next",e)}function s(e){asyncGeneratorStep(l,i,o,r,s,"throw",e)}var l=e.apply(t,n);r(void 0)})}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,_toPropertyKey(i.key),i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _callSuper(e,t,n){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,n||[],_getPrototypeOf(e).constructor):t.apply(e,n))}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _wrapNativeSuper(e){var t="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(e){function n(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(n,e)})(e)}function _construct(e,t,n){if(_isNativeReflectConstruct())return Reflect.construct.apply(null,arguments);var i=[null];i.push.apply(i,t);var o=new(e.bind.apply(e,i));return n&&_setPrototypeOf(o,n.prototype),o}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _isNativeFunction(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _callSuper(e,t,n){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,n||[],_getPrototypeOf(e).constructor):t.apply(e,n))}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=_superPropBase(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},_get.apply(this,arguments)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,o,r,s,l=[],a=!0,u=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;a=!1}else for(;!(a=(i=r.call(n)).done)&&(l.push(i.value),l.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{if(!a&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(u)throw o}}return l}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _regeneratorRuntime(){"use strict";function e(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}function t(e,t,n,o){var r=t&&t.prototype instanceof i?t:i,s=Object.create(r.prototype),l=new h(o||[]);return y(s,"_invoke",{value:a(e,n,l)}),s}function n(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function i(){}function o(){}function r(){}function s(t){["next","throw","return"].forEach(function(n){e(t,n,function(e){return this._invoke(n,e)})})}function l(e,t){function i(o,r,s,l){var a=n(e[o],e,r);if("throw"!==a.type){var u=a.arg,d=u.value;return d&&"object"==_typeof(d)&&v.call(d,"__await")?t.resolve(d.__await).then(function(e){i("next",e,s,l)},function(e){i("throw",e,s,l)}):t.resolve(d).then(function(e){u.value=e,s(u)},function(e){return i("throw",e,s,l)})}l(a.arg)}var o;y(this,"_invoke",{value:function(e,n){function r(){return new t(function(t,o){i(e,n,t,o)})}return o=o?o.then(r,r):r()}})}function a(e,t,i){var o=E;return function(r,s){if(o===S)throw new Error("Generator is already running");if(o===C){if("throw"===r)throw s;return{value:f,done:!0}}for(i.method=r,i.arg=s;;){var l=i.delegate;if(l){var a=u(l,i);if(a){if(a===F)continue;return a}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(o===E)throw o=C,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);o=S;var d=n(e,t,i);if("normal"===d.type){if(o=i.done?C:A,d.arg===F)continue;return{value:d.arg,done:i.done}}"throw"===d.type&&(o=C,i.method="throw",i.arg=d.arg)}}}function u(e,t){var i=t.method,o=e.iterator[i];if(o===f)return t.delegate=null,"throw"===i&&e.iterator.return&&(t.method="return",t.arg=f,u(e,t),"throw"===t.method)||"return"!==i&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+i+"' method")),F;var r=n(o,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,F;var s=r.arg;return s?s.done?(t[e.resultName]=s.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=f),t.delegate=null,F):s:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,F)}function d(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function c(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function h(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(d,this),this.reset(!0)}function p(e){if(e||""===e){var t=e[w];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(v.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=f,t.done=!0,t};return i.next=i}}throw new TypeError(_typeof(e)+" is not iterable")}_regeneratorRuntime=function(){return g};var f,g={},m=Object.prototype,v=m.hasOwnProperty,y=Object.defineProperty||function(e,t,n){e[t]=n.value},b="function"==typeof Symbol?Symbol:{},w=b.iterator||"@@iterator",_=b.asyncIterator||"@@asyncIterator",x=b.toStringTag||"@@toStringTag";try{e({},"")}catch(f){e=function(e,t,n){return e[t]=n}}g.wrap=t;var E="suspendedStart",A="suspendedYield",S="executing",C="completed",F={},k={};e(k,w,function(){return this});var T=Object.getPrototypeOf,O=T&&T(T(p([])));O&&O!==m&&v.call(O,w)&&(k=O);var N=r.prototype=i.prototype=Object.create(k);return o.prototype=r,y(N,"constructor",{value:r,configurable:!0}),y(r,"constructor",{value:o,configurable:!0}),o.displayName=e(r,x,"GeneratorFunction"),g.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===o||"GeneratorFunction"===(t.displayName||t.name))},g.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,r):(t.__proto__=r,e(t,x,"GeneratorFunction")),t.prototype=Object.create(N),t},g.awrap=function(e){return{__await:e}},s(l.prototype),e(l.prototype,_,function(){return this}),g.AsyncIterator=l,g.async=function(e,n,i,o,r){void 0===r&&(r=Promise);var s=new l(t(e,n,i,o),r);return g.isGeneratorFunction(n)?s:s.next().then(function(e){return e.done?e.value:s.next()})},s(N),e(N,x,"Generator"),e(N,w,function(){return this}),e(N,"toString",function(){return"[object Generator]"}),g.keys=function(e){var t=Object(e),n=[];for(var i in t)n.push(i);return n.reverse(),function e(){for(;n.length;){var i=n.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},g.values=p,h.prototype={constructor:h,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=f,this.done=!1,this.delegate=null,this.method="next",this.arg=f,this.tryEntries.forEach(c),!e)for(var t in this)"t"===t.charAt(0)&&v.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=f)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){function t(t,i){return r.type="throw",r.arg=e,n.next=t,i&&(n.method="next",n.arg=f),!!i}if(this.done)throw e;for(var n=this,i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],r=o.completion;if("root"===o.tryLoc)return t("end");if(o.tryLoc<=this.prev){var s=v.call(o,"catchLoc"),l=v.call(o,"finallyLoc");if(s&&l){if(this.prev<o.catchLoc)return t(o.catchLoc,!0);if(this.prev<o.finallyLoc)return t(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return t(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return t(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&v.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var r=o?o.completion:{};return r.type=e,r.arg=t,o?(this.method="next",this.next=o.finallyLoc,F):this.complete(r)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),F},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),c(n),F}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var o=i.arg;c(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:p(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=f),F}},g}function asyncGeneratorStep(e,t,n,i,o,r,s){try{var l=e[r](s),a=l.value}catch(e){return void n(e)}l.done?t(a):Promise.resolve(a).then(i,o)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise(function(i,o){function r(e){asyncGeneratorStep(l,i,o,r,s,"next",e)}function s(e){asyncGeneratorStep(l,i,o,r,s,"throw",e)}var l=e.apply(t,n);r(void 0)})}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,_toPropertyKey(i.key),i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){l=!0,r=e},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw r}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _asyncIterator(e){var t,n,i,o=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,i=Symbol.iterator);o--;){if(n&&null!=(t=e[n]))return t.call(e);if(i&&null!=(t=e[i]))return new AsyncFromSyncIterator(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function AsyncFromSyncIterator(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then(function(e){return{value:e,done:t}})}return AsyncFromSyncIterator=function(e){this.s=e,this.n=e.next},AsyncFromSyncIterator.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new AsyncFromSyncIterator(e)}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(e,t,n){return t=_toPropertyKey(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,o,r,s,l=[],a=!0,u=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;a=!1}else for(;!(a=(i=r.call(n)).done)&&(l.push(i.value),l.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{if(!a&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(u)throw o}}return l}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){l=!0,r=e},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw r}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _callSuper(e,t,n){return t=_getPrototypeOf(t),_possibleConstructorReturn(e,_isNativeReflectConstruct()?Reflect.construct(t,n||[],_getPrototypeOf(e).constructor):t.apply(e,n))}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(_isNativeReflectConstruct=function(){return!!e})()}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,_toPropertyKey(i.key),i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _regeneratorRuntime(){"use strict";function e(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}function t(e,t,n,o){var r=t&&t.prototype instanceof i?t:i,s=Object.create(r.prototype),l=new h(o||[]);return y(s,"_invoke",{value:a(e,n,l)}),s}function n(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function i(){}function o(){}function r(){}function s(t){["next","throw","return"].forEach(function(n){e(t,n,function(e){return this._invoke(n,e)})})}function l(e,t){function i(o,r,s,l){var a=n(e[o],e,r);if("throw"!==a.type){var u=a.arg,d=u.value;return d&&"object"==_typeof(d)&&v.call(d,"__await")?t.resolve(d.__await).then(function(e){i("next",e,s,l)},function(e){i("throw",e,s,l)}):t.resolve(d).then(function(e){u.value=e,s(u)},function(e){return i("throw",e,s,l)})}l(a.arg)}var o;y(this,"_invoke",{value:function(e,n){function r(){return new t(function(t,o){i(e,n,t,o)})}return o=o?o.then(r,r):r()}})}function a(e,t,i){var o=E;return function(r,s){if(o===S)throw new Error("Generator is already running");if(o===C){if("throw"===r)throw s;return{value:f,done:!0}}for(i.method=r,i.arg=s;;){var l=i.delegate;if(l){var a=u(l,i);if(a){if(a===F)continue;return a}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(o===E)throw o=C,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);o=S;var d=n(e,t,i);if("normal"===d.type){if(o=i.done?C:A,d.arg===F)continue;return{value:d.arg,done:i.done}}"throw"===d.type&&(o=C,i.method="throw",i.arg=d.arg)}}}function u(e,t){var i=t.method,o=e.iterator[i];if(o===f)return t.delegate=null,"throw"===i&&e.iterator.return&&(t.method="return",t.arg=f,u(e,t),"throw"===t.method)||"return"!==i&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+i+"' method")),F;var r=n(o,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,F;var s=r.arg;return s?s.done?(t[e.resultName]=s.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=f),t.delegate=null,F):s:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,F)}function d(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function c(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function h(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(d,this),this.reset(!0)}function p(e){if(e||""===e){var t=e[w];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(v.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=f,t.done=!0,t};return i.next=i}}throw new TypeError(_typeof(e)+" is not iterable")}_regeneratorRuntime=function(){return g};var f,g={},m=Object.prototype,v=m.hasOwnProperty,y=Object.defineProperty||function(e,t,n){e[t]=n.value},b="function"==typeof Symbol?Symbol:{},w=b.iterator||"@@iterator",_=b.asyncIterator||"@@asyncIterator",x=b.toStringTag||"@@toStringTag";try{e({},"")}catch(f){e=function(e,t,n){
return e[t]=n}}g.wrap=t;var E="suspendedStart",A="suspendedYield",S="executing",C="completed",F={},k={};e(k,w,function(){return this});var T=Object.getPrototypeOf,O=T&&T(T(p([])));O&&O!==m&&v.call(O,w)&&(k=O);var N=r.prototype=i.prototype=Object.create(k);return o.prototype=r,y(N,"constructor",{value:r,configurable:!0}),y(r,"constructor",{value:o,configurable:!0}),o.displayName=e(r,x,"GeneratorFunction"),g.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===o||"GeneratorFunction"===(t.displayName||t.name))},g.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,r):(t.__proto__=r,e(t,x,"GeneratorFunction")),t.prototype=Object.create(N),t},g.awrap=function(e){return{__await:e}},s(l.prototype),e(l.prototype,_,function(){return this}),g.AsyncIterator=l,g.async=function(e,n,i,o,r){void 0===r&&(r=Promise);var s=new l(t(e,n,i,o),r);return g.isGeneratorFunction(n)?s:s.next().then(function(e){return e.done?e.value:s.next()})},s(N),e(N,x,"Generator"),e(N,w,function(){return this}),e(N,"toString",function(){return"[object Generator]"}),g.keys=function(e){var t=Object(e),n=[];for(var i in t)n.push(i);return n.reverse(),function e(){for(;n.length;){var i=n.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},g.values=p,h.prototype={constructor:h,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=f,this.done=!1,this.delegate=null,this.method="next",this.arg=f,this.tryEntries.forEach(c),!e)for(var t in this)"t"===t.charAt(0)&&v.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=f)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){function t(t,i){return r.type="throw",r.arg=e,n.next=t,i&&(n.method="next",n.arg=f),!!i}if(this.done)throw e;for(var n=this,i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],r=o.completion;if("root"===o.tryLoc)return t("end");if(o.tryLoc<=this.prev){var s=v.call(o,"catchLoc"),l=v.call(o,"finallyLoc");if(s&&l){if(this.prev<o.catchLoc)return t(o.catchLoc,!0);if(this.prev<o.finallyLoc)return t(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return t(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return t(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&v.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var r=o?o.completion:{};return r.type=e,r.arg=t,o?(this.method="next",this.next=o.finallyLoc,F):this.complete(r)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),F},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),c(n),F}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var o=i.arg;c(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:p(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=f),F}},g}function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){l=!0,r=e},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw r}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _awaitAsyncGenerator(e){return new _OverloadYield(e,0)}function _wrapAsyncGenerator(e){return function(){return new _AsyncGenerator(e.apply(this,arguments))}}function _AsyncGenerator(e){function t(i,o){try{var r=e[i](o),s=r.value,l=s instanceof _OverloadYield;Promise.resolve(l?s.v:s).then(function(o){if(l){var a="return"===i?"return":"next";if(!s.k||o.done)return t(a,o);o=e[a](o).value}n(r.done?"return":"normal",o)},function(e){t("throw",e)})}catch(e){n("throw",e)}}function n(e,n){switch(e){case"return":i.resolve({value:n,done:!0});break;case"throw":i.reject(n);break;default:i.resolve({value:n,done:!1})}(i=i.next)?t(i.key,i.arg):o=null}var i,o;this._invoke=function(e,n){return new Promise(function(r,s){var l={key:e,arg:n,resolve:r,reject:s,next:null};o?o=o.next=l:(i=o=l,t(e,n))})},"function"!=typeof e.return&&(this.return=void 0)}function _OverloadYield(e,t){this.v=e,this.k=t}define("utils/trackModifiers",["require","exports","module"],function(e,t,n){function i(e,t,n,i){e==l.alt_key_pressed&&t==l.shift_key_pressed&&n==l.meta_key_pressed&&i==l.control_key_pressed||(l.alt_key_pressed=e,l.shift_key_pressed=t,l.meta_key_pressed=n,l.control_key_pressed=i,$(window).trigger("modifierschanged",l))}function o(e){if(e.getModifierState)i(e.getModifierState("Alt"),e.getModifierState("Shift"),e.getModifierState("Meta"),e.getModifierState("Control"));else{var t=e.altKey,n=e.shiftKey,o=e.metaKey||!e.metaKey&&e.altKey&&e.shiftKey,r=e.ctrlKey;"keyup"==e.type&&(16==e.keyCode&&n&&(n=!1),17==e.keyCode&&r&&(r=!1),18==e.keyCode&&t&&(t=!1)),i(t,n,o,r)}}function r(e){o(e)}function s(e){i(!1,!1,!1,!1)}var l={control_key_pressed:!1,alt_key_pressed:!1,shift_key_pressed:!1,meta_key_pressed:!1};return document.addEventListener("keydown",o,{capture:!0,passive:!0}),document.addEventListener("keyup",o,{capture:!0,passive:!0}),document.addEventListener("webkitvisibilitychange",s,!1),document.addEventListener("pointerdown",r,{capture:!0,passive:!0}),window.addEventListener("load",s,!1),window.addEventListener("focus",s,!1),window.addEventListener("blur",s,!1),l}),function(e){var t;if("function"==typeof define&&define.amd&&(define("js-cookie",e),t=!0),"object"==typeof exports&&(module.exports=e(),t=!0),!t){var n=window.Cookies,i=window.Cookies=e();i.noConflict=function(){return window.Cookies=n,i}}}(function(){function e(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var i in n)t[i]=n[i]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}function n(i){function o(){}function r(t,n,r){if("undefined"!=typeof document){r=e({path:"/"},o.defaults,r),"number"==typeof r.expires&&(r.expires=new Date(1*new Date+864e5*r.expires)),r.expires=r.expires?r.expires.toUTCString():"";try{var s=JSON.stringify(n);/^[\{\[]/.test(s)&&(n=s)}catch(e){}n=i.write?i.write(n,t):encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var l="";for(var a in r)r[a]&&(l+="; "+a,!0!==r[a]&&(l+="="+r[a].split(";")[0]));return document.cookie=t+"="+n+l}}function s(e,n){if("undefined"!=typeof document){for(var o={},r=document.cookie?document.cookie.split("; "):[],s=0;s<r.length;s++){var l=r[s].split("="),a=l.slice(1).join("=");n||'"'!==a.charAt(0)||(a=a.slice(1,-1));try{var u=t(l[0]);if(a=(i.read||i)(a,u)||t(a),n)try{a=JSON.parse(a)}catch(e){}if(o[u]=a,e===u)break}catch(e){}}return e?o[e]:o}}return o.set=r,o.get=function(e){return s(e,!1)},o.getJSON=function(e){return s(e,!0)},o.remove=function(t,n){r(t,"",e(n,{expires:-1}))},o.defaults={},o.withConverter=n,o}return n(function(){})}),function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(e,t){"use strict";function n(e,t){t=t||ne;var n=t.createElement("script");n.text=e,t.head.appendChild(n).parentNode.removeChild(n)}function i(e){var t=!!e&&"length"in e&&e.length,n=ge.type(e);return"function"!==n&&!ge.isWindow(e)&&("array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e)}function o(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}function r(e,t,n){return ge.isFunction(t)?ge.grep(e,function(e,i){return!!t.call(e,i,e)!==n}):t.nodeType?ge.grep(e,function(e){return e===t!==n}):"string"!=typeof t?ge.grep(e,function(e){return le.call(t,e)>-1!==n}):Se.test(t)?ge.filter(t,e,n):(t=ge.filter(t,e),ge.grep(e,function(e){return le.call(t,e)>-1!==n&&1===e.nodeType}))}function s(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}function l(e){var t={};return ge.each(e.match(Oe)||[],function(e,n){t[n]=!0}),t}function a(e){return e}function u(e){throw e}function d(e,t,n,i){var o;try{e&&ge.isFunction(o=e.promise)?o.call(e).done(t).fail(n):e&&ge.isFunction(o=e.then)?o.call(e,t,n):t.apply(void 0,[e].slice(i))}catch(e){n.apply(void 0,[e])}}function c(){ne.removeEventListener("DOMContentLoaded",c),e.removeEventListener("load",c),ge.ready()}function h(){this.expando=ge.expando+h.uid++}function p(e){return"true"===e||"false"!==e&&("null"===e?null:e===+e+""?+e:Me.test(e)?JSON.parse(e):e)}function f(e,t,n){var i;if(void 0===n&&1===e.nodeType)if(i="data-"+t.replace($e,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(i))){try{n=p(n)}catch(e){}De.set(e,t,n)}else n=void 0;return n}function g(e,t,n,i){var o,r=1,s=20,l=i?function(){return i.cur()}:function(){return ge.css(e,t,"")},a=l(),u=n&&n[3]||(ge.cssNumber[t]?"":"px"),d=(ge.cssNumber[t]||"px"!==u&&+a)&&je.exec(ge.css(e,t));if(d&&d[3]!==u){u=u||d[3],n=n||[],d=+a||1;do{r=r||".5",d/=r,ge.style(e,t,d+u)}while(r!==(r=l()/a)&&1!==r&&--s)}return n&&(d=+d||+a||0,o=n[1]?d+(n[1]+1)*n[2]:+n[2],i&&(i.unit=u,i.start=d,i.end=o)),o}function m(e){var t,n=e.ownerDocument,i=e.nodeName,o=Ve[i];return o||(t=n.body.appendChild(n.createElement(i)),o=ge.css(t,"display"),t.parentNode.removeChild(t),"none"===o&&(o="block"),Ve[i]=o,o)}function v(e,t){for(var n,i,o=[],r=0,s=e.length;r<s;r++)i=e[r],i.style&&(n=i.style.display,t?("none"===n&&(o[r]=Pe.get(i,"display")||null,o[r]||(i.style.display="")),""===i.style.display&&Ge(i)&&(o[r]=m(i))):"none"!==n&&(o[r]="none",Pe.set(i,"display",n)));for(r=0;r<s;r++)null!=o[r]&&(e[r].style.display=o[r]);return e}function y(e,t){var n;return n=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&o(e,t)?ge.merge([e],n):n}function b(e,t){for(var n=0,i=e.length;n<i;n++)Pe.set(e[n],"globalEval",!t||Pe.get(t[n],"globalEval"))}function w(e,t,n,i,o){for(var r,s,l,a,u,d,c=t.createDocumentFragment(),h=[],p=0,f=e.length;p<f;p++)if((r=e[p])||0===r)if("object"===ge.type(r))ge.merge(h,r.nodeType?[r]:r);else if(Ke.test(r)){for(s=s||c.appendChild(t.createElement("div")),l=(qe.exec(r)||["",""])[1].toLowerCase(),a=Ye[l]||Ye._default,s.innerHTML=a[1]+ge.htmlPrefilter(r)+a[2],d=a[0];d--;)s=s.lastChild;ge.merge(h,s.childNodes),s=c.firstChild,s.textContent=""}else h.push(t.createTextNode(r));for(c.textContent="",p=0;r=h[p++];)if(i&&ge.inArray(r,i)>-1)o&&o.push(r);else if(u=ge.contains(r.ownerDocument,r),s=y(c.appendChild(r),"script"),u&&b(s),n)for(d=0;r=s[d++];)We.test(r.type||"")&&n.push(r);return c}function _(){return!0}function x(){return!1}function E(){try{return ne.activeElement}catch(e){}}function A(e,t,n,i,o,r){var s,l;if("object"==typeof t){"string"!=typeof n&&(i=i||n,n=void 0);for(l in t)A(e,l,n,i,t[l],r);return e}if(null==i&&null==o?(o=n,i=n=void 0):null==o&&("string"==typeof n?(o=i,i=void 0):(o=i,i=n,n=void 0)),!1===o)o=x;else if(!o)return e;return 1===r&&(s=o,o=function(e){return ge().off(e),s.apply(this,arguments)},o.guid=s.guid||(s.guid=ge.guid++)),e.each(function(){ge.event.add(this,t,o,i,n)})}function S(e,t){return o(e,"table")&&o(11!==t.nodeType?t:t.firstChild,"tr")?ge(">tbody",e)[0]||e:e}function C(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function F(e){var t=it.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function k(e,t){var n,i,o,r,s,l,a,u;if(1===t.nodeType){if(Pe.hasData(e)&&(r=Pe.access(e),s=Pe.set(t,r),u=r.events)){delete s.handle,s.events={};for(o in u)for(n=0,i=u[o].length;n<i;n++)ge.event.add(t,o,u[o][n])}De.hasData(e)&&(l=De.access(e),a=ge.extend({},l),De.set(t,a))}}function T(e,t){var n=t.nodeName.toLowerCase();"input"===n&&Ue.test(e.type)?t.checked=e.checked:"input"!==n&&"textarea"!==n||(t.defaultValue=e.defaultValue)}function O(e,t,i,o){t=re.apply([],t);var r,s,l,a,u,d,c=0,h=e.length,p=h-1,f=t[0],g=ge.isFunction(f);if(g||h>1&&"string"==typeof f&&!pe.checkClone&&nt.test(f))return e.each(function(n){var r=e.eq(n);g&&(t[0]=f.call(this,n,r.html())),O(r,t,i,o)});if(h&&(r=w(t,e[0].ownerDocument,!1,e,o),s=r.firstChild,1===r.childNodes.length&&(r=s),s||o)){for(l=ge.map(y(r,"script"),C),a=l.length;c<h;c++)u=r,c!==p&&(u=ge.clone(u,!0,!0),a&&ge.merge(l,y(u,"script"))),i.call(e[c],u,c);if(a)for(d=l[l.length-1].ownerDocument,ge.map(l,F),c=0;c<a;c++)u=l[c],We.test(u.type||"")&&!Pe.access(u,"globalEval")&&ge.contains(d,u)&&(u.src?ge._evalUrl&&ge._evalUrl(u.src):n(u.textContent.replace(ot,""),d))}return e}function N(e,t,n){for(var i,o=t?ge.filter(t,e):e,r=0;null!=(i=o[r]);r++)n||1!==i.nodeType||ge.cleanData(y(i)),i.parentNode&&(n&&ge.contains(i.ownerDocument,i)&&b(y(i,"script")),i.parentNode.removeChild(i));return e}function I(e,t,n){var i,o,r,s,l=e.style;return n=n||lt(e),n&&(s=n.getPropertyValue(t)||n[t],""!==s||ge.contains(e.ownerDocument,e)||(s=ge.style(e,t)),!pe.pixelMarginRight()&&st.test(s)&&rt.test(t)&&(i=l.width,o=l.minWidth,r=l.maxWidth,l.minWidth=l.maxWidth=l.width=s,s=n.width,l.width=i,l.minWidth=o,l.maxWidth=r)),void 0!==s?s+"":s}function L(e,t){return{get:function(){return e()?void delete this.get:(this.get=t).apply(this,arguments)}}}function R(e){if(e in pt)return e;for(var t=e[0].toUpperCase()+e.slice(1),n=ht.length;n--;)if((e=ht[n]+t)in pt)return e}function P(e){var t=ge.cssProps[e];return t||(t=ge.cssProps[e]=R(e)||e),t}function D(e,t,n){var i=je.exec(t);return i?Math.max(0,i[2]-(n||0))+(i[3]||"px"):t}function M(e,t,n,i,o){var r,s=0;for(r=n===(i?"border":"content")?4:"width"===t?1:0;r<4;r+=2)"margin"===n&&(s+=ge.css(e,n+He[r],!0,o)),i?("content"===n&&(s-=ge.css(e,"padding"+He[r],!0,o)),"margin"!==n&&(s-=ge.css(e,"border"+He[r]+"Width",!0,o))):(s+=ge.css(e,"padding"+He[r],!0,o),"padding"!==n&&(s+=ge.css(e,"border"+He[r]+"Width",!0,o)));return s}function $(e,t,n){var i,o=lt(e),r=I(e,t,o),s="border-box"===ge.css(e,"boxSizing",!1,o);return st.test(r)?r:(i=s&&(pe.boxSizingReliable()||r===e.style[t]),"auto"===r&&(r=e["offset"+t[0].toUpperCase()+t.slice(1)]),(r=parseFloat(r)||0)+M(e,t,n||(s?"border":"content"),i,o)+"px")}function B(e,t,n,i,o){return new B.prototype.init(e,t,n,i,o)}function j(){gt&&(!1===ne.hidden&&e.requestAnimationFrame?e.requestAnimationFrame(j):e.setTimeout(j,ge.fx.interval),ge.fx.tick())}function H(){return e.setTimeout(function(){ft=void 0}),ft=ge.now()}function G(e,t){var n,i=0,o={height:e};for(t=t?1:0;i<4;i+=2-t)n=He[i],o["margin"+n]=o["padding"+n]=e;return t&&(o.opacity=o.width=e),o}function z(e,t,n){for(var i,o=(q.tweeners[t]||[]).concat(q.tweeners["*"]),r=0,s=o.length;r<s;r++)if(i=o[r].call(n,t,e))return i}function V(e,t,n){var i,o,r,s,l,a,u,d,c="width"in t||"height"in t,h=this,p={},f=e.style,g=e.nodeType&&Ge(e),m=Pe.get(e,"fxshow");n.queue||(s=ge._queueHooks(e,"fx"),null==s.unqueued&&(s.unqueued=0,l=s.empty.fire,s.empty.fire=function(){s.unqueued||l()}),s.unqueued++,h.always(function(){h.always(function(){s.unqueued--,ge.queue(e,"fx").length||s.empty.fire()})}));for(i in t)if(o=t[i],mt.test(o)){if(delete t[i],r=r||"toggle"===o,o===(g?"hide":"show")){if("show"!==o||!m||void 0===m[i])continue;g=!0}p[i]=m&&m[i]||ge.style(e,i)}if((a=!ge.isEmptyObject(t))||!ge.isEmptyObject(p)){c&&1===e.nodeType&&(n.overflow=[f.overflow,f.overflowX,f.overflowY],u=m&&m.display,null==u&&(u=Pe.get(e,"display")),d=ge.css(e,"display"),"none"===d&&(u?d=u:(v([e],!0),u=e.style.display||u,d=ge.css(e,"display"),v([e]))),("inline"===d||"inline-block"===d&&null!=u)&&"none"===ge.css(e,"float")&&(a||(h.done(function(){f.display=u}),null==u&&(d=f.display,u="none"===d?"":d)),f.display="inline-block")),n.overflow&&(f.overflow="hidden",h.always(function(){f.overflow=n.overflow[0],f.overflowX=n.overflow[1],f.overflowY=n.overflow[2]})),a=!1;for(i in p)a||(m?"hidden"in m&&(g=m.hidden):m=Pe.access(e,"fxshow",{display:u}),r&&(m.hidden=!g),g&&v([e],!0),h.done(function(){g||v([e]),Pe.remove(e,"fxshow");for(i in p)ge.style(e,i,p[i])})),a=z(g?m[i]:0,i,h),i in m||(m[i]=a.start,g&&(a.end=a.start,a.start=0))}}function U(e,t){var n,i,o,r,s;for(n in e)if(i=ge.camelCase(n),o=t[i],r=e[n],Array.isArray(r)&&(o=r[1],r=e[n]=r[0]),n!==i&&(e[i]=r,delete e[n]),(s=ge.cssHooks[i])&&"expand"in s){r=s.expand(r),delete e[i];for(n in r)n in e||(e[n]=r[n],t[n]=o)}else t[i]=o}function q(e,t,n){var i,o,r=0,s=q.prefilters.length,l=ge.Deferred().always(function(){delete a.elem}),a=function(){if(o)return!1;for(var t=ft||H(),n=Math.max(0,u.startTime+u.duration-t),i=n/u.duration||0,r=1-i,s=0,a=u.tweens.length;s<a;s++)u.tweens[s].run(r);return l.notifyWith(e,[u,r,n]),r<1&&a?n:(a||l.notifyWith(e,[u,1,0]),l.resolveWith(e,[u]),!1)},u=l.promise({elem:e,props:ge.extend({},t),opts:ge.extend(!0,{specialEasing:{},easing:ge.easing._default},n),originalProperties:t,originalOptions:n,startTime:ft||H(),duration:n.duration,tweens:[],createTween:function(t,n){var i=ge.Tween(e,u.opts,t,n,u.opts.specialEasing[t]||u.opts.easing);return u.tweens.push(i),i},stop:function(t){var n=0,i=t?u.tweens.length:0;if(o)return this;for(o=!0;n<i;n++)u.tweens[n].run(1);return t?(l.notifyWith(e,[u,1,0]),l.resolveWith(e,[u,t])):l.rejectWith(e,[u,t]),this}}),d=u.props;for(U(d,u.opts.specialEasing);r<s;r++)if(i=q.prefilters[r].call(u,e,d,u.opts))return ge.isFunction(i.stop)&&(ge._queueHooks(u.elem,u.opts.queue).stop=ge.proxy(i.stop,i)),i;return ge.map(d,z,u),ge.isFunction(u.opts.start)&&u.opts.start.call(e,u),u.progress(u.opts.progress).done(u.opts.done,u.opts.complete).fail(u.opts.fail).always(u.opts.always),ge.fx.timer(ge.extend(a,{elem:e,anim:u,queue:u.opts.queue})),u}function W(e){return(e.match(Oe)||[]).join(" ")}function Y(e){return e.getAttribute&&e.getAttribute("class")||""}function K(e,t,n,i){var o;if(Array.isArray(t))ge.each(t,function(t,o){n||Ft.test(e)?i(e,o):K(e+"["+("object"==typeof o&&null!=o?t:"")+"]",o,n,i)});else if(n||"object"!==ge.type(t))i(e,t);else for(o in t)K(e+"["+o+"]",t[o],n,i)}function X(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var i,o=0,r=t.toLowerCase().match(Oe)||[];if(ge.isFunction(n))for(;i=r[o++];)"+"===i[0]?(i=i.slice(1)||"*",(e[i]=e[i]||[]).unshift(n)):(e[i]=e[i]||[]).push(n)}}function J(e,t,n,i){function o(l){var a;return r[l]=!0,ge.each(e[l]||[],function(e,l){var u=l(t,n,i);return"string"!=typeof u||s||r[u]?s?!(a=u):void 0:(t.dataTypes.unshift(u),o(u),!1)}),a}var r={},s=e===Bt;return o(t.dataTypes[0])||!r["*"]&&o("*")}function Q(e,t){var n,i,o=ge.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((o[n]?e:i||(i={}))[n]=t[n]);return i&&ge.extend(!0,e,i),e}function Z(e,t,n){for(var i,o,r,s,l=e.contents,a=e.dataTypes;"*"===a[0];)a.shift(),void 0===i&&(i=e.mimeType||t.getResponseHeader("Content-Type"));if(i)for(o in l)if(l[o]&&l[o].test(i)){a.unshift(o);break}if(a[0]in n)r=a[0];else{for(o in n){if(!a[0]||e.converters[o+" "+a[0]]){r=o;break}s||(s=o)}r=r||s}if(r)return r!==a[0]&&a.unshift(r),n[r]}function ee(e,t,n,i){var o,r,s,l,a,u={},d=e.dataTypes.slice();if(d[1])for(s in e.converters)u[s.toLowerCase()]=e.converters[s];for(r=d.shift();r;)if(e.responseFields[r]&&(n[e.responseFields[r]]=t),!a&&i&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),a=r,r=d.shift())if("*"===r)r=a;else if("*"!==a&&a!==r){if(!(s=u[a+" "+r]||u["* "+r]))for(o in u)if(l=o.split(" "),l[1]===r&&(s=u[a+" "+l[0]]||u["* "+l[0]])){!0===s?s=u[o]:!0!==u[o]&&(r=l[0],d.unshift(l[1]));break}if(!0!==s)if(s&&e.throws)t=s(t);else try{t=s(t)}catch(e){return{state:"parsererror",error:s?e:"No conversion from "+a+" to "+r}}}return{state:"success",data:t}}var te=[],ne=e.document,ie=Object.getPrototypeOf,oe=te.slice,re=te.concat,se=te.push,le=te.indexOf,ae={},ue=ae.toString,de=ae.hasOwnProperty,ce=de.toString,he=ce.call(Object),pe={},fe="3.2.1",ge=function(e,t){return new ge.fn.init(e,t)},me=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,ve=/^-ms-/,ye=/-([a-z])/g,be=function(e,t){return t.toUpperCase()};ge.fn=ge.prototype={jquery:fe,constructor:ge,length:0,toArray:function(){return oe.call(this)},get:function(e){return null==e?oe.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=ge.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return ge.each(this,e)},map:function(e){return this.pushStack(ge.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(oe.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:se,sort:te.sort,splice:te.splice},ge.extend=ge.fn.extend=function(){var e,t,n,i,o,r,s=arguments[0]||{},l=1,a=arguments.length,u=!1;for("boolean"==typeof s&&(u=s,s=arguments[l]||{},l++),"object"==typeof s||ge.isFunction(s)||(s={}),l===a&&(s=this,l--);l<a;l++)if(null!=(e=arguments[l]))for(t in e)n=s[t],i=e[t],s!==i&&(u&&i&&(ge.isPlainObject(i)||(o=Array.isArray(i)))?(o?(o=!1,r=n&&Array.isArray(n)?n:[]):r=n&&ge.isPlainObject(n)?n:{},s[t]=ge.extend(u,r,i)):void 0!==i&&(s[t]=i));return s},ge.extend({expando:"jQuery"+(fe+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===ge.type(e)},isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){var t=ge.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==ue.call(e)||(t=ie(e))&&("function"!=typeof(n=de.call(t,"constructor")&&t.constructor)||ce.call(n)!==he))},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?ae[ue.call(e)]||"object":typeof e},globalEval:function(e){n(e)},camelCase:function(e){return e.replace(ve,"ms-").replace(ye,be)},each:function(e,t){var n,o=0;if(i(e))for(n=e.length;o<n&&!1!==t.call(e[o],o,e[o]);o++);else for(o in e)if(!1===t.call(e[o],o,e[o]))break;return e},trim:function(e){return null==e?"":(e+"").replace(me,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(i(Object(e))?ge.merge(n,"string"==typeof e?[e]:e):se.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:le.call(t,e,n)},merge:function(e,t){for(var n=+t.length,i=0,o=e.length;i<n;i++)e[o++]=t[i];return e.length=o,e},grep:function(e,t,n){for(var i=[],o=0,r=e.length,s=!n;o<r;o++)!t(e[o],o)!==s&&i.push(e[o]);return i},map:function(e,t,n){var o,r,s=0,l=[];if(i(e))for(o=e.length;s<o;s++)null!=(r=t(e[s],s,n))&&l.push(r);else for(s in e)null!=(r=t(e[s],s,n))&&l.push(r);return re.apply([],l)},guid:1,proxy:function(e,t){var n,i,o;if("string"==typeof t&&(n=e[t],t=e,e=n),ge.isFunction(e))return i=oe.call(arguments,2),o=function(){return e.apply(t||this,i.concat(oe.call(arguments)))},o.guid=e.guid=e.guid||ge.guid++,o},now:Date.now,support:pe}),"function"==typeof Symbol&&(ge.fn[Symbol.iterator]=te[Symbol.iterator]),ge.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){ae["[object "+t+"]"]=t.toLowerCase()});var we=function(e){function t(e,t,n,i){var o,r,s,l,a,d,h,p=t&&t.ownerDocument,f=t?t.nodeType:9;if(n=n||[],"string"!=typeof e||!e||1!==f&&9!==f&&11!==f)return n;if(!i&&((t?t.ownerDocument||t:B)!==N&&O(t),t=t||N,L)){if(11!==f&&(a=ge.exec(e)))if(o=a[1]){if(9===f){if(!(s=t.getElementById(o)))return n;if(s.id===o)return n.push(s),n}else if(p&&(s=p.getElementById(o))&&M(t,s)&&s.id===o)return n.push(s),n}else{if(a[2])return X.apply(n,t.getElementsByTagName(e)),n;if((o=a[3])&&w.getElementsByClassName&&t.getElementsByClassName)return X.apply(n,t.getElementsByClassName(o)),n}if(w.qsa&&!V[e+" "]&&(!R||!R.test(e))){if(1!==f)p=t,h=e;else if("object"!==t.nodeName.toLowerCase()){for((l=t.getAttribute("id"))?l=l.replace(be,we):t.setAttribute("id",l=$),d=A(e),r=d.length;r--;)d[r]="#"+l+" "+c(d[r]);h=d.join(","),p=me.test(e)&&u(t.parentNode)||t}if(h)try{return X.apply(n,p.querySelectorAll(h)),n}catch(e){}finally{l===$&&t.removeAttribute("id")}}}return C(e.replace(re,"$1"),t,n,i)}function n(){function e(n,i){return t.push(n+" ")>_.cacheLength&&delete e[t.shift()],e[n+" "]=i}var t=[];return e}function i(e){return e[$]=!0,e}function o(e){var t=N.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function r(e,t){for(var n=e.split("|"),i=n.length;i--;)_.attrHandle[n[i]]=t}function s(e,t){var n=t&&e,i=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(i)return i;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function l(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&xe(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function a(e){return i(function(t){return t=+t,i(function(n,i){for(var o,r=e([],n.length,t),s=r.length;s--;)n[o=r[s]]&&(n[o]=!(i[o]=n[o]))})})}function u(e){return e&&void 0!==e.getElementsByTagName&&e}function d(){}function c(e){for(var t=0,n=e.length,i="";t<n;t++)i+=e[t].value;return i}function h(e,t,n){var i=t.dir,o=t.next,r=o||i,s=n&&"parentNode"===r,l=H++;return t.first?function(t,n,o){for(;t=t[i];)if(1===t.nodeType||s)return e(t,n,o);return!1}:function(t,n,a){var u,d,c,h=[j,l];if(a){for(;t=t[i];)if((1===t.nodeType||s)&&e(t,n,a))return!0}else for(;t=t[i];)if(1===t.nodeType||s)if(c=t[$]||(t[$]={}),d=c[t.uniqueID]||(c[t.uniqueID]={}),o&&o===t.nodeName.toLowerCase())t=t[i]||t;else{if((u=d[r])&&u[0]===j&&u[1]===l)return h[2]=u[2];if(d[r]=h,h[2]=e(t,n,a))return!0}return!1}}function p(e){return e.length>1?function(t,n,i){for(var o=e.length;o--;)if(!e[o](t,n,i))return!1;return!0}:e[0]}function f(e,n,i){for(var o=0,r=n.length;o<r;o++)t(e,n[o],i);return i}function g(e,t,n,i,o){for(var r,s=[],l=0,a=e.length,u=null!=t;l<a;l++)(r=e[l])&&(n&&!n(r,i,o)||(s.push(r),u&&t.push(l)));return s}function m(e,t,n,o,r,s){return o&&!o[$]&&(o=m(o)),r&&!r[$]&&(r=m(r,s)),i(function(i,s,l,a){var u,d,c,h=[],p=[],m=s.length,v=i||f(t||"*",l.nodeType?[l]:l,[]),y=!e||!i&&t?v:g(v,h,e,l,a),b=n?r||(i?e:m||o)?[]:s:y;if(n&&n(y,b,l,a),o)for(u=g(b,p),o(u,[],l,a),d=u.length;d--;)(c=u[d])&&(b[p[d]]=!(y[p[d]]=c));if(i){if(r||e){if(r){for(u=[],d=b.length;d--;)(c=b[d])&&u.push(y[d]=c);r(null,b=[],u,a)}for(d=b.length;d--;)(c=b[d])&&(u=r?Q(i,c):h[d])>-1&&(i[u]=!(s[u]=c))}}else b=g(b===s?b.splice(m,b.length):b),r?r(null,s,b,a):X.apply(s,b)})}function v(e){for(var t,n,i,o=e.length,r=_.relative[e[0].type],s=r||_.relative[" "],l=r?1:0,a=h(function(e){return e===t},s,!0),u=h(function(e){return Q(t,e)>-1},s,!0),d=[function(e,n,i){var o=!r&&(i||n!==F)||((t=n).nodeType?a(e,n,i):u(e,n,i));return t=null,o}];l<o;l++)if(n=_.relative[e[l].type])d=[h(p(d),n)];else{if(n=_.filter[e[l].type].apply(null,e[l].matches),n[$]){for(i=++l;i<o&&!_.relative[e[i].type];i++);return m(l>1&&p(d),l>1&&c(e.slice(0,l-1).concat({value:" "===e[l-2].type?"*":""})).replace(re,"$1"),n,l<i&&v(e.slice(l,i)),i<o&&v(e=e.slice(i)),i<o&&c(e))}d.push(n)}return p(d)}function y(e,n){var o=n.length>0,r=e.length>0,s=function(i,s,l,a,u){var d,c,h,p=0,f="0",m=i&&[],v=[],y=F,b=i||r&&_.find.TAG("*",u),w=j+=null==y?1:Math.random()||.1,x=b.length;for(u&&(F=s===N||s||u);f!==x&&null!=(d=b[f]);f++){if(r&&d){for(c=0,s||d.ownerDocument===N||(O(d),l=!L);h=e[c++];)if(h(d,s||N,l)){a.push(d);break}u&&(j=w)}o&&((d=!h&&d)&&p--,i&&m.push(d))}if(p+=f,o&&f!==p){for(c=0;h=n[c++];)h(m,v,s,l);if(i){if(p>0)for(;f--;)m[f]||v[f]||(v[f]=Y.call(a));v=g(v)}X.apply(a,v),u&&!i&&v.length>0&&p+n.length>1&&t.uniqueSort(a)}return u&&(j=w,F=y),m};return o?i(s):s}var b,w,_,x,E,A,S,C,F,k,T,O,N,I,L,R,P,D,M,$="sizzle"+1*new Date,B=e.document,j=0,H=0,G=n(),z=n(),V=n(),U=function(e,t){return e===t&&(T=!0),0},q={}.hasOwnProperty,W=[],Y=W.pop,K=W.push,X=W.push,J=W.slice,Q=function(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1},Z="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ee="[\\x20\\t\\r\\n\\f]",te="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",ne="\\["+ee+"*("+te+")(?:"+ee+"*([*^$|!~]?=)"+ee+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+te+"))|)"+ee+"*\\]",ie=":("+te+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+ne+")*)|.*)\\)|)",oe=new RegExp(ee+"+","g"),re=new RegExp("^"+ee+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ee+"+$","g"),se=new RegExp("^"+ee+"*,"+ee+"*"),le=new RegExp("^"+ee+"*([>+~]|"+ee+")"+ee+"*"),ae=new RegExp("="+ee+"*([^\\]'\"]*?)"+ee+"*\\]","g"),ue=new RegExp(ie),de=new RegExp("^"+te+"$"),ce={ID:new RegExp("^#("+te+")"),CLASS:new RegExp("^\\.("+te+")"),TAG:new RegExp("^("+te+"|[*])"),ATTR:new RegExp("^"+ne),PSEUDO:new RegExp("^"+ie),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ee+"*(even|odd|(([+-]|)(\\d*)n|)"+ee+"*(?:([+-]|)"+ee+"*(\\d+)|))"+ee+"*\\)|)","i"),bool:new RegExp("^(?:"+Z+")$","i"),needsContext:new RegExp("^"+ee+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ee+"*((?:-\\d)?\\d*)"+ee+"*\\)|)(?=[^-]|$)","i")},he=/^(?:input|select|textarea|button)$/i,pe=/^h\d$/i,fe=/^[^{]+\{\s*\[native \w/,ge=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,me=/[+~]/,ve=new RegExp("\\\\([\\da-f]{1,6}"+ee+"?|("+ee+")|.)","ig"),ye=function(e,t,n){var i="0x"+t-65536;return i!==i||n?t:i<0?String.fromCharCode(i+65536):String.fromCharCode(i>>10|55296,1023&i|56320)},be=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,we=function(e,t){return t?"\0"===e?"�":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},_e=function(){O()},xe=h(function(e){return!0===e.disabled&&("form"in e||"label"in e)},{dir:"parentNode",next:"legend"});try{X.apply(W=J.call(B.childNodes),B.childNodes),W[B.childNodes.length].nodeType}catch(e){X={apply:W.length?function(e,t){K.apply(e,J.call(t))}:function(e,t){for(var n=e.length,i=0;e[n++]=t[i++];);e.length=n-1}}}w=t.support={},E=t.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName},O=t.setDocument=function(e){var t,n,i=e?e.ownerDocument||e:B;return i!==N&&9===i.nodeType&&i.documentElement?(N=i,I=N.documentElement,L=!E(N),B!==N&&(n=N.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",_e,!1):n.attachEvent&&n.attachEvent("onunload",_e)),w.attributes=o(function(e){return e.className="i",!e.getAttribute("className")}),w.getElementsByTagName=o(function(e){return e.appendChild(N.createComment("")),!e.getElementsByTagName("*").length}),w.getElementsByClassName=fe.test(N.getElementsByClassName),w.getById=o(function(e){return I.appendChild(e).id=$,!N.getElementsByName||!N.getElementsByName($).length}),w.getById?(_.filter.ID=function(e){var t=e.replace(ve,ye);return function(e){return e.getAttribute("id")===t}},_.find.ID=function(e,t){
if(void 0!==t.getElementById&&L){var n=t.getElementById(e);return n?[n]:[]}}):(_.filter.ID=function(e){var t=e.replace(ve,ye);return function(e){var n=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}},_.find.ID=function(e,t){if(void 0!==t.getElementById&&L){var n,i,o,r=t.getElementById(e);if(r){if((n=r.getAttributeNode("id"))&&n.value===e)return[r];for(o=t.getElementsByName(e),i=0;r=o[i++];)if((n=r.getAttributeNode("id"))&&n.value===e)return[r]}return[]}}),_.find.TAG=w.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):w.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,i=[],o=0,r=t.getElementsByTagName(e);if("*"===e){for(;n=r[o++];)1===n.nodeType&&i.push(n);return i}return r},_.find.CLASS=w.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&L)return t.getElementsByClassName(e)},P=[],R=[],(w.qsa=fe.test(N.querySelectorAll))&&(o(function(e){I.appendChild(e).innerHTML="<a id='"+$+"'></a><select id='"+$+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&R.push("[*^$]="+ee+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||R.push("\\["+ee+"*(?:value|"+Z+")"),e.querySelectorAll("[id~="+$+"-]").length||R.push("~="),e.querySelectorAll(":checked").length||R.push(":checked"),e.querySelectorAll("a#"+$+"+*").length||R.push(".#.+[+~]")}),o(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=N.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&R.push("name"+ee+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&R.push(":enabled",":disabled"),I.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&R.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),R.push(",.*:")})),(w.matchesSelector=fe.test(D=I.matches||I.webkitMatchesSelector||I.mozMatchesSelector||I.oMatchesSelector||I.msMatchesSelector))&&o(function(e){w.disconnectedMatch=D.call(e,"*"),D.call(e,"[s!='']:x"),P.push("!=",ie)}),R=R.length&&new RegExp(R.join("|")),P=P.length&&new RegExp(P.join("|")),t=fe.test(I.compareDocumentPosition),M=t||fe.test(I.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,i=t&&t.parentNode;return e===i||!(!i||1!==i.nodeType||!(n.contains?n.contains(i):e.compareDocumentPosition&&16&e.compareDocumentPosition(i)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},U=t?function(e,t){if(e===t)return T=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(n=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&n||!w.sortDetached&&t.compareDocumentPosition(e)===n?e===N||e.ownerDocument===B&&M(B,e)?-1:t===N||t.ownerDocument===B&&M(B,t)?1:k?Q(k,e)-Q(k,t):0:4&n?-1:1)}:function(e,t){if(e===t)return T=!0,0;var n,i=0,o=e.parentNode,r=t.parentNode,l=[e],a=[t];if(!o||!r)return e===N?-1:t===N?1:o?-1:r?1:k?Q(k,e)-Q(k,t):0;if(o===r)return s(e,t);for(n=e;n=n.parentNode;)l.unshift(n);for(n=t;n=n.parentNode;)a.unshift(n);for(;l[i]===a[i];)i++;return i?s(l[i],a[i]):l[i]===B?-1:a[i]===B?1:0},N):N},t.matches=function(e,n){return t(e,null,null,n)},t.matchesSelector=function(e,n){if((e.ownerDocument||e)!==N&&O(e),n=n.replace(ae,"='$1']"),w.matchesSelector&&L&&!V[n+" "]&&(!P||!P.test(n))&&(!R||!R.test(n)))try{var i=D.call(e,n);if(i||w.disconnectedMatch||e.document&&11!==e.document.nodeType)return i}catch(e){}return t(n,N,null,[e]).length>0},t.contains=function(e,t){return(e.ownerDocument||e)!==N&&O(e),M(e,t)},t.attr=function(e,t){(e.ownerDocument||e)!==N&&O(e);var n=_.attrHandle[t.toLowerCase()],i=n&&q.call(_.attrHandle,t.toLowerCase())?n(e,t,!L):void 0;return void 0!==i?i:w.attributes||!L?e.getAttribute(t):(i=e.getAttributeNode(t))&&i.specified?i.value:null},t.escape=function(e){return(e+"").replace(be,we)},t.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},t.uniqueSort=function(e){var t,n=[],i=0,o=0;if(T=!w.detectDuplicates,k=!w.sortStable&&e.slice(0),e.sort(U),T){for(;t=e[o++];)t===e[o]&&(i=n.push(o));for(;i--;)e.splice(n[i],1)}return k=null,e},x=t.getText=function(e){var t,n="",i=0,o=e.nodeType;if(o){if(1===o||9===o||11===o){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=x(e)}else if(3===o||4===o)return e.nodeValue}else for(;t=e[i++];)n+=x(t);return n},_=t.selectors={cacheLength:50,createPseudo:i,match:ce,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(ve,ye),e[3]=(e[3]||e[4]||e[5]||"").replace(ve,ye),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||t.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&t.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return ce.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&ue.test(n)&&(t=A(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(ve,ye).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=G[e+" "];return t||(t=new RegExp("(^|"+ee+")"+e+"("+ee+"|$)"))&&G(e,function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,n,i){return function(o){var r=t.attr(o,e);return null==r?"!="===n:!n||(r+="","="===n?r===i:"!="===n?r!==i:"^="===n?i&&0===r.indexOf(i):"*="===n?i&&r.indexOf(i)>-1:"$="===n?i&&r.slice(-i.length)===i:"~="===n?(" "+r.replace(oe," ")+" ").indexOf(i)>-1:"|="===n&&(r===i||r.slice(0,i.length+1)===i+"-"))}},CHILD:function(e,t,n,i,o){var r="nth"!==e.slice(0,3),s="last"!==e.slice(-4),l="of-type"===t;return 1===i&&0===o?function(e){return!!e.parentNode}:function(t,n,a){var u,d,c,h,p,f,g=r!==s?"nextSibling":"previousSibling",m=t.parentNode,v=l&&t.nodeName.toLowerCase(),y=!a&&!l,b=!1;if(m){if(r){for(;g;){for(h=t;h=h[g];)if(l?h.nodeName.toLowerCase()===v:1===h.nodeType)return!1;f=g="only"===e&&!f&&"nextSibling"}return!0}if(f=[s?m.firstChild:m.lastChild],s&&y){for(h=m,c=h[$]||(h[$]={}),d=c[h.uniqueID]||(c[h.uniqueID]={}),u=d[e]||[],p=u[0]===j&&u[1],b=p&&u[2],h=p&&m.childNodes[p];h=++p&&h&&h[g]||(b=p=0)||f.pop();)if(1===h.nodeType&&++b&&h===t){d[e]=[j,p,b];break}}else if(y&&(h=t,c=h[$]||(h[$]={}),d=c[h.uniqueID]||(c[h.uniqueID]={}),u=d[e]||[],p=u[0]===j&&u[1],b=p),!1===b)for(;(h=++p&&h&&h[g]||(b=p=0)||f.pop())&&((l?h.nodeName.toLowerCase()!==v:1!==h.nodeType)||!++b||(y&&(c=h[$]||(h[$]={}),d=c[h.uniqueID]||(c[h.uniqueID]={}),d[e]=[j,b]),h!==t)););return(b-=o)===i||b%i==0&&b/i>=0}}},PSEUDO:function(e,n){var o,r=_.pseudos[e]||_.setFilters[e.toLowerCase()]||t.error("unsupported pseudo: "+e);return r[$]?r(n):r.length>1?(o=[e,e,"",n],_.setFilters.hasOwnProperty(e.toLowerCase())?i(function(e,t){for(var i,o=r(e,n),s=o.length;s--;)i=Q(e,o[s]),e[i]=!(t[i]=o[s])}):function(e){return r(e,0,o)}):r}},pseudos:{not:i(function(e){var t=[],n=[],o=S(e.replace(re,"$1"));return o[$]?i(function(e,t,n,i){for(var r,s=o(e,null,i,[]),l=e.length;l--;)(r=s[l])&&(e[l]=!(t[l]=r))}):function(e,i,r){return t[0]=e,o(t,null,r,n),t[0]=null,!n.pop()}}),has:i(function(e){return function(n){return t(e,n).length>0}}),contains:i(function(e){return e=e.replace(ve,ye),function(t){return(t.textContent||t.innerText||x(t)).indexOf(e)>-1}}),lang:i(function(e){return de.test(e||"")||t.error("unsupported lang: "+e),e=e.replace(ve,ye).toLowerCase(),function(t){var n;do{if(n=L?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(n=n.toLowerCase())===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===I},focus:function(e){return e===N.activeElement&&(!N.hasFocus||N.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:l(!1),disabled:l(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!_.pseudos.empty(e)},header:function(e){return pe.test(e.nodeName)},input:function(e){return he.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:a(function(){return[0]}),last:a(function(e,t){return[t-1]}),eq:a(function(e,t,n){return[n<0?n+t:n]}),even:a(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:a(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:a(function(e,t,n){for(var i=n<0?n+t:n;--i>=0;)e.push(i);return e}),gt:a(function(e,t,n){for(var i=n<0?n+t:n;++i<t;)e.push(i);return e})}},_.pseudos.nth=_.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})_.pseudos[b]=function(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}(b);for(b in{submit:!0,reset:!0})_.pseudos[b]=function(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}(b);return d.prototype=_.filters=_.pseudos,_.setFilters=new d,A=t.tokenize=function(e,n){var i,o,r,s,l,a,u,d=z[e+" "];if(d)return n?0:d.slice(0);for(l=e,a=[],u=_.preFilter;l;){i&&!(o=se.exec(l))||(o&&(l=l.slice(o[0].length)||l),a.push(r=[])),i=!1,(o=le.exec(l))&&(i=o.shift(),r.push({value:i,type:o[0].replace(re," ")}),l=l.slice(i.length));for(s in _.filter)!(o=ce[s].exec(l))||u[s]&&!(o=u[s](o))||(i=o.shift(),r.push({value:i,type:s,matches:o}),l=l.slice(i.length));if(!i)break}return n?l.length:l?t.error(e):z(e,a).slice(0)},S=t.compile=function(e,t){var n,i=[],o=[],r=V[e+" "];if(!r){for(t||(t=A(e)),n=t.length;n--;)r=v(t[n]),r[$]?i.push(r):o.push(r);r=V(e,y(o,i)),r.selector=e}return r},C=t.select=function(e,t,n,i){var o,r,s,l,a,d="function"==typeof e&&e,h=!i&&A(e=d.selector||e);if(n=n||[],1===h.length){if(r=h[0]=h[0].slice(0),r.length>2&&"ID"===(s=r[0]).type&&9===t.nodeType&&L&&_.relative[r[1].type]){if(!(t=(_.find.ID(s.matches[0].replace(ve,ye),t)||[])[0]))return n;d&&(t=t.parentNode),e=e.slice(r.shift().value.length)}for(o=ce.needsContext.test(e)?0:r.length;o--&&(s=r[o],!_.relative[l=s.type]);)if((a=_.find[l])&&(i=a(s.matches[0].replace(ve,ye),me.test(r[0].type)&&u(t.parentNode)||t))){if(r.splice(o,1),!(e=i.length&&c(r)))return X.apply(n,i),n;break}}return(d||S(e,h))(i,t,!L,n,!t||me.test(e)&&u(t.parentNode)||t),n},w.sortStable=$.split("").sort(U).join("")===$,w.detectDuplicates=!!T,O(),w.sortDetached=o(function(e){return 1&e.compareDocumentPosition(N.createElement("fieldset"))}),o(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||r("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),w.attributes&&o(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||r("value",function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),o(function(e){return null==e.getAttribute("disabled")})||r(Z,function(e,t,n){var i;if(!n)return!0===e[t]?t.toLowerCase():(i=e.getAttributeNode(t))&&i.specified?i.value:null}),t}(e);ge.find=we,ge.expr=we.selectors,ge.expr[":"]=ge.expr.pseudos,ge.uniqueSort=ge.unique=we.uniqueSort,ge.text=we.getText,ge.isXMLDoc=we.isXML,ge.contains=we.contains,ge.escapeSelector=we.escape;var _e=function(e,t,n){for(var i=[],o=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(o&&ge(e).is(n))break;i.push(e)}return i},xe=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},Ee=ge.expr.match.needsContext,Ae=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i,Se=/^.[^:#\[\.,]*$/;ge.filter=function(e,t,n){var i=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===i.nodeType?ge.find.matchesSelector(i,e)?[i]:[]:ge.find.matches(e,ge.grep(t,function(e){return 1===e.nodeType}))},ge.fn.extend({find:function(e){var t,n,i=this.length,o=this;if("string"!=typeof e)return this.pushStack(ge(e).filter(function(){for(t=0;t<i;t++)if(ge.contains(o[t],this))return!0}));for(n=this.pushStack([]),t=0;t<i;t++)ge.find(e,o[t],n);return i>1?ge.uniqueSort(n):n},filter:function(e){return this.pushStack(r(this,e||[],!1))},not:function(e){return this.pushStack(r(this,e||[],!0))},is:function(e){return!!r(this,"string"==typeof e&&Ee.test(e)?ge(e):e||[],!1).length}});var Ce,Fe=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(ge.fn.init=function(e,t,n){var i,o;if(!e)return this;if(n=n||Ce,"string"==typeof e){if(!(i="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:Fe.exec(e))||!i[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(i[1]){if(t=t instanceof ge?t[0]:t,ge.merge(this,ge.parseHTML(i[1],t&&t.nodeType?t.ownerDocument||t:ne,!0)),Ae.test(i[1])&&ge.isPlainObject(t))for(i in t)ge.isFunction(this[i])?this[i](t[i]):this.attr(i,t[i]);return this}return o=ne.getElementById(i[2]),o&&(this[0]=o,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):ge.isFunction(e)?void 0!==n.ready?n.ready(e):e(ge):ge.makeArray(e,this)}).prototype=ge.fn,Ce=ge(ne);var ke=/^(?:parents|prev(?:Until|All))/,Te={children:!0,contents:!0,next:!0,prev:!0};ge.fn.extend({has:function(e){var t=ge(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(ge.contains(this,t[e]))return!0})},closest:function(e,t){var n,i=0,o=this.length,r=[],s="string"!=typeof e&&ge(e);if(!Ee.test(e))for(;i<o;i++)for(n=this[i];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(s?s.index(n)>-1:1===n.nodeType&&ge.find.matchesSelector(n,e))){r.push(n);break}return this.pushStack(r.length>1?ge.uniqueSort(r):r)},index:function(e){return e?"string"==typeof e?le.call(ge(e),this[0]):le.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(ge.uniqueSort(ge.merge(this.get(),ge(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),ge.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return _e(e,"parentNode")},parentsUntil:function(e,t,n){return _e(e,"parentNode",n)},next:function(e){return s(e,"nextSibling")},prev:function(e){return s(e,"previousSibling")},nextAll:function(e){return _e(e,"nextSibling")},prevAll:function(e){return _e(e,"previousSibling")},nextUntil:function(e,t,n){return _e(e,"nextSibling",n)},prevUntil:function(e,t,n){return _e(e,"previousSibling",n)},siblings:function(e){return xe((e.parentNode||{}).firstChild,e)},children:function(e){return xe(e.firstChild)},contents:function(e){return o(e,"iframe")?e.contentDocument:(o(e,"template")&&(e=e.content||e),ge.merge([],e.childNodes))}},function(e,t){ge.fn[e]=function(n,i){var o=ge.map(this,t,n);return"Until"!==e.slice(-5)&&(i=n),i&&"string"==typeof i&&(o=ge.filter(i,o)),this.length>1&&(Te[e]||ge.uniqueSort(o),ke.test(e)&&o.reverse()),this.pushStack(o)}});var Oe=/[^\x20\t\r\n\f]+/g;ge.Callbacks=function(e){e="string"==typeof e?l(e):ge.extend({},e);var t,n,i,o,r=[],s=[],a=-1,u=function(){for(o=o||e.once,i=t=!0;s.length;a=-1)for(n=s.shift();++a<r.length;)!1===r[a].apply(n[0],n[1])&&e.stopOnFalse&&(a=r.length,n=!1);e.memory||(n=!1),t=!1,o&&(r=n?[]:"")},d={add:function(){return r&&(n&&!t&&(a=r.length-1,s.push(n)),function t(n){ge.each(n,function(n,i){ge.isFunction(i)?e.unique&&d.has(i)||r.push(i):i&&i.length&&"string"!==ge.type(i)&&t(i)})}(arguments),n&&!t&&u()),this},remove:function(){return ge.each(arguments,function(e,t){for(var n;(n=ge.inArray(t,r,n))>-1;)r.splice(n,1),n<=a&&a--}),this},has:function(e){return e?ge.inArray(e,r)>-1:r.length>0},empty:function(){return r&&(r=[]),this},disable:function(){return o=s=[],r=n="",this},disabled:function(){return!r},lock:function(){return o=s=[],n||t||(r=n=""),this},locked:function(){return!!o},fireWith:function(e,n){return o||(n=n||[],n=[e,n.slice?n.slice():n],s.push(n),t||u()),this},fire:function(){return d.fireWith(this,arguments),this},fired:function(){return!!i}};return d},ge.extend({Deferred:function(t){var n=[["notify","progress",ge.Callbacks("memory"),ge.Callbacks("memory"),2],["resolve","done",ge.Callbacks("once memory"),ge.Callbacks("once memory"),0,"resolved"],["reject","fail",ge.Callbacks("once memory"),ge.Callbacks("once memory"),1,"rejected"]],i="pending",o={state:function(){return i},always:function(){return r.done(arguments).fail(arguments),this},catch:function(e){return o.then(null,e)},pipe:function(){var e=arguments;return ge.Deferred(function(t){ge.each(n,function(n,i){var o=ge.isFunction(e[i[4]])&&e[i[4]];r[i[1]](function(){var e=o&&o.apply(this,arguments);e&&ge.isFunction(e.promise)?e.promise().progress(t.notify).done(t.resolve).fail(t.reject):t[i[0]+"With"](this,o?[e]:arguments)})}),e=null}).promise()},then:function(t,i,o){function r(t,n,i,o){return function(){var l=this,d=arguments,c=function(){var e,c;if(!(t<s)){if((e=i.apply(l,d))===n.promise())throw new TypeError("Thenable self-resolution");c=e&&("object"==typeof e||"function"==typeof e)&&e.then,ge.isFunction(c)?o?c.call(e,r(s,n,a,o),r(s,n,u,o)):(s++,c.call(e,r(s,n,a,o),r(s,n,u,o),r(s,n,a,n.notifyWith))):(i!==a&&(l=void 0,d=[e]),(o||n.resolveWith)(l,d))}},h=o?c:function(){try{c()}catch(e){ge.Deferred.exceptionHook&&ge.Deferred.exceptionHook(e,h.stackTrace),t+1>=s&&(i!==u&&(l=void 0,d=[e]),n.rejectWith(l,d))}};t?h():(ge.Deferred.getStackHook&&(h.stackTrace=ge.Deferred.getStackHook()),e.setTimeout(h))}}var s=0;return ge.Deferred(function(e){n[0][3].add(r(0,e,ge.isFunction(o)?o:a,e.notifyWith)),n[1][3].add(r(0,e,ge.isFunction(t)?t:a)),n[2][3].add(r(0,e,ge.isFunction(i)?i:u))}).promise()},promise:function(e){return null!=e?ge.extend(e,o):o}},r={};return ge.each(n,function(e,t){var s=t[2],l=t[5];o[t[1]]=s.add,l&&s.add(function(){i=l},n[3-e][2].disable,n[0][2].lock),s.add(t[3].fire),r[t[0]]=function(){return r[t[0]+"With"](this===r?void 0:this,arguments),this},r[t[0]+"With"]=s.fireWith}),o.promise(r),t&&t.call(r,r),r},when:function(e){var t=arguments.length,n=t,i=Array(n),o=oe.call(arguments),r=ge.Deferred(),s=function(e){return function(n){i[e]=this,o[e]=arguments.length>1?oe.call(arguments):n,--t||r.resolveWith(i,o)}};if(t<=1&&(d(e,r.done(s(n)).resolve,r.reject,!t),"pending"===r.state()||ge.isFunction(o[n]&&o[n].then)))return r.then();for(;n--;)d(o[n],s(n),r.reject);return r.promise()}});var Ne=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;ge.Deferred.exceptionHook=function(t,n){e.console&&e.console.warn&&t&&Ne.test(t.name)&&e.console.warn("jQuery.Deferred exception: "+t.message,t.stack,n)},ge.readyException=function(t){e.setTimeout(function(){throw t})};var Ie=ge.Deferred();ge.fn.ready=function(e){return Ie.then(e).catch(function(e){ge.readyException(e)}),this},ge.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--ge.readyWait:ge.isReady)||(ge.isReady=!0,!0!==e&&--ge.readyWait>0||Ie.resolveWith(ne,[ge]))}}),ge.ready.then=Ie.then,"complete"===ne.readyState||"loading"!==ne.readyState&&!ne.documentElement.doScroll?e.setTimeout(ge.ready):(ne.addEventListener("DOMContentLoaded",c),e.addEventListener("load",c));var Le=function(e,t,n,i,o,r,s){var l=0,a=e.length,u=null==n;if("object"===ge.type(n)){o=!0;for(l in n)Le(e,t,l,n[l],!0,r,s)}else if(void 0!==i&&(o=!0,ge.isFunction(i)||(s=!0),u&&(s?(t.call(e,i),t=null):(u=t,t=function(e,t,n){return u.call(ge(e),n)})),t))for(;l<a;l++)t(e[l],n,s?i:i.call(e[l],l,t(e[l],n)));return o?e:u?t.call(e):a?t(e[0],n):r},Re=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};h.uid=1,h.prototype={cache:function(e){var t=e[this.expando];return t||(t={},Re(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var i,o=this.cache(e);if("string"==typeof t)o[ge.camelCase(t)]=n;else for(i in t)o[ge.camelCase(i)]=t[i];return o},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][ge.camelCase(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,i=e[this.expando];if(void 0!==i){if(void 0!==t){Array.isArray(t)?t=t.map(ge.camelCase):(t=ge.camelCase(t),t=t in i?[t]:t.match(Oe)||[]),n=t.length;for(;n--;)delete i[t[n]]}(void 0===t||ge.isEmptyObject(i))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!ge.isEmptyObject(t)}};var Pe=new h,De=new h,Me=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,$e=/[A-Z]/g;ge.extend({hasData:function(e){return De.hasData(e)||Pe.hasData(e)},data:function(e,t,n){return De.access(e,t,n)},removeData:function(e,t){De.remove(e,t)},_data:function(e,t,n){return Pe.access(e,t,n)},_removeData:function(e,t){Pe.remove(e,t)}}),ge.fn.extend({data:function(e,t){var n,i,o,r=this[0],s=r&&r.attributes;if(void 0===e){if(this.length&&(o=De.get(r),1===r.nodeType&&!Pe.get(r,"hasDataAttrs"))){for(n=s.length;n--;)s[n]&&(i=s[n].name,0===i.indexOf("data-")&&(i=ge.camelCase(i.slice(5)),f(r,i,o[i])));Pe.set(r,"hasDataAttrs",!0)}return o}return"object"==typeof e?this.each(function(){De.set(this,e)}):Le(this,function(t){var n;if(r&&void 0===t){if(void 0!==(n=De.get(r,e)))return n;if(void 0!==(n=f(r,e)))return n}else this.each(function(){De.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){De.remove(this,e)})}}),ge.extend({queue:function(e,t,n){var i;if(e)return t=(t||"fx")+"queue",i=Pe.get(e,t),n&&(!i||Array.isArray(n)?i=Pe.access(e,t,ge.makeArray(n)):i.push(n)),i||[]},dequeue:function(e,t){t=t||"fx";var n=ge.queue(e,t),i=n.length,o=n.shift(),r=ge._queueHooks(e,t),s=function(){ge.dequeue(e,t)};"inprogress"===o&&(o=n.shift(),i--),o&&("fx"===t&&n.unshift("inprogress"),delete r.stop,o.call(e,s,r)),!i&&r&&r.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return Pe.get(e,n)||Pe.access(e,n,{empty:ge.Callbacks("once memory").add(function(){Pe.remove(e,[t+"queue",n])})})}}),ge.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?ge.queue(this[0],e):void 0===t?this:this.each(function(){var n=ge.queue(this,e,t);ge._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&ge.dequeue(this,e)})},dequeue:function(e){return this.each(function(){ge.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,i=1,o=ge.Deferred(),r=this,s=this.length,l=function(){--i||o.resolveWith(r,[r])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";s--;)(n=Pe.get(r[s],e+"queueHooks"))&&n.empty&&(i++,n.empty.add(l));return l(),o.promise(t)}});var Be=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,je=new RegExp("^(?:([+-])=|)("+Be+")([a-z%]*)$","i"),He=["Top","Right","Bottom","Left"],Ge=function(e,t){return e=t||e,"none"===e.style.display||""===e.style.display&&ge.contains(e.ownerDocument,e)&&"none"===ge.css(e,"display")},ze=function(e,t,n,i){var o,r,s={};for(r in t)s[r]=e.style[r],e.style[r]=t[r];o=n.apply(e,i||[]);for(r in t)e.style[r]=s[r];return o},Ve={};ge.fn.extend({show:function(){return v(this,!0)},hide:function(){return v(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){Ge(this)?ge(this).show():ge(this).hide()})}});var Ue=/^(?:checkbox|radio)$/i,qe=/<([a-z][^\/\0>\x20\t\r\n\f]+)/i,We=/^$|\/(?:java|ecma)script/i,Ye={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Ye.optgroup=Ye.option,Ye.tbody=Ye.tfoot=Ye.colgroup=Ye.caption=Ye.thead,Ye.th=Ye.td;var Ke=/<|&#?\w+;/;!function(){var e=ne.createDocumentFragment(),t=e.appendChild(ne.createElement("div")),n=ne.createElement("input");n.setAttribute("type","radio"),n.setAttribute("checked","checked"),n.setAttribute("name","t"),t.appendChild(n),pe.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,t.innerHTML="<textarea>x</textarea>",pe.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue}();var Xe=ne.documentElement,Je=/^key/,Qe=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Ze=/^([^.]*)(?:\.(.+)|)/;ge.event={global:{},add:function(e,t,n,i,o){var r,s,l,a,u,d,c,h,p,f,g,m=Pe.get(e);if(m)for(n.handler&&(r=n,n=r.handler,o=r.selector),o&&ge.find.matchesSelector(Xe,o),n.guid||(n.guid=ge.guid++),(a=m.events)||(a=m.events={}),(s=m.handle)||(s=m.handle=function(t){return void 0!==ge&&ge.event.triggered!==t.type?ge.event.dispatch.apply(e,arguments):void 0}),t=(t||"").match(Oe)||[""],u=t.length;u--;)l=Ze.exec(t[u])||[],p=g=l[1],f=(l[2]||"").split(".").sort(),p&&(c=ge.event.special[p]||{},p=(o?c.delegateType:c.bindType)||p,c=ge.event.special[p]||{},d=ge.extend({type:p,origType:g,data:i,handler:n,guid:n.guid,selector:o,needsContext:o&&ge.expr.match.needsContext.test(o),namespace:f.join(".")},r),(h=a[p])||(h=a[p]=[],h.delegateCount=0,c.setup&&!1!==c.setup.call(e,i,f,s)||e.addEventListener&&e.addEventListener(p,s)),c.add&&(c.add.call(e,d),d.handler.guid||(d.handler.guid=n.guid)),o?h.splice(h.delegateCount++,0,d):h.push(d),ge.event.global[p]=!0)},remove:function(e,t,n,i,o){var r,s,l,a,u,d,c,h,p,f,g,m=Pe.hasData(e)&&Pe.get(e);if(m&&(a=m.events)){for(t=(t||"").match(Oe)||[""],u=t.length;u--;)if(l=Ze.exec(t[u])||[],p=g=l[1],f=(l[2]||"").split(".").sort(),p){for(c=ge.event.special[p]||{},p=(i?c.delegateType:c.bindType)||p,h=a[p]||[],l=l[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),s=r=h.length;r--;)d=h[r],!o&&g!==d.origType||n&&n.guid!==d.guid||l&&!l.test(d.namespace)||i&&i!==d.selector&&("**"!==i||!d.selector)||(h.splice(r,1),d.selector&&h.delegateCount--,c.remove&&c.remove.call(e,d));s&&!h.length&&(c.teardown&&!1!==c.teardown.call(e,f,m.handle)||ge.removeEvent(e,p,m.handle),delete a[p])}else for(p in a)ge.event.remove(e,p+t[u],n,i,!0);ge.isEmptyObject(a)&&Pe.remove(e,"handle events")}},dispatch:function(e){var t,n,i,o,r,s,l=ge.event.fix(e),a=new Array(arguments.length),u=(Pe.get(this,"events")||{})[l.type]||[],d=ge.event.special[l.type]||{};for(a[0]=l,t=1;t<arguments.length;t++)a[t]=arguments[t];if(l.delegateTarget=this,!d.preDispatch||!1!==d.preDispatch.call(this,l)){for(s=ge.event.handlers.call(this,l,u),t=0;(o=s[t++])&&!l.isPropagationStopped();)for(l.currentTarget=o.elem,n=0;(r=o.handlers[n++])&&!l.isImmediatePropagationStopped();)l.rnamespace&&!l.rnamespace.test(r.namespace)||(l.handleObj=r,l.data=r.data,void 0!==(i=((ge.event.special[r.origType]||{}).handle||r.handler).apply(o.elem,a))&&!1===(l.result=i)&&(l.preventDefault(),l.stopPropagation()));return d.postDispatch&&d.postDispatch.call(this,l),l.result}},handlers:function(e,t){var n,i,o,r,s,l=[],a=t.delegateCount,u=e.target;if(a&&u.nodeType&&!("click"===e.type&&e.button>=1))for(;u!==this;u=u.parentNode||this)if(1===u.nodeType&&("click"!==e.type||!0!==u.disabled)){for(r=[],s={},n=0;n<a;n++)i=t[n],o=i.selector+" ",void 0===s[o]&&(s[o]=i.needsContext?ge(o,this).index(u)>-1:ge.find(o,this,null,[u]).length),s[o]&&r.push(i);r.length&&l.push({elem:u,handlers:r})}return u=this,a<t.length&&l.push({elem:u,handlers:t.slice(a)}),l},addProp:function(e,t){Object.defineProperty(ge.Event.prototype,e,{enumerable:!0,configurable:!0,get:ge.isFunction(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[ge.expando]?e:new ge.Event(e)},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==E()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===E()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&o(this,"input"))return this.click(),!1},_default:function(e){return o(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},ge.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},ge.Event=function(e,t){return this instanceof ge.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?_:x,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&ge.extend(this,t),this.timeStamp=e&&e.timeStamp||ge.now(),void(this[ge.expando]=!0)):new ge.Event(e,t)},ge.Event.prototype={constructor:ge.Event,isDefaultPrevented:x,isPropagationStopped:x,isImmediatePropagationStopped:x,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=_,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=_,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=_,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},ge.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&Je.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&Qe.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},ge.event.addProp),ge.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){ge.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,i=this,o=e.relatedTarget,r=e.handleObj;return o&&(o===i||ge.contains(i,o))||(e.type=r.origType,n=r.handler.apply(this,arguments),e.type=t),n}}}),ge.fn.extend({on:function(e,t,n,i){return A(this,e,t,n,i)},one:function(e,t,n,i){return A(this,e,t,n,i,1)},off:function(e,t,n){var i,o;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,ge(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(o in e)this.off(o,t,e[o]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=x),this.each(function(){ge.event.remove(this,e,n,t)})}});var et=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,tt=/<script|<style|<link/i,nt=/checked\s*(?:[^=]|=\s*.checked.)/i,it=/^true\/(.*)/,ot=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;ge.extend({htmlPrefilter:function(e){return e.replace(et,"<$1></$2>")},clone:function(e,t,n){var i,o,r,s,l=e.cloneNode(!0),a=ge.contains(e.ownerDocument,e);if(!(pe.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||ge.isXMLDoc(e)))for(s=y(l),r=y(e),i=0,o=r.length;i<o;i++)T(r[i],s[i]);if(t)if(n)for(r=r||y(e),s=s||y(l),i=0,o=r.length;i<o;i++)k(r[i],s[i]);else k(e,l);return s=y(l,"script"),s.length>0&&b(s,!a&&y(e,"script")),l},cleanData:function(e){for(var t,n,i,o=ge.event.special,r=0;void 0!==(n=e[r]);r++)if(Re(n)){if(t=n[Pe.expando]){if(t.events)for(i in t.events)o[i]?ge.event.remove(n,i):ge.removeEvent(n,i,t.handle);n[Pe.expando]=void 0}n[De.expando]&&(n[De.expando]=void 0)}}}),ge.fn.extend({detach:function(e){return N(this,e,!0)},remove:function(e){
return N(this,e)},text:function(e){return Le(this,function(e){return void 0===e?ge.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return O(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){S(this,e).appendChild(e)}})},prepend:function(){return O(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=S(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return O(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return O(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(ge.cleanData(y(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return ge.clone(this,e,t)})},html:function(e){return Le(this,function(e){var t=this[0]||{},n=0,i=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!tt.test(e)&&!Ye[(qe.exec(e)||["",""])[1].toLowerCase()]){e=ge.htmlPrefilter(e);try{for(;n<i;n++)t=this[n]||{},1===t.nodeType&&(ge.cleanData(y(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=[];return O(this,arguments,function(t){var n=this.parentNode;ge.inArray(this,e)<0&&(ge.cleanData(y(this)),n&&n.replaceChild(t,this))},e)}}),ge.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){ge.fn[e]=function(e){for(var n,i=[],o=ge(e),r=o.length-1,s=0;s<=r;s++)n=s===r?this:this.clone(!0),ge(o[s])[t](n),se.apply(i,n.get());return this.pushStack(i)}});var rt=/^margin/,st=new RegExp("^("+Be+")(?!px)[a-z%]+$","i"),lt=function(t){var n=t.ownerDocument.defaultView;return n&&n.opener||(n=e),n.getComputedStyle(t)};!function(){function t(){if(l){l.style.cssText="box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",l.innerHTML="",Xe.appendChild(s);var t=e.getComputedStyle(l);n="1%"!==t.top,r="2px"===t.marginLeft,i="4px"===t.width,l.style.marginRight="50%",o="4px"===t.marginRight,Xe.removeChild(s),l=null}}var n,i,o,r,s=ne.createElement("div"),l=ne.createElement("div");l.style&&(l.style.backgroundClip="content-box",l.cloneNode(!0).style.backgroundClip="",pe.clearCloneStyle="content-box"===l.style.backgroundClip,s.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",s.appendChild(l),ge.extend(pe,{pixelPosition:function(){return t(),n},boxSizingReliable:function(){return t(),i},pixelMarginRight:function(){return t(),o},reliableMarginLeft:function(){return t(),r}}))}();var at=/^(none|table(?!-c[ea]).+)/,ut=/^--/,dt={position:"absolute",visibility:"hidden",display:"block"},ct={letterSpacing:"0",fontWeight:"400"},ht=["Webkit","Moz","ms"],pt=ne.createElement("div").style;ge.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=I(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(e,t,n,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var o,r,s,l=ge.camelCase(t),a=ut.test(t),u=e.style;return a||(t=P(l)),s=ge.cssHooks[t]||ge.cssHooks[l],void 0===n?s&&"get"in s&&void 0!==(o=s.get(e,!1,i))?o:u[t]:(r=typeof n,"string"===r&&(o=je.exec(n))&&o[1]&&(n=g(e,t,o),r="number"),void(null!=n&&n===n&&("number"===r&&(n+=o&&o[3]||(ge.cssNumber[l]?"":"px")),pe.clearCloneStyle||""!==n||0!==t.indexOf("background")||(u[t]="inherit"),s&&"set"in s&&void 0===(n=s.set(e,n,i))||(a?u.setProperty(t,n):u[t]=n))))}},css:function(e,t,n,i){var o,r,s,l=ge.camelCase(t);return ut.test(t)||(t=P(l)),s=ge.cssHooks[t]||ge.cssHooks[l],s&&"get"in s&&(o=s.get(e,!0,n)),void 0===o&&(o=I(e,t,i)),"normal"===o&&t in ct&&(o=ct[t]),""===n||n?(r=parseFloat(o),!0===n||isFinite(r)?r||0:o):o}}),ge.each(["height","width"],function(e,t){ge.cssHooks[t]={get:function(e,n,i){if(n)return!at.test(ge.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?$(e,t,i):ze(e,dt,function(){return $(e,t,i)})},set:function(e,n,i){var o,r=i&&lt(e),s=i&&M(e,t,i,"border-box"===ge.css(e,"boxSizing",!1,r),r);return s&&(o=je.exec(n))&&"px"!==(o[3]||"px")&&(e.style[t]=n,n=ge.css(e,t)),D(e,n,s)}}}),ge.cssHooks.marginLeft=L(pe.reliableMarginLeft,function(e,t){if(t)return(parseFloat(I(e,"marginLeft"))||e.getBoundingClientRect().left-ze(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),ge.each({margin:"",padding:"",border:"Width"},function(e,t){ge.cssHooks[e+t]={expand:function(n){for(var i=0,o={},r="string"==typeof n?n.split(" "):[n];i<4;i++)o[e+He[i]+t]=r[i]||r[i-2]||r[0];return o}},rt.test(e)||(ge.cssHooks[e+t].set=D)}),ge.fn.extend({css:function(e,t){return Le(this,function(e,t,n){var i,o,r={},s=0;if(Array.isArray(t)){for(i=lt(e),o=t.length;s<o;s++)r[t[s]]=ge.css(e,t[s],!1,i);return r}return void 0!==n?ge.style(e,t,n):ge.css(e,t)},e,t,arguments.length>1)}}),ge.Tween=B,B.prototype={constructor:B,init:function(e,t,n,i,o,r){this.elem=e,this.prop=n,this.easing=o||ge.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=i,this.unit=r||(ge.cssNumber[n]?"":"px")},cur:function(){var e=B.propHooks[this.prop];return e&&e.get?e.get(this):B.propHooks._default.get(this)},run:function(e){var t,n=B.propHooks[this.prop];return this.options.duration?this.pos=t=ge.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):B.propHooks._default.set(this),this}},B.prototype.init.prototype=B.prototype,B.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=ge.css(e.elem,e.prop,""),t&&"auto"!==t?t:0)},set:function(e){ge.fx.step[e.prop]?ge.fx.step[e.prop](e):1!==e.elem.nodeType||null==e.elem.style[ge.cssProps[e.prop]]&&!ge.cssHooks[e.prop]?e.elem[e.prop]=e.now:ge.style(e.elem,e.prop,e.now+e.unit)}}},B.propHooks.scrollTop=B.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},ge.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},ge.fx=B.prototype.init,ge.fx.step={};var ft,gt,mt=/^(?:toggle|show|hide)$/,vt=/queueHooks$/;ge.Animation=ge.extend(q,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return g(n.elem,e,je.exec(t),n),n}]},tweener:function(e,t){ge.isFunction(e)?(t=e,e=["*"]):e=e.match(Oe);for(var n,i=0,o=e.length;i<o;i++)n=e[i],q.tweeners[n]=q.tweeners[n]||[],q.tweeners[n].unshift(t)},prefilters:[V],prefilter:function(e,t){t?q.prefilters.unshift(e):q.prefilters.push(e)}}),ge.speed=function(e,t,n){var i=e&&"object"==typeof e?ge.extend({},e):{complete:n||!n&&t||ge.isFunction(e)&&e,duration:e,easing:n&&t||t&&!ge.isFunction(t)&&t};return ge.fx.off?i.duration=0:"number"!=typeof i.duration&&(i.duration in ge.fx.speeds?i.duration=ge.fx.speeds[i.duration]:i.duration=ge.fx.speeds._default),null!=i.queue&&!0!==i.queue||(i.queue="fx"),i.old=i.complete,i.complete=function(){ge.isFunction(i.old)&&i.old.call(this),i.queue&&ge.dequeue(this,i.queue)},i},ge.fn.extend({fadeTo:function(e,t,n,i){return this.filter(Ge).css("opacity",0).show().end().animate({opacity:t},e,n,i)},animate:function(e,t,n,i){var o=ge.isEmptyObject(e),r=ge.speed(t,n,i),s=function(){var t=q(this,ge.extend({},e),r);(o||Pe.get(this,"finish"))&&t.stop(!0)};return s.finish=s,o||!1===r.queue?this.each(s):this.queue(r.queue,s)},stop:function(e,t,n){var i=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&!1!==e&&this.queue(e||"fx",[]),this.each(function(){var t=!0,o=null!=e&&e+"queueHooks",r=ge.timers,s=Pe.get(this);if(o)s[o]&&s[o].stop&&i(s[o]);else for(o in s)s[o]&&s[o].stop&&vt.test(o)&&i(s[o]);for(o=r.length;o--;)r[o].elem!==this||null!=e&&r[o].queue!==e||(r[o].anim.stop(n),t=!1,r.splice(o,1));!t&&n||ge.dequeue(this,e)})},finish:function(e){return!1!==e&&(e=e||"fx"),this.each(function(){var t,n=Pe.get(this),i=n[e+"queue"],o=n[e+"queueHooks"],r=ge.timers,s=i?i.length:0;for(n.finish=!0,ge.queue(this,e,[]),o&&o.stop&&o.stop.call(this,!0),t=r.length;t--;)r[t].elem===this&&r[t].queue===e&&(r[t].anim.stop(!0),r.splice(t,1));for(t=0;t<s;t++)i[t]&&i[t].finish&&i[t].finish.call(this);delete n.finish})}}),ge.each(["toggle","show","hide"],function(e,t){var n=ge.fn[t];ge.fn[t]=function(e,i,o){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(G(t,!0),e,i,o)}}),ge.each({slideDown:G("show"),slideUp:G("hide"),slideToggle:G("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){ge.fn[e]=function(e,n,i){return this.animate(t,e,n,i)}}),ge.timers=[],ge.fx.tick=function(){var e,t=0,n=ge.timers;for(ft=ge.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||ge.fx.stop(),ft=void 0},ge.fx.timer=function(e){ge.timers.push(e),ge.fx.start()},ge.fx.interval=13,ge.fx.start=function(){gt||(gt=!0,j())},ge.fx.stop=function(){gt=null},ge.fx.speeds={slow:600,fast:200,_default:400},ge.fn.delay=function(t,n){return t=ge.fx?ge.fx.speeds[t]||t:t,n=n||"fx",this.queue(n,function(n,i){var o=e.setTimeout(n,t);i.stop=function(){e.clearTimeout(o)}})},function(){var e=ne.createElement("input"),t=ne.createElement("select"),n=t.appendChild(ne.createElement("option"));e.type="checkbox",pe.checkOn=""!==e.value,pe.optSelected=n.selected,e=ne.createElement("input"),e.value="t",e.type="radio",pe.radioValue="t"===e.value}();var yt,bt=ge.expr.attrHandle;ge.fn.extend({attr:function(e,t){return Le(this,ge.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){ge.removeAttr(this,e)})}}),ge.extend({attr:function(e,t,n){var i,o,r=e.nodeType;if(3!==r&&8!==r&&2!==r)return void 0===e.getAttribute?ge.prop(e,t,n):(1===r&&ge.isXMLDoc(e)||(o=ge.attrHooks[t.toLowerCase()]||(ge.expr.match.bool.test(t)?yt:void 0)),void 0!==n?null===n?void ge.removeAttr(e,t):o&&"set"in o&&void 0!==(i=o.set(e,n,t))?i:(e.setAttribute(t,n+""),n):o&&"get"in o&&null!==(i=o.get(e,t))?i:(i=ge.find.attr(e,t),null==i?void 0:i))},attrHooks:{type:{set:function(e,t){if(!pe.radioValue&&"radio"===t&&o(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,i=0,o=t&&t.match(Oe);if(o&&1===e.nodeType)for(;n=o[i++];)e.removeAttribute(n)}}),yt={set:function(e,t,n){return!1===t?ge.removeAttr(e,n):e.setAttribute(n,n),n}},ge.each(ge.expr.match.bool.source.match(/\w+/g),function(e,t){var n=bt[t]||ge.find.attr;bt[t]=function(e,t,i){var o,r,s=t.toLowerCase();return i||(r=bt[s],bt[s]=o,o=null!=n(e,t,i)?s:null,bt[s]=r),o}});var wt=/^(?:input|select|textarea|button)$/i,_t=/^(?:a|area)$/i;ge.fn.extend({prop:function(e,t){return Le(this,ge.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[ge.propFix[e]||e]})}}),ge.extend({prop:function(e,t,n){var i,o,r=e.nodeType;if(3!==r&&8!==r&&2!==r)return 1===r&&ge.isXMLDoc(e)||(t=ge.propFix[t]||t,o=ge.propHooks[t]),void 0!==n?o&&"set"in o&&void 0!==(i=o.set(e,n,t))?i:e[t]=n:o&&"get"in o&&null!==(i=o.get(e,t))?i:e[t]},propHooks:{tabIndex:{get:function(e){var t=ge.find.attr(e,"tabindex");return t?parseInt(t,10):wt.test(e.nodeName)||_t.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),pe.optSelected||(ge.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),ge.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){ge.propFix[this.toLowerCase()]=this}),ge.fn.extend({addClass:function(e){var t,n,i,o,r,s,l,a=0;if(ge.isFunction(e))return this.each(function(t){ge(this).addClass(e.call(this,t,Y(this)))});if("string"==typeof e&&e)for(t=e.match(Oe)||[];n=this[a++];)if(o=Y(n),i=1===n.nodeType&&" "+W(o)+" "){for(s=0;r=t[s++];)i.indexOf(" "+r+" ")<0&&(i+=r+" ");l=W(i),o!==l&&n.setAttribute("class",l)}return this},removeClass:function(e){var t,n,i,o,r,s,l,a=0;if(ge.isFunction(e))return this.each(function(t){ge(this).removeClass(e.call(this,t,Y(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof e&&e)for(t=e.match(Oe)||[];n=this[a++];)if(o=Y(n),i=1===n.nodeType&&" "+W(o)+" "){for(s=0;r=t[s++];)for(;i.indexOf(" "+r+" ")>-1;)i=i.replace(" "+r+" "," ");l=W(i),o!==l&&n.setAttribute("class",l)}return this},toggleClass:function(e,t){var n=typeof e;return"boolean"==typeof t&&"string"===n?t?this.addClass(e):this.removeClass(e):ge.isFunction(e)?this.each(function(n){ge(this).toggleClass(e.call(this,n,Y(this),t),t)}):this.each(function(){var t,i,o,r;if("string"===n)for(i=0,o=ge(this),r=e.match(Oe)||[];t=r[i++];)o.hasClass(t)?o.removeClass(t):o.addClass(t);else void 0!==e&&"boolean"!==n||(t=Y(this),t&&Pe.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",t||!1===e?"":Pe.get(this,"__className__")||""))})},hasClass:function(e){var t,n,i=0;for(t=" "+e+" ";n=this[i++];)if(1===n.nodeType&&(" "+W(Y(n))+" ").indexOf(t)>-1)return!0;return!1}});var xt=/\r/g;ge.fn.extend({val:function(e){var t,n,i,o=this[0];return arguments.length?(i=ge.isFunction(e),this.each(function(n){var o;1===this.nodeType&&(o=i?e.call(this,n,ge(this).val()):e,null==o?o="":"number"==typeof o?o+="":Array.isArray(o)&&(o=ge.map(o,function(e){return null==e?"":e+""})),(t=ge.valHooks[this.type]||ge.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,o,"value")||(this.value=o))})):o?(t=ge.valHooks[o.type]||ge.valHooks[o.nodeName.toLowerCase()],t&&"get"in t&&void 0!==(n=t.get(o,"value"))?n:(n=o.value,"string"==typeof n?n.replace(xt,""):null==n?"":n)):void 0}}),ge.extend({valHooks:{option:{get:function(e){var t=ge.find.attr(e,"value");return null!=t?t:W(ge.text(e))}},select:{get:function(e){var t,n,i,r=e.options,s=e.selectedIndex,l="select-one"===e.type,a=l?null:[],u=l?s+1:r.length;for(i=s<0?u:l?s:0;i<u;i++)if(n=r[i],(n.selected||i===s)&&!n.disabled&&(!n.parentNode.disabled||!o(n.parentNode,"optgroup"))){if(t=ge(n).val(),l)return t;a.push(t)}return a},set:function(e,t){for(var n,i,o=e.options,r=ge.makeArray(t),s=o.length;s--;)i=o[s],(i.selected=ge.inArray(ge.valHooks.option.get(i),r)>-1)&&(n=!0);return n||(e.selectedIndex=-1),r}}}}),ge.each(["radio","checkbox"],function(){ge.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=ge.inArray(ge(e).val(),t)>-1}},pe.checkOn||(ge.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var Et=/^(?:focusinfocus|focusoutblur)$/;ge.extend(ge.event,{trigger:function(t,n,i,o){var r,s,l,a,u,d,c,h=[i||ne],p=de.call(t,"type")?t.type:t,f=de.call(t,"namespace")?t.namespace.split("."):[];if(s=l=i=i||ne,3!==i.nodeType&&8!==i.nodeType&&!Et.test(p+ge.event.triggered)&&(p.indexOf(".")>-1&&(f=p.split("."),p=f.shift(),f.sort()),u=p.indexOf(":")<0&&"on"+p,t=t[ge.expando]?t:new ge.Event(p,"object"==typeof t&&t),t.isTrigger=o?2:3,t.namespace=f.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=i),n=null==n?[t]:ge.makeArray(n,[t]),c=ge.event.special[p]||{},o||!c.trigger||!1!==c.trigger.apply(i,n))){if(!o&&!c.noBubble&&!ge.isWindow(i)){for(a=c.delegateType||p,Et.test(a+p)||(s=s.parentNode);s;s=s.parentNode)h.push(s),l=s;l===(i.ownerDocument||ne)&&h.push(l.defaultView||l.parentWindow||e)}for(r=0;(s=h[r++])&&!t.isPropagationStopped();)t.type=r>1?a:c.bindType||p,d=(Pe.get(s,"events")||{})[t.type]&&Pe.get(s,"handle"),d&&d.apply(s,n),(d=u&&s[u])&&d.apply&&Re(s)&&(t.result=d.apply(s,n),!1===t.result&&t.preventDefault());return t.type=p,o||t.isDefaultPrevented()||c._default&&!1!==c._default.apply(h.pop(),n)||!Re(i)||u&&ge.isFunction(i[p])&&!ge.isWindow(i)&&(l=i[u],l&&(i[u]=null),ge.event.triggered=p,i[p](),ge.event.triggered=void 0,l&&(i[u]=l)),t.result}},simulate:function(e,t,n){var i=ge.extend(new ge.Event,n,{type:e,isSimulated:!0});ge.event.trigger(i,null,t)}}),ge.fn.extend({trigger:function(e,t){return this.each(function(){ge.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return ge.event.trigger(e,t,n,!0)}}),ge.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,t){ge.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),ge.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),pe.focusin="onfocusin"in e,pe.focusin||ge.each({focus:"focusin",blur:"focusout"},function(e,t){var n=function(e){ge.event.simulate(t,e.target,ge.event.fix(e))};ge.event.special[t]={setup:function(){var i=this.ownerDocument||this,o=Pe.access(i,t);o||i.addEventListener(e,n,!0),Pe.access(i,t,(o||0)+1)},teardown:function(){var i=this.ownerDocument||this,o=Pe.access(i,t)-1;o?Pe.access(i,t,o):(i.removeEventListener(e,n,!0),Pe.remove(i,t))}}});var At=e.location,St=ge.now(),Ct=/\?/;ge.parseXML=function(t){var n;if(!t||"string"!=typeof t)return null;try{n=(new e.DOMParser).parseFromString(t,"text/xml")}catch(e){n=void 0}return n&&!n.getElementsByTagName("parsererror").length||ge.error("Invalid XML: "+t),n};var Ft=/\[\]$/,kt=/\r?\n/g,Tt=/^(?:submit|button|image|reset|file)$/i,Ot=/^(?:input|select|textarea|keygen)/i;ge.param=function(e,t){var n,i=[],o=function(e,t){var n=ge.isFunction(t)?t():t;i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(Array.isArray(e)||e.jquery&&!ge.isPlainObject(e))ge.each(e,function(){o(this.name,this.value)});else for(n in e)K(n,e[n],t,o);return i.join("&")},ge.fn.extend({serialize:function(){return ge.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=ge.prop(this,"elements");return e?ge.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!ge(this).is(":disabled")&&Ot.test(this.nodeName)&&!Tt.test(e)&&(this.checked||!Ue.test(e))}).map(function(e,t){var n=ge(this).val();return null==n?null:Array.isArray(n)?ge.map(n,function(e){return{name:t.name,value:e.replace(kt,"\r\n")}}):{name:t.name,value:n.replace(kt,"\r\n")}}).get()}});var Nt=/%20/g,It=/#.*$/,Lt=/([?&])_=[^&]*/,Rt=/^(.*?):[ \t]*([^\r\n]*)$/gm,Pt=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Dt=/^(?:GET|HEAD)$/,Mt=/^\/\//,$t={},Bt={},jt="*/".concat("*"),Ht=ne.createElement("a");Ht.href=At.href,ge.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:At.href,type:"GET",isLocal:Pt.test(At.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":jt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":ge.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Q(Q(e,ge.ajaxSettings),t):Q(ge.ajaxSettings,e)},ajaxPrefilter:X($t),ajaxTransport:X(Bt),ajax:function(t,n){function i(t,n,i,l){var u,h,p,w,_,x=n;d||(d=!0,a&&e.clearTimeout(a),o=void 0,s=l||"",E.readyState=t>0?4:0,u=t>=200&&t<300||304===t,i&&(w=Z(f,E,i)),w=ee(f,w,E,u),u?(f.ifModified&&(_=E.getResponseHeader("Last-Modified"),_&&(ge.lastModified[r]=_),(_=E.getResponseHeader("etag"))&&(ge.etag[r]=_)),204===t||"HEAD"===f.type?x="nocontent":304===t?x="notmodified":(x=w.state,h=w.data,p=w.error,u=!p)):(p=x,!t&&x||(x="error",t<0&&(t=0))),E.status=t,E.statusText=(n||x)+"",u?v.resolveWith(g,[h,x,E]):v.rejectWith(g,[E,x,p]),E.statusCode(b),b=void 0,c&&m.trigger(u?"ajaxSuccess":"ajaxError",[E,f,u?h:p]),y.fireWith(g,[E,x]),c&&(m.trigger("ajaxComplete",[E,f]),--ge.active||ge.event.trigger("ajaxStop")))}"object"==typeof t&&(n=t,t=void 0),n=n||{};var o,r,s,l,a,u,d,c,h,p,f=ge.ajaxSetup({},n),g=f.context||f,m=f.context&&(g.nodeType||g.jquery)?ge(g):ge.event,v=ge.Deferred(),y=ge.Callbacks("once memory"),b=f.statusCode||{},w={},_={},x="canceled",E={readyState:0,getResponseHeader:function(e){var t;if(d){if(!l)for(l={};t=Rt.exec(s);)l[t[1].toLowerCase()]=t[2];t=l[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return d?s:null},setRequestHeader:function(e,t){return null==d&&(e=_[e.toLowerCase()]=_[e.toLowerCase()]||e,w[e]=t),this},overrideMimeType:function(e){return null==d&&(f.mimeType=e),this},statusCode:function(e){var t;if(e)if(d)E.always(e[E.status]);else for(t in e)b[t]=[b[t],e[t]];return this},abort:function(e){var t=e||x;return o&&o.abort(t),i(0,t),this}};if(v.promise(E),f.url=((t||f.url||At.href)+"").replace(Mt,At.protocol+"//"),f.type=n.method||n.type||f.method||f.type,f.dataTypes=(f.dataType||"*").toLowerCase().match(Oe)||[""],null==f.crossDomain){u=ne.createElement("a");try{u.href=f.url,u.href=u.href,f.crossDomain=Ht.protocol+"//"+Ht.host!=u.protocol+"//"+u.host}catch(e){f.crossDomain=!0}}if(f.data&&f.processData&&"string"!=typeof f.data&&(f.data=ge.param(f.data,f.traditional)),J($t,f,n,E),d)return E;c=ge.event&&f.global,c&&0==ge.active++&&ge.event.trigger("ajaxStart"),f.type=f.type.toUpperCase(),f.hasContent=!Dt.test(f.type),r=f.url.replace(It,""),f.hasContent?f.data&&f.processData&&0===(f.contentType||"").indexOf("application/x-www-form-urlencoded")&&(f.data=f.data.replace(Nt,"+")):(p=f.url.slice(r.length),f.data&&(r+=(Ct.test(r)?"&":"?")+f.data,delete f.data),!1===f.cache&&(r=r.replace(Lt,"$1"),p=(Ct.test(r)?"&":"?")+"_="+St+++p),f.url=r+p),f.ifModified&&(ge.lastModified[r]&&E.setRequestHeader("If-Modified-Since",ge.lastModified[r]),ge.etag[r]&&E.setRequestHeader("If-None-Match",ge.etag[r])),(f.data&&f.hasContent&&!1!==f.contentType||n.contentType)&&E.setRequestHeader("Content-Type",f.contentType),E.setRequestHeader("Accept",f.dataTypes[0]&&f.accepts[f.dataTypes[0]]?f.accepts[f.dataTypes[0]]+("*"!==f.dataTypes[0]?", "+jt+"; q=0.01":""):f.accepts["*"]);for(h in f.headers)E.setRequestHeader(h,f.headers[h]);if(f.beforeSend&&(!1===f.beforeSend.call(g,E,f)||d))return E.abort();if(x="abort",y.add(f.complete),E.done(f.success),E.fail(f.error),o=J(Bt,f,n,E)){if(E.readyState=1,c&&m.trigger("ajaxSend",[E,f]),d)return E;f.async&&f.timeout>0&&(a=e.setTimeout(function(){E.abort("timeout")},f.timeout));try{d=!1,o.send(w,i)}catch(e){if(d)throw e;i(-1,e)}}else i(-1,"No Transport");return E},getJSON:function(e,t,n){return ge.get(e,t,n,"json")},getScript:function(e,t){return ge.get(e,void 0,t,"script")}}),ge.each(["get","post"],function(e,t){ge[t]=function(e,n,i,o){return ge.isFunction(n)&&(o=o||i,i=n,n=void 0),ge.ajax(ge.extend({url:e,type:t,dataType:o,data:n,success:i},ge.isPlainObject(e)&&e))}}),ge._evalUrl=function(e){return ge.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,throws:!0})},ge.fn.extend({wrapAll:function(e){var t;return this[0]&&(ge.isFunction(e)&&(e=e.call(this[0])),t=ge(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(e){return ge.isFunction(e)?this.each(function(t){ge(this).wrapInner(e.call(this,t))}):this.each(function(){var t=ge(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=ge.isFunction(e);return this.each(function(n){ge(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(e){return this.parent(e).not("body").each(function(){ge(this).replaceWith(this.childNodes)}),this}}),ge.expr.pseudos.hidden=function(e){return!ge.expr.pseudos.visible(e)},ge.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},ge.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch(e){}};var Gt={0:200,1223:204},zt=ge.ajaxSettings.xhr();pe.cors=!!zt&&"withCredentials"in zt,pe.ajax=zt=!!zt,ge.ajaxTransport(function(t){var n,i;if(pe.cors||zt&&!t.crossDomain)return{send:function(o,r){var s,l=t.xhr();if(l.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(s in t.xhrFields)l[s]=t.xhrFields[s];t.mimeType&&l.overrideMimeType&&l.overrideMimeType(t.mimeType),t.crossDomain||o["X-Requested-With"]||(o["X-Requested-With"]="XMLHttpRequest");for(s in o)l.setRequestHeader(s,o[s]);n=function(e){return function(){n&&(n=i=l.onload=l.onerror=l.onabort=l.onreadystatechange=null,"abort"===e?l.abort():"error"===e?"number"!=typeof l.status?r(0,"error"):r(l.status,l.statusText):r(Gt[l.status]||l.status,l.statusText,"text"!==(l.responseType||"text")||"string"!=typeof l.responseText?{binary:l.response}:{text:l.responseText},l.getAllResponseHeaders()))}},l.onload=n(),i=l.onerror=n("error"),void 0!==l.onabort?l.onabort=i:l.onreadystatechange=function(){4===l.readyState&&e.setTimeout(function(){n&&i()})},n=n("abort");try{l.send(t.hasContent&&t.data||null)}catch(e){if(n)throw e}},abort:function(){n&&n()}}}),ge.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),ge.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return ge.globalEval(e),e}}}),ge.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),ge.ajaxTransport("script",function(e){if(e.crossDomain){var t,n;return{send:function(i,o){t=ge("<script>").prop({charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&o("error"===e.type?404:200,e.type)}),ne.head.appendChild(t[0])},abort:function(){n&&n()}}}});var Vt=[],Ut=/(=)\?(?=&|$)|\?\?/;ge.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Vt.pop()||ge.expando+"_"+St++;return this[e]=!0,e}}),ge.ajaxPrefilter("json jsonp",function(t,n,i){var o,r,s,l=!1!==t.jsonp&&(Ut.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&Ut.test(t.data)&&"data");if(l||"jsonp"===t.dataTypes[0])return o=t.jsonpCallback=ge.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,l?t[l]=t[l].replace(Ut,"$1"+o):!1!==t.jsonp&&(t.url+=(Ct.test(t.url)?"&":"?")+t.jsonp+"="+o),t.converters["script json"]=function(){return s||ge.error(o+" was not called"),s[0]},t.dataTypes[0]="json",r=e[o],e[o]=function(){s=arguments},i.always(function(){void 0===r?ge(e).removeProp(o):e[o]=r,t[o]&&(t.jsonpCallback=n.jsonpCallback,Vt.push(o)),s&&ge.isFunction(r)&&r(s[0]),s=r=void 0}),"script"}),pe.createHTMLDocument=function(){var e=ne.implementation.createHTMLDocument("").body;return e.innerHTML="<form></form><form></form>",2===e.childNodes.length}(),ge.parseHTML=function(e,t,n){if("string"!=typeof e)return[];"boolean"==typeof t&&(n=t,t=!1);var i,o,r;return t||(pe.createHTMLDocument?(t=ne.implementation.createHTMLDocument(""),i=t.createElement("base"),i.href=ne.location.href,t.head.appendChild(i)):t=ne),o=Ae.exec(e),r=!n&&[],o?[t.createElement(o[1])]:(o=w([e],t,r),r&&r.length&&ge(r).remove(),ge.merge([],o.childNodes))},ge.fn.load=function(e,t,n){var i,o,r,s=this,l=e.indexOf(" ");return l>-1&&(i=W(e.slice(l)),e=e.slice(0,l)),ge.isFunction(t)?(n=t,t=void 0):t&&"object"==typeof t&&(o="POST"),s.length>0&&ge.ajax({url:e,type:o||"GET",dataType:"html",data:t}).done(function(e){r=arguments,s.html(i?ge("<div>").append(ge.parseHTML(e)).find(i):e)}).always(n&&function(e,t){s.each(function(){n.apply(this,r||[e.responseText,t,e])})}),this},ge.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){ge.fn[t]=function(e){return this.on(t,e)}}),ge.expr.pseudos.animated=function(e){return ge.grep(ge.timers,function(t){return e===t.elem}).length},ge.offset={setOffset:function(e,t,n){var i,o,r,s,l,a,u,d=ge.css(e,"position"),c=ge(e),h={};"static"===d&&(e.style.position="relative"),l=c.offset(),r=ge.css(e,"top"),a=ge.css(e,"left"),u=("absolute"===d||"fixed"===d)&&(r+a).indexOf("auto")>-1,u?(i=c.position(),s=i.top,o=i.left):(s=parseFloat(r)||0,o=parseFloat(a)||0),ge.isFunction(t)&&(t=t.call(e,n,ge.extend({},l))),null!=t.top&&(h.top=t.top-l.top+s),null!=t.left&&(h.left=t.left-l.left+o),"using"in t?t.using.call(e,h):c.css(h)}},ge.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){ge.offset.setOffset(this,e,t)});var t,n,i,o,r=this[0];return r?r.getClientRects().length?(i=r.getBoundingClientRect(),t=r.ownerDocument,n=t.documentElement,o=t.defaultView,{top:i.top+o.pageYOffset-n.clientTop,left:i.left+o.pageXOffset-n.clientLeft}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n=this[0],i={top:0,left:0};return"fixed"===ge.css(n,"position")?t=n.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),o(e[0],"html")||(i=e.offset()),i={top:i.top+ge.css(e[0],"borderTopWidth",!0),left:i.left+ge.css(e[0],"borderLeftWidth",!0)}),{top:t.top-i.top-ge.css(n,"marginTop",!0),left:t.left-i.left-ge.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&"static"===ge.css(e,"position");)e=e.offsetParent;return e||Xe})}}),ge.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var n="pageYOffset"===t;ge.fn[e]=function(i){return Le(this,function(e,i,o){var r;return ge.isWindow(e)?r=e:9===e.nodeType&&(r=e.defaultView),void 0===o?r?r[t]:e[i]:void(r?r.scrollTo(n?r.pageXOffset:o,n?o:r.pageYOffset):e[i]=o)},e,i,arguments.length)}}),ge.each(["top","left"],function(e,t){ge.cssHooks[t]=L(pe.pixelPosition,function(e,n){if(n)return n=I(e,t),st.test(n)?ge(e).position()[t]+"px":n})}),ge.each({Height:"height",Width:"width"},function(e,t){ge.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,i){ge.fn[i]=function(o,r){var s=arguments.length&&(n||"boolean"!=typeof o),l=n||(!0===o||!0===r?"margin":"border");return Le(this,function(t,n,o){var r;return ge.isWindow(t)?0===i.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(r=t.documentElement,Math.max(t.body["scroll"+e],r["scroll"+e],t.body["offset"+e],r["offset"+e],r["client"+e])):void 0===o?ge.css(t,n,l):ge.style(t,n,o,l)},t,s?o:void 0,s)}})}),ge.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,i){return this.on(t,e,n,i)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}}),ge.holdReady=function(e){e?ge.readyWait++:ge.ready(!0)},ge.isArray=Array.isArray,ge.parseJSON=JSON.parse,ge.nodeName=o,"function"==typeof define&&define.amd&&define("jquery",[],function(){return ge});var qt=e.jQuery,Wt=e.$;return ge.noConflict=function(t){return e.$===ge&&(e.$=Wt),t&&e.jQuery===ge&&(e.jQuery=qt),ge},t||(e.jQuery=e.$=ge),ge}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("underscore",t):(e="undefined"!=typeof globalThis?globalThis:e||self,function(){var n=e._,i=e._=t();i.noConflict=function(){return e._=n,i}}())}(this,function(){function e(e,t){return t=null==t?e.length-1:+t,function(){for(var n=Math.max(arguments.length-t,0),i=Array(n),o=0;o<n;o++)i[o]=arguments[o+t];switch(t){case 0:return e.call(this,i);case 1:return e.call(this,arguments[0],i);case 2:return e.call(this,arguments[0],arguments[1],i)}var r=Array(t+1);for(o=0;o<t;o++)r[o]=arguments[o];return r[t]=i,e.apply(this,r)}}function t(e){var t=typeof e;return"function"===t||"object"===t&&!!e}function n(e){return void 0===e}function i(e){
return!0===e||!1===e||"[object Boolean]"===we.call(e)}function o(e){var t="[object "+e+"]";return function(e){return we.call(e)===t}}function r(e,t){return null!=e&&_e.call(e,t)}function s(e){return Re(e)&&ke(e)}function l(e){return function(){return e}}function a(e){return function(t){var n=e(t);return"number"==typeof n&&n>=0&&n<=Ie}}function u(e){return function(t){return null==t?void 0:t[e]}}function d(e,t){t=function(e){for(var t={},n=e.length,i=0;i<n;++i)t[e[i]]=!0;return{contains:function(e){return!0===t[e]},push:function(n){return t[n]=!0,e.push(n)}}}(t);var n=Ne.length,i=e.constructor,o=Ge(i)&&i.prototype||me,s="constructor";for(r(e,s)&&!t.contains(s)&&t.push(s);n--;)(s=Ne[n])in e&&e[s]!==o[s]&&!t.contains(s)&&t.push(s)}function c(e){if(!t(e))return[];if(Se)return Se(e);var n=[];for(var i in e)r(e,i)&&n.push(i);return Oe&&d(e,n),n}function h(e,t){var n=c(t),i=n.length;if(null==e)return!i;for(var o=Object(e),r=0;r<i;r++){var s=n[r];if(t[s]!==o[s]||!(s in o))return!1}return!0}function p(e){return e instanceof p?e:this instanceof p?void(this._wrapped=e):new p(e)}function f(e){return new Uint8Array(e.buffer||e,e.byteOffset||0,Je(e))}function g(e,t,n,i){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return!1;if(e!=e)return t!=t;var o=typeof e;return("function"===o||"object"===o||"object"==typeof t)&&function e(t,n,i,o){t instanceof p&&(t=t._wrapped),n instanceof p&&(n=n._wrapped);var s=we.call(t);if(s!==we.call(n))return!1;if(Ve&&"[object Object]"==s&&We(t)){if(!We(n))return!1;s=nt}switch(s){case"[object RegExp]":case"[object String]":return""+t==""+n;case"[object Number]":return+t!=+t?+n!=+n:0==+t?1/+t==1/n:+t==+n;case"[object Date]":case"[object Boolean]":return+t==+n;case"[object Symbol]":return ve.valueOf.call(t)===ve.valueOf.call(n);case"[object ArrayBuffer]":case nt:return e(f(t),f(n),i,o)}var l="[object Array]"===s;if(!l&&et(t)){if(Je(t)!==Je(n))return!1;if(t.buffer===n.buffer&&t.byteOffset===n.byteOffset)return!0;l=!0}if(!l){if("object"!=typeof t||"object"!=typeof n)return!1;var a=t.constructor,u=n.constructor;if(a!==u&&!(Ge(a)&&a instanceof a&&Ge(u)&&u instanceof u)&&"constructor"in t&&"constructor"in n)return!1}o=o||[];for(var d=(i=i||[]).length;d--;)if(i[d]===t)return o[d]===n;if(i.push(t),o.push(n),l){if((d=t.length)!==n.length)return!1;for(;d--;)if(!g(t[d],n[d],i,o))return!1}else{var h,m=c(t);if(d=m.length,c(n).length!==d)return!1;for(;d--;)if(h=m[d],!r(n,h)||!g(t[h],n[h],i,o))return!1}return i.pop(),o.pop(),!0}(e,t,n,i)}function m(e){if(!t(e))return[];var n=[];for(var i in e)n.push(i);return Oe&&d(e,n),n}function v(e){var t=tt(e);return function(n){if(null==n)return!1;var i=m(n);if(tt(i))return!1;for(var o=0;o<t;o++)if(!Ge(n[e[o]]))return!1;return e!==lt||!Ge(n[it])}}function y(e){for(var t=c(e),n=t.length,i=Array(n),o=0;o<n;o++)i[o]=e[t[o]];return i}function b(e){for(var t={},n=c(e),i=0,o=n.length;i<o;i++)t[e[n[i]]]=n[i];return t}function w(e){var t=[];for(var n in e)Ge(e[n])&&t.push(n);return t.sort()}function _(e,t){return function(n){var i=arguments.length;if(t&&(n=Object(n)),i<2||null==n)return n;for(var o=1;o<i;o++)for(var r=arguments[o],s=e(r),l=s.length,a=0;a<l;a++){var u=s[a];t&&void 0!==n[u]||(n[u]=r[u])}return n}}function x(e){if(!t(e))return{};if(Ce)return Ce(e);var n=function(){};n.prototype=e;var i=new n;return n.prototype=null,i}function E(e){return Ye(e)?e:[e]}function A(e){return p.toPath(e)}function S(e,t){for(var n=t.length,i=0;i<n;i++){if(null==e)return;e=e[t[i]]}return n?e:void 0}function C(e,t,i){var o=S(e,A(t));return n(o)?i:o}function F(e){return e}function k(e){return e=ft({},e),function(t){return h(t,e)}}function T(e){return e=A(e),function(t){return S(t,e)}}function O(e,t,n){if(void 0===t)return e;switch(null==n?3:n){case 1:return function(n){return e.call(t,n)};case 3:return function(n,i,o){return e.call(t,n,i,o)};case 4:return function(n,i,o,r){return e.call(t,n,i,o,r)}}return function(){return e.apply(t,arguments)}}function N(e,n,i){return null==e?F:Ge(e)?O(e,n,i):t(e)&&!Ye(e)?k(e):T(e)}function I(e,t){return N(e,t,1/0)}function L(e,t,n){return p.iteratee!==I?p.iteratee(e,t):N(e,t,n)}function R(){}function P(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))}function D(e){var t=function(t){return e[t]},n="(?:"+c(e).join("|")+")",i=RegExp(n),o=RegExp(n,"g");return function(e){return e=null==e?"":""+e,i.test(e)?e.replace(o,t):e}}function M(e){return"\\"+xt[e]}function $(e,n,i,o,r){if(!(o instanceof n))return e.apply(i,r);var s=x(e.prototype),l=e.apply(s,r);return t(l)?l:s}function B(e,t,n,i){if(i=i||[],t||0===t){if(t<=0)return i.concat(e)}else t=1/0;for(var o=i.length,r=0,s=tt(e);r<s;r++){var l=e[r];if(kt(l)&&(Ye(l)||Xe(l)))if(t>1)B(l,t-1,n,i),o=i.length;else for(var a=0,u=l.length;a<u;)i[o++]=l[a++];else n||(i[o++]=l)}return i}function j(e){return function(){return!e.apply(this,arguments)}}function H(e,t){var n;return function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=null),n}}function G(e,t,n){t=L(t,n);for(var i,o=c(e),r=0,s=o.length;r<s;r++)if(t(e[i=o[r]],i,e))return i}function z(e){return function(t,n,i){n=L(n,i);for(var o=tt(t),r=e>0?0:o-1;r>=0&&r<o;r+=e)if(n(t[r],r,t))return r;return-1}}function V(e,t,n,i){for(var o=(n=L(n,i,1))(t),r=0,s=tt(e);r<s;){var l=Math.floor((r+s)/2);n(e[l])<o?r=l+1:s=l}return r}function U(e,t,n){return function(i,o,r){var l=0,a=tt(i);if("number"==typeof r)e>0?l=r>=0?r:Math.max(r+a,l):a=r>=0?Math.min(r+1,a):r+a+1;else if(n&&r&&a)return i[r=n(i,o)]===o?r:-1;if(o!=o)return(r=t(be.call(i,l,a),s))>=0?r+l:-1;for(r=e>0?l:a-1;r>=0&&r<a;r+=e)if(i[r]===o)return r;return-1}}function q(e,t,n){var i=(kt(e)?Lt:G)(e,t,n);if(void 0!==i&&-1!==i)return e[i]}function W(e,t,n){var i,o;if(t=O(t,n),kt(e))for(i=0,o=e.length;i<o;i++)t(e[i],i,e);else{var r=c(e);for(i=0,o=r.length;i<o;i++)t(e[r[i]],r[i],e)}return e}function Y(e,t,n){t=L(t,n);for(var i=!kt(e)&&c(e),o=(i||e).length,r=Array(o),s=0;s<o;s++){var l=i?i[s]:s;r[s]=t(e[l],l,e)}return r}function K(e){var t=function(t,n,i,o){var r=!kt(t)&&c(t),s=(r||t).length,l=e>0?0:s-1;for(o||(i=t[r?r[l]:l],l+=e);l>=0&&l<s;l+=e){var a=r?r[l]:l;i=n(i,t[a],a,t)}return i};return function(e,n,i,o){var r=arguments.length>=3;return t(e,O(n,o,4),i,r)}}function X(e,t,n){var i=[];return t=L(t,n),W(e,function(e,n,o){t(e,n,o)&&i.push(e)}),i}function J(e,t,n){t=L(t,n);for(var i=!kt(e)&&c(e),o=(i||e).length,r=0;r<o;r++){var s=i?i[r]:r;if(!t(e[s],s,e))return!1}return!0}function Q(e,t,n){t=L(t,n);for(var i=!kt(e)&&c(e),o=(i||e).length,r=0;r<o;r++){var s=i?i[r]:r;if(t(e[s],s,e))return!0}return!1}function Z(e,t,n,i){return kt(e)||(e=y(e)),("number"!=typeof n||i)&&(n=0),Pt(e,t,n)>=0}function ee(e,t){return Y(e,T(t))}function te(e,t,n){var i,o,r=-1/0,s=-1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var l=0,a=(e=kt(e)?e:y(e)).length;l<a;l++)null!=(i=e[l])&&i>r&&(r=i);else t=L(t,n),W(e,function(e,n,i){((o=t(e,n,i))>s||o===-1/0&&r===-1/0)&&(r=e,s=o)});return r}function ne(e){return e?Ye(e)?be.call(e):Le(e)?e.match(jt):kt(e)?Y(e,F):y(e):[]}function ie(e,t,n){if(null==t||n)return kt(e)||(e=y(e)),e[P(e.length-1)];var i=ne(e),o=tt(i);t=Math.max(Math.min(t,o),0);for(var r=o-1,s=0;s<t;s++){var l=P(s,r),a=i[s];i[s]=i[l],i[l]=a}return i.slice(0,t)}function oe(e,t){return function(n,i,o){var r=t?[[],[]]:{};return i=L(i,o),W(n,function(t,o){var s=i(t,o,n);e(r,t,s)}),r}}function re(e,t,n){return t in n}function se(e,t,n){return be.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))}function le(e,t,n){return null==e||e.length<1?null==t||n?void 0:[]:null==t||n?e[0]:se(e,e.length-t)}function ae(e,t,n){return be.call(e,null==t||n?1:t)}function ue(e,t,n,o){i(t)||(o=n,n=t,t=!1),null!=n&&(n=L(n,o));for(var r=[],s=[],l=0,a=tt(e);l<a;l++){var u=e[l],d=n?n(u,l,e):u;t&&!n?(l&&s===d||r.push(u),s=d):n?Z(s,d)||(s.push(d),r.push(u)):Z(r,u)||r.push(u)}return r}function de(e){for(var t=e&&te(e,tt).length||0,n=Array(t),i=0;i<t;i++)n[i]=ee(e,i);return n}function ce(e,t){return e._chain?p(t).chain():t}function he(e){return W(w(e),function(t){var n=p[t]=e[t];p.prototype[t]=function(){var e=[this._wrapped];return ye.apply(e,arguments),ce(this,n.apply(p,e))}}),p}var pe="1.13.7",fe="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||Function("return this")()||{},ge=Array.prototype,me=Object.prototype,ve="undefined"!=typeof Symbol?Symbol.prototype:null,ye=ge.push,be=ge.slice,we=me.toString,_e=me.hasOwnProperty,xe="undefined"!=typeof ArrayBuffer,Ee="undefined"!=typeof DataView,Ae=Array.isArray,Se=Object.keys,Ce=Object.create,Fe=xe&&ArrayBuffer.isView,ke=isNaN,Te=isFinite,Oe=!{toString:null}.propertyIsEnumerable("toString"),Ne=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],Ie=Math.pow(2,53)-1,Le=o("String"),Re=o("Number"),Pe=o("Date"),De=o("RegExp"),Me=o("Error"),$e=o("Symbol"),Be=o("ArrayBuffer"),je=o("Function"),He=fe.document&&fe.document.childNodes;"function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof He&&(je=function(e){return"function"==typeof e||!1});var Ge=je,ze=o("Object"),Ve=Ee&&(!/\[native code\]/.test(String(DataView))||ze(new DataView(new ArrayBuffer(8)))),Ue="undefined"!=typeof Map&&ze(new Map),qe=o("DataView"),We=Ve?function(e){return null!=e&&Ge(e.getInt8)&&Be(e.buffer)}:qe,Ye=Ae||o("Array"),Ke=o("Arguments");!function(){Ke(arguments)||(Ke=function(e){return r(e,"callee")})}();var Xe=Ke,Je=u("byteLength"),Qe=a(Je),Ze=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/,et=xe?function(e){return Fe?Fe(e)&&!We(e):Qe(e)&&Ze.test(we.call(e))}:l(!1),tt=u("length");p.VERSION=pe,p.prototype.value=function(){return this._wrapped},p.prototype.valueOf=p.prototype.toJSON=p.prototype.value,p.prototype.toString=function(){return String(this._wrapped)};var nt="[object DataView]",it="forEach",ot=["clear","delete"],rt=["get","has","set"],st=ot.concat(it,rt),lt=ot.concat(rt),at=["add"].concat(ot,it,"has"),ut=Ue?v(st):o("Map"),dt=Ue?v(lt):o("WeakMap"),ct=Ue?v(at):o("Set"),ht=o("WeakSet"),pt=_(m),ft=_(c),gt=_(m,!0);p.toPath=E,p.iteratee=I;var mt=Date.now||function(){return(new Date).getTime()},vt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},yt=D(vt),bt=D(b(vt)),wt=p.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},_t=/(.)^/,xt={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Et=/\\|'|\r|\n|\u2028|\u2029/g,At=/^\s*(\w|\$)+\s*$/,St=0,Ct=e(function(e,t){var n=Ct.placeholder,i=function(){for(var o=0,r=t.length,s=Array(r),l=0;l<r;l++)s[l]=t[l]===n?arguments[o++]:t[l];for(;o<arguments.length;)s.push(arguments[o++]);return $(e,i,this,this,s)};return i});Ct.placeholder=p;var Ft=e(function(t,n,i){if(!Ge(t))throw new TypeError("Bind must be called on a function");var o=e(function(e){return $(t,o,n,this,i.concat(e))});return o}),kt=a(tt),Tt=e(function(e,t){var n=(t=B(t,!1,!1)).length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var i=t[n];e[i]=Ft(e[i],e)}return e}),Ot=e(function(e,t,n){return setTimeout(function(){return e.apply(null,n)},t)}),Nt=Ct(Ot,p,1),It=Ct(H,2),Lt=z(1),Rt=z(-1),Pt=U(1,Lt,V),Dt=U(-1,Rt),Mt=K(1),$t=K(-1),Bt=e(function(e,t,n){var i,o;return Ge(t)?o=t:(t=A(t),i=t.slice(0,-1),t=t[t.length-1]),Y(e,function(e){var r=o;if(!r){if(i&&i.length&&(e=S(e,i)),null==e)return;r=e[t]}return null==r?r:r.apply(e,n)})}),jt=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g,Ht=oe(function(e,t,n){r(e,n)?e[n].push(t):e[n]=[t]}),Gt=oe(function(e,t,n){e[n]=t}),zt=oe(function(e,t,n){r(e,n)?e[n]++:e[n]=1}),Vt=oe(function(e,t,n){e[n?0:1].push(t)},!0),Ut=e(function(e,t){var n={},i=t[0];if(null==e)return n;Ge(i)?(t.length>1&&(i=O(i,t[1])),t=m(e)):(i=re,t=B(t,!1,!1),e=Object(e));for(var o=0,r=t.length;o<r;o++){var s=t[o],l=e[s];i(l,s,e)&&(n[s]=l)}return n}),qt=e(function(e,t){var n,i=t[0];return Ge(i)?(i=j(i),t.length>1&&(n=t[1])):(t=Y(B(t,!1,!1),String),i=function(e,n){return!Z(t,n)}),Ut(e,i,n)}),Wt=e(function(e,t){return t=B(t,!0,!0),X(e,function(e){return!Z(t,e)})}),Yt=e(function(e,t){return Wt(e,t)}),Kt=e(function(e){return ue(B(e,!0,!0))}),Xt=e(de);W(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=ge[e];p.prototype[e]=function(){var n=this._wrapped;return null!=n&&(t.apply(n,arguments),"shift"!==e&&"splice"!==e||0!==n.length||delete n[0]),ce(this,n)}}),W(["concat","join","slice"],function(e){var t=ge[e];p.prototype[e]=function(){var e=this._wrapped;return null!=e&&(e=t.apply(e,arguments)),ce(this,e)}});var Jt=he({__proto__:null,VERSION:pe,restArguments:e,isObject:t,isNull:function(e){return null===e},isUndefined:n,isBoolean:i,isElement:function(e){return!(!e||1!==e.nodeType)},isString:Le,isNumber:Re,isDate:Pe,isRegExp:De,isError:Me,isSymbol:$e,isArrayBuffer:Be,isDataView:We,isArray:Ye,isFunction:Ge,isArguments:Xe,isFinite:function(e){return!$e(e)&&Te(e)&&!isNaN(parseFloat(e))},isNaN:s,isTypedArray:et,isEmpty:function(e){if(null==e)return!0;var t=tt(e);return"number"==typeof t&&(Ye(e)||Le(e)||Xe(e))?0===t:0===tt(c(e))},isMatch:h,isEqual:function(e,t){return g(e,t)},isMap:ut,isWeakMap:dt,isSet:ct,isWeakSet:ht,keys:c,allKeys:m,values:y,pairs:function(e){for(var t=c(e),n=t.length,i=Array(n),o=0;o<n;o++)i[o]=[t[o],e[t[o]]];return i},invert:b,functions:w,methods:w,extend:pt,extendOwn:ft,assign:ft,defaults:gt,create:function(e,t){var n=x(e);return t&&ft(n,t),n},clone:function(e){return t(e)?Ye(e)?e.slice():pt({},e):e},tap:function(e,t){return t(e),e},get:C,has:function(e,t){for(var n=(t=A(t)).length,i=0;i<n;i++){var o=t[i];if(!r(e,o))return!1;e=e[o]}return!!n},mapObject:function(e,t,n){t=L(t,n);for(var i=c(e),o=i.length,r={},s=0;s<o;s++){var l=i[s];r[l]=t(e[l],l,e)}return r},identity:F,constant:l,noop:R,toPath:E,property:T,propertyOf:function(e){return null==e?R:function(t){return C(e,t)}},matcher:k,matches:k,times:function(e,t,n){var i=Array(Math.max(0,e));t=O(t,n,1);for(var o=0;o<e;o++)i[o]=t(o);return i},random:P,now:mt,escape:yt,unescape:bt,templateSettings:wt,template:function(e,t,n){!t&&n&&(t=n),t=gt({},t,p.templateSettings);var i=RegExp([(t.escape||_t).source,(t.interpolate||_t).source,(t.evaluate||_t).source].join("|")+"|$","g"),o=0,r="__p+='";e.replace(i,function(t,n,i,s,l){return r+=e.slice(o,l).replace(Et,M),o=l+t.length,n?r+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":i?r+="'+\n((__t=("+i+"))==null?'':__t)+\n'":s&&(r+="';\n"+s+"\n__p+='"),t}),r+="';\n";var s,l=t.variable;if(l){if(!At.test(l))throw new Error("variable is not a bare identifier: "+l)}else r="with(obj||{}){\n"+r+"}\n",l="obj";r="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+r+"return __p;\n";try{s=new Function(l,"_",r)}catch(e){throw e.source=r,e}var a=function(e){return s.call(this,e,p)};return a.source="function("+l+"){\n"+r+"}",a},result:function(e,t,n){var i=(t=A(t)).length;if(!i)return Ge(n)?n.call(e):n;for(var o=0;o<i;o++){var r=null==e?void 0:e[t[o]];void 0===r&&(r=n,o=i),e=Ge(r)?r.call(e):r}return e},uniqueId:function(e){var t=++St+"";return e?e+t:t},chain:function(e){var t=p(e);return t._chain=!0,t},iteratee:I,partial:Ct,bind:Ft,bindAll:Tt,memoize:function(e,t){var n=function(i){var o=n.cache,s=""+(t?t.apply(this,arguments):i);return r(o,s)||(o[s]=e.apply(this,arguments)),o[s]};return n.cache={},n},delay:Ot,defer:Nt,throttle:function(e,t,n){var i,o,r,s,l=0;n||(n={});var a=function(){l=!1===n.leading?0:mt(),i=null,s=e.apply(o,r),i||(o=r=null)},u=function(){var u=mt();l||!1!==n.leading||(l=u);var d=t-(u-l);return o=this,r=arguments,d<=0||d>t?(i&&(clearTimeout(i),i=null),l=u,s=e.apply(o,r),i||(o=r=null)):i||!1===n.trailing||(i=setTimeout(a,d)),s};return u.cancel=function(){clearTimeout(i),l=0,i=o=r=null},u},debounce:function(t,n,i){var o,r,s,l,a,u=function(){var e=mt()-r;n>e?o=setTimeout(u,n-e):(o=null,i||(l=t.apply(a,s)),o||(s=a=null))},d=e(function(e){return a=this,s=e,r=mt(),o||(o=setTimeout(u,n),i&&(l=t.apply(a,s))),l});return d.cancel=function(){clearTimeout(o),o=s=a=null},d},wrap:function(e,t){return Ct(t,e)},negate:j,compose:function(){var e=arguments,t=e.length-1;return function(){for(var n=t,i=e[t].apply(this,arguments);n--;)i=e[n].call(this,i);return i}},after:function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},before:H,once:It,findKey:G,findIndex:Lt,findLastIndex:Rt,sortedIndex:V,indexOf:Pt,lastIndexOf:Dt,find:q,detect:q,findWhere:function(e,t){return q(e,k(t))},each:W,forEach:W,map:Y,collect:Y,reduce:Mt,foldl:Mt,inject:Mt,reduceRight:$t,foldr:$t,filter:X,select:X,reject:function(e,t,n){return X(e,j(L(t)),n)},every:J,all:J,some:Q,any:Q,contains:Z,includes:Z,include:Z,invoke:Bt,pluck:ee,where:function(e,t){return X(e,k(t))},max:te,min:function(e,t,n){var i,o,r=1/0,s=1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var l=0,a=(e=kt(e)?e:y(e)).length;l<a;l++)null!=(i=e[l])&&i<r&&(r=i);else t=L(t,n),W(e,function(e,n,i){((o=t(e,n,i))<s||o===1/0&&r===1/0)&&(r=e,s=o)});return r},shuffle:function(e){return ie(e,1/0)},sample:ie,sortBy:function(e,t,n){var i=0;return t=L(t,n),ee(Y(e,function(e,n,o){return{value:e,index:i++,criteria:t(e,n,o)}}).sort(function(e,t){var n=e.criteria,i=t.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(n<i||void 0===i)return-1}return e.index-t.index}),"value")},groupBy:Ht,indexBy:Gt,countBy:zt,partition:Vt,toArray:ne,size:function(e){return null==e?0:kt(e)?e.length:c(e).length},pick:Ut,omit:qt,first:le,head:le,take:le,initial:se,last:function(e,t,n){return null==e||e.length<1?null==t||n?void 0:[]:null==t||n?e[e.length-1]:ae(e,Math.max(0,e.length-t))},rest:ae,tail:ae,drop:ae,compact:function(e){return X(e,Boolean)},flatten:function(e,t){return B(e,t,!1)},without:Yt,uniq:ue,unique:ue,union:Kt,intersection:function(e){for(var t=[],n=arguments.length,i=0,o=tt(e);i<o;i++){var r=e[i];if(!Z(t,r)){var s;for(s=1;s<n&&Z(arguments[s],r);s++);s===n&&t.push(r)}}return t},difference:Wt,unzip:de,transpose:de,zip:Xt,object:function(e,t){for(var n={},i=0,o=tt(e);i<o;i++)t?n[e[i]]=t[i]:n[e[i][0]]=e[i][1];return n},range:function(e,t,n){null==t&&(t=e||0,e=0),n||(n=t<e?-1:1);for(var i=Math.max(Math.ceil((t-e)/n),0),o=Array(i),r=0;r<i;r++,e+=n)o[r]=e;return o},chunk:function(e,t){if(null==t||t<1)return[];for(var n=[],i=0,o=e.length;i<o;)n.push(be.call(e,i,i+=t));return n},mixin:he,default:p});return Jt._=Jt,Jt}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define("async",["exports"],t):t(e.async=e.async||{})}(this,function(e){"use strict";function t(e,t){t|=0;for(var n=Math.max(e.length-t,0),i=Array(n),o=0;o<n;o++)i[o]=e[t+o];return i}function n(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function i(e){setTimeout(e,0)}function o(e){return function(n){var i=t(arguments,1);e(function(){n.apply(null,i)})}}function r(e){return nt(function(t,i){var o;try{o=e.apply(this,t)}catch(e){return i(e)}n(o)&&"function"==typeof o.then?o.then(function(e){s(i,null,e)},function(e){s(i,e.message?e:new Error(e))}):i(null,o)})}function s(e,t,n){try{e(t,n)}catch(e){rt(l,e)}}function l(e){throw e}function a(e){return st&&"AsyncFunction"===e[Symbol.toStringTag]}function u(e){return a(e)?r(e):e}function d(e){return function(n){var i=t(arguments,1),o=nt(function(t,i){var o=this;return e(n,function(e,n){u(e).apply(o,t.concat(n))},i)});return i.length?o.apply(this,i):o}}function c(e){var t=ht.call(e,ft),n=e[ft];try{e[ft]=void 0;var i=!0}catch(e){}var o=pt.call(e);return i&&(t?e[ft]=n:delete e[ft]),o}function h(e){return mt.call(e)}function p(e){return null==e?void 0===e?yt:vt:(e=Object(e),bt&&bt in e?c(e):h(e))}function f(e){if(!n(e))return!1;var t=p(e);return t==_t||t==xt||t==wt||t==Et}function g(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=At}function m(e){return null!=e&&g(e.length)&&!f(e)}function v(){}function y(e){return function(){if(null!==e){var t=e;e=null,t.apply(this,arguments)}}}function b(e,t){for(var n=-1,i=Array(e);++n<e;)i[n]=t(n);return i}function w(e){return null!=e&&"object"==typeof e}function _(e){return w(e)&&p(e)==kt}function x(){return!1}function E(e,t){return!!(t=null==t?jt:t)&&("number"==typeof e||Ht.test(e))&&e>-1&&e%1==0&&e<t}function A(e){return w(e)&&g(e.length)&&!!Gt[p(e)]}function S(e,t){var n=Lt(e),i=!n&&It(e),o=!n&&!i&&Bt(e),r=!n&&!i&&!o&&Kt(e),s=n||i||o||r,l=s?b(e.length,String):[],a=l.length;for(var u in e)!t&&!Jt.call(e,u)||s&&("length"==u||o&&("offset"==u||"parent"==u)||r&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||E(u,a))||l.push(u);return l}function C(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Qt)}function F(e){if(!C(e))return Zt(e);var t=[];for(var n in Object(e))tn.call(e,n)&&"constructor"!=n&&t.push(n);return t}function k(e){return m(e)?S(e):F(e)}function T(e){var t=-1,n=e.length;return function(){return++t<n?{value:e[t],key:t}:null}}function O(e){var t=-1;return function(){var n=e.next();return n.done?null:(t++,{value:n.value,key:t})}}function N(e){var t=k(e),n=-1,i=t.length;return function(){var o=t[++n];return n<i?{value:e[o],key:o}:null}}function I(e){if(m(e))return T(e);var t=Ft(e);return t?O(t):N(e)}function L(e){return function(){if(null===e)throw new Error("Callback was already called.");var t=e;e=null,t.apply(this,arguments)}}function R(e){return function(t,n,i){function o(e,t){if(a-=1,e)l=!0,i(e);else{if(t===St||l&&a<=0)return l=!0,i(null);r()}}function r(){for(;a<e&&!l;){var t=s();if(null===t)return l=!0,void(a<=0&&i(null));a+=1,n(t.value,t.key,L(o))}}if(i=y(i||v),e<=0||!t)return i(null);var s=I(t),l=!1,a=0;r()}}function P(e,t,n,i){R(t)(e,u(n),i)}function D(e,t){return function(n,i,o){return e(n,t,i,o)}}function M(e,t,n){function i(e,t){e?n(e):++r!==s&&t!==St||n(null)}n=y(n||v);var o=0,r=0,s=e.length;for(0===s&&n(null);o<s;o++)t(e[o],o,L(i))}function $(e){return function(t,n,i){return e(on,t,u(n),i)}}function B(e,t,n,i){i=i||v,t=t||[];var o=[],r=0,s=u(n);e(t,function(e,t,n){var i=r++;s(e,function(e,t){o[i]=t,n(e)})},function(e){i(e,o)})}function j(e){return function(t,n,i,o){return e(R(n),t,u(i),o)}}function H(e,t){for(var n=-1,i=null==e?0:e.length;++n<i&&!1!==t(e[n],n,e););return e}function G(e,t){return e&&cn(e,t,k)}function z(e,t,n,i){for(var o=e.length,r=n+(i?1:-1);i?r--:++r<o;)if(t(e[r],r,e))return r;return-1}function V(e){return e!==e}function U(e,t,n){for(var i=n-1,o=e.length;++i<o;)if(e[i]===t)return i;return-1}function q(e,t,n){return t===t?U(e,t,n):z(e,V,n)}function W(e,t){for(var n=-1,i=null==e?0:e.length,o=Array(i);++n<i;)o[n]=t(e[n],n,e);return o}function Y(e){return"symbol"==typeof e||w(e)&&p(e)==pn}function K(e){if("string"==typeof e)return e;if(Lt(e))return W(e,K)+"";if(Y(e))return mn?mn.call(e):"";var t=e+"";return"0"==t&&1/e==-fn?"-0":t}function X(e,t,n){var i=-1,o=e.length;t<0&&(t=-t>o?0:o+t),n=n>o?o:n,n<0&&(n+=o),o=t>n?0:n-t>>>0,t>>>=0;for(var r=Array(o);++i<o;)r[i]=e[i+t];return r}function J(e,t,n){var i=e.length;return n=void 0===n?i:n,!t&&n>=i?e:X(e,t,n)}function Q(e,t){for(var n=e.length;n--&&q(t,e[n],0)>-1;);return n}function Z(e,t){for(var n=-1,i=e.length;++n<i&&q(t,e[n],0)>-1;);return n}function ee(e){return e.split("")}function te(e){return vn.test(e)}function ne(e){return e.match(Tn)||[]}function ie(e){return te(e)?ne(e):ee(e)}function oe(e){return null==e?"":K(e)}function re(e,t,n){if((e=oe(e))&&(n||void 0===t))return e.replace(On,"");if(!e||!(t=K(t)))return e;var i=ie(e),o=ie(t);return J(i,Z(i,o),Q(i,o)+1).join("")}function se(e){return e=e.toString().replace(Rn,""),e=e.match(Nn)[2].replace(" ",""),e=e?e.split(In):[],e=e.map(function(e){return re(e.replace(Ln,""))})}function le(e,t){var n={};G(e,function(e,t){function i(t,n){var i=W(o,function(e){return t[e]});i.push(n),u(e).apply(null,i)}var o,r=a(e),s=!r&&1===e.length||r&&0===e.length;if(Lt(e))o=e.slice(0,-1),e=e[e.length-1],n[t]=o.concat(o.length>0?i:e);else if(s)n[t]=e;else{if(o=se(e),0===e.length&&!r&&0===o.length)throw new Error("autoInject task functions require explicit parameters.");r||o.pop(),n[t]=o.concat(i)}}),hn(n,t)}function ae(){this.head=this.tail=null,this.length=0}function ue(e,t){e.length=1,e.head=e.tail=t}function de(e,t,n){function i(e,t,n){if(null!=n&&"function"!=typeof n)throw new Error("task callback must be a function");if(d.started=!0,Lt(e)||(e=[e]),0===e.length&&d.idle())return rt(function(){d.drain()});for(var i=0,o=e.length;i<o;i++){var r={data:e[i],callback:n||v};t?d._tasks.unshift(r):d._tasks.push(r)}rt(d.process)}function o(e){return function(t){s-=1;for(var n=0,i=e.length;n<i;n++){var o=e[n],r=q(l,o,0);r>=0&&l.splice(r,1),o.callback.apply(o,arguments),null!=t&&d.error(t,o.data)}s<=d.concurrency-d.buffer&&d.unsaturated(),d.idle()&&d.drain(),d.process()}}if(null==t)t=1;else if(0===t)throw new Error("Concurrency must not be zero");var r=u(e),s=0,l=[],a=!1,d={_tasks:new ae,concurrency:t,payload:n,saturated:v,unsaturated:v,buffer:t/4,empty:v,drain:v,error:v,started:!1,paused:!1,push:function(e,t){i(e,!1,t)},kill:function(){d.drain=v,d._tasks.empty()},unshift:function(e,t){i(e,!0,t)},remove:function(e){d._tasks.remove(e)},process:function(){if(!a){for(a=!0;!d.paused&&s<d.concurrency&&d._tasks.length;){var e=[],t=[],n=d._tasks.length;d.payload&&(n=Math.min(n,d.payload));for(var i=0;i<n;i++){var u=d._tasks.shift();e.push(u),l.push(u),t.push(u.data)}s+=1,0===d._tasks.length&&d.empty(),s===d.concurrency&&d.saturated();var c=L(o(e));r(t,c)}a=!1}},length:function(){return d._tasks.length},running:function(){return s},workersList:function(){return l},idle:function(){return d._tasks.length+s===0},pause:function(){d.paused=!0},resume:function(){!1!==d.paused&&(d.paused=!1,rt(d.process))}};return d}function ce(e,t){return de(e,1,t)}function he(e,t,n,i){i=y(i||v);var o=u(n);Dn(e,function(e,n,i){o(t,e,function(e,n){t=n,i(e)})},function(e){i(e,t)})}function pe(){var e=W(arguments,u);return function(){var n=t(arguments),i=this,o=n[n.length-1];"function"==typeof o?n.pop():o=v,he(e,n,function(e,n,o){n.apply(i,e.concat(function(e){var n=t(arguments,1);o(e,n)}))},function(e,t){o.apply(i,[e].concat(t))})}}function fe(e){return e}function ge(e,t){return function(n,i,o,r){r=r||v;var s,l=!1;n(i,function(n,i,r){o(n,function(i,o){i?r(i):e(o)&&!s?(l=!0,s=t(!0,n),r(null,St)):r()})},function(e){e?r(e):r(null,l?s:t(!1))})}}function me(e,t){return t}function ve(e){return function(n){var i=t(arguments,1);i.push(function(n){var i=t(arguments,1);"object"==typeof console&&(n?console.error&&console.error(n):console[e]&&H(i,function(t){console[e](t)}))}),u(n).apply(null,i)}}function ye(e,n,i){function o(e){if(e)return i(e);var n=t(arguments,1);n.push(r),l.apply(this,n)}function r(e,t){return e?i(e):t?void s(o):i(null)}i=L(i||v);var s=u(e),l=u(n);r(null,!0)}function be(e,n,i){i=L(i||v);var o=u(e),r=function(e){if(e)return i(e);var s=t(arguments,1);return n.apply(this,s)?o(r):void i.apply(null,[null].concat(s))};o(r)}function we(e,t,n){be(e,function(){return!t.apply(this,arguments)},n)}function _e(e,t,n){function i(e){return e?n(e):void s(o)}function o(e,t){return e?n(e):t?void r(i):n(null)}n=L(n||v);var r=u(t),s=u(e);s(o)}function xe(e){return function(t,n,i){return e(t,i)}}function Ee(e,t,n){on(e,xe(u(t)),n)}function Ae(e,t,n,i){R(t)(e,xe(u(n)),i)}function Se(e){return a(e)?e:nt(function(t,n){var i=!0;t.push(function(){var e=arguments;i?rt(function(){n.apply(null,e)}):n.apply(null,e)}),e.apply(this,t),i=!1})}function Ce(e){return!e}function Fe(e){return function(t){return null==t?void 0:t[e]}}function ke(e,t,n,i){var o=new Array(t.length);e(t,function(e,t,i){n(e,function(e,n){o[t]=!!n,i(e)})},function(e){if(e)return i(e);for(var n=[],r=0;r<t.length;r++)o[r]&&n.push(t[r]);i(null,n)})}function Te(e,t,n,i){var o=[];e(t,function(e,t,i){n(e,function(n,r){n?i(n):(r&&o.push({index:t,value:e}),i())})},function(e){e?i(e):i(null,W(o.sort(function(e,t){return e.index-t.index}),Fe("value")))})}function Oe(e,t,n,i){(m(t)?ke:Te)(e,t,u(n),i||v)}function Ne(e,t){function n(e){return e?i(e):void o(n)}var i=L(t||v),o=u(Se(e));n()}function Ie(e,t,n,i){i=y(i||v);var o={},r=u(n);P(e,t,function(e,t,n){r(e,t,function(e,i){return e?n(e):(o[t]=i,void n())})},function(e){i(e,o)})}function Le(e,t){return t in e}function Re(e,n){var i=Object.create(null),o=Object.create(null);n=n||fe;var r=u(e),s=nt(function(e,s){var l=n.apply(null,e);Le(i,l)?rt(function(){s.apply(null,i[l])}):Le(o,l)?o[l].push(s):(o[l]=[s],r.apply(null,e.concat(function(){var e=t(arguments);i[l]=e;var n=o[l];delete o[l];for(var r=0,s=n.length;r<s;r++)n[r].apply(null,e)})))});return s.memo=i,s.unmemoized=e,s}function Pe(e,n,i){i=i||v;var o=m(n)?[]:{};e(n,function(e,n,i){u(e)(function(e,r){arguments.length>2&&(r=t(arguments,1)),o[n]=r,i(e)})},function(e){i(e,o)})}function De(e,t){Pe(on,e,t)}function Me(e,t,n){Pe(R(t),e,n)}function $e(e,t){if(t=y(t||v),!Lt(e))return t(new TypeError("First argument to race must be an array of functions"));if(!e.length)return t();for(var n=0,i=e.length;n<i;n++)u(e[n])(t)}function Be(e,n,i,o){he(t(e).reverse(),n,i,o)}function je(e){var n=u(e);return nt(function(e,i){return e.push(function(e,n){if(e)i(null,{error:e});else{var o;o=arguments.length<=2?n:t(arguments,1),i(null,{value:o})}}),n.apply(this,e)})}function He(e,t,n,i){Oe(e,t,function(e,t){n(e,function(e,n){t(e,!n)})},i)}function Ge(e){var t;return Lt(e)?t=W(e,je):(t={},G(e,function(e,n){t[n]=je.call(this,e)})),t}function ze(e){return function(){return e}}function Ve(e,t,n){function i(){l(function(e){e&&a++<s.times&&("function"!=typeof s.errorFilter||s.errorFilter(e))?setTimeout(i,s.intervalFunc(a)):n.apply(null,arguments)})}var o=5,r=0,s={times:o,intervalFunc:ze(r)};if(arguments.length<3&&"function"==typeof e?(n=t||v,t=e):(function(e,t){if("object"==typeof t)e.times=+t.times||o,e.intervalFunc="function"==typeof t.interval?t.interval:ze(+t.interval||r),e.errorFilter=t.errorFilter;else{if("number"!=typeof t&&"string"!=typeof t)throw new Error("Invalid arguments for async.retry");e.times=+t||o}}(s,e),n=n||v),"function"!=typeof t)throw new Error("Invalid arguments for async.retry");var l=u(t),a=1;i()}function Ue(e,t){Pe(Dn,e,t)}function qe(e,t,n){function i(e,t){var n=e.criteria,i=t.criteria;return n<i?-1:n>i?1:0}var o=u(t);rn(e,function(e,t){o(e,function(n,i){return n?t(n):void t(null,{value:e,criteria:i})})},function(e,t){return e?n(e):void n(null,W(t.sort(i),Fe("value")))})}function We(e,t,n){var i=u(e);return nt(function(o,r){function s(){var t=e.name||"anonymous",i=new Error('Callback function "'+t+'" timed out.');i.code="ETIMEDOUT",n&&(i.info=n),a=!0,r(i)}var l,a=!1;o.push(function(){a||(r.apply(null,arguments),clearTimeout(l))}),l=setTimeout(s,t),i.apply(null,o)})}function Ye(e,t,n,i){for(var o=-1,r=vi(mi((t-e)/(n||1)),0),s=Array(r);r--;)s[i?r:++o]=e,e+=n;return s}function Ke(e,t,n,i){var o=u(n);ln(Ye(0,e,1),t,o,i)}function Xe(e,t,n,i){arguments.length<=3&&(i=n,n=t,t=Lt(e)?[]:{}),i=y(i||v);var o=u(n);on(e,function(e,n,i){o(t,e,n,i)},function(e){i(e,t)})}function Je(e,n){var i,o=null;n=n||v,Wn(e,function(e,n){u(e)(function(e,r){i=arguments.length>2?t(arguments,1):r,o=e,n(!e)})},function(){n(o,i)})}function Qe(e){return function(){return(e.unmemoized||e).apply(null,arguments)}}function Ze(e,n,i){i=L(i||v);var o=u(n);if(!e())return i(null);var r=function(n){if(n)return i(n);if(e())return o(r);var s=t(arguments,1);i.apply(null,[null].concat(s))};o(r)}function et(e,t,n){Ze(function(){return!e.apply(this,arguments)},t,n)}var tt,nt=function(e){return function(){var n=t(arguments),i=n.pop();e.call(this,n,i)}},it="function"==typeof setImmediate&&setImmediate,ot="object"==typeof process&&"function"==typeof process.nextTick;tt=it?setImmediate:ot?process.nextTick:i
;var rt=o(tt),st="function"==typeof Symbol,lt="object"==typeof global&&global&&global.Object===Object&&global,at="object"==typeof self&&self&&self.Object===Object&&self,ut=lt||at||Function("return this")(),dt=ut.Symbol,ct=Object.prototype,ht=ct.hasOwnProperty,pt=ct.toString,ft=dt?dt.toStringTag:void 0,gt=Object.prototype,mt=gt.toString,vt="[object Null]",yt="[object Undefined]",bt=dt?dt.toStringTag:void 0,wt="[object AsyncFunction]",_t="[object Function]",xt="[object GeneratorFunction]",Et="[object Proxy]",At=9007199254740991,St={},Ct="function"==typeof Symbol&&Symbol.iterator,Ft=function(e){return Ct&&e[Ct]&&e[Ct]()},kt="[object Arguments]",Tt=Object.prototype,Ot=Tt.hasOwnProperty,Nt=Tt.propertyIsEnumerable,It=_(function(){return arguments}())?_:function(e){return w(e)&&Ot.call(e,"callee")&&!Nt.call(e,"callee")},Lt=Array.isArray,Rt="object"==typeof e&&e&&!e.nodeType&&e,Pt=Rt&&"object"==typeof module&&module&&!module.nodeType&&module,Dt=Pt&&Pt.exports===Rt,Mt=Dt?ut.Buffer:void 0,$t=Mt?Mt.isBuffer:void 0,Bt=$t||x,jt=9007199254740991,Ht=/^(?:0|[1-9]\d*)$/,Gt={};Gt["[object Float32Array]"]=Gt["[object Float64Array]"]=Gt["[object Int8Array]"]=Gt["[object Int16Array]"]=Gt["[object Int32Array]"]=Gt["[object Uint8Array]"]=Gt["[object Uint8ClampedArray]"]=Gt["[object Uint16Array]"]=Gt["[object Uint32Array]"]=!0,Gt["[object Arguments]"]=Gt["[object Array]"]=Gt["[object ArrayBuffer]"]=Gt["[object Boolean]"]=Gt["[object DataView]"]=Gt["[object Date]"]=Gt["[object Error]"]=Gt["[object Function]"]=Gt["[object Map]"]=Gt["[object Number]"]=Gt["[object Object]"]=Gt["[object RegExp]"]=Gt["[object Set]"]=Gt["[object String]"]=Gt["[object WeakMap]"]=!1;var zt="object"==typeof e&&e&&!e.nodeType&&e,Vt=zt&&"object"==typeof module&&module&&!module.nodeType&&module,Ut=Vt&&Vt.exports===zt,qt=Ut&&lt.process,Wt=function(){try{return qt&&qt.binding("util")}catch(e){}}(),Yt=Wt&&Wt.isTypedArray,Kt=Yt?function(e){return function(t){return e(t)}}(Yt):A,Xt=Object.prototype,Jt=Xt.hasOwnProperty,Qt=Object.prototype,Zt=function(e,t){return function(n){return e(t(n))}}(Object.keys,Object),en=Object.prototype,tn=en.hasOwnProperty,nn=D(P,1/0),on=function(e,t,n){(m(e)?M:nn)(e,u(t),n)},rn=$(B),sn=d(rn),ln=j(B),an=D(ln,1),un=d(an),dn=function(e){var n=t(arguments,1);return function(){var i=t(arguments);return e.apply(null,n.concat(i))}},cn=function(e){return function(t,n,i){for(var o=-1,r=Object(t),s=i(t),l=s.length;l--;){var a=s[e?l:++o];if(!1===n(r[a],a,r))break}return t}}(),hn=function(e,n,i){function o(e,t){b.push(function(){a(e,t)})}function r(){if(0===b.length&&0===f)return i(null,p);for(;b.length&&f<n;){b.shift()()}}function s(e,t){var n=m[e];n||(n=m[e]=[]),n.push(t)}function l(e){H(m[e]||[],function(e){e()}),r()}function a(e,n){if(!g){var o=L(function(n,o){if(f--,arguments.length>2&&(o=t(arguments,1)),n){var r={};G(p,function(e,t){r[t]=e}),r[e]=o,g=!0,m=Object.create(null),i(n,r)}else p[e]=o,l(e)});f++;var r=u(n[n.length-1]);n.length>1?r(p,o):r(o)}}function d(t){var n=[];return G(e,function(e,i){Lt(e)&&q(e,t,0)>=0&&n.push(i)}),n}"function"==typeof n&&(i=n,n=null),i=y(i||v);var c=k(e),h=c.length;if(!h)return i(null);n||(n=h);var p={},f=0,g=!1,m=Object.create(null),b=[],w=[],_={};G(e,function(t,n){if(!Lt(t))return o(n,[t]),void w.push(n);var i=t.slice(0,t.length-1),r=i.length;return 0===r?(o(n,t),void w.push(n)):(_[n]=r,void H(i,function(l){if(!e[l])throw new Error("async.auto task `"+n+"` has a non-existent dependency `"+l+"` in "+i.join(", "));s(l,function(){0===--r&&o(n,t)})}))}),function(){for(var e,t=0;w.length;)e=w.pop(),t++,H(d(e),function(e){0==--_[e]&&w.push(e)});if(t!==h)throw new Error("async.auto cannot execute tasks due to a recursive dependency")}(),r()},pn="[object Symbol]",fn=1/0,gn=dt?dt.prototype:void 0,mn=gn?gn.toString:void 0,vn=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0\\ufe0e\\ufe0f]"),yn="\\ud800-\\udfff",bn="[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]",wn="\\ud83c[\\udffb-\\udfff]",_n="[^"+yn+"]",xn="(?:\\ud83c[\\udde6-\\uddff]){2}",En="[\\ud800-\\udbff][\\udc00-\\udfff]",An="(?:[\\u0300-\\u036f\\ufe20-\\ufe23\\u20d0-\\u20f0]|\\ud83c[\\udffb-\\udfff])?",Sn="[\\ufe0e\\ufe0f]?",Cn="(?:\\u200d(?:"+[_n,xn,En].join("|")+")"+Sn+An+")*",Fn=Sn+An+Cn,kn="(?:"+[_n+bn+"?",bn,xn,En,"[\\ud800-\\udfff]"].join("|")+")",Tn=RegExp(wn+"(?="+wn+")|"+kn+Fn,"g"),On=/^\s+|\s+$/g,Nn=/^(?:async\s+)?(function)?\s*[^\(]*\(\s*([^\)]*)\)/m,In=/,/,Ln=/(=.+)?(\s*)$/,Rn=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm;ae.prototype.removeLink=function(e){return e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev,e.prev=e.next=null,this.length-=1,e},ae.prototype.empty=function(){for(;this.head;)this.shift();return this},ae.prototype.insertAfter=function(e,t){t.prev=e,t.next=e.next,e.next?e.next.prev=t:this.tail=t,e.next=t,this.length+=1},ae.prototype.insertBefore=function(e,t){t.prev=e.prev,t.next=e,e.prev?e.prev.next=t:this.head=t,e.prev=t,this.length+=1},ae.prototype.unshift=function(e){this.head?this.insertBefore(this.head,e):ue(this,e)},ae.prototype.push=function(e){this.tail?this.insertAfter(this.tail,e):ue(this,e)},ae.prototype.shift=function(){return this.head&&this.removeLink(this.head)},ae.prototype.pop=function(){return this.tail&&this.removeLink(this.tail)},ae.prototype.toArray=function(){for(var e=Array(this.length),t=this.head,n=0;n<this.length;n++)e[n]=t.data,t=t.next;return e},ae.prototype.remove=function(e){for(var t=this.head;t;){var n=t.next;e(t)&&this.removeLink(t),t=n}return this};var Pn,Dn=D(P,1),Mn=function(){return pe.apply(null,t(arguments).reverse())},$n=Array.prototype.concat,Bn=function(e,n,i,o){o=o||v;var r=u(i);ln(e,n,function(e,n){r(e,function(e){return e?n(e):n(null,t(arguments,1))})},function(e,t){for(var n=[],i=0;i<t.length;i++)t[i]&&(n=$n.apply(n,t[i]));return o(e,n)})},jn=D(Bn,1/0),Hn=D(Bn,1),Gn=function(){var e=t(arguments),n=[null].concat(e);return function(){return arguments[arguments.length-1].apply(this,n)}},zn=$(ge(fe,me)),Vn=j(ge(fe,me)),Un=D(Vn,1),qn=ve("dir"),Wn=D(Ae,1),Yn=$(ge(Ce,Ce)),Kn=j(ge(Ce,Ce)),Xn=D(Kn,1),Jn=$(Oe),Qn=j(Oe),Zn=D(Qn,1),ei=function(e,t,n,i){i=i||v;var o=u(n);ln(e,t,function(e,t){o(e,function(n,i){return n?t(n):t(null,{key:i,val:e})})},function(e,t){for(var n={},o=Object.prototype.hasOwnProperty,r=0;r<t.length;r++)if(t[r]){var s=t[r].key,l=t[r].val;o.call(n,s)?n[s].push(l):n[s]=[l]}return i(e,n)})},ti=D(ei,1/0),ni=D(ei,1),ii=ve("log"),oi=D(Ie,1/0),ri=D(Ie,1);Pn=ot?process.nextTick:it?setImmediate:i;var si=o(Pn),li=function(e,t){var n=u(e);return de(function(e,t){n(e[0],t)},t,1)},ai=function(e,t){var n=li(e,t);return n.push=function(e,t,i){if(null==i&&(i=v),"function"!=typeof i)throw new Error("task callback must be a function");if(n.started=!0,Lt(e)||(e=[e]),0===e.length)return rt(function(){n.drain()});t=t||0;for(var o=n._tasks.head;o&&t>=o.priority;)o=o.next;for(var r=0,s=e.length;r<s;r++){var l={data:e[r],priority:t,callback:i};o?n._tasks.insertBefore(o,l):n._tasks.push(l)}rt(n.process)},delete n.unshift,n},ui=$(He),di=j(He),ci=D(di,1),hi=function(e,t){t||(t=e,e=null);var n=u(t);return nt(function(t,i){function o(e){n.apply(null,t.concat(e))}e?Ve(e,o,i):Ve(o,i)})},pi=$(ge(Boolean,fe)),fi=j(ge(Boolean,fe)),gi=D(fi,1),mi=Math.ceil,vi=Math.max,yi=D(Ke,1/0),bi=D(Ke,1),wi=function(e,n){function i(t){var n=u(e[r++]);t.push(L(o)),n.apply(null,t)}function o(o){return o||r===e.length?n.apply(null,arguments):void i(t(arguments,1))}if(n=y(n||v),!Lt(e))return n(new Error("First argument to waterfall must be an array of functions"));if(!e.length)return n();var r=0;i([])},_i={applyEach:sn,applyEachSeries:un,apply:dn,asyncify:r,auto:hn,autoInject:le,cargo:ce,compose:Mn,concat:jn,concatLimit:Bn,concatSeries:Hn,constant:Gn,detect:zn,detectLimit:Vn,detectSeries:Un,dir:qn,doDuring:ye,doUntil:we,doWhilst:be,during:_e,each:Ee,eachLimit:Ae,eachOf:on,eachOfLimit:P,eachOfSeries:Dn,eachSeries:Wn,ensureAsync:Se,every:Yn,everyLimit:Kn,everySeries:Xn,filter:Jn,filterLimit:Qn,filterSeries:Zn,forever:Ne,groupBy:ti,groupByLimit:ei,groupBySeries:ni,log:ii,map:rn,mapLimit:ln,mapSeries:an,mapValues:oi,mapValuesLimit:Ie,mapValuesSeries:ri,memoize:Re,nextTick:si,parallel:De,parallelLimit:Me,priorityQueue:ai,queue:li,race:$e,reduce:he,reduceRight:Be,reflect:je,reflectAll:Ge,reject:ui,rejectLimit:di,rejectSeries:ci,retry:Ve,retryable:hi,seq:pe,series:Ue,setImmediate:rt,some:pi,someLimit:fi,someSeries:gi,sortBy:qe,timeout:We,times:yi,timesLimit:Ke,timesSeries:bi,transform:Xe,tryEach:Je,unmemoize:Qe,until:et,waterfall:wi,whilst:Ze,all:Yn,any:pi,forEach:Ee,forEachSeries:Wn,forEachLimit:Ae,forEachOf:on,forEachOfSeries:Dn,forEachOfLimit:P,inject:he,foldl:he,foldr:Be,select:Jn,selectLimit:Qn,selectSeries:Zn,wrapSync:r};e.default=_i,e.applyEach=sn,e.applyEachSeries=un,e.apply=dn,e.asyncify=r,e.auto=hn,e.autoInject=le,e.cargo=ce,e.compose=Mn,e.concat=jn,e.concatLimit=Bn,e.concatSeries=Hn,e.constant=Gn,e.detect=zn,e.detectLimit=Vn,e.detectSeries=Un,e.dir=qn,e.doDuring=ye,e.doUntil=we,e.doWhilst=be,e.during=_e,e.each=Ee,e.eachLimit=Ae,e.eachOf=on,e.eachOfLimit=P,e.eachOfSeries=Dn,e.eachSeries=Wn,e.ensureAsync=Se,e.every=Yn,e.everyLimit=Kn,e.everySeries=Xn,e.filter=Jn,e.filterLimit=Qn,e.filterSeries=Zn,e.forever=Ne,e.groupBy=ti,e.groupByLimit=ei,e.groupBySeries=ni,e.log=ii,e.map=rn,e.mapLimit=ln,e.mapSeries=an,e.mapValues=oi,e.mapValuesLimit=Ie,e.mapValuesSeries=ri,e.memoize=Re,e.nextTick=si,e.parallel=De,e.parallelLimit=Me,e.priorityQueue=ai,e.queue=li,e.race=$e,e.reduce=he,e.reduceRight=Be,e.reflect=je,e.reflectAll=Ge,e.reject=ui,e.rejectLimit=di,e.rejectSeries=ci,e.retry=Ve,e.retryable=hi,e.seq=pe,e.series=Ue,e.setImmediate=rt,e.some=pi,e.someLimit=fi,e.someSeries=gi,e.sortBy=qe,e.timeout=We,e.times=yi,e.timesLimit=Ke,e.timesSeries=bi,e.transform=Xe,e.tryEach=Je,e.unmemoize=Qe,e.until=et,e.waterfall=wi,e.whilst=Ze,e.all=Yn,e.allLimit=Kn,e.allSeries=Xn,e.any=pi,e.anyLimit=fi,e.anySeries=gi,e.find=zn,e.findLimit=Vn,e.findSeries=Un,e.forEach=Ee,e.forEachSeries=Wn,e.forEachLimit=Ae,e.forEachOf=on,e.forEachOfSeries=Dn,e.forEachOfLimit=P,e.inject=he,e.foldl=he,e.foldr=Be,e.select=Jn,e.selectLimit=Qn,e.selectSeries=Zn,e.wrapSync=r,Object.defineProperty(e,"__esModule",{value:!0})}),function(e){var t="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global;if("function"==typeof define&&define.amd)define("backbone",["underscore","jquery","exports"],function(n,i,o){t.Backbone=e(t,o,n,i)});else if("undefined"!=typeof exports){var n,i=require("underscore");try{n=require("jquery")}catch(e){}e(t,exports,i,n)}else t.Backbone=e(t,{},t._,t.jQuery||t.Zepto||t.ender||t.$)}(function(e,t,n,i){var o=e.Backbone,r=Array.prototype.slice;t.VERSION="1.3.3",t.$=i,t.noConflict=function(){return e.Backbone=o,this},t.emulateHTTP=!1,t.emulateJSON=!1;var s=function(e,t,i){switch(e){case 1:return function(){return n[t](this[i])};case 2:return function(e){return n[t](this[i],e)};case 3:return function(e,o){return n[t](this[i],a(e,this),o)};case 4:return function(e,o,r){return n[t](this[i],a(e,this),o,r)};default:return function(){var e=r.call(arguments);return e.unshift(this[i]),n[t].apply(n,e)}}},l=function(e,t,i){n.each(t,function(t,o){n[o]&&(e.prototype[o]=s(t,o,i))})},a=function(e,t){return n.isFunction(e)?e:n.isObject(e)&&!t._isModel(e)?u(e):n.isString(e)?function(t){return t.get(e)}:e},u=function(e){var t=n.matches(e);return function(e){return t(e.attributes)}},d=t.Events={},c=/\s+/,h=function(e,t,i,o,r){var s,l=0;if(i&&"object"==typeof i){void 0!==o&&"context"in r&&void 0===r.context&&(r.context=o);for(s=n.keys(i);l<s.length;l++)t=h(e,t,s[l],i[s[l]],r)}else if(i&&c.test(i))for(s=i.split(c);l<s.length;l++)t=e(t,s[l],o,r);else t=e(t,i,o,r);return t};d.on=function(e,t,n){return p(this,e,t,n)};var p=function(e,t,n,i,o){if(e._events=h(f,e._events||{},t,n,{context:i,ctx:e,listening:o}),o){(e._listeners||(e._listeners={}))[o.id]=o}return e};d.listenTo=function(e,t,i){if(!e)return this;var o=e._listenId||(e._listenId=n.uniqueId("l")),r=this._listeningTo||(this._listeningTo={}),s=r[o];if(!s){var l=this._listenId||(this._listenId=n.uniqueId("l"));s=r[o]={obj:e,objId:o,id:l,listeningTo:r,count:0}}return p(e,t,i,this,s),this};var f=function(e,t,n,i){if(n){var o=e[t]||(e[t]=[]),r=i.context,s=i.ctx,l=i.listening;l&&l.count++,o.push({callback:n,context:r,ctx:r||s,listening:l})}return e};d.off=function(e,t,n){return this._events?(this._events=h(g,this._events,e,t,{context:n,listeners:this._listeners}),this):this},d.stopListening=function(e,t,i){var o=this._listeningTo;if(!o)return this;for(var r=e?[e._listenId]:n.keys(o),s=0;s<r.length;s++){var l=o[r[s]];if(!l)break;l.obj.off(t,i,this)}return this};var g=function(e,t,i,o){if(e){var r,s=0,l=o.context,a=o.listeners;if(t||i||l){for(var u=t?[t]:n.keys(e);s<u.length;s++){t=u[s];var d=e[t];if(!d)break;for(var c=[],h=0;h<d.length;h++){var p=d[h];i&&i!==p.callback&&i!==p.callback._callback||l&&l!==p.context?c.push(p):(r=p.listening)&&0==--r.count&&(delete a[r.id],delete r.listeningTo[r.objId])}c.length?e[t]=c:delete e[t]}return e}for(var f=n.keys(a);s<f.length;s++)r=a[f[s]],delete a[r.id],delete r.listeningTo[r.objId]}};d.once=function(e,t,i){var o=h(m,{},e,t,n.bind(this.off,this));return"string"==typeof e&&null==i&&(t=void 0),this.on(o,t,i)},d.listenToOnce=function(e,t,i){var o=h(m,{},t,i,n.bind(this.stopListening,this,e));return this.listenTo(e,o)};var m=function(e,t,i,o){if(i){var r=e[t]=n.once(function(){o(t,r),i.apply(this,arguments)});r._callback=i}return e};d.trigger=function(e){if(!this._events)return this;for(var t=Math.max(0,arguments.length-1),n=Array(t),i=0;i<t;i++)n[i]=arguments[i+1];return h(v,this._events,e,void 0,n),this};var v=function(e,t,n,i){if(e){var o=e[t],r=e.all;o&&r&&(r=r.slice()),o&&y(o,i),r&&y(r,[t].concat(i))}return e},y=function(e,t){var n,i=-1,o=e.length,r=t[0],s=t[1],l=t[2];switch(t.length){case 0:for(;++i<o;)(n=e[i]).callback.call(n.ctx);return;case 1:for(;++i<o;)(n=e[i]).callback.call(n.ctx,r);return;case 2:for(;++i<o;)(n=e[i]).callback.call(n.ctx,r,s);return;case 3:for(;++i<o;)(n=e[i]).callback.call(n.ctx,r,s,l);return;default:for(;++i<o;)(n=e[i]).callback.apply(n.ctx,t);return}};d.bind=d.on,d.unbind=d.off,n.extend(t,d);var b=t.Model=function(e,t){var i=e||{};t||(t={}),this.cid=n.uniqueId(this.cidPrefix),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(i=this.parse(i,t)||{});var o=n.result(this,"defaults");i=n.defaults(n.extend({},o,i),o),this.set(i,t),this.changed={},this.initialize.apply(this,arguments)};n.extend(b.prototype,d,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(e){return n.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return n.escape(this.get(e))},has:function(e){return null!=this.get(e)},matches:function(e){return!!n.iteratee(e,this)(this.attributes)},set:function(e,t,i){if(null==e)return this;var o;if("object"==typeof e?(o=e,i=t):(o={})[e]=t,i||(i={}),!this._validate(o,i))return!1;var r=i.unset,s=i.silent,l=[],a=this._changing;this._changing=!0,a||(this._previousAttributes=n.clone(this.attributes),this.changed={});var u=this.attributes,d=this.changed,c=this._previousAttributes;for(var h in o)t=o[h],n.isEqual(u[h],t)||l.push(h),n.isEqual(c[h],t)?delete d[h]:d[h]=t,r?delete u[h]:u[h]=t;if(this.idAttribute in o&&(this.id=this.get(this.idAttribute)),!s){l.length&&(this._pending=i);for(var p=0;p<l.length;p++)this.trigger("change:"+l[p],this,u[l[p]],i)}if(a)return this;if(!s)for(;this._pending;)i=this._pending,this._pending=!1,this.trigger("change",this,i);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,n.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var i in this.attributes)t[i]=void 0;return this.set(t,n.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!n.isEmpty(this.changed):n.has(this.changed,e)},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&n.clone(this.changed);var t=this._changing?this._previousAttributes:this.attributes,i={};for(var o in e){var r=e[o];n.isEqual(t[o],r)||(i[o]=r)}return!!n.size(i)&&i},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(e){e=n.extend({parse:!0},e);var t=this,i=e.success;return e.success=function(n){var o=e.parse?t.parse(n,e):n;if(!t.set(o,e))return!1;i&&i.call(e.context,t,n,e),t.trigger("sync",t,n,e)},B(this,e),this.sync("read",this,e)},save:function(e,t,i){var o;null==e||"object"==typeof e?(o=e,i=t):(o={})[e]=t,i=n.extend({validate:!0,parse:!0},i);var r=i.wait;if(o&&!r){if(!this.set(o,i))return!1}else if(!this._validate(o,i))return!1;var s=this,l=i.success,a=this.attributes;i.success=function(e){s.attributes=a;var t=i.parse?s.parse(e,i):e;if(r&&(t=n.extend({},o,t)),t&&!s.set(t,i))return!1;l&&l.call(i.context,s,e,i),s.trigger("sync",s,e,i)},B(this,i),o&&r&&(this.attributes=n.extend({},a,o));var u=this.isNew()?"create":i.patch?"patch":"update";"patch"!==u||i.attrs||(i.attrs=o);var d=this.sync(u,this,i);return this.attributes=a,d},destroy:function(e){e=e?n.clone(e):{};var t=this,i=e.success,o=e.wait,r=function(){t.stopListening(),t.trigger("destroy",t,t.collection,e)};e.success=function(n){o&&r(),i&&i.call(e.context,t,n,e),t.isNew()||t.trigger("sync",t,n,e)};var s=!1;return this.isNew()?n.defer(e.success):(B(this,e),s=this.sync("delete",this,e)),o||r(),s},url:function(){var e=n.result(this,"urlRoot")||n.result(this.collection,"url")||$();if(this.isNew())return e;var t=this.get(this.idAttribute);return e.replace(/[^\/]$/,"$&/")+encodeURIComponent(t)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},n.extend({},e,{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=n.extend({},this.attributes,e);var i=this.validationError=this.validate(e,t)||null;return!i||(this.trigger("invalid",this,i,n.extend(t,{validationError:i})),!1)}}),l(b,{keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1},"attributes");var w=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,n.extend({silent:!0},t))},_={add:!0,remove:!0,merge:!0},x={add:!0,remove:!1},E=function(e,t,n){n=Math.min(Math.max(n,0),e.length);var i,o=Array(e.length-n),r=t.length;for(i=0;i<o.length;i++)o[i]=e[i+n];for(i=0;i<r;i++)e[i+n]=t[i];for(i=0;i<o.length;i++)e[i+r+n]=o[i]};n.extend(w.prototype,d,{model:b,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,n.extend({merge:!1},t,x))},remove:function(e,t){t=n.extend({},t);var i=!n.isArray(e);e=i?[e]:e.slice();var o=this._removeModels(e,t);return!t.silent&&o.length&&(t.changes={added:[],merged:[],removed:o},this.trigger("update",this,t)),i?o[0]:o},set:function(e,t){if(null!=e){t=n.extend({},_,t),t.parse&&!this._isModel(e)&&(e=this.parse(e,t)||[]);var i=!n.isArray(e);e=i?[e]:e.slice();var o=t.at;null!=o&&(o=+o),o>this.length&&(o=this.length),o<0&&(o+=this.length+1);var r,s,l=[],a=[],u=[],d=[],c={},h=t.add,p=t.merge,f=t.remove,g=!1,m=this.comparator&&null==o&&!1!==t.sort,v=n.isString(this.comparator)?this.comparator:null;for(s=0;s<e.length;s++){r=e[s];var y=this.get(r);if(y){if(p&&r!==y){var b=this._isModel(r)?r.attributes:r;t.parse&&(b=y.parse(b,t)),y.set(b,t),u.push(y),m&&!g&&(g=y.hasChanged(v))}c[y.cid]||(c[y.cid]=!0,l.push(y)),e[s]=y}else h&&(r=e[s]=this._prepareModel(r,t))&&(a.push(r),this._addReference(r,t),c[r.cid]=!0,l.push(r))}if(f){for(s=0;s<this.length;s++)r=this.models[s],c[r.cid]||d.push(r);d.length&&this._removeModels(d,t)}var w=!1,x=!m&&h&&f;if(l.length&&x?(w=this.length!==l.length||n.some(this.models,function(e,t){return e!==l[t]}),this.models.length=0,E(this.models,l,0),this.length=this.models.length):a.length&&(m&&(g=!0),E(this.models,a,null==o?this.length:o),this.length=this.models.length),g&&this.sort({silent:!0}),!t.silent){for(s=0;s<a.length;s++)null!=o&&(t.index=o+s),r=a[s],r.trigger("add",r,this,t);(g||w)&&this.trigger("sort",this,t),(a.length||d.length||u.length)&&(t.changes={added:a,removed:d,merged:u},this.trigger("update",this,t))}return i?e[0]:e}},reset:function(e,t){t=t?n.clone(t):{};for(var i=0;i<this.models.length;i++)this._removeReference(this.models[i],t);return t.previousModels=this.models,this._reset(),e=this.add(e,n.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,n.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e)},unshift:function(e,t){return this.add(e,n.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e)},slice:function(){return r.apply(this.models,arguments)},get:function(e){if(null!=e)return this._byId[e]||this._byId[this.modelId(e.attributes||e)]||e.cid&&this._byId[e.cid]},has:function(e){return null!=this.get(e)},at:function(e){return e<0&&(e+=this.length),this.models[e]},where:function(e,t){return this[t?"find":"filter"](e)},findWhere:function(e){return this.where(e,!0)},sort:function(e){var t=this.comparator;if(!t)throw new Error("Cannot sort a set without a comparator");e||(e={});var i=t.length;return n.isFunction(t)&&(t=n.bind(t,this)),1===i||n.isString(t)?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return this.map(e+"")},fetch:function(e){e=n.extend({parse:!0},e);var t=e.success,i=this;return e.success=function(n){var o=e.reset?"reset":"set";i[o](n,e),t&&t.call(e.context,i,n,e),i.trigger("sync",i,n,e)},B(this,e),this.sync("read",this,e)},create:function(e,t){t=t?n.clone(t):{};var i=t.wait;if(!(e=this._prepareModel(e,t)))return!1;i||this.add(e,t);var o=this,r=t.success;return t.success=function(e,t,n){i&&o.add(e,n),r&&r.call(n.context,e,t,n)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(e){return e[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(this._isModel(e))return e.collection||(e.collection=this),e;t=t?n.clone(t):{},t.collection=this;var i=new this.model(e,t);return i.validationError?(this.trigger("invalid",this,i.validationError,t),!1):i},_removeModels:function(e,t){for(var n=[],i=0;i<e.length;i++){var o=this.get(e[i]);if(o){var r=this.indexOf(o);this.models.splice(r,1),this.length--,delete this._byId[o.cid];var s=this.modelId(o.attributes);null!=s&&delete this._byId[s],t.silent||(t.index=r,o.trigger("remove",o,this,t)),n.push(o),this._removeReference(o,t)}}return n},_isModel:function(e){return e instanceof b},_addReference:function(e,t){this._byId[e.cid]=e;var n=this.modelId(e.attributes);null!=n&&(this._byId[n]=e),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){delete this._byId[e.cid];var n=this.modelId(e.attributes);null!=n&&delete this._byId[n],this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,i){if(t){if(("add"===e||"remove"===e)&&n!==this)return;if("destroy"===e&&this.remove(t,i),"change"===e){var o=this.modelId(t.previousAttributes()),r=this.modelId(t.attributes);o!==r&&(null!=o&&delete this._byId[o],null!=r&&(this._byId[r]=t))}}this.trigger.apply(this,arguments)}}),l(w,{forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3},"models");var A=t.View=function(e){this.cid=n.uniqueId("view"),n.extend(this,n.pick(e,C)),this._ensureElement(),this.initialize.apply(this,arguments)},S=/^(\S+)\s*(.*)$/,C=["model","collection","el","id","attributes","className","tagName","events"];n.extend(A.prototype,d,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(e){return this.undelegateEvents(),this._setElement(e),this.delegateEvents(),this},_setElement:function(e){this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0]},delegateEvents:function(e){if(e||(e=n.result(this,"events")),!e)return this;this.undelegateEvents();for(var t in e){var i=e[t];if(n.isFunction(i)||(i=this[i]),i){var o=t.match(S);this.delegate(o[1],o[2],n.bind(i,this))}}return this},delegate:function(e,t,n){return this.$el.on(e+".delegateEvents"+this.cid,t,n),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(e,t,n){return this.$el.off(e+".delegateEvents"+this.cid,t,n),this},_createElement:function(e){return document.createElement(e)},_ensureElement:function(){if(this.el)this.setElement(n.result(this,"el"));else{var e=n.extend({},n.result(this,"attributes"));this.id&&(e.id=n.result(this,"id")),this.className&&(e.class=n.result(this,"className")),this.setElement(this._createElement(n.result(this,"tagName"))),this._setAttributes(e)}},_setAttributes:function(e){this.$el.attr(e)}}),t.sync=function(e,i,o){var r=F[e];n.defaults(o||(o={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var s={type:r,dataType:"json"};if(o.url||(s.url=n.result(i,"url")||$()),null!=o.data||!i||"create"!==e&&"update"!==e&&"patch"!==e||(s.contentType="application/json",s.data=JSON.stringify(o.attrs||i.toJSON(o))),o.emulateJSON&&(s.contentType="application/x-www-form-urlencoded",s.data=s.data?{model:s.data}:{}),o.emulateHTTP&&("PUT"===r||"DELETE"===r||"PATCH"===r)){s.type="POST",o.emulateJSON&&(s.data._method=r);var l=o.beforeSend;o.beforeSend=function(e){if(e.setRequestHeader("X-HTTP-Method-Override",r),l)return l.apply(this,arguments)}}"GET"===s.type||o.emulateJSON||(s.processData=!1);var a=o.error;o.error=function(e,t,n){o.textStatus=t,o.errorThrown=n,a&&a.call(o.context,e,t,n)};var u=o.xhr=t.ajax(n.extend(s,o));return i.trigger("request",i,u,o),u};var F={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var k=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},T=/\((.*?)\)/g,O=/(\(\?)?:\w+/g,N=/\*\w+/g,I=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(k.prototype,d,{initialize:function(){},route:function(e,i,o){n.isRegExp(e)||(e=this._routeToRegExp(e)),n.isFunction(i)&&(o=i,i=""),o||(o=this[i]);var r=this;return t.history.route(e,function(n){var s=r._extractParameters(e,n);!1!==r.execute(o,s,i)&&(r.trigger.apply(r,["route:"+i].concat(s)),r.trigger("route",i,s),t.history.trigger("route",r,i,s))}),this},execute:function(e,t,n){e&&e.apply(this,t)},navigate:function(e,n){return t.history.navigate(e,n),this},_bindRoutes:function(){if(this.routes){this.routes=n.result(this,"routes");for(var e,t=n.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(I,"\\$&").replace(T,"(?:$1)?").replace(O,function(e,t){return t?e:"([^/?]+)"}).replace(N,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var i=e.exec(t).slice(1);return n.map(i,function(e,t){return t===i.length-1?e||null:e?decodeURIComponent(e):null})}});var L=t.History=function(){this.handlers=[],this.checkUrl=n.bind(this.checkUrl,this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},R=/^[#\/]|\s+$/g,P=/^\/+|\/+$/g,D=/#.*$/;L.started=!1,n.extend(L.prototype,d,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root&&!this.getSearch()},matchRoot:function(){return this.decodeFragment(this.location.pathname).slice(0,this.root.length-1)+"/"===this.root},decodeFragment:function(e){return decodeURI(e.replace(/%25/g,"%2525"))},getSearch:function(){var e=this.location.href.replace(/#.*/,"").match(/\?.+/);return e?e[0]:""},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getPath:function(){var e=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===e.charAt(0)?e.slice(1):e},getFragment:function(e){return null==e&&(e=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),e.replace(R,"")},start:function(e){if(L.started)throw new Error("Backbone.history has already been started");if(L.started=!0,this.options=n.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(P,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var t=this.root.slice(0,-1)||"/";return this.location.replace(t+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var i=document.body,o=i.insertBefore(this.iframe,i.firstChild).contentWindow;o.document.open(),o.document.close(),o.location.hash="#"+this.fragment}var r=window.addEventListener||function(e,t){return attachEvent("on"+e,t)};if(this._usePushState?r("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?r("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()},stop:function(){var e=window.removeEventListener||function(e,t){return detachEvent("on"+e,t)};this._usePushState?e("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&e("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),L.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();if(t===this.fragment&&this.iframe&&(t=this.getHash(this.iframe.contentWindow)),t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(e){return!!this.matchRoot()&&(e=this.fragment=this.getFragment(e),n.some(this.handlers,function(t){if(t.route.test(e))return t.callback(e),!0}))},navigate:function(e,t){if(!L.started)return!1;t&&!0!==t||(t={trigger:!!t}),e=this.getFragment(e||"");var n=this.root;""!==e&&"?"!==e.charAt(0)||(n=n.slice(0,-1)||"/");var i=n+e;if(e=this.decodeFragment(e.replace(D,"")),this.fragment!==e){if(this.fragment=e,this._usePushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,i);else{if(!this._wantsHashChange)return this.location.assign(i);if(this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getHash(this.iframe.contentWindow)){var o=this.iframe.contentWindow;t.replace||(o.document.open(),o.document.close()),this._updateHash(o.location,e,t.replace)}}return t.trigger?this.loadUrl(e):void 0
}},_updateHash:function(e,t,n){if(n){var i=e.href.replace(/(javascript:|#).*$/,"");e.replace(i+"#"+t)}else e.hash="#"+t}}),t.history=new L;var M=function(e,t){var i,o=this;return i=e&&n.has(e,"constructor")?e.constructor:function(){return o.apply(this,arguments)},n.extend(i,o,t),i.prototype=n.create(o.prototype,e),i.prototype.constructor=i,i.__super__=o.prototype,i};b.extend=w.extend=k.extend=A.extend=L.extend=M;var $=function(){throw new Error('A "url" property or function must be specified')},B=function(e,t){var n=t.error;t.error=function(i){n&&n.call(t.context,e,i,t),e.trigger("error",e,i,t)}};return t}),define("utils/queryString",[],function(){return function(e){return function(e){if(!e)return{};for(var t={},n=0;n<e.length;++n){var i=e[n].split("=");if(2==i.length)if(/\[\]$/.exec(i[0])){var o=i[0].slice(0,i[0].length-2);t.hasOwnProperty(o)||(t[o]=[]),t[o].push(decodeURIComponent(i[1].replace(/\+/g," ")))}else t[i[0]]=decodeURIComponent(i[1].replace(/\+/g," "))}return t}((e||window.location.search).substr(1).split("&"))}});try{!function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define("cached-iterable",["exports"],t):t(e.CachedIterable={})}(void 0,function(e){"use strict";var t=function(e){function t(){return _classCallCheck(this,t),_callSuper(this,t,arguments)}return _inherits(t,e),_createClass(t,null,[{key:"from",value:function(e){return e instanceof this?e:new this(e)}}]),t}(_wrapNativeSuper(Array)),n=function(e,t){function n(e){var t;if(_classCallCheck(this,n),t=_callSuper(this,n),!(Symbol.iterator in Object(e)))throw new TypeError("Argument must implement the iteration protocol.");return t.iterator=e[Symbol.iterator](),t}return _inherits(n,e),_createClass(n,[{key:t,value:function(){var e=this,t=0;return{next:function(){return e.length<=t&&e.push(e.iterator.next()),e[t++]}}}},{key:"touchNext",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=0;t++<e;){var n=this[this.length-1];if(n&&n.done)break;this.push(this.iterator.next())}return this[this.length-1]}}]),n}(t,Symbol.iterator),i=function(e,t){function n(e){var t;if(_classCallCheck(this,n),t=_callSuper(this,n),Symbol.asyncIterator in Object(e))t.iterator=e[Symbol.asyncIterator]();else{if(!(Symbol.iterator in Object(e)))throw new TypeError("Argument must implement the iteration protocol.");t.iterator=e[Symbol.iterator]()}return t}return _inherits(n,e),_createClass(n,[{key:t,value:function(){var e=this,t=0;return{next:function(){return _asyncToGenerator(_regeneratorRuntime().mark(function n(){return _regeneratorRuntime().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return e.length<=t&&e.push(e.iterator.next()),n.abrupt("return",e[t++]);case 2:case"end":return n.stop()}},n)}))()}}}},{key:"touchNext",value:function(){function e(){return t.apply(this,arguments)}var t=_asyncToGenerator(_regeneratorRuntime().mark(function e(){var t,n,i,o=arguments;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=o.length>0&&void 0!==o[0]?o[0]:1,n=0;case 2:if(!(n++<t)){e.next=14;break}if(i=this[this.length-1],e.t0=i,!e.t0){e.next=9;break}return e.next=8,i;case 8:e.t0=e.sent.done;case 9:if(!e.t0){e.next=11;break}return e.abrupt("break",14);case 11:this.push(this.iterator.next()),e.next=2;break;case 14:return e.abrupt("return",this[this.length-1]);case 15:case"end":return e.stop()}},e,this)}));return e}()}]),n}(t,Symbol.asyncIterator);e.CachedSyncIterable=n,e.CachedAsyncIterable=i,Object.defineProperty(e,"__esModule",{value:!0})})}catch(e){console.log("load error",e)}try{!function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?t(exports,require("cached-iterable")):"function"==typeof define&&define.amd?define("@fluent/dom",["exports","cached-iterable"],t):(e="undefined"!=typeof globalThis?globalThis:e||self,t(e.FluentDOM={},e.CachedIterable))}(void 0,function(e,t){"use strict";function n(e,t){var n=t.value;if("string"==typeof n)if("title"===e.localName&&"http://www.w3.org/1999/xhtml"===e.namespaceURI)e.textContent=n;else if(g.test(n)){var o=e.ownerDocument.createElementNS("http://www.w3.org/1999/xhtml","template");o.innerHTML=n,i(o.content,e)}else e.textContent=n;r(t,e)}function i(e,t){var n,i=_createForOfIteratorHelper(e.childNodes);try{for(i.s();!(n=i.n()).done;){var o=n.value;if(o.nodeType!==o.TEXT_NODE)if(o.hasAttribute("data-l10n-name")){var r=s(t,o);e.replaceChild(r,o)}else if(u(o)){var d=l(o);e.replaceChild(d,o)}else console.warn('An element of forbidden type "'.concat(o.localName,'" was found in ')+"the translation. Only safe text-level elements and elements with data-l10n-name are allowed."),e.replaceChild(a(o),o)}}catch(e){i.e(e)}finally{i.f()}t.textContent="",t.appendChild(e)}function o(e,t){if(!e)return!1;var n,i=_createForOfIteratorHelper(e);try{for(i.s();!(n=i.n()).done;){if(n.value.name===t)return!0}}catch(e){i.e(e)}finally{i.f()}return!1}function r(e,t){for(var n=t.hasAttribute("data-l10n-attrs")?t.getAttribute("data-l10n-attrs").split(",").map(function(e){return e.trim()}):null,i=0,r=Array.from(t.attributes);i<r.length;i++){var s=r[i];d(s.name,t,n)&&!o(e.attributes,s.name)&&t.removeAttribute(s.name)}if(e.attributes)for(var l=0,a=Array.from(e.attributes);l<a.length;l++){var u=a[l];d(u.name,t,n)&&t.getAttribute(u.name)!==u.value&&t.setAttribute(u.name,u.value)}}function s(e,t){var n=t.getAttribute("data-l10n-name"),i=e.querySelector('[data-l10n-name="'.concat(n,'"]'));return i?i.localName!==t.localName?(console.warn('An element named "'.concat(n,'" was found in the translation ')+"but its type ".concat(t.localName," didn't match the ")+"element found in the source (".concat(i.localName,").")),a(t)):(e.removeChild(i),c(t,i.cloneNode(!1))):(console.warn('An element named "'.concat(n,"\" wasn't found in the source.")),a(t))}function l(e){return c(e,e.ownerDocument.createElement(e.localName))}function a(e){return e.ownerDocument.createTextNode(e.textContent)}function u(e){var t=m[e.namespaceURI];return t&&t.includes(e.localName)}function d(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(n&&n.includes(e))return!0;var i=v[t.namespaceURI];if(!i)return!1;var o=e.toLowerCase(),r=t.localName;if(i.global.includes(o))return!0;if(!i[r])return!1;if(i[r].includes(o))return!0;if("http://www.w3.org/1999/xhtml"===t.namespaceURI&&"input"===r&&"value"===o){var s=t.type.toLowerCase();if("submit"===s||"button"===s||"reset"===s)return!0}return!1}function c(e,t){return t.textContent=e.textContent,r(e,t),t}function h(e,t,n,i){return n.value?e.formatPattern(n.value,i,t):null}function p(e,t,n,i){var o={value:null,attributes:null};n.value&&(o.value=e.formatPattern(n.value,i,t));var r=Object.keys(n.attributes);if(r.length>0){o.attributes=new Array(r.length);var s,l=_createForOfIteratorHelper(r.entries());try{for(l.s();!(s=l.n()).done;){var a=_slicedToArray(s.value,2),u=a[0],d=a[1],c=e.formatPattern(n.attributes[d],i,t);o.attributes[u]={name:d,value:c}}}catch(e){l.e(e)}finally{l.f()}}return o}function f(e,t,n,i){var o=[],r=new Set;return n.forEach(function(n,s){var l=n.id,a=n.args;if(void 0===i[s]){var u=t.getMessage(l);if(u){if(o.length=0,i[s]=e(t,o,u,a),o.length>0&&"undefined"!=typeof console){var d=t.locales[0],c=o.join(", ");console.warn("[fluent][resolver] errors in ".concat(d,"/").concat(l,": ").concat(c,"."))}}else r.add(l)}}),r}var g=/<|&#?\w+;/,m={"http://www.w3.org/1999/xhtml":["em","strong","small","s","cite","q","dfn","abbr","data","time","code","var","samp","kbd","sub","sup","i","b","u","mark","bdi","bdo","span","br","wbr"]},v={"http://www.w3.org/1999/xhtml":{global:["title","aria-label","aria-valuetext"],a:["download"],area:["download","alt"],input:["alt","placeholder"],menuitem:["label"],menu:["label"],optgroup:["label"],option:["label"],track:["label"],img:["alt"],textarea:["placeholder"],th:["abbr"]},"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul":{global:["accesskey","aria-label","aria-valuetext","label","title","tooltiptext"],description:["value"],key:["key","keycode"],label:["value"],textbox:["placeholder","value"]}},y=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0;_classCallCheck(this,e),this.resourceIds=t,this.generateBundles=n,this.onChange(!0)}return _createClass(e,[{key:"addResourceIds",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(t=this.resourceIds).push.apply(t,_toConsumableArray(e)),this.onChange(n),this.resourceIds.length}},{key:"removeResourceIds",value:function(e){return this.resourceIds=this.resourceIds.filter(function(t){return!e.includes(t)}),this.onChange(),this.resourceIds.length}},{key:"formatWithFallback",value:function(){function e(e,n){return t.apply(this,arguments)}var t=_asyncToGenerator(_regeneratorRuntime().mark(function e(t,n){var i,o,r,s,l,a,u,d,c,h,p;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i=[],o=!1,r=!1,s=!1,e.prev=4,a=_asyncIterator(this.bundles);case 6:return e.next=8,a.next();case 8:if(!(r=!(u=e.sent).done)){e.next=18;break}if(d=u.value,o=!0,c=f(n,d,t,i),0!==c.size){e.next=14;break}return e.abrupt("break",18);case 14:"undefined"!=typeof console&&(h=d.locales[0],p=Array.from(c).join(", "),console.warn("[fluent] Missing translations in ".concat(h,": ").concat(p)));case 15:r=!1,e.next=6;break;case 18:e.next=24;break;case 20:e.prev=20,e.t0=e.catch(4),s=!0,l=e.t0;case 24:if(e.prev=24,e.prev=25,!r||null==a.return){e.next=29;break}return e.next=29,a.return();case 29:if(e.prev=29,!s){e.next=32;break}throw l;case 32:return e.finish(29);case 33:return e.finish(24);case 34:return o||"undefined"==typeof console||console.warn("[fluent] Request for keys failed because no resource bundles got generated.\n  keys: ".concat(JSON.stringify(t),".\n  resourceIds: ").concat(JSON.stringify(this.resourceIds),".")),e.abrupt("return",i);case 36:case"end":return e.stop()}},e,this,[[4,20,24,34],[25,,29,33]])}));return e}()},{key:"formatMessages",value:function(e){return this.formatWithFallback(e,p)}},{key:"formatValues",value:function(e){return this.formatWithFallback(e,h)}},{key:"formatValue",value:function(){function e(e,n){return t.apply(this,arguments)}var t=_asyncToGenerator(_regeneratorRuntime().mark(function e(t,n){var i,o,r;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.formatValues([{id:t,args:n}]);case 2:return i=e.sent,o=_slicedToArray(i,1),r=o[0],e.abrupt("return",r);case 6:case"end":return e.stop()}},e,this)}));return e}()},{key:"handleEvent",value:function(){this.onChange()}},{key:"onChange",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.bundles=t.CachedAsyncIterable.from(this.generateBundles(this.resourceIds)),e&&this.bundles.touchNext(2)}}]),e}(),b="data-l10n-id",w="data-l10n-args",_="[".concat(b,"]"),x=function(e){function t(e,n){var i;return _classCallCheck(this,t),i=_callSuper(this,t,[e,n]),i.roots=new Set,i.pendingrAF=null,i.pendingElements=new Set,i.windowElement=null,i.mutationObserver=null,i.observerConfig={attributes:!0,characterData:!1,childList:!0,subtree:!0,attributeFilter:[b,w]},i}return _inherits(t,e),_createClass(t,[{key:"onChange",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];_get(_getPrototypeOf(t.prototype),"onChange",this).call(this,e),this.roots&&this.translateRoots()}},{key:"setAttributes",value:function(e,t,n){return e.setAttribute(b,t),n?e.setAttribute(w,JSON.stringify(n)):e.removeAttribute(w),e}},{key:"getAttributes",value:function(e){return{id:e.getAttribute(b),args:JSON.parse(e.getAttribute(w)||null)}}},{key:"connectRoot",value:function(e){var t,n=this,i=_createForOfIteratorHelper(this.roots);try{for(i.s();!(t=i.n()).done;){var o=t.value;if(o===e||o.contains(e)||e.contains(o))throw new Error("Cannot add a root that overlaps with existing root.")}}catch(e){i.e(e)}finally{i.f()}if(this.windowElement){if(this.windowElement!==e.ownerDocument.defaultView)throw new Error("Cannot connect a root:\n          DOMLocalization already has a root from a different window.")}else this.windowElement=e.ownerDocument.defaultView,this.mutationObserver=new this.windowElement.MutationObserver(function(e){return n.translateMutations(e)});this.roots.add(e),this.mutationObserver.observe(e,this.observerConfig)}},{key:"disconnectRoot",value:function(e){return this.roots.delete(e),this.pauseObserving(),0===this.roots.size?(this.mutationObserver=null,this.windowElement=null,this.pendingrAF=null,this.pendingElements.clear(),!0):(this.resumeObserving(),!1)}},{key:"translateRoots",value:function(){var e=this,t=Array.from(this.roots);return Promise.all(t.map(function(t){return e.translateFragment(t)}))}},{key:"pauseObserving",value:function(){this.mutationObserver&&(this.translateMutations(this.mutationObserver.takeRecords()),this.mutationObserver.disconnect())}},{key:"resumeObserving",value:function(){if(this.mutationObserver){var e,t=_createForOfIteratorHelper(this.roots);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.mutationObserver.observe(n,this.observerConfig)}}catch(e){t.e(e)}finally{t.f()}}}},{key:"translateMutations",value:function(e){var t,n=this,i=_createForOfIteratorHelper(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;switch(o.type){case"attributes":o.target.hasAttribute("data-l10n-id")&&this.pendingElements.add(o.target);break;case"childList":var r,s=_createForOfIteratorHelper(o.addedNodes);try{for(s.s();!(r=s.n()).done;){var l=r.value;if(l.nodeType===l.ELEMENT_NODE)if(l.childElementCount){var a,u=_createForOfIteratorHelper(this.getTranslatables(l));try{for(u.s();!(a=u.n()).done;){var d=a.value;this.pendingElements.add(d)}}catch(e){u.e(e)}finally{u.f()}}else l.hasAttribute(b)&&this.pendingElements.add(l)}}catch(e){s.e(e)}finally{s.f()}}}}catch(e){i.e(e)}finally{i.f()}this.pendingElements.size>0&&null===this.pendingrAF&&(this.pendingrAF=this.windowElement.requestAnimationFrame(function(){n.translateElements(Array.from(n.pendingElements)),n.pendingElements.clear(),n.pendingrAF=null}))}},{key:"translateFragment",value:function(e){return this.translateElements(this.getTranslatables(e))}},{key:"translateElements",value:function(){function e(e){return t.apply(this,arguments)}var t=_asyncToGenerator(_regeneratorRuntime().mark(function e(t){var n,i;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length){e.next=2;break}return e.abrupt("return",void 0);case 2:return n=t.map(this.getKeysForElement),e.next=5,this.formatMessages(n);case 5:return i=e.sent,e.abrupt("return",this.applyTranslations(t,i));case 7:case"end":return e.stop()}},e,this)}));return e}()},{key:"applyTranslations",value:function(e,t){this.pauseObserving();for(var i=0;i<e.length;i++)void 0!==t[i]&&n(e[i],t[i]);this.resumeObserving()}},{key:"getTranslatables",value:function(e){var t=Array.from(e.querySelectorAll(_));return"function"==typeof e.hasAttribute&&e.hasAttribute(b)&&t.push(e),t}},{key:"getKeysForElement",value:function(e){return{id:e.getAttribute(b),args:JSON.parse(e.getAttribute(w)||null)}}}]),t}(y);e.DOMLocalization=x,e.Localization=y})}catch(e){console.log("load error",e)}try{!function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define("@fluent/bundle",["exports"],t):(e="undefined"!=typeof globalThis?globalThis:e||self,t(e.FluentBundle={}))}(void 0,function(e){"use strict";function t(e,t,n){if(n===t)return!0;if(n instanceof y&&t instanceof y&&n.value===t.value)return!0;if(t instanceof y&&"string"==typeof n){if(n===e.memoizeIntlObject(Intl.PluralRules,t.opts).select(t.value))return!0}return!1}function n(e,t,n){return t[n]?c(e,t[n].value):(e.reportError(new RangeError("No default")),new v)}function i(e,t){var n,i=[],r=Object.create(null),s=_createForOfIteratorHelper(t);try{for(s.s();!(n=s.n()).done;){var l=n.value;"narg"===l.type?r[l.name]=o(e,l.value):i.push(o(e,l))}}catch(e){s.e(e)}finally{s.f()}return{positional:i,named:r}}function o(e,t){switch(t.type){case"str":return t.value;case"num":return new y(t.value,{minimumFractionDigits:t.precision});case"var":return r(e,t);case"mesg":return s(e,t);case"term":return l(e,t);case"func":return a(e,t);case"select":return u(e,t);default:return new v}}function r(e,t){var n,i=t.name;if(e.params){if(!Object.prototype.hasOwnProperty.call(e.params,i))return new v("$".concat(i));n=e.params[i]}else{if(!e.args||!Object.prototype.hasOwnProperty.call(e.args,i))return e.reportError(new ReferenceError("Unknown variable: $".concat(i))),new v("$".concat(i));n=e.args[i]}if(n instanceof m)return n;switch(_typeof(n)){case"string":return n;case"number":return new y(n);case"object":if(n instanceof Date)return new b(n.getTime());default:return e.reportError(new TypeError("Variable type not supported: $".concat(i,", ").concat(_typeof(n)))),new v("$".concat(i))}}function s(e,t){var n=t.name,i=t.attr,o=e.bundle._messages.get(n);if(!o)return e.reportError(new ReferenceError("Unknown message: ".concat(n))),new v(n);if(i){var r=o.attributes[i];return r?c(e,r):(e.reportError(new ReferenceError("Unknown attribute: ".concat(i))),new v("".concat(n,".").concat(i)))}return o.value?c(e,o.value):(e.reportError(new ReferenceError("No value: ".concat(n))),new v(n))}function l(e,t){var n=t.name,o=t.attr,r=t.args,s="-".concat(n),l=e.bundle._terms.get(s);if(!l)return e.reportError(new ReferenceError("Unknown term: ".concat(s))),new v(s);if(o){var a=l.attributes[o];if(a){e.params=i(e,r).named;var u=c(e,a);return e.params=null,u}return e.reportError(new ReferenceError("Unknown attribute: ".concat(o))),new v("".concat(s,".").concat(o))}e.params=i(e,r).named;var d=c(e,l.value);return e.params=null,d}function a(e,t){var n=t.name,o=t.args,r=e.bundle._functions[n];if(!r)return e.reportError(new ReferenceError("Unknown function: ".concat(n,"()"))),new v("".concat(n,"()"));if("function"!=typeof r)return e.reportError(new TypeError("Function ".concat(n,"() is not callable"))),new v("".concat(n,"()"));try{var s=i(e,o);return r(s.positional,s.named)}catch(t){return e.reportError(t),new v("".concat(n,"()"))}}function u(e,i){var r=i.selector,s=i.variants,l=i.star,a=o(e,r);if(a instanceof v)return n(e,s,l);var u,d=_createForOfIteratorHelper(s);try{for(d.s();!(u=d.n()).done;){var h=u.value;if(t(e,a,o(e,h.key)))return c(e,h.value)}}catch(e){d.e(e)}finally{d.f()}return n(e,s,l)}function d(e,t){if(e.dirty.has(t))return e.reportError(new RangeError("Cyclic reference")),new v;e.dirty.add(t);var n,i=[],r=e.bundle._useIsolating&&t.length>1,s=_createForOfIteratorHelper(t);try{for(s.s();!(n=s.n()).done;){var l=n.value;if("string"!=typeof l){if(++e.placeables>w)throw e.dirty.delete(t),new RangeError("Too many placeables expanded: ".concat(e.placeables,", ")+"max allowed is ".concat(w));r&&i.push(_),i.push(o(e,l).toString(e)),r&&i.push(x)}else i.push(e.bundle._transform(l))}}catch(e){s.e(e)}finally{s.f()}return e.dirty.delete(t),i.join("")}function c(e,t){return"string"==typeof t?e.bundle._transform(t):d(e,t)}function h(e,t){for(var n=Object.create(null),i=0,o=Object.entries(e);i<o.length;i++){var r=_slicedToArray(o[i],2),s=r[0],l=r[1];t.includes(s)&&(n[s]=l.valueOf())}return n}function p(e,t){var n=e[0];if(n instanceof v)return new v("NUMBER(".concat(n.valueOf(),")"));if(n instanceof y)return new y(n.valueOf(),_objectSpread(_objectSpread({},n.opts),h(t,A)));if(n instanceof b)return new y(n.valueOf(),_objectSpread({},h(t,A)));throw new TypeError("Invalid argument to NUMBER")}function f(e,t){var n=e[0];if(n instanceof v)return new v("DATETIME(".concat(n.valueOf(),")"));if(n instanceof b)return new b(n.valueOf(),_objectSpread(_objectSpread({},n.opts),h(t,S)));if(n instanceof y)return new b(n.valueOf(),_objectSpread({},h(t,S)));throw new TypeError("Invalid argument to DATETIME")}function g(e){var t=Array.isArray(e)?e.join(" "):e,n=C.get(t);return void 0===n&&(n=new Map,C.set(t,n)),n}var m=function(){function e(t){_classCallCheck(this,e),this.value=t}return _createClass(e,[{key:"valueOf",value:function(){return this.value}}]),e}(),v=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"???";return _classCallCheck(this,t),_callSuper(this,t,[e])}return _inherits(t,e),_createClass(t,[{key:"toString",value:function(e){return"{".concat(this.value,"}")}}]),t}(m),y=function(e){function t(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return _classCallCheck(this,t),n=_callSuper(this,t,[e]),n.opts=i,n}return _inherits(t,e),_createClass(t,[{key:"toString",value:function(e){try{return e.memoizeIntlObject(Intl.NumberFormat,this.opts).format(this.value)}catch(t){return e.reportError(t),this.value.toString(10)}}}]),t}(m),b=function(e){function t(e){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return _classCallCheck(this,t),n=_callSuper(this,t,[e]),n.opts=i,n}return _inherits(t,e),_createClass(t,[{key:"toString",value:function(e){try{return e.memoizeIntlObject(Intl.DateTimeFormat,this.opts).format(this.value)}catch(t){return e.reportError(t),new Date(this.value).toISOString()}}}]),t}(m),w=100,_="⁨",x="⁩",E=function(){function e(t,n,i){_classCallCheck(this,e),this.dirty=new WeakSet,this.params=null,this.placeables=0,this.bundle=t,this.errors=n,this.args=i}return _createClass(e,[{key:"reportError",value:function(e){if(!(this.errors&&e instanceof Error))throw e;this.errors.push(e)}},{key:"memoizeIntlObject",value:function(e,t){var n=this.bundle._intls.get(e);n||(n={},this.bundle._intls.set(e,n));var i=JSON.stringify(t);return n[i]||(n[i]=new e(this.bundle.locales,t)),n[i]}}]),e}(),A=["unitDisplay","currencyDisplay","useGrouping","minimumIntegerDigits","minimumFractionDigits","maximumFractionDigits","minimumSignificantDigits","maximumSignificantDigits"],S=["dateStyle","timeStyle","fractionalSecondDigits","dayPeriod","hour12","weekday","era","year","month","day","hour","minute","second","timeZoneName"],C=new Map,F=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.functions,o=n.useIsolating,r=void 0===o||o,s=n.transform,l=void 0===s?function(e){return e}:s;_classCallCheck(this,e),this._terms=new Map,this._messages=new Map,this.locales=Array.isArray(t)?t:[t],this._functions=_objectSpread({NUMBER:p,DATETIME:f},i),this._useIsolating=r,this._transform=l,this._intls=g(t)}return _createClass(e,[{key:"hasMessage",value:function(e){return this._messages.has(e)}},{key:"getMessage",value:function(e){return this._messages.get(e)}},{key:"addResource",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.allowOverrides,i=void 0!==n&&n,o=[],r=0;r<e.body.length;r++){var s=e.body[r];if(s.id.startsWith("-")){if(!1===i&&this._terms.has(s.id)){o.push(new Error('Attempt to override an existing term: "'.concat(s.id,'"')));continue}this._terms.set(s.id,s)}else{if(!1===i&&this._messages.has(s.id)){o.push(new Error('Attempt to override an existing message: "'.concat(s.id,'"')));continue}this._messages.set(s.id,s)}}return o}},{key:"formatPattern",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if("string"==typeof e)return this._transform(e);var i=new E(this,n,t);try{return d(i,e).toString(i)}catch(e){if(i.errors&&e instanceof Error)return i.errors.push(e),(new v).toString(i);throw e}}}]),e}(),k=/^(-?[a-zA-Z][\w-]*) *= */gm,T=new RegExp("\\.([a-zA-Z][\\w-]*) *= *","y"),O=new RegExp("\\*?\\[","y"),N=new RegExp("(-?[0-9]+(?:\\.([0-9]+))?)","y"),I=new RegExp("([a-zA-Z][\\w-]*)","y"),L=new RegExp("([$-])?([a-zA-Z][\\w-]*)(?:\\.([a-zA-Z][\\w-]*))?","y"),R=/^[A-Z][A-Z0-9_-]*$/,P=new RegExp("([^{}\\n\\r]+)","y"),D=new RegExp('([^\\\\"\\n\\r]*)',"y"),M=new RegExp('\\\\([\\\\"])',"y"),$=new RegExp("\\\\u([a-fA-F0-9]{4})|\\\\U([a-fA-F0-9]{6})","y"),B=/^\n+/,j=/ +$/,H=/ *\r?\n/g,G=/( *)$/,z=new RegExp("{\\s*","y"),V=new RegExp("\\s*}","y"),U=new RegExp("\\[\\s*","y"),q=new RegExp("\\s*] *","y"),W=new RegExp("\\s*\\(\\s*","y"),Y=new RegExp("\\s*->\\s*","y"),K=new RegExp("\\s*:\\s*","y"),X=new RegExp("\\s*,?\\s*","y"),J=new RegExp("\\s+","y"),Q=_createClass(function e(t){function n(e){return e.lastIndex=E,e.test(t)}function i(e,n){if(t[E]===e)return E++,!0;if(n)throw new n("Expected ".concat(e));return!1}function o(e,t){if(n(e))return E=e.lastIndex,!0;if(t)throw new t("Expected ".concat(e.toString()));return!1}function r(e){e.lastIndex=E;var n=e.exec(t);if(null===n)throw new SyntaxError("Expected ".concat(e.toString()));return E=e.lastIndex,n}function s(e){return r(e)[1]}function l(){for(var e=Object.create(null);n(T);){var t=s(T),i=a();if(null===i)throw new SyntaxError("Expected attribute value");e[t]=i}return e}function a(){var e;if(n(P)&&(e=s(P)),"{"===t[E]||"}"===t[E])return u(e?[e]:[],1/0);var i=w();return i?e?u([e,i],i.length):(i.value=_(i.value,B),u([i],i.length)):e?_(e,j):null}function u(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1?arguments[1]:void 0;;)if(n(P))e.push(s(P));else if("{"!==t[E]){if("}"===t[E])throw new SyntaxError("Unbalanced closing brace");var o=w();if(!o)break;e.push(o),i=Math.min(i,o.length)}else e.push(d());var r=e.length-1,l=e[r];"string"==typeof l&&(e[r]=_(l,j));var a,u=[],c=_createForOfIteratorHelper(e);try{for(c.s();!(a=c.n()).done;){var h=a.value;h instanceof Z&&(h=h.value.slice(0,h.value.length-i)),h&&u.push(h)}}catch(e){c.e(e)}finally{c.f()}return u}function d(){o(z,SyntaxError);var e=c();if(o(V))return e;if(o(Y)){var t=f();return o(V,SyntaxError),_objectSpread({type:"select",selector:e},t)}throw new SyntaxError("Unclosed placeable")}function c(){if("{"===t[E])return d();if(n(L)){var e=r(L),i=_slicedToArray(e,4),s=i[1],l=i[2],a=i[3],u=void 0===a?null:a;if("$"===s)return{type:"var",name:l};if(o(W)){var c=h();if("-"===s)return{type:"term",name:l,attr:u,args:c};if(R.test(l))return{type:"func",name:l,args:c};throw new SyntaxError("Function names must be all upper-case")}return"-"===s?{type:"term",name:l,attr:u,args:[]}:{type:"mesg",name:l,attr:u}}return m()}function h(){for(var e=[];;){switch(t[E]){case")":return E++,e;case void 0:throw new SyntaxError("Unclosed argument list")}e.push(p()),o(X)}}function p(){var e=c();return"mesg"!==e.type?e:o(K)?{type:"narg",name:e.name,value:m()}:e}function f(){for(var e,t=[],o=0;n(O);){i("*")&&(e=o);var r=g(),s=a();if(null===s)throw new SyntaxError("Expected variant value");t[o++]={key:r,value:s}}if(0===o)return null;if(void 0===e)throw new SyntaxError("Expected default variant");return{variants:t,star:e}}function g(){o(U,SyntaxError);var e;return e=n(N)?v():{type:"str",value:s(I)},o(q,SyntaxError),e}function m(){if(n(N))return v();if('"'===t[E])return y();throw new SyntaxError("Invalid expression")}function v(){var e=r(N),t=_slicedToArray(e,3),n=t[1],i=t[2],o=void 0===i?"":i,s=o.length;return{type:"num",value:parseFloat(n),precision:s}}function y(){i('"',SyntaxError);for(var e="";;){e+=s(D);{if("\\"!==t[E]){if(i('"'))return{type:"str",value:e};throw new SyntaxError("Unclosed string literal")}e+=b()}}}function b(){if(n(M))return s(M);if(n($)){var e=r($),t=_slicedToArray(e,3),i=t[1],o=t[2],l=parseInt(i||o,16);return l<=55295||57344<=l?String.fromCodePoint(l):"�"}throw new SyntaxError("Unknown escape sequence")}function w(){var e=E;switch(o(J),t[E]){case".":case"[":case"*":case"}":case void 0:return!1;case"{":return x(t.slice(e,E))}return" "===t[E-1]&&x(t.slice(e,E))}function _(e,t){return e.replace(t,"")}function x(e){var t=e.replace(H,"\n"),n=G.exec(e)[1].length;return new Z(t,n)}_classCallCheck(this,e),this.body=[],k.lastIndex=0;for(var E=0;;){var A=k.exec(t);if(null===A)break;E=k.lastIndex;try{this.body.push(function(e){var t=a(),n=l();if(null===t&&0===Object.keys(n).length)throw new SyntaxError("Expected message value or attributes");return{id:e,value:t,attributes:n}}(A[1]))}catch(e){if(e instanceof SyntaxError)continue;throw e}}}),Z=_createClass(function e(t,n){_classCallCheck(this,e),this.value=t,this.length=n});e.FluentBundle=F,e.FluentDateTime=b,e.FluentNone=v,e.FluentNumber=y,e.FluentResource=Q,e.FluentType=m})}catch(e){console.log("load error",e)}try{_AsyncGenerator.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},_AsyncGenerator.prototype.next=function(e){return this._invoke("next",e)},_AsyncGenerator.prototype.throw=function(e){return this._invoke("throw",e)},_AsyncGenerator.prototype.return=function(e){return this._invoke("return",e)},define("l10n",["require","exports","module","utils/queryString","js-cookie","cached-iterable","@fluent/dom","@fluent/bundle"],function(e,t,n){function i(e){return o.apply(this,arguments)}function o(){return o=_wrapAsyncGenerator(_regeneratorRuntime().mark(function e(t){var n,i,o,r,s,l,a;return _regeneratorRuntime().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=_createForOfIteratorHelper(document.head.getElementsByTagName("script")),e.prev=1,n.s();case 3:if((i=n.n()).done){e.next=18;break}if(o=i.value,"application/l20n"!==o.type){e.next=16;break}return r=new u.FluentResource(o.innerText),s=o.getAttribute("data-l10n-locale"),l=new u.FluentBundle(s),a=l.addResource(r),a.length&&console.error("syntax errors in ".concat(s),a),c||(c=s),d.push(l),console.log("loaded translations for "+s),e.next=16,l;case 16:e.next=3;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(1),n.e(e.t0);case 23:return e.prev=23,n.f(),e.finish(23);case 26:case"end":return e.stop()}},e,null,[[1,20,23,26]])})),o.apply(this,arguments)}var r=e("utils/queryString"),s=e("js-cookie"),l={getSync:function(e,t){return t}};if("1"==s.get("disable_translations")||window.Coggle_App_Main||r().print)return l;if(!window.Symbol||!window.Symbol.asyncIterator)return console.error("Browser does not support translations."),l;e("cached-iterable");var a=e("@fluent/dom"),u=e("@fluent/bundle"),d=[],c=null,h=new a.DOMLocalization(["builtin-dom-legacy"],i);return h.connectRoot(document.documentElement),h.translateRoots().then(function(){0===d.length?document.documentElement.setAttribute("lang","en"):(c&&c.startsWith("en-")||"en"===c)&&document.documentElement.setAttribute("lang",c)}),h.getSync=function(e,t,n){for(var i=0,o=d;i<o.length;i++){var r=o[i],s=r.getMessage(e);if(null!==s&&void 0!==s&&s.value)return r.formatPattern(s.value,n)}return d.length&&console.warn("missing translation for ".concat(e)),t},h})}catch(e){console.log("load error",e)}define("backbone.fetchOrQueue",["require","exports","module"],function(e,t,n){Backbone.Model.prototype.fetchOrQueue=Backbone.Collection.prototype.fetchOrQueue=function(e,t){var n=this;return t||(t={}),n.loaded&&Date.now()-n.loaded.getTime()<12e4?(e&&setTimeout(function(){e(!1,n)},0),n):(e&&(n._pending_callbacks||(n._pending_callbacks=[]),n._pending_callbacks.push(e),n.fetching||(t.success=function(){n.loaded=new Date,n.fetching=!1,n._pending_callbacks.map(function(e){e(!1,n)}),delete n._pending_callbacks},t.error=function(){n.loaded=!1,n.fetching=!1,n._pending_callbacks.map(function(e){e(!0)}),delete n._pending_callbacks},n.fetch(t),n.fetching=!0)),n)}}),define("models/Access",["require","exports","module","backbone","underscore"],function(e,t,n){var i=e("backbone"),o=e("underscore"),r=i.Model.extend({idAttribute:"user",revoke:function(e,t){"string"==typeof e&&(e=[e]),this.setPermissions(o.difference(this.get("permissions"),e),t)},grant:function(e,t){"string"==typeof e&&(e=[e]),this.setPermissions(o.union(this.get("permissions"),e),t)},setPermissions:function(e,t){var n=this.get("permissions").slice().sort();e=e.sort(),o.isEqual(e,n)?t&&t(!1,this):(this.set("permissions",e),this.save(null,{wait:!0,success:function(e){t&&t(!1,e)},error:function(e){t&&t(!0,e)}}))},applyRole:function(e,t){
"read"==e?this.revoke(["write","admin","clone"],t):"clone"==e?this.revoke(["write","admin"],function(e){if(e)return t?t(e):e;this.grant("clone",t)}.bind(this)):"write"==e?this.revoke("admin",function(e){if(e)return t?t(e):e;this.grant(["write","clone"],t)}.bind(this)):"admin"==e?this.grant(["write","admin","clone"],t):(console.error("invalid role:",e),t&&t("invalid role"))},displayName:function(){return this.get("name")?this.get("name"):this.get("email")},isMe:function(){return window.getCoggleUser().id===this.id}}),s=i.Collection.extend({model:r,initialize:function(e,t){var n=t.resource.url;"string"!=typeof n&&(n=t.resource.url()),this.url=n+"/access"},comparator:function(e,t){var n=e.get("name")+e.get("email")||"",i=t.get("name")+t.get("email")||"";return n.localeCompare(i)},getMe:function(){var e=this.get(this.myId());return e||(e=new n.exports.AccessModel({user:this.myId(),permissions:[]})),e.url=this.url+"/me",e},myId:function(){return window.getCoggleUser().id},search:function(e){return e=e.toLowerCase(),this.filter(function(t){var n=o.union([t.get("name").toLowerCase(),t.get("email").toLowerCase()],t.get("name").toLowerCase().split(/[\s,]+/),t.get("email").toLowerCase().split(/[\s,@]+/));return o.any(n,function(t){return 0===t.indexOf(e)})})}});n.exports.AccessModel=r,n.exports.AccessCollection=s}),define("models/Invite",["require","exports","module","underscore","backbone","models/Access"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=e("models/Access").AccessModel,s=r.extend({idAttribute:"email",sync:function(e,t,n){n.resend&&(n.url=i.result(t,"url")+"?resend=true"),r.prototype.sync.apply(this,arguments)},displayName:function(){return this.get("email")}}),l=o.Collection.extend({model:s,initialize:function(e,t){this.options=t},url:function(){return i.result(this.options.resource,"url")+"/invites"},comparator:function(e,t){return e.get("email").localeCompare(t.get("email"))},search:function(e){return e=e.toLowerCase(),this.filter(function(t){var n=i.union([t.get("email").toLowerCase()],t.get("email").toLowerCase().split(/[\s,@]+/));return i.any(n,function(t){return 0===t.indexOf(e)})})}});n.exports.InviteModel=s,n.exports.InviteCollection=l}),define("models/PrivateLink",["require","exports","module","underscore","backbone"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=o.Model.extend({idAttribute:"key",hasTag:function(e){return-1!=this.get("tags").indexOf(e)},toggleClone:function(){var e=this.get("permissions");e=-1==e.indexOf("clone")?i.union(e,["clone"]):i.without(e,"clone"),this.save({permissions:e},{wait:!0})},toggleWrite:function(){var e=this.get("permissions");-1==e.indexOf("write")?(getCoggleUser().getActions().perform("made-writable-link"),e=i.union(e,["write","list"])):e=i.without(e,"write"),this.save({permissions:e},{wait:!0})}}),s=o.Collection.extend({model:r,initialize:function(e,t){this.diagram=t.resource,this.url=t.resource.url()+"/links"}});n.exports.PrivateLinkModel=r,n.exports.PrivateLinkCollection=s}),define("models/Delta",["require","exports","module","backbone"],function(e,t,n){var i=e("backbone"),o=i.Model.extend({idAttribute:"_id"}),r=i.Collection.extend({model:o,lastDeltaWithServerId:function(){var e=this.findLastIndex(function(e){return!!e.get("_id")});return-1!==e?this.at(e):null},addIfNotLocalDuplicate:function(e){if(e._cid){var t=this.findLastIndex(function(t){return t.get("_cid")===e._cid});if(-1!==t)return t=this.at(t),e._id&&!t.get("_id")&&t.set("_id",e._id),void(e.action_ts&&!t.get("action_ts")&&t.set("action_ts",e.action_ts))}i.Collection.prototype.add.call(this,e)},poll:function(e){var t=this.lastDeltaWithServerId();$.ajax({method:"GET",url:this.url,contentType:"application/json",data:{from:t?t.get("_id"):void 0,from_date:t?t.get("action_ts"):0}}).done(function(t,n,i){var o=i.getResponseHeader("complete-up-to");o&&(o=parseInt(o,10));var r=i.getResponseHeader("date")||null;r&&(r=Date.parse(r)||null),console.log("poll done, complete up to: "+o+" (delay "+(r&&o?r-o:"unknown")+")"),t&&t.length&&t.forEach(this.addIfNotLocalDuplicate.bind(this));var s=null;t||(s=new Error("invalid response")),e&&e(s,o,r)}.bind(this)).fail(function(){e&&e(new Error("poll failed"))}.bind(this))}});n.exports.DeltaModel=o,n.exports.DeltaCollection=r}),define("env",["jquery"],function(e){"use strict";var t={};return window.CONFIG&&(t=e.extend(!0,{},t,window.CONFIG)),t}),define("models/Attachment",["require","exports","module","underscore","backbone","env"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=o.Model.extend({idAttribute:"_id",getUrl:function(e){if(new Date(this.get("url_expires")).getTime()>Date.now()){var t=this.collection,n=this.get("_id");t.fetchOrQueue(function(i){if(e){var o=t.get(n);return e(i,o&&o.get("url"))}})}else e&&e(null,this.get("url"));return this.get("url")},destroy:function(t){var n=i.extend({url:e("env").api.url+"/api/1/diagrams/"+this.get("diagram")+"/attachments/"+this.get("local_id")},t||{});return o.Model.prototype.destroy.call(this,n)}}),s=o.Collection.extend({model:r,initialize:function(e,t){this.resource=t.resource,this.url=t.resource.url()+"/attachments"},getByLocalId:function(e){return this.where({local_id:e})[0]}});n.exports.AttachmentModel=r,n.exports.AttachmentCollection=s}),define("encodeji",[],function(){function e(t,n){for(var i,o,r=/IFRAME|NOFRAMES|NOSCRIPT|SCRIPT|SELECT|STYLE|TEXTAREA|[a-z]/,s=t.childNodes,l=s.length;l--;)i=s[l],o=i.nodeType,3===o?n.push(i):1!==o||r.test(i.nodeName)||e(i,n);return n}function t(e){var t=parseInt("0x"+e);if(t>65535){var n=Math.floor((t-65536)/1024)+55296,i=(t-65536)%1024+56320;return String.fromCharCode(n)+String.fromCharCode(i)}return String.fromCharCode(t)}function n(e){return e.split("-").map(t).join("")}function i(e){var t=null;this.data=function(){if(t)return t;t=o(),e&&e.extendData&&e.extendData.forEach(function(e){for(var n,i=!1,o=0;o<t.length;o++)if(n=t[o],e.name&&e.name==n.name||e.unified&&e.unified==n.unified){i=n;break}if(i)for(var r in e)e.hasOwnProperty(r)&&("short_names"==r?i.short_names=i.short_names.concat(e.short_names):i[r]=e[r]);else t.push(e)}),this._warn_duplicates=e&&e.warnDuplicates,this.buildShortNameIndex()}}var o=function(e){var t=!1;return function(){if(t)return e;t=!0;for(var n=0;n<e.length;n++){9!==e[n].length&&console.log("pack error:",n,e[n]);for(var i=["name","unified","short_name","short_names","category","sort_order","skin_variations","text","texts"],o={},r=0;r<i.length;r++)o[i[r]]=e[n][r];e[n]=o}return e}
}([["COPYRIGHT SIGN","00A9","copyright",["copyright"],"Symbols",197,null,null,null],["REGISTERED SIGN","00AE","registered",["registered"],"Symbols",198,null,null,null],["DOUBLE EXCLAMATION MARK","203C","bangbang",["bangbang"],"Symbols",89,null,null,null],["EXCLAMATION QUESTION MARK","2049","interrobang",["interrobang"],"Symbols",90,null,null,null],["TRADE MARK SIGN","2122","tm",["tm"],"Symbols",196,null,null,null],["INFORMATION SOURCE","2139","information_source",["information_source"],"Symbols",130,null,null,null],["LEFT RIGHT ARROW","2194","left_right_arrow",["left_right_arrow"],"Symbols",178,null,null,null],["UP DOWN ARROW","2195","arrow_up_down",["arrow_up_down"],"Symbols",177,null,null,null],["NORTH WEST ARROW","2196","arrow_upper_left",["arrow_upper_left"],"Symbols",176,null,null,null],["NORTH EAST ARROW","2197","arrow_upper_right",["arrow_upper_right"],"Symbols",173,null,null,null],["SOUTH EAST ARROW","2198","arrow_lower_right",["arrow_lower_right"],"Symbols",174,null,null,null],["SOUTH WEST ARROW","2199","arrow_lower_left",["arrow_lower_left"],"Symbols",175,null,null,null],["LEFTWARDS ARROW WITH HOOK","21A9","leftwards_arrow_with_hook",["leftwards_arrow_with_hook"],"Symbols",180,null,null,null],["RIGHTWARDS ARROW WITH HOOK","21AA","arrow_right_hook",["arrow_right_hook"],"Symbols",179,null,null,null],["WATCH","231A","watch",["watch"],"Objects",1,null,null,null],["HOURGLASS","231B","hourglass",["hourglass"],"Objects",36,null,null,null],["KEYBOARD","2328","keyboard",["keyboard"],"Objects",5,null,null,null],["EJECT SYMBOL","23CF","eject",["eject"],"Symbols",158,null,null,null],["BLACK RIGHT-POINTING DOUBLE TRIANGLE","23E9","fast_forward",["fast_forward"],"Symbols",162,null,null,null],["BLACK LEFT-POINTING DOUBLE TRIANGLE","23EA","rewind",["rewind"],"Symbols",163,null,null,null],["BLACK UP-POINTING DOUBLE TRIANGLE","23EB","arrow_double_up",["arrow_double_up"],"Symbols",164,null,null,null],["BLACK DOWN-POINTING DOUBLE TRIANGLE","23EC","arrow_double_down",["arrow_double_down"],"Symbols",165,null,null,null],["BLACK RIGHT-POINTING DOUBLE TRIANGLE WITH VERTICAL BAR","23ED","black_right_pointing_double_triangle_with_vertical_bar",["black_right_pointing_double_triangle_with_vertical_bar"],"Symbols",160,null,null,null],["BLACK LEFT-POINTING DOUBLE TRIANGLE WITH VERTICAL BAR","23EE","black_left_pointing_double_triangle_with_vertical_bar",["black_left_pointing_double_triangle_with_vertical_bar"],"Symbols",161,null,null,null],["BLACK RIGHT-POINTING TRIANGLE WITH DOUBLE VERTICAL BAR","23EF","black_right_pointing_triangle_with_double_vertical_bar",["black_right_pointing_triangle_with_double_vertical_bar"],"Symbols",156,null,null,null],["ALARM CLOCK","23F0","alarm_clock",["alarm_clock"],"Objects",34,null,null,null],["STOPWATCH","23F1","stopwatch",["stopwatch"],"Objects",32,null,null,null],["TIMER CLOCK","23F2","timer_clock",["timer_clock"],"Objects",33,null,null,null],["HOURGLASS WITH FLOWING SAND","23F3","hourglass_flowing_sand",["hourglass_flowing_sand"],"Objects",37,null,null,null],["DOUBLE VERTICAL BAR","23F8","double_vertical_bar",["double_vertical_bar"],"Symbols",155,null,null,null],["BLACK SQUARE FOR STOP","23F9","black_square_for_stop",["black_square_for_stop"],"Symbols",157,null,null,null],["BLACK CIRCLE FOR RECORD","23FA","black_circle_for_record",["black_circle_for_record"],"Symbols",159,null,null,null],["CIRCLED LATIN CAPITAL LETTER M","24C2","m",["m"],"Symbols",108,null,null,null],["BLACK SMALL SQUARE","25AA","black_small_square",["black_small_square"],"Symbols",222,null,null,null],["WHITE SMALL SQUARE","25AB","white_small_square",["white_small_square"],"Symbols",223,null,null,null],["BLACK RIGHT-POINTING TRIANGLE","25B6","arrow_forward",["arrow_forward"],"Symbols",154,null,null,null],["BLACK LEFT-POINTING TRIANGLE","25C0","arrow_backward",["arrow_backward"],"Symbols",166,null,null,null],["WHITE MEDIUM SQUARE","25FB","white_medium_square",["white_medium_square"],"Symbols",227,null,null,null],["BLACK MEDIUM SQUARE","25FC","black_medium_square",["black_medium_square"],"Symbols",226,null,null,null],["WHITE MEDIUM SMALL SQUARE","25FD","white_medium_small_square",["white_medium_small_square"],"Symbols",225,null,null,null],["BLACK MEDIUM SMALL SQUARE","25FE","black_medium_small_square",["black_medium_small_square"],"Symbols",224,null,null,null],["BLACK SUN WITH RAYS","2600","sunny",["sunny"],"Nature",138,null,null,null],["CLOUD","2601","cloud",["cloud"],"Nature",144,null,null,null],["UMBRELLA","2602","umbrella",["umbrella"],"People",293,null,null,null],["SNOWMAN","2603","snowman",["snowman"],"Nature",149,null,null,null],["COMET","2604","comet",["comet"],"Nature",137,null,null,null],["BLACK TELEPHONE","260E","phone",["phone","telephone"],"Objects",24,null,null,null],["BALLOT BOX WITH CHECK","2611","ballot_box_with_check",["ballot_box_with_check"],"Symbols",208,null,null,null],["UMBRELLA WITH RAIN DROPS","2614","umbrella_with_rain_drops",["umbrella_with_rain_drops"],"Nature",159,null,null,null],["HOT BEVERAGE","2615","coffee",["coffee"],"Foods",73,null,null,null],["SHAMROCK","2618","shamrock",["shamrock"],"Nature",96,null,null,null],["WHITE UP POINTING INDEX","261D","point_up",["point_up"],"People",116,!0,null,null],["SKULL AND CROSSBONES","2620","skull_and_crossbones",["skull_and_crossbones"],"People",83,null,null,null],["RADIOACTIVE SIGN","2622","radioactive_sign",["radioactive_sign"],"Symbols",44,null,null,null],["BIOHAZARD SIGN","2623","biohazard_sign",["biohazard_sign"],"Symbols",45,null,null,null],["ORTHODOX CROSS","2626","orthodox_cross",["orthodox_cross"],"Symbols",26,null,null,null],["STAR AND CRESCENT","262A","star_and_crescent",["star_and_crescent"],"Symbols",19,null,null,null],["PEACE SYMBOL","262E","peace_symbol",["peace_symbol"],"Symbols",17,null,null,null],["YIN YANG","262F","yin_yang",["yin_yang"],"Symbols",25,null,null,null],["WHEEL OF DHARMA","2638","wheel_of_dharma",["wheel_of_dharma"],"Symbols",21,null,null,null],["WHITE FROWNING FACE","2639","white_frowning_face",["white_frowning_face"],"People",38,null,null,null],["WHITE SMILING FACE","263A","relaxed",["relaxed"],"People",9,null,null,null],["FEMALE SIGN","2640","female_sign",["female_sign"],"Symbols",274,null,null,null],["MALE SIGN","2642","male_sign",["male_sign"],"Symbols",275,null,null,null],["ARIES","2648","aries",["aries"],"Symbols",29,null,null,null],["TAURUS","2649","taurus",["taurus"],"Symbols",30,null,null,null],["GEMINI","264A","gemini",["gemini"],"Symbols",31,null,null,null],["CANCER","264B","cancer",["cancer"],"Symbols",32,null,null,null],["LEO","264C","leo",["leo"],"Symbols",33,null,null,null],["VIRGO","264D","virgo",["virgo"],"Symbols",34,null,null,null],["LIBRA","264E","libra",["libra"],"Symbols",35,null,null,null],["SCORPIUS","264F","scorpius",["scorpius"],"Symbols",36,null,null,null],["SAGITTARIUS","2650","sagittarius",["sagittarius"],"Symbols",37,null,null,null],["CAPRICORN","2651","capricorn",["capricorn"],"Symbols",38,null,null,null],["AQUARIUS","2652","aquarius",["aquarius"],"Symbols",39,null,null,null],["PISCES","2653","pisces",["pisces"],"Symbols",40,null,null,null],["BLACK SPADE SUIT","2660","spades",["spades"],"Symbols",243,null,null,null],["BLACK CLUB SUIT","2663","clubs",["clubs"],"Symbols",244,null,null,null],["BLACK HEART SUIT","2665","hearts",["hearts"],"Symbols",245,null,null,null],["BLACK DIAMOND SUIT","2666","diamonds",["diamonds"],"Symbols",246,null,null,null],["HOT SPRINGS","2668","hotsprings",["hotsprings"],"Symbols",77,null,null,null],["BLACK UNIVERSAL RECYCLING SYMBOL","267B","recycle",["recycle"],"Symbols",99,null,null,null],["WHEELCHAIR SYMBOL","267F","wheelchair",["wheelchair"],"Symbols",113,null,null,null],["HAMMER AND PICK","2692","hammer_and_pick",["hammer_and_pick"],"Objects",57,null,null,null],["ANCHOR","2693","anchor",["anchor"],"Places",53,null,null,null],["CROSSED SWORDS","2694","crossed_swords",["crossed_swords"],"Objects",67,null,null,null],["STAFF OF AESCULAPIUS","2695","staff_of_aesculapius",["staff_of_aesculapius"],"Symbols",276,null,null,null],["SCALES","2696","scales",["scales"],"Objects",54,null,null,null],["ALEMBIC","2697","alembic",["alembic"],"Objects",76,null,null,null],["GEAR","2699","gear",["gear"],"Objects",61,null,null,null],["ATOM SYMBOL","269B","atom_symbol",["atom_symbol"],"Symbols",42,null,null,null],["FLEUR-DE-LIS","269C","fleur_de_lis",["fleur_de_lis"],"Symbols",97,null,null,null],["WARNING SIGN","26A0","warning",["warning"],"Symbols",94,null,null,null],["HIGH VOLTAGE SIGN","26A1","zap",["zap"],"Nature",134,null,null,null],["MEDIUM WHITE CIRCLE","26AA","white_circle",["white_circle"],"Symbols",210,null,null,null],["MEDIUM BLACK CIRCLE","26AB","black_circle",["black_circle"],"Symbols",211,null,null,null],["COFFIN","26B0","coffin",["coffin"],"Objects",70,null,null,null],["FUNERAL URN","26B1","funeral_urn",["funeral_urn"],"Objects",71,null,null,null],["SOCCER BALL","26BD","soccer",["soccer"],"Activity",1,null,null,null],["BASEBALL","26BE","baseball",["baseball"],"Activity",4,null,null,null],["SNOWMAN WITHOUT SNOW","26C4","snowman_without_snow",["snowman_without_snow"],"Nature",150,null,null,null],["SUN BEHIND CLOUD","26C5","partly_sunny",["partly_sunny"],"Nature",140,null,null,null],["THUNDER CLOUD AND RAIN","26C8","thunder_cloud_and_rain",["thunder_cloud_and_rain"],"Nature",146,null,null,null],["OPHIUCHUS","26CE","ophiuchus",["ophiuchus"],"Symbols",28,null,null,null],["PICK","26CF","pick",["pick"],"Objects",59,null,null,null],["HELMET WITH WHITE CROSS","26D1","helmet_with_white_cross",["helmet_with_white_cross"],"People",284,null,null,null],["CHAINS","26D3","chains",["chains"],"Objects",62,null,null,null],["NO ENTRY","26D4","no_entry",["no_entry"],"Symbols",72,null,null,null],["SHINTO SHRINE","26E9","shinto_shrine",["shinto_shrine"],"Places",104,null,null,null],["CHURCH","26EA","church",["church"],"Places",100,null,null,null],["MOUNTAIN","26F0","mountain",["mountain"],"Places",73,null,null,null],["UMBRELLA ON GROUND","26F1","umbrella_on_ground",["umbrella_on_ground"],"Places",70,null,null,null],["FOUNTAIN","26F2","fountain",["fountain"],"Places",62,null,null,null],["FLAG IN HOLE","26F3","golf",["golf"],"Activity",15,null,null,null],["FERRY","26F4","ferry",["ferry"],"Places",51,null,null,null],["SAILBOAT","26F5","boat",["boat","sailboat"],"Places",47,null,null,null],["SKIER","26F7","skier",["skier"],"Activity",22,null,null,null],["ICE SKATE","26F8","ice_skate",["ice_skate"],"Activity",20,null,null,null],["PERSON WITH BALL","26F9","person_with_ball",["person_with_ball"],"Activity",34,!0,null,null],["TENT","26FA","tent",["tent"],"Places",79,null,null,null],["FUEL PUMP","26FD","fuelpump",["fuelpump"],"Places",55,null,null,null],["BLACK SCISSORS","2702","scissors",["scissors"],"Objects",160,null,null,null],["WHITE HEAVY CHECK MARK","2705","white_check_mark",["white_check_mark"],"Symbols",100,null,null,null],["AIRPLANE","2708","airplane",["airplane"],"Places",40,null,null,null],["ENVELOPE","2709","email",["email","envelope"],"Objects",107,null,null,null],["RAISED FIST","270A","fist",["fist"],"People",105,!0,null,null],["RAISED HAND","270B","hand",["hand","raised_hand"],"People",117,!0,null,null],["VICTORY HAND","270C","v",["v"],"People",109,!0,null,null],["WRITING HAND","270D","writing_hand",["writing_hand"],"People",125,!0,null,null],["PENCIL","270F","pencil2",["pencil2"],"Objects",167,null,null,null],["BLACK NIB","2712","black_nib",["black_nib"],"Objects",163,null,null,null],["HEAVY CHECK MARK","2714","heavy_check_mark",["heavy_check_mark"],"Symbols",207,null,null,null],["HEAVY MULTIPLICATION X","2716","heavy_multiplication_x",["heavy_multiplication_x"],"Symbols",193,null,null,null],["LATIN CROSS","271D","latin_cross",["latin_cross"],"Symbols",18,null,null,null],["STAR OF DAVID","2721","star_of_david",["star_of_david"],"Symbols",22,null,null,null],["SPARKLES","2728","sparkles",["sparkles"],"Nature",133,null,null,null],["EIGHT SPOKED ASTERISK","2733","eight_spoked_asterisk",["eight_spoked_asterisk"],"Symbols",104,null,null,null],["EIGHT POINTED BLACK STAR","2734","eight_pointed_black_star",["eight_pointed_black_star"],"Symbols",53,null,null,null],["SNOWFLAKE","2744","snowflake",["snowflake"],"Nature",151,null,null,null],["SPARKLE","2747","sparkle",["sparkle"],"Symbols",103,null,null,null],["CROSS MARK","274C","x",["x"],"Symbols",69,null,null,null],["NEGATIVE SQUARED CROSS MARK","274E","negative_squared_cross_mark",["negative_squared_cross_mark"],"Symbols",105,null,null,null],["BLACK QUESTION MARK ORNAMENT","2753","question",["question"],"Symbols",87,null,null,null],["WHITE QUESTION MARK ORNAMENT","2754","grey_question",["grey_question"],"Symbols",88,null,null,null],["WHITE EXCLAMATION MARK ORNAMENT","2755","grey_exclamation",["grey_exclamation"],"Symbols",86,null,null,null],["HEAVY EXCLAMATION MARK SYMBOL","2757","exclamation",["exclamation","heavy_exclamation_mark"],"Symbols",85,null,null,null],["HEAVY HEART EXCLAMATION MARK ORNAMENT","2763","heavy_heart_exclamation_mark_ornament",["heavy_heart_exclamation_mark_ornament"],"Symbols",8,null,null,null],["HEAVY BLACK HEART","2764","heart",["heart"],"Symbols",1,null,"<3",["<3"]],["HEAVY PLUS SIGN","2795","heavy_plus_sign",["heavy_plus_sign"],"Symbols",190,null,null,null],["HEAVY MINUS SIGN","2796","heavy_minus_sign",["heavy_minus_sign"],"Symbols",191,null,null,null],["HEAVY DIVISION SIGN","2797","heavy_division_sign",["heavy_division_sign"],"Symbols",192,null,null,null],["BLACK RIGHTWARDS ARROW","27A1","arrow_right",["arrow_right"],"Symbols",169,null,null,null],["CURLY LOOP","27B0","curly_loop",["curly_loop"],"Symbols",200,null,null,null],["DOUBLE CURLY LOOP","27BF","loop",["loop"],"Symbols",201,null,null,null],["ARROW POINTING RIGHTWARDS THEN CURVING UPWARDS","2934","arrow_heading_up",["arrow_heading_up"],"Symbols",181,null,null,null],["ARROW POINTING RIGHTWARDS THEN CURVING DOWNWARDS","2935","arrow_heading_down",["arrow_heading_down"],"Symbols",182,null,null,null],["LEFTWARDS BLACK ARROW","2B05","arrow_left",["arrow_left"],"Symbols",170,null,null,null],["UPWARDS BLACK ARROW","2B06","arrow_up",["arrow_up"],"Symbols",171,null,null,null],["DOWNWARDS BLACK ARROW","2B07","arrow_down",["arrow_down"],"Symbols",172,null,null,null],["BLACK LARGE SQUARE","2B1B","black_large_square",["black_large_square"],"Symbols",228,null,null,null],["WHITE LARGE SQUARE","2B1C","white_large_square",["white_large_square"],"Symbols",229,null,null,null],["WHITE MEDIUM STAR","2B50","star",["star"],"Nature",131,null,null,null],["HEAVY LARGE CIRCLE","2B55","o",["o"],"Symbols",70,null,null,null],["WAVY DASH","3030","wavy_dash",["wavy_dash"],"Symbols",199,null,null,null],["PART ALTERNATION MARK","303D","part_alternation_mark",["part_alternation_mark"],"Symbols",93,null,null,null],["CIRCLED IDEOGRAPH CONGRATULATION","3297","congratulations",["congratulations"],"Symbols",58,null,null,null],["CIRCLED IDEOGRAPH SECRET","3299","secret",["secret"],"Symbols",57,null,null,null],["MAHJONG TILE RED DRAGON","1F004","mahjong",["mahjong"],"Symbols",249,null,null,null],["PLAYING CARD BLACK JOKER","1F0CF","black_joker",["black_joker"],"Symbols",247,null,null,null],["NEGATIVE SQUARED LATIN CAPITAL LETTER A","1F170","a",["a"],"Symbols",63,null,null,null],["NEGATIVE SQUARED LATIN CAPITAL LETTER B","1F171","b",["b"],"Symbols",64,null,null,null],["NEGATIVE SQUARED LATIN CAPITAL LETTER O","1F17E","o2",["o2"],"Symbols",67,null,null,null],["NEGATIVE SQUARED LATIN CAPITAL LETTER P","1F17F","parking",["parking"],"Symbols",114,null,null,null],["NEGATIVE SQUARED AB","1F18E","ab",["ab"],"Symbols",65,null,null,null],["SQUARED CL","1F191","cl",["cl"],"Symbols",66,null,null,null],["SQUARED COOL","1F192","cool",["cool"],"Symbols",137,null,null,null],["SQUARED FREE","1F193","free",["free"],"Symbols",139,null,null,null],["SQUARED ID","1F194","id",["id"],"Symbols",41,null,null,null],["SQUARED NEW","1F195","new",["new"],"Symbols",138,null,null,null],["SQUARED NG","1F196","ng",["ng"],"Symbols",134,null,null,null],["SQUARED OK","1F197","ok",["ok"],"Symbols",135,null,null,null],["SQUARED SOS","1F198","sos",["sos"],"Symbols",68,null,null,null],["SQUARED UP WITH EXCLAMATION MARK","1F199","up",["up"],"Symbols",136,null,null,null],["SQUARED VS","1F19A","vs",["vs"],"Symbols",54,null,null,null],["SQUARED KATAKANA KOKO","1F201","koko",["koko"],"Symbols",128,null,null,null],["SQUARED KATAKANA SA","1F202","sa",["sa"],"Symbols",116,null,null,null],["SQUARED CJK UNIFIED IDEOGRAPH-7121","1F21A","u7121",["u7121"],"Symbols",49,null,null,null],["SQUARED CJK UNIFIED IDEOGRAPH-6307","1F22F","u6307",["u6307"],"Symbols",101,null,null,null],["SQUARED CJK UNIFIED IDEOGRAPH-7981","1F232","u7981",["u7981"],"Symbols",62,null,null,null],["SQUARED CJK UNIFIED IDEOGRAPH-7A7A","1F233","u7a7a",["u7a7a"],"Symbols",115,null,null,null],["SQUARED CJK UNIFIED IDEOGRAPH-5408","1F234","u5408",["u5408"],"Symbols",59,null,null,null],["SQUARED CJK UNIFIED IDEOGRAPH-6E80","1F235","u6e80",["u6e80"],"Symbols",60,null,null,null],["SQUARED CJK UNIFIED IDEOGRAPH-6709","1F236","u6709",["u6709"],"Symbols",48,null,null,null],["SQUARED CJK UNIFIED IDEOGRAPH-6708","1F237","u6708",["u6708"],"Symbols",52,null,null,null],["SQUARED CJK UNIFIED IDEOGRAPH-7533","1F238","u7533",["u7533"],"Symbols",50,null,null,null],["SQUARED CJK UNIFIED IDEOGRAPH-5272","1F239","u5272",["u5272"],"Symbols",61,null,null,null],["SQUARED CJK UNIFIED IDEOGRAPH-55B6","1F23A","u55b6",["u55b6"],"Symbols",51,null,null,null],["CIRCLED IDEOGRAPH ADVANTAGE","1F250","ideograph_advantage",["ideograph_advantage"],"Symbols",56,null,null,null],["CIRCLED IDEOGRAPH ACCEPT","1F251","accept",["accept"],"Symbols",43,null,null,null],["CYCLONE","1F300","cyclone",["cyclone"],"Symbols",109,null,null,null],["FOGGY","1F301","foggy",["foggy"],"Places",119,null,null,null],["CLOSED UMBRELLA","1F302","closed_umbrella",["closed_umbrella"],"People",292,null,null,null],["NIGHT WITH STARS","1F303","night_with_stars",["night_with_stars"],"Places",116,null,null,null],["SUNRISE OVER MOUNTAINS","1F304","sunrise_over_mountains",["sunrise_over_mountains"],"Places",109,null,null,null],["SUNRISE","1F305","sunrise",["sunrise"],"Places",108,null,null,null],["CITYSCAPE AT DUSK","1F306","city_sunset",["city_sunset"],"Places",114,null,null,null],["SUNSET OVER BUILDINGS","1F307","city_sunrise",["city_sunrise"],"Places",113,null,null,null],["RAINBOW","1F308","rainbow",["rainbow"],"Nature",143,null,null,null],["BRIDGE AT NIGHT","1F309","bridge_at_night",["bridge_at_night"],"Places",118,null,null,null],["WATER WAVE","1F30A","ocean",["ocean"],"Nature",156,null,null,null],["VOLCANO","1F30B","volcano",["volcano"],"Places",76,null,null,null],["MILKY WAY","1F30C","milky_way",["milky_way"],"Places",117,null,null,null],["EARTH GLOBE EUROPE-AFRICA","1F30D","earth_africa",["earth_africa"],"Nature",114,null,null,null],["EARTH GLOBE AMERICAS","1F30E","earth_americas",["earth_americas"],"Nature",113,null,null,null],["EARTH GLOBE ASIA-AUSTRALIA","1F30F","earth_asia",["earth_asia"],"Nature",115,null,null,null],["GLOBE WITH MERIDIANS","1F310","globe_with_meridians",["globe_with_meridians"],"Symbols",106,null,null,null],["NEW MOON SYMBOL","1F311","new_moon",["new_moon"],"Nature",120,null,null,null],["WAXING CRESCENT MOON SYMBOL","1F312","waxing_crescent_moon",["waxing_crescent_moon"],"Nature",121,null,null,null],["FIRST QUARTER MOON SYMBOL","1F313","first_quarter_moon",["first_quarter_moon"],"Nature",122,null,null,null],["WAXING GIBBOUS MOON SYMBOL","1F314","moon",["moon","waxing_gibbous_moon"],"Nature",123,null,null,null],["FULL MOON SYMBOL","1F315","full_moon",["full_moon"],"Nature",116,null,null,null],["WANING GIBBOUS MOON SYMBOL","1F316","waning_gibbous_moon",["waning_gibbous_moon"],"Nature",117,null,null,null],["LAST QUARTER MOON SYMBOL","1F317","last_quarter_moon",["last_quarter_moon"],"Nature",118,null,null,null],["WANING CRESCENT MOON SYMBOL","1F318","waning_crescent_moon",["waning_crescent_moon"],"Nature",119,null,null,null],["CRESCENT MOON","1F319","crescent_moon",["crescent_moon"],"Nature",129,null,null,null],["NEW MOON WITH FACE","1F31A","new_moon_with_face",["new_moon_with_face"],"Nature",124,null,null,null],["FIRST QUARTER MOON WITH FACE","1F31B","first_quarter_moon_with_face",["first_quarter_moon_with_face"],"Nature",127,null,null,null],["LAST QUARTER MOON WITH FACE","1F31C","last_quarter_moon_with_face",["last_quarter_moon_with_face"],"Nature",128,null,null,null],["FULL MOON WITH FACE","1F31D","full_moon_with_face",["full_moon_with_face"],"Nature",125,null,null,null],["SUN WITH FACE","1F31E","sun_with_face",["sun_with_face"],"Nature",126,null,null,null],["GLOWING STAR","1F31F","star2",["star2"],"Nature",132,null,null,null],["SHOOTING STAR","1F320","stars",["stars"],"Places",110,null,null,null],["THERMOMETER","1F321","thermometer",["thermometer"],"Objects",82,null,null,null],["WHITE SUN WITH SMALL CLOUD","1F324","mostly_sunny",["mostly_sunny","sun_small_cloud"],"Nature",139,null,null,null],["WHITE SUN BEHIND CLOUD","1F325","barely_sunny",["barely_sunny","sun_behind_cloud"],"Nature",141,null,null,null],["WHITE SUN BEHIND CLOUD WITH RAIN","1F326","partly_sunny_rain",["partly_sunny_rain","sun_behind_rain_cloud"],"Nature",142,null,null,null],["CLOUD WITH RAIN","1F327","rain_cloud",["rain_cloud"],"Nature",145,null,null,null],["CLOUD WITH SNOW","1F328","snow_cloud",["snow_cloud"],"Nature",148,null,null,null],["CLOUD WITH LIGHTNING","1F329","lightning",["lightning","lightning_cloud"],"Nature",147,null,null,null],["CLOUD WITH TORNADO","1F32A","tornado",["tornado","tornado_cloud"],"Nature",154,null,null,null],["FOG","1F32B","fog",["fog"],"Nature",155,null,null,null],["WIND BLOWING FACE","1F32C","wind_blowing_face",["wind_blowing_face"],"Nature",152,null,null,null],["HOT DOG","1F32D","hotdog",["hotdog"],"Foods",39,null,null,null],["TACO","1F32E","taco",["taco"],"Foods",43,null,null,null],["BURRITO","1F32F","burrito",["burrito"],"Foods",44,null,null,null],["CHESTNUT","1F330","chestnut",["chestnut"],"Foods",24,null,null,null],["SEEDLING","1F331","seedling",["seedling"],"Nature",94,null,null,null],["EVERGREEN TREE","1F332","evergreen_tree",["evergreen_tree"],"Nature",91,null,null,null],["DECIDUOUS TREE","1F333","deciduous_tree",["deciduous_tree"],"Nature",92,null,null,null],["PALM TREE","1F334","palm_tree",["palm_tree"],"Nature",93,null,null,null],["CACTUS","1F335","cactus",["cactus"],"Nature",89,null,null,null],["HOT PEPPER","1F336","hot_pepper",["hot_pepper"],"Foods",21,null,null,null],["TULIP","1F337","tulip",["tulip"],"Nature",106,null,null,null],["CHERRY BLOSSOM","1F338","cherry_blossom",["cherry_blossom"],"Nature",111,null,null,null],["ROSE","1F339","rose",["rose"],"Nature",107,null,null,null],["HIBISCUS","1F33A","hibiscus",["hibiscus"],"Nature",112,null,null,null],["SUNFLOWER","1F33B","sunflower",["sunflower"],"Nature",109,null,null,null],["BLOSSOM","1F33C","blossom",["blossom"],"Nature",110,null,null,null],["EAR OF MAIZE","1F33D","corn",["corn"],"Foods",20,null,null,null],["EAR OF RICE","1F33E","ear_of_rice",["ear_of_rice"],"Nature",104,null,null,null],["HERB","1F33F","herb",["herb"],"Nature",95,null,null,null],["FOUR LEAF CLOVER","1F340","four_leaf_clover",["four_leaf_clover"],"Nature",97,null,null,null],["MAPLE LEAF","1F341","maple_leaf",["maple_leaf"],"Nature",102,null,null,null],["FALLEN LEAF","1F342","fallen_leaf",["fallen_leaf"],"Nature",101,null,null,null],["LEAF FLUTTERING IN WIND","1F343","leaves",["leaves"],"Nature",100,null,null,null],["MUSHROOM","1F344","mushroom",["mushroom"],"Nature",103,null,null,null],["TOMATO","1F345","tomato",["tomato"],"Foods",16,null,null,null],["AUBERGINE","1F346","eggplant",["eggplant"],"Foods",17,null,null,null],["GRAPES","1F347","grapes",["grapes"],"Foods",8,null,null,null],["MELON","1F348","melon",["melon"],"Foods",10,null,null,null],["WATERMELON","1F349","watermelon",["watermelon"],"Foods",7,null,null,null],["TANGERINE","1F34A","tangerine",["tangerine"],"Foods",4,null,null,null],["LEMON","1F34B","lemon",["lemon"],"Foods",5,null,null,null],["BANANA","1F34C","banana",["banana"],"Foods",6,null,null,null],["PINEAPPLE","1F34D","pineapple",["pineapple"],"Foods",13,null,null,null],["RED APPLE","1F34E","apple",["apple"],"Foods",2,null,null,null],["GREEN APPLE","1F34F","green_apple",["green_apple"],"Foods",1,null,null,null],["PEAR","1F350","pear",["pear"],"Foods",3,null,null,null],["PEACH","1F351","peach",["peach"],"Foods",12,null,null,null],["CHERRIES","1F352","cherries",["cherries"],"Foods",11,null,null,null],["STRAWBERRY","1F353","strawberry",["strawberry"],"Foods",9,null,null,null],["HAMBURGER","1F354","hamburger",["hamburger"],"Foods",40,null,null,null],["SLICE OF PIZZA","1F355","pizza",["pizza"],"Foods",38,null,null,null],["MEAT ON BONE","1F356","meat_on_bone",["meat_on_bone"],"Foods",37,null,null,null],["POULTRY LEG","1F357","poultry_leg",["poultry_leg"],"Foods",36,null,null,null],["RICE CRACKER","1F358","rice_cracker",["rice_cracker"],"Foods",56,null,null,null],["RICE BALL","1F359","rice_ball",["rice_ball"],"Foods",55,null,null,null],["COOKED RICE","1F35A","rice",["rice"],"Foods",54,null,null,null],["CURRY AND RICE","1F35B","curry",["curry"],"Foods",53,null,null,null],["STEAMING BOWL","1F35C","ramen",["ramen"],"Foods",48,null,null,null],["SPAGHETTI","1F35D","spaghetti",["spaghetti"],"Foods",47,null,null,null],["BREAD","1F35E","bread",["bread"],"Foods",28,null,null,null],["FRENCH FRIES","1F35F","fries",["fries"],"Foods",41,null,null,null],["ROASTED SWEET POTATO","1F360","sweet_potato",["sweet_potato"],"Foods",23,null,null,null],["DANGO","1F361","dango",["dango"],"Foods",58,null,null,null],["ODEN","1F362","oden",["oden"],"Foods",57,null,null,null],["SUSHI","1F363","sushi",["sushi"],"Foods",51,null,null,null],["FRIED SHRIMP","1F364","fried_shrimp",["fried_shrimp"],"Foods",35,null,null,null],["FISH CAKE WITH SWIRL DESIGN","1F365","fish_cake",["fish_cake"],"Foods",50,null,null,null],["SOFT ICE CREAM","1F366","icecream",["icecream"],"Foods",61,null,null,null],["SHAVED ICE","1F367","shaved_ice",["shaved_ice"],"Foods",59,null,null,null],["ICE CREAM","1F368","ice_cream",["ice_cream"],"Foods",60,null,null,null],["DOUGHNUT","1F369","doughnut",["doughnut"],"Foods",69,null,null,null],["COOKIE","1F36A","cookie",["cookie"],"Foods",70,null,null,null],["CHOCOLATE BAR","1F36B","chocolate_bar",["chocolate_bar"],"Foods",67,null,null,null],["CANDY","1F36C","candy",["candy"],"Foods",66,null,null,null],["LOLLIPOP","1F36D","lollipop",["lollipop"],"Foods",65,null,null,null],["CUSTARD","1F36E","custard",["custard"],"Foods",64,null,null,null],["HONEY POT","1F36F","honey_pot",["honey_pot"],"Foods",26,null,null,null],["SHORTCAKE","1F370","cake",["cake"],"Foods",62,null,null,null],["BENTO BOX","1F371","bento",["bento"],"Foods",52,null,null,null],["POT OF FOOD","1F372","stew",["stew"],"Foods",49,null,null,null],["COOKING","1F373","fried_egg",["fried_egg","cooking"],"Foods",32,null,null,null],["FORK AND KNIFE","1F374","fork_and_knife",["fork_and_knife"],"Foods",85,null,null,null],["TEACUP WITHOUT HANDLE","1F375","tea",["tea"],"Foods",74,null,null,null],["SAKE BOTTLE AND CUP","1F376","sake",["sake"],"Foods",75,null,null,null],["WINE GLASS","1F377","wine_glass",["wine_glass"],"Foods",79,null,null,null],["COCKTAIL GLASS","1F378","cocktail",["cocktail"],"Foods",81,null,null,null],["TROPICAL DRINK","1F379","tropical_drink",["tropical_drink"],"Foods",82,null,null,null],["BEER MUG","1F37A","beer",["beer"],"Foods",76,null,null,null],["CLINKING BEER MUGS","1F37B","beers",["beers"],"Foods",77,null,null,null],["BABY BOTTLE","1F37C","baby_bottle",["baby_bottle"],"Foods",72,null,null,null],["FORK AND KNIFE WITH PLATE","1F37D","knife_fork_plate",["knife_fork_plate"],"Foods",86,null,null,null],["BOTTLE WITH POPPING CORK","1F37E","champagne",["champagne"],"Foods",83,null,null,null],["POPCORN","1F37F","popcorn",["popcorn"],"Foods",68,null,null,null],["RIBBON","1F380","ribbon",["ribbon"],"Objects",101,null,null,null],["WRAPPED PRESENT","1F381","gift",["gift"],"Objects",98,null,null,null],["BIRTHDAY CAKE","1F382","birthday",["birthday"],"Foods",63,null,null,null],["JACK-O-LANTERN","1F383","jack_o_lantern",["jack_o_lantern"],"People",87,null,null,null],["CHRISTMAS TREE","1F384","christmas_tree",["christmas_tree"],"Nature",90,null,null,null],["FATHER CHRISTMAS","1F385","santa",["santa"],"People",194,!0,null,null],["FIREWORKS","1F386","fireworks",["fireworks"],"Places",112,null,null,null],["FIREWORK SPARKLER","1F387","sparkler",["sparkler"],"Places",111,null,null,null],["BALLOON","1F388","balloon",["balloon"],"Objects",99,null,null,null],["PARTY POPPER","1F389","tada",["tada"],"Objects",103,null,null,null],["CONFETTI BALL","1F38A","confetti_ball",["confetti_ball"],"Objects",102,null,null,null],["TANABATA TREE","1F38B","tanabata_tree",["tanabata_tree"],"Nature",99,null,null,null],["CROSSED FLAGS","1F38C","crossed_flags",["crossed_flags"],"Flags",118,null,null,null],["PINE DECORATION","1F38D","bamboo",["bamboo"],"Nature",98,null,null,null],["JAPANESE DOLLS","1F38E","dolls",["dolls"],"Objects",104,null,null,null],["CARP STREAMER","1F38F","flags",["flags"],"Objects",100,null,null,null],["WIND CHIME","1F390","wind_chime",["wind_chime"],"Objects",106,null,null,null],["MOON VIEWING CEREMONY","1F391","rice_scene",["rice_scene"],"Places",106,null,null,null],["SCHOOL SATCHEL","1F392","school_satchel",["school_satchel"],"People",285,null,null,null],["GRADUATION CAP","1F393","mortar_board",["mortar_board"],"People",282,null,null,null],["MILITARY MEDAL","1F396","medal",["medal"],"Activity",56,null,null,null],["REMINDER RIBBON","1F397","reminder_ribbon",["reminder_ribbon"],"Activity",62,null,null,null],["STUDIO MICROPHONE","1F399","studio_microphone",["studio_microphone"],"Objects",29,null,null,null],["LEVEL SLIDER","1F39A","level_slider",["level_slider"],"Objects",30,null,null,null],["CONTROL KNOBS","1F39B","control_knobs",["control_knobs"],"Objects",31,null,null,null],["FILM FRAMES","1F39E","film_frames",["film_frames"],"Objects",22,null,null,null],["ADMISSION TICKETS","1F39F","admission_tickets",["admission_tickets"],"Activity",64,null,null,null],["CAROUSEL HORSE","1F3A0","carousel_horse",["carousel_horse"],"Places",69,null,null,null],["FERRIS WHEEL","1F3A1","ferris_wheel",["ferris_wheel"],"Places",67,null,null,null],["ROLLER COASTER","1F3A2","roller_coaster",["roller_coaster"],"Places",68,null,null,null],["FISHING POLE AND FISH","1F3A3","fishing_pole_and_fish",["fishing_pole_and_fish"],"Activity",17,null,null,null],["MICROPHONE","1F3A4","microphone",["microphone"],"Activity",72,null,null,null],["MOVIE CAMERA","1F3A5","movie_camera",["movie_camera"],"Objects",20,null,null,null],["CINEMA","1F3A6","cinema",["cinema"],"Symbols",126,null,null,null],["HEADPHONE","1F3A7","headphones",["headphones"],"Activity",73,null,null,null],["ARTIST PALETTE","1F3A8","art",["art"],"Activity",70,null,null,null],["TOP HAT","1F3A9","tophat",["tophat"],"People",281,null,null,null],["CIRCUS TENT","1F3AA","circus_tent",["circus_tent"],"Activity",65,null,null,null],["TICKET","1F3AB","ticket",["ticket"],"Activity",63,null,null,null],["CLAPPER BOARD","1F3AC","clapper",["clapper"],"Activity",71,null,null,null],["PERFORMING ARTS","1F3AD","performing_arts",["performing_arts"],"Activity",69,null,null,null],["VIDEO GAME","1F3AE","video_game",["video_game"],"Activity",84,null,null,null],["DIRECT HIT","1F3AF","dart",["dart"],"Activity",82,null,null,null],["SLOT MACHINE","1F3B0","slot_machine",["slot_machine"],"Activity",85,null,null,null],["BILLIARDS","1F3B1","8ball",["8ball"],"Activity",8,null,null,null],["GAME DIE","1F3B2","game_die",["game_die"],"Activity",81,null,null,null],["BOWLING","1F3B3","bowling",["bowling"],"Activity",83,null,null,null],["FLOWER PLAYING CARDS","1F3B4","flower_playing_cards",["flower_playing_cards"],"Symbols",248,null,null,null],["MUSICAL NOTE","1F3B5","musical_note",["musical_note"],"Symbols",188,null,null,null],["MULTIPLE MUSICAL NOTES","1F3B6","notes",["notes"],"Symbols",189,null,null,null],["SAXOPHONE","1F3B7","saxophone",["saxophone"],"Activity",77,null,null,null],["GUITAR","1F3B8","guitar",["guitar"],"Activity",79,null,null,null],["MUSICAL KEYBOARD","1F3B9","musical_keyboard",["musical_keyboard"],"Activity",75,null,null,null],["TRUMPET","1F3BA","trumpet",["trumpet"],"Activity",78,null,null,null],["VIOLIN","1F3BB","violin",["violin"],"Activity",80,null,null,null],["MUSICAL SCORE","1F3BC","musical_score",["musical_score"],"Activity",74,null,null,null],["RUNNING SHIRT WITH SASH","1F3BD","running_shirt_with_sash",["running_shirt_with_sash"],"Activity",54,null,null,null],["TENNIS RACQUET AND BALL","1F3BE","tennis",["tennis"],"Activity",5,null,null,null],["SKI AND SKI BOOT","1F3BF","ski",["ski"],"Activity",21,null,null,null],["BASKETBALL AND HOOP","1F3C0","basketball",["basketball"],"Activity",2,null,null,null],["CHEQUERED FLAG","1F3C1","checkered_flag",["checkered_flag"],"Flags",3,null,null,null],["SNOWBOARDER","1F3C2","snowboarder",["snowboarder"],"Activity",23,!0,null,null],["RUNNER","1F3C3","runner",["runner","running"],"People",233,!0,null,null],["SURFER","1F3C4","surfer",["surfer"],"Activity",41,!0,null,null],["SPORTS MEDAL","1F3C5","sports_medal",["sports_medal"],"Activity",55,null,null,null],["TROPHY","1F3C6","trophy",["trophy"],"Activity",60,null,null,null],["HORSE RACING","1F3C7","horse_racing",["horse_racing"],"Activity",49,!0,null,null],["AMERICAN FOOTBALL","1F3C8","football",["football"],"Activity",3,null,null,null],["RUGBY FOOTBALL","1F3C9","rugby_football",["rugby_football"],"Activity",7,null,null,null],["SWIMMER","1F3CA","swimmer",["swimmer"],"Activity",43,!0,null,null],["WEIGHT LIFTER","1F3CB","weight_lifter",["weight_lifter"],"Activity",25,!0,null,null],["GOLFER","1F3CC","golfer",["golfer"],"Activity",39,!0,null,null],["RACING MOTORCYCLE","1F3CD","racing_motorcycle",["racing_motorcycle"],"Places",17,null,null,null],["RACING CAR","1F3CE","racing_car",["racing_car"],"Places",6,null,null,null],["CRICKET BAT AND BALL","1F3CF","cricket_bat_and_ball",["cricket_bat_and_ball"],"Activity",14,null,null,null],["VOLLEYBALL","1F3D0","volleyball",["volleyball"],"Activity",6,null,null,null],["FIELD HOCKEY STICK AND BALL","1F3D1","field_hockey_stick_and_ball",["field_hockey_stick_and_ball"],"Activity",13,null,null,null],["ICE HOCKEY STICK AND PUCK","1F3D2","ice_hockey_stick_and_puck",["ice_hockey_stick_and_puck"],"Activity",12,null,null,null],["TABLE TENNIS PADDLE AND BALL","1F3D3","table_tennis_paddle_and_ball",["table_tennis_paddle_and_ball"],"Activity",9,null,null,null],["SNOW CAPPED MOUNTAIN","1F3D4","snow_capped_mountain",["snow_capped_mountain"],"Places",74,null,null,null],["CAMPING","1F3D5","camping",["camping"],"Places",78,null,null,null],["BEACH WITH UMBRELLA","1F3D6","beach_with_umbrella",["beach_with_umbrella"],"Places",71,null,null,null],["BUILDING CONSTRUCTION","1F3D7","building_construction",["building_construction"],"Places",82,null,null,null],["HOUSE BUILDINGS","1F3D8","house_buildings",["house_buildings"],"Places",86,null,null,null],["CITYSCAPE","1F3D9","cityscape",["cityscape"],"Places",115,null,null,null],["DERELICT HOUSE BUILDING","1F3DA","derelict_house_building",["derelict_house_building"],"Places",87,null,null,null],["CLASSICAL BUILDING","1F3DB","classical_building",["classical_building"],"Places",99,null,null,null],["DESERT","1F3DC","desert",["desert"],"Places",77,null,null,null],["DESERT ISLAND","1F3DD","desert_island",["desert_island"],"Places",72,null,null,null],["NATIONAL PARK","1F3DE","national_park",["national_park"],"Places",107,null,null,null],["STADIUM","1F3DF","stadium",["stadium"],"Places",66,null,null,null],["HOUSE BUILDING","1F3E0","house",["house"],"Places",84,null,null,null],["HOUSE WITH GARDEN","1F3E1","house_with_garden",["house_with_garden"],"Places",85,null,null,null],["OFFICE BUILDING","1F3E2","office",["office"],"Places",88,null,null,null],["JAPANESE POST OFFICE","1F3E3","post_office",["post_office"],"Places",90,null,null,null],["EUROPEAN POST OFFICE","1F3E4","european_post_office",["european_post_office"],"Places",91,null,null,null],["HOSPITAL","1F3E5","hospital",["hospital"],"Places",92,null,null,null],["BANK","1F3E6","bank",["bank"],"Places",93,null,null,null],["AUTOMATED TELLER MACHINE","1F3E7","atm",["atm"],"Symbols",111,null,null,null],["HOTEL","1F3E8","hotel",["hotel"],"Places",94,null,null,null],["LOVE HOTEL","1F3E9","love_hotel",["love_hotel"],"Places",97,null,null,null],["CONVENIENCE STORE","1F3EA","convenience_store",["convenience_store"],"Places",95,null,null,null],["SCHOOL","1F3EB","school",["school"],"Places",96,null,null,null],["DEPARTMENT STORE","1F3EC","department_store",["department_store"],"Places",89,null,null,null],["FACTORY","1F3ED","factory",["factory"],"Places",83,null,null,null],["IZAKAYA LANTERN","1F3EE","izakaya_lantern",["izakaya_lantern","lantern"],"Objects",105,null,null,null],["JAPANESE CASTLE","1F3EF","japanese_castle",["japanese_castle"],"Places",65,null,null,null],["EUROPEAN CASTLE","1F3F0","european_castle",["european_castle"],"Places",64,null,null,null],["WAVING WHITE FLAG","1F3F3","waving_white_flag",["waving_white_flag"],"Flags",1,null,null,null],["WAVING BLACK FLAG","1F3F4","waving_black_flag",["waving_black_flag"],"Flags",2,null,null,null],["ROSETTE","1F3F5","rosette",["rosette"],"Activity",61,null,null,null],["LABEL","1F3F7","label",["label"],"Objects",115,null,null,null],["BADMINTON RACQUET AND SHUTTLECOCK","1F3F8","badminton_racquet_and_shuttlecock",["badminton_racquet_and_shuttlecock"],"Activity",10,null,null,null],["BOW AND ARROW","1F3F9","bow_and_arrow",["bow_and_arrow"],"Activity",16,null,null,null],["AMPHORA","1F3FA","amphora",["amphora"],"Objects",72,null,null,null],["EMOJI MODIFIER FITZPATRICK TYPE-1-2","1F3FB","skin-tone-2",["skin-tone-2"],"Skin Tones",1,null,null,null],["EMOJI MODIFIER FITZPATRICK TYPE-3","1F3FC","skin-tone-3",["skin-tone-3"],"Skin Tones",2,null,null,null],["EMOJI MODIFIER FITZPATRICK TYPE-4","1F3FD","skin-tone-4",["skin-tone-4"],"Skin Tones",3,null,null,null],["EMOJI MODIFIER FITZPATRICK TYPE-5","1F3FE","skin-tone-5",["skin-tone-5"],"Skin Tones",4,null,null,null],["EMOJI MODIFIER FITZPATRICK TYPE-6","1F3FF","skin-tone-6",["skin-tone-6"],"Skin Tones",5,null,null,null],["RAT","1F400","rat",["rat"],"Nature",84,null,null,null],["MOUSE","1F401","mouse2",["mouse2"],"Nature",83,null,null,null],["OX","1F402","ox",["ox"],"Nature",63,null,null,null],["WATER BUFFALO","1F403","water_buffalo",["water_buffalo"],"Nature",62,null,null,null],["COW","1F404","cow2",["cow2"],"Nature",64,null,null,null],["TIGER","1F405","tiger2",["tiger2"],"Nature",61,null,null,null],["LEOPARD","1F406","leopard",["leopard"],"Nature",60,null,null,null],["RABBIT","1F407","rabbit2",["rabbit2"],"Nature",82,null,null,null],["CAT","1F408","cat2",["cat2"],"Nature",78,null,null,null],["DRAGON","1F409","dragon",["dragon"],"Nature",87,null,null,null],["CROCODILE","1F40A","crocodile",["crocodile"],"Nature",59,null,null,null],["WHALE","1F40B","whale2",["whale2"],"Nature",58,null,null,null],["SNAIL","1F40C","snail",["snail"],"Nature",38,null,null,null],["SNAKE","1F40D","snake",["snake"],"Nature",45,null,null,null],["HORSE","1F40E","racehorse",["racehorse"],"Nature",71,null,null,null],["RAM","1F40F","ram",["ram"],"Nature",74,null,null,null],["GOAT","1F410","goat",["goat"],"Nature",73,null,null,null],["SHEEP","1F411","sheep",["sheep"],"Nature",75,null,null,null],["MONKEY","1F412","monkey",["monkey"],"Nature",20,null,null,null],["ROOSTER","1F413","rooster",["rooster"],"Nature",79,null,null,null],["CHICKEN","1F414","chicken",["chicken"],"Nature",21,null,null,null],["DOG","1F415","dog2",["dog2"],"Nature",76,null,null,null],["PIG","1F416","pig2",["pig2"],"Nature",72,null,null,null],["BOAR","1F417","boar",["boar"],"Nature",32,null,null,null],["ELEPHANT","1F418","elephant",["elephant"],"Nature",68,null,null,null],["OCTOPUS","1F419","octopus",["octopus"],"Nature",50,null,null,null],["SPIRAL SHELL","1F41A","shell",["shell"],"Nature",39,null,null,null],["BUG","1F41B","bug",["bug"],"Nature",36,null,null,null],["ANT","1F41C","ant",["ant"],"Nature",41,null,null,null],["HONEYBEE","1F41D","bee",["bee","honeybee"],"Nature",35,null,null,null],["LADY BEETLE","1F41E","beetle",["beetle"],"Nature",40,null,null,null],["FISH","1F41F","fish",["fish"],"Nature",53,null,null,null],["TROPICAL FISH","1F420","tropical_fish",["tropical_fish"],"Nature",52,null,null,null],["BLOWFISH","1F421","blowfish",["blowfish"],"Nature",54,null,null,null],["TURTLE","1F422","turtle",["turtle"],"Nature",44,null,null,null],["HATCHING CHICK","1F423","hatching_chick",["hatching_chick"],"Nature",25,null,null,null],["BABY CHICK","1F424","baby_chick",["baby_chick"],"Nature",24,null,null,null],["FRONT-FACING BABY CHICK","1F425","hatched_chick",["hatched_chick"],"Nature",26,null,null,null],["BIRD","1F426","bird",["bird"],"Nature",23,null,null,null],["PENGUIN","1F427","penguin",["penguin"],"Nature",22,null,null,null],["KOALA","1F428","koala",["koala"],"Nature",9,null,null,null],["POODLE","1F429","poodle",["poodle"],"Nature",77,null,null,null],["DROMEDARY CAMEL","1F42A","dromedary_camel",["dromedary_camel"],"Nature",66,null,null,null],["BACTRIAN CAMEL","1F42B","camel",["camel"],"Nature",67,null,null,null],["DOLPHIN","1F42C","dolphin",["dolphin","flipper"],"Nature",55,null,null,null],["MOUSE FACE","1F42D","mouse",["mouse"],"Nature",3,null,null,null],["COW FACE","1F42E","cow",["cow"],"Nature",12,null,null,null],["TIGER FACE","1F42F","tiger",["tiger"],"Nature",10,null,null,null],["RABBIT FACE","1F430","rabbit",["rabbit"],"Nature",5,null,null,null],["CAT FACE","1F431","cat",["cat"],"Nature",2,null,null,null],["DRAGON FACE","1F432","dragon_face",["dragon_face"],"Nature",88,null,null,null],["SPOUTING WHALE","1F433","whale",["whale"],"Nature",57,null,null,null],["HORSE FACE","1F434","horse",["horse"],"Nature",33,null,null,null],["MONKEY FACE","1F435","monkey_face",["monkey_face"],"Nature",16,null,null,[":o)"]],["DOG FACE","1F436","dog",["dog"],"Nature",1,null,null,null],["PIG FACE","1F437","pig",["pig"],"Nature",13,null,null,null],["FROG FACE","1F438","frog",["frog"],"Nature",15,null,null,null],["HAMSTER FACE","1F439","hamster",["hamster"],"Nature",4,null,null,null],["WOLF FACE","1F43A","wolf",["wolf"],"Nature",31,null,null,null],["BEAR FACE","1F43B","bear",["bear"],"Nature",7,null,null,null],["PANDA FACE","1F43C","panda_face",["panda_face"],"Nature",8,null,null,null],["PIG NOSE","1F43D","pig_nose",["pig_nose"],"Nature",14,null,null,null],["PAW PRINTS","1F43E","feet",["feet","paw_prints"],"Nature",86,null,null,null],["CHIPMUNK","1F43F","chipmunk",["chipmunk"],"Nature",85,null,null,null],["EYES","1F440","eyes",["eyes"],"People",137,null,null,null],["EYE","1F441","eye",["eye"],"People",136,null,null,null],["EAR","1F442","ear",["ear"],"People",133,!0,null,null],["NOSE","1F443","nose",["nose"],"People",134,!0,null,null],["MOUTH","1F444","lips",["lips"],"People",131,null,null,null],["TONGUE","1F445","tongue",["tongue"],"People",132,null,null,null],["WHITE UP POINTING BACKHAND INDEX","1F446","point_up_2",["point_up_2"],"People",114,!0,null,null],["WHITE DOWN POINTING BACKHAND INDEX","1F447","point_down",["point_down"],"People",115,!0,null,null],["WHITE LEFT POINTING BACKHAND INDEX","1F448","point_left",["point_left"],"People",112,!0,null,null],["WHITE RIGHT POINTING BACKHAND INDEX","1F449","point_right",["point_right"],"People",113,!0,null,null],["FISTED HAND SIGN","1F44A","facepunch",["facepunch","punch"],"People",104,!0,null,null],["WAVING HAND SIGN","1F44B","wave",["wave"],"People",121,!0,null,null],["OK HAND SIGN","1F44C","ok_hand",["ok_hand"],"People",111,!0,null,null],["THUMBS UP SIGN","1F44D","+1",["+1","thumbsup"],"People",102,!0,null,null],["THUMBS DOWN SIGN","1F44E","-1",["-1","thumbsdown"],"People",103,!0,null,null],["CLAPPING HANDS SIGN","1F44F","clap",["clap"],"People",99,!0,null,null],["OPEN HANDS SIGN","1F450","open_hands",["open_hands"],"People",97,!0,null,null],["CROWN","1F451","crown",["crown"],"People",283,null,null,null],["WOMANS HAT","1F452","womans_hat",["womans_hat"],"People",280,null,null,null],["EYEGLASSES","1F453","eyeglasses",["eyeglasses"],"People",290,null,null,null],["NECKTIE","1F454","necktie",["necktie"],"People",271,null,null,null],["T-SHIRT","1F455","shirt",["shirt","tshirt"],"People",269,null,null,null],["JEANS","1F456","jeans",["jeans"],"People",270,null,null,null],["DRESS","1F457","dress",["dress"],"People",272,null,null,null],["KIMONO","1F458","kimono",["kimono"],"People",274,null,null,null],["BIKINI","1F459","bikini",["bikini"],"People",273,null,null,null],["WOMANS CLOTHES","1F45A","womans_clothes",["womans_clothes"],"People",268,null,null,null],["PURSE","1F45B","purse",["purse"],"People",287,null,null,null],["HANDBAG","1F45C","handbag",["handbag"],"People",288,null,null,null],["POUCH","1F45D","pouch",["pouch"],"People",286,null,null,null],["MANS SHOE","1F45E","mans_shoe",["mans_shoe","shoe"],"People",278,null,null,null],["ATHLETIC SHOE","1F45F","athletic_shoe",["athletic_shoe"],"People",279,null,null,null],["HIGH-HEELED SHOE","1F460","high_heel",["high_heel"],"People",275,null,null,null],["WOMANS SANDAL","1F461","sandal",["sandal"],"People",276,null,null,null],["WOMANS BOOTS","1F462","boot",["boot"],"People",277,null,null,null],["FOOTPRINTS","1F463","footprints",["footprints"],"People",135,null,null,null],["BUST IN SILHOUETTE","1F464","bust_in_silhouette",["bust_in_silhouette"],"People",139,null,null,null],["BUSTS IN SILHOUETTE","1F465","busts_in_silhouette",["busts_in_silhouette"],"People",140,null,null,null],["BOY","1F466","boy",["boy"],"People",142,!0,null,null],["GIRL","1F467","girl",["girl"],"People",143,!0,null,null],["MAN","1F468","man",["man"],"People",144,!0,null,null],["WOMAN","1F469","woman",["woman"],"People",145,!0,null,null],["FAMILY","1F46A","family",["family","man-woman-boy"],"People",243,null,null,null],["MAN AND WOMAN HOLDING HANDS","1F46B","couple",["couple","man_and_woman_holding_hands"],"People",234,null,null,null],["TWO MEN HOLDING HANDS","1F46C","two_men_holding_hands",["two_men_holding_hands"],"People",236,null,null,null],["TWO WOMEN HOLDING HANDS","1F46D","two_women_holding_hands",["two_women_holding_hands"],"People",235,null,null,null],["POLICE OFFICER","1F46E","cop",["cop"],"People",154,!0,null,null],["WOMAN WITH BUNNY EARS","1F46F","dancers",["dancers"],"People",228,null,null,null],["BRIDE WITH VEIL","1F470","bride_with_veil",["bride_with_veil"],"People",197,!0,null,null],["PERSON WITH BLOND HAIR","1F471","person_with_blond_hair",["person_with_blond_hair"],"People",147,!0,null,null],["MAN WITH GUA PI MAO","1F472","man_with_gua_pi_mao",["man_with_gua_pi_mao"],"People",150,!0,null,null],["MAN WITH TURBAN","1F473","man_with_turban",["man_with_turban"],"People",152,!0,null,null],["OLDER MAN","1F474","older_man",["older_man"],"People",148,!0,null,null],["OLDER WOMAN","1F475","older_woman",["older_woman"],"People",149,!0,null,null],["BABY","1F476","baby",["baby"],"People",141,!0,null,null],["CONSTRUCTION WORKER","1F477","construction_worker",["construction_worker"],"People",156,!0,null,null],["PRINCESS","1F478","princess",["princess"],"People",195,!0,null,null],["JAPANESE OGRE","1F479","japanese_ogre",["japanese_ogre"],"People",78,null,null,null],["JAPANESE GOBLIN","1F47A","japanese_goblin",["japanese_goblin"],"People",79,null,null,null],["GHOST","1F47B","ghost",["ghost"],"People",81,null,null,null],["BABY ANGEL","1F47C","angel",["angel"],"People",199,!0,null,null],["EXTRATERRESTRIAL ALIEN","1F47D","alien",["alien"],"People",84,null,null,null],["ALIEN MONSTER","1F47E","space_invader",["space_invader"],"People",85,null,null,null],["IMP","1F47F","imp",["imp"],"People",77,null,null,null],["SKULL","1F480","skull",["skull"],"People",82,null,null,null],["INFORMATION DESK PERSON","1F481","information_desk_person",["information_desk_person"],"People",203,!0,null,null],["GUARDSMAN","1F482","guardsman",["guardsman"],"People",158,!0,null,null],["DANCER","1F483","dancer",["dancer"],"People",226,!0,null,null],["LIPSTICK","1F484","lipstick",["lipstick"],"People",129,null,null,null],["NAIL POLISH","1F485","nail_care",["nail_care"],"People",127,!0,null,null],["FACE MASSAGE","1F486","massage",["massage"],"People",223,!0,null,null],["HAIRCUT","1F487","haircut",["haircut"],"People",221,!0,null,null],["BARBER POLE","1F488","barber",["barber"],"Objects",75,null,null,null],["SYRINGE","1F489","syringe",["syringe"],"Objects",81,null,null,null],["PILL","1F48A","pill",["pill"],"Objects",80,null,null,null],["KISS MARK","1F48B","kiss",["kiss"],"People",130,null,null,null],["LOVE LETTER","1F48C","love_letter",["love_letter"],"Objects",111,null,null,null],["RING","1F48D","ring",["ring"],"People",128,null,null,null],["GEM STONE","1F48E","gem",["gem"],"Objects",53,null,null,null],["KISS","1F48F","couplekiss",["couplekiss"],"People",240,null,null,null],["BOUQUET","1F490","bouquet",["bouquet"],"Nature",105,null,null,null],["COUPLE WITH HEART","1F491","couple_with_heart",["couple_with_heart"],"People",237,null,null,null],["WEDDING","1F492","wedding",["wedding"],"Places",98,null,null,null],["BEATING HEART","1F493","heartbeat",["heartbeat"],"Symbols",11,null,null,null],["BROKEN HEART","1F494","broken_heart",["broken_heart"],"Symbols",7,null,"</3",["</3"]],["TWO HEARTS","1F495","two_hearts",["two_hearts"],"Symbols",9,null,null,null],["SPARKLING HEART","1F496","sparkling_heart",["sparkling_heart"],"Symbols",13,null,null,null],["GROWING HEART","1F497","heartpulse",["heartpulse"],"Symbols",12,null,null,null],["HEART WITH ARROW","1F498","cupid",["cupid"],"Symbols",14,null,null,null],["BLUE HEART","1F499","blue_heart",["blue_heart"],"Symbols",4,null,"<3",null],["GREEN HEART","1F49A","green_heart",["green_heart"],"Symbols",3,null,"<3",null],["YELLOW HEART","1F49B","yellow_heart",["yellow_heart"],"Symbols",2,null,"<3",null],["PURPLE HEART","1F49C","purple_heart",["purple_heart"],"Symbols",5,null,"<3",null],["HEART WITH RIBBON","1F49D","gift_heart",["gift_heart"],"Symbols",15,null,null,null],["REVOLVING HEARTS","1F49E","revolving_hearts",["revolving_hearts"],"Symbols",10,null,null,null],["HEART DECORATION","1F49F","heart_decoration",["heart_decoration"],"Symbols",16,null,null,null],["DIAMOND SHAPE WITH A DOT INSIDE","1F4A0","diamond_shape_with_a_dot_inside",["diamond_shape_with_a_dot_inside"],"Symbols",107,null,null,null],["ELECTRIC LIGHT BULB","1F4A1","bulb",["bulb"],"Objects",41,null,null,null],["ANGER SYMBOL","1F4A2","anger",["anger"],"Symbols",76,null,null,null],["BOMB","1F4A3","bomb",["bomb"],"Objects",64,null,null,null],["SLEEPING SYMBOL","1F4A4","zzz",["zzz"],"Symbols",110,null,null,null],["COLLISION SYMBOL","1F4A5","boom",["boom","collision"],"Nature",136,null,null,null],["SPLASHING SWEAT SYMBOL","1F4A6","sweat_drops",["sweat_drops"],"Nature",158,null,null,null],["DROPLET","1F4A7","droplet",["droplet"],"Nature",157,null,null,null],["DASH SYMBOL","1F4A8","dash",["dash"],"Nature",153,null,null,null],["PILE OF POO","1F4A9","hankey",["hankey","poop","shit"],"People",80,null,null,null],["FLEXED BICEPS","1F4AA","muscle",["muscle"],"People",123,!0,null,null],["DIZZY SYMBOL","1F4AB","dizzy",["dizzy"],"Nature",130,null,null,null],["SPEECH BALLOON","1F4AC","speech_balloon",["speech_balloon"],"Symbols",239,null,null,null],["THOUGHT BALLOON","1F4AD","thought_balloon",["thought_balloon"],"Symbols",241,null,null,null],["WHITE FLOWER","1F4AE","white_flower",["white_flower"],"Symbols",55,null,null,null],["HUNDRED POINTS SYMBOL","1F4AF","100",["100"],"Symbols",75,null,null,null],["MONEY BAG","1F4B0","moneybag",["moneybag"],"Objects",51,null,null,null],["CURRENCY EXCHANGE","1F4B1","currency_exchange",["currency_exchange"],"Symbols",195,null,null,null],["HEAVY DOLLAR SIGN","1F4B2","heavy_dollar_sign",["heavy_dollar_sign"],"Symbols",194,null,null,null],["CREDIT CARD","1F4B3","credit_card",["credit_card"],"Objects",52,null,null,null],["BANKNOTE WITH YEN SIGN","1F4B4","yen",["yen"],"Objects",48,null,null,null],["BANKNOTE WITH DOLLAR SIGN","1F4B5","dollar",["dollar"],"Objects",47,null,null,null],["BANKNOTE WITH EURO SIGN","1F4B6","euro",["euro"],"Objects",49,null,null,null],["BANKNOTE WITH POUND SIGN","1F4B7","pound",["pound"],"Objects",50,null,null,null],["MONEY WITH WINGS","1F4B8","money_with_wings",["money_with_wings"],"Objects",46,null,null,null],["CHART WITH UPWARDS TREND AND YEN SIGN","1F4B9","chart",["chart"],"Symbols",102,null,null,null],["SEAT","1F4BA","seat",["seat"],"Places",45,null,null,null],["PERSONAL COMPUTER","1F4BB","computer",["computer"],"Objects",4,null,null,null],["BRIEFCASE","1F4BC","briefcase",["briefcase"],"People",289,null,null,null],["MINIDISC","1F4BD","minidisc",["minidisc"],"Objects",12,null,null,null],["FLOPPY DISK","1F4BE","floppy_disk",["floppy_disk"],"Objects",13,null,null,null],["OPTICAL DISC","1F4BF","cd",["cd"],"Objects",14,null,null,null],["DVD","1F4C0","dvd",["dvd"],"Objects",15,null,null,null],["FILE FOLDER","1F4C1","file_folder",["file_folder"],"Objects",138,null,null,null],["OPEN FILE FOLDER","1F4C2","open_file_folder",["open_file_folder"],"Objects",139,null,null,null],["PAGE WITH CURL","1F4C3","page_with_curl",["page_with_curl"],"Objects",123,null,null,null],["PAGE FACING UP","1F4C4","page_facing_up",["page_facing_up"],"Objects",124,null,null,null],["CALENDAR","1F4C5","date",["date"],"Objects",132,null,null,null],["TEAR-OFF CALENDAR","1F4C6","calendar",["calendar"],"Objects",131,null,null,null],["CARD INDEX","1F4C7","card_index",["card_index"],"Objects",133,null,null,null],["CHART WITH UPWARDS TREND","1F4C8","chart_with_upwards_trend",["chart_with_upwards_trend"],"Objects",127,null,null,null],["CHART WITH DOWNWARDS TREND","1F4C9","chart_with_downwards_trend",["chart_with_downwards_trend"],"Objects",128,null,null,null],["BAR CHART","1F4CA","bar_chart",["bar_chart"],"Objects",126,null,null,null],["CLIPBOARD","1F4CB","clipboard",["clipboard"],"Objects",137,null,null,null],["PUSHPIN","1F4CC","pushpin",["pushpin"],"Objects",158,null,null,null],["ROUND PUSHPIN","1F4CD","round_pushpin",["round_pushpin"],"Objects",159,null,null,null],["PAPERCLIP","1F4CE","paperclip",["paperclip"],"Objects",154,null,null,null],["STRAIGHT RULER","1F4CF","straight_ruler",["straight_ruler"],"Objects",157,null,null,null],["TRIANGULAR RULER","1F4D0","triangular_ruler",["triangular_ruler"],"Objects",156,null,null,null],["BOOKMARK TABS","1F4D1","bookmark_tabs",["bookmark_tabs"],"Objects",125,null,null,null],["LEDGER","1F4D2","ledger",["ledger"],"Objects",145,null,null,null],["NOTEBOOK","1F4D3","notebook",["notebook"],"Objects",143,null,null,null],["NOTEBOOK WITH DECORATIVE COVER","1F4D4","notebook_with_decorative_cover",["notebook_with_decorative_cover"],"Objects",144,null,null,null],["CLOSED BOOK","1F4D5","closed_book",["closed_book"],"Objects",146,null,null,null],["OPEN BOOK","1F4D6","book",["book","open_book"],"Objects",151,null,null,null],["GREEN BOOK","1F4D7","green_book",["green_book"],"Objects",147,null,null,null],["BLUE BOOK","1F4D8","blue_book",["blue_book"],"Objects",148,null,null,null],["ORANGE BOOK","1F4D9","orange_book",["orange_book"],"Objects",149,null,null,null],["BOOKS","1F4DA","books",["books"],"Objects",150,null,null,null],["NAME BADGE","1F4DB","name_badge",["name_badge"],"Symbols",73,null,null,null],["SCROLL","1F4DC","scroll",["scroll"],"Objects",122,null,null,null],["MEMO","1F4DD","memo",["memo","pencil"],"Objects",166,null,null,null],["TELEPHONE RECEIVER","1F4DE","telephone_receiver",["telephone_receiver"],"Objects",23,null,null,null],["PAGER","1F4DF","pager",["pager"],"Objects",25,null,null,null],["FAX MACHINE","1F4E0","fax",["fax"],"Objects",26,null,null,null],["SATELLITE ANTENNA","1F4E1","satellite_antenna",["satellite_antenna"],"Objects",38,null,null,null],["PUBLIC ADDRESS LOUDSPEAKER","1F4E2","loudspeaker",["loudspeaker"],"Symbols",237,null,null,null],["CHEERING MEGAPHONE","1F4E3","mega",["mega"],"Symbols",236,null,null,null],["OUTBOX TRAY","1F4E4","outbox_tray",["outbox_tray"],"Objects",113,null,null,null],["INBOX TRAY","1F4E5","inbox_tray",["inbox_tray"],"Objects",112,null,null,null],["PACKAGE","1F4E6","package",["package"],"Objects",114,null,null,null],["E-MAIL SYMBOL","1F4E7","e-mail",["e-mail"],"Objects",110,null,null,null],["INCOMING ENVELOPE","1F4E8","incoming_envelope",["incoming_envelope"],"Objects",109,null,null,null],["ENVELOPE WITH DOWNWARDS ARROW ABOVE","1F4E9","envelope_with_arrow",["envelope_with_arrow"],"Objects",108,null,null,null],["CLOSED MAILBOX WITH LOWERED FLAG","1F4EA","mailbox_closed",["mailbox_closed"],"Objects",116,null,null,null],["CLOSED MAILBOX WITH RAISED FLAG","1F4EB","mailbox",["mailbox"],"Objects",117,null,null,null],["OPEN MAILBOX WITH RAISED FLAG","1F4EC","mailbox_with_mail",["mailbox_with_mail"],"Objects",118,null,null,null],["OPEN MAILBOX WITH LOWERED FLAG","1F4ED","mailbox_with_no_mail",["mailbox_with_no_mail"],"Objects",119,null,null,null],["POSTBOX","1F4EE","postbox",["postbox"],"Objects",120,null,null,null],["POSTAL HORN","1F4EF","postal_horn",["postal_horn"],"Objects",121,null,null,null],["NEWSPAPER","1F4F0","newspaper",["newspaper"],"Objects",142,null,null,null],["MOBILE PHONE","1F4F1","iphone",["iphone"],"Objects",2,null,null,null],["MOBILE PHONE WITH RIGHTWARDS ARROW AT LEFT","1F4F2","calling",["calling"],"Objects",3,null,null,null],["VIBRATION MODE","1F4F3","vibration_mode",["vibration_mode"],"Symbols",47,null,null,null],["MOBILE PHONE OFF","1F4F4","mobile_phone_off",["mobile_phone_off"],"Symbols",46,null,null,null],["NO MOBILE PHONES","1F4F5","no_mobile_phones",["no_mobile_phones"],"Symbols",83,null,null,null],["ANTENNA WITH BARS","1F4F6","signal_strength",["signal_strength"],"Symbols",127,null,null,null],["CAMERA","1F4F7","camera",["camera"],"Objects",17,null,null,null],["CAMERA WITH FLASH","1F4F8","camera_with_flash",["camera_with_flash"],"Objects",18,null,null,null],["VIDEO CAMERA","1F4F9","video_camera",["video_camera"],"Objects",19,null,null,null],["TELEVISION","1F4FA","tv",["tv"],"Objects",27,null,null,null],["RADIO","1F4FB","radio",["radio"],"Objects",28,null,null,null],["VIDEOCASSETTE","1F4FC","vhs",["vhs"],"Objects",16,null,null,null],["FILM PROJECTOR","1F4FD","film_projector",["film_projector"],"Objects",21,null,null,null],["PRAYER BEADS","1F4FF","prayer_beads",["prayer_beads"],"Objects",74,null,null,null],["TWISTED RIGHTWARDS ARROWS","1F500","twisted_rightwards_arrows",["twisted_rightwards_arrows"],"Symbols",183,null,null,null],["CLOCKWISE RIGHTWARDS AND LEFTWARDS OPEN CIRCLE ARROWS","1F501","repeat",["repeat"],"Symbols",184,null,null,null],["CLOCKWISE RIGHTWARDS AND LEFTWARDS OPEN CIRCLE ARROWS WITH CIRCLED ONE OVERLAY","1F502","repeat_one",["repeat_one"],"Symbols",185,null,null,null],["CLOCKWISE DOWNWARDS AND UPWARDS OPEN CIRCLE ARROWS","1F503","arrows_clockwise",["arrows_clockwise"],"Symbols",187,null,null,null],["ANTICLOCKWISE DOWNWARDS AND UPWARDS OPEN CIRCLE ARROWS","1F504","arrows_counterclockwise",["arrows_counterclockwise"],"Symbols",186,null,null,null],["LOW BRIGHTNESS SYMBOL","1F505","low_brightness",["low_brightness"],"Symbols",91,null,null,null],["HIGH BRIGHTNESS SYMBOL","1F506","high_brightness",["high_brightness"],"Symbols",92,null,null,null],["SPEAKER WITH CANCELLATION STROKE","1F507","mute",["mute"],"Symbols",231,null,null,null],["SPEAKER","1F508","speaker",["speaker"],"Symbols",230,null,null,null],["SPEAKER WITH ONE SOUND WAVE","1F509","sound",["sound"],"Symbols",232,null,null,null],["SPEAKER WITH THREE SOUND WAVES","1F50A","loud_sound",["loud_sound"],"Symbols",233,null,null,null],["BATTERY","1F50B","battery",["battery"],"Objects",39,null,null,null],["ELECTRIC PLUG","1F50C","electric_plug",["electric_plug"],"Objects",40,null,null,null],["LEFT-POINTING MAGNIFYING GLASS","1F50D","mag",["mag"],"Objects",168,null,null,null],["RIGHT-POINTING MAGNIFYING GLASS","1F50E","mag_right",["mag_right"],"Objects",169,null,null,null],["LOCK WITH INK PEN","1F50F","lock_with_ink_pen",["lock_with_ink_pen"],"Objects",170,null,null,null],["CLOSED LOCK WITH KEY","1F510","closed_lock_with_key",["closed_lock_with_key"],"Objects",171,null,null,null],["KEY","1F511","key",["key"],"Objects",89,null,null,null],["LOCK","1F512","lock",["lock"],"Objects",172,null,null,null],["OPEN LOCK","1F513","unlock",["unlock"],"Objects",173,null,null,null],["BELL","1F514","bell",["bell"],"Symbols",234,null,null,null],["BELL WITH CANCELLATION STROKE","1F515","no_bell",["no_bell"],"Symbols",235,null,null,null],["BOOKMARK","1F516","bookmark",["bookmark"],"Objects",152,null,null,null],["LINK SYMBOL","1F517","link",["link"],"Objects",153,null,null,null],["RADIO BUTTON","1F518","radio_button",["radio_button"],"Symbols",209,null,null,null],["BACK WITH LEFTWARDS ARROW ABOVE","1F519","back",["back"],"Symbols",203,null,null,null],["END WITH LEFTWARDS ARROW ABOVE","1F51A","end",["end"],"Symbols",202,null,null,null],["ON WITH EXCLAMATION MARK WITH LEFT RIGHT ARROW ABOVE","1F51B","on",["on"],"Symbols",204,null,null,null],["SOON WITH RIGHTWARDS ARROW ABOVE","1F51C","soon",["soon"],"Symbols",206,null,null,null],["TOP WITH UPWARDS ARROW ABOVE","1F51D","top",["top"],"Symbols",205,null,null,null],["NO ONE UNDER EIGHTEEN SYMBOL","1F51E","underage",["underage"],"Symbols",82,null,null,null],["KEYCAP TEN","1F51F","keycap_ten",["keycap_ten"],"Symbols",150,null,null,null],["INPUT SYMBOL FOR LATIN CAPITAL LETTERS","1F520","capital_abcd",["capital_abcd"],"Symbols",133,null,null,null],["INPUT SYMBOL FOR LATIN SMALL LETTERS","1F521","abcd",["abcd"],"Symbols",132,null,null,null],["INPUT SYMBOL FOR NUMBERS","1F522","1234",["1234"],"Symbols",151,null,null,null],["INPUT SYMBOL FOR SYMBOLS","1F523","symbols",["symbols"],"Symbols",129,null,null,null],["INPUT SYMBOL FOR LATIN LETTERS","1F524","abc",["abc"],"Symbols",131,null,null,null],["FIRE","1F525","fire",["fire"],"Nature",135,null,null,null],["ELECTRIC TORCH","1F526","flashlight",["flashlight"],"Objects",42,null,null,null],["WRENCH","1F527","wrench",["wrench"],"Objects",55,null,null,null],["HAMMER","1F528","hammer",["hammer"],"Objects",56,null,null,null],["NUT AND BOLT","1F529","nut_and_bolt",["nut_and_bolt"],"Objects",60,null,null,null],["HOCHO","1F52A","hocho",["hocho","knife"],"Objects",65,null,null,null],["PISTOL","1F52B","gun",["gun"],"Objects",63,null,null,null],["MICROSCOPE","1F52C","microscope",["microscope"],"Objects",78,null,null,null],["TELESCOPE","1F52D","telescope",["telescope"],"Objects",77,null,null,null],["CRYSTAL BALL","1F52E","crystal_ball",["crystal_ball"],"Objects",73,null,null,null],["SIX POINTED STAR WITH MIDDLE DOT","1F52F","six_pointed_star",["six_pointed_star"],"Symbols",23,null,null,null],["JAPANESE SYMBOL FOR BEGINNER","1F530","beginner",["beginner"],"Symbols",98,null,null,null],["TRIDENT EMBLEM","1F531","trident",["trident"],"Symbols",96,null,null,null],["BLACK SQUARE BUTTON","1F532","black_square_button",["black_square_button"],"Symbols",221,null,null,null],["WHITE SQUARE BUTTON","1F533","white_square_button",["white_square_button"],"Symbols",220,null,null,null],["LARGE RED CIRCLE","1F534","red_circle",["red_circle"],"Symbols",212,null,null,null],["LARGE BLUE CIRCLE","1F535","large_blue_circle",["large_blue_circle"],"Symbols",213,null,null,null],["LARGE ORANGE DIAMOND","1F536","large_orange_diamond",["large_orange_diamond"],"Symbols",218,null,null,null],["LARGE BLUE DIAMOND","1F537","large_blue_diamond",["large_blue_diamond"],"Symbols",219,null,null,null],["SMALL ORANGE DIAMOND","1F538","small_orange_diamond",["small_orange_diamond"],"Symbols",216,null,null,null],["SMALL BLUE DIAMOND","1F539","small_blue_diamond",["small_blue_diamond"],"Symbols",217,null,null,null],["UP-POINTING RED TRIANGLE","1F53A","small_red_triangle",["small_red_triangle"],"Symbols",214,null,null,null],["DOWN-POINTING RED TRIANGLE","1F53B","small_red_triangle_down",["small_red_triangle_down"],"Symbols",215,null,null,null],["UP-POINTING SMALL RED TRIANGLE","1F53C","arrow_up_small",["arrow_up_small"],"Symbols",167,null,null,null],["DOWN-POINTING SMALL RED TRIANGLE","1F53D","arrow_down_small",["arrow_down_small"],"Symbols",168,null,null,null],["OM SYMBOL","1F549","om_symbol",["om_symbol"],"Symbols",20,null,null,null],["DOVE OF PEACE","1F54A","dove_of_peace",["dove_of_peace"],"Nature",81,null,null,null],["KAABA","1F54B","kaaba",["kaaba"],"Places",103,null,null,null],["MOSQUE","1F54C","mosque",["mosque"],"Places",101,null,null,null],["SYNAGOGUE","1F54D","synagogue",["synagogue"],"Places",102,null,null,null],["MENORAH WITH NINE BRANCHES","1F54E","menorah_with_nine_branches",["menorah_with_nine_branches"],"Symbols",24,null,null,null],["CLOCK FACE ONE OCLOCK","1F550","clock1",["clock1"],"Symbols",250,null,null,null],["CLOCK FACE TWO OCLOCK","1F551","clock2",["clock2"],"Symbols",251,null,null,null],["CLOCK FACE THREE OCLOCK","1F552","clock3",["clock3"],"Symbols",252,null,null,null],["CLOCK FACE FOUR OCLOCK","1F553","clock4",["clock4"],"Symbols",253,null,null,null],["CLOCK FACE FIVE OCLOCK","1F554","clock5",["clock5"],"Symbols",254,null,null,null],["CLOCK FACE SIX OCLOCK","1F555","clock6",["clock6"],"Symbols",255,null,null,null],["CLOCK FACE SEVEN OCLOCK","1F556","clock7",["clock7"],"Symbols",256,null,null,null],["CLOCK FACE EIGHT OCLOCK","1F557","clock8",["clock8"],"Symbols",257,null,null,null],["CLOCK FACE NINE OCLOCK","1F558","clock9",["clock9"],"Symbols",258,null,null,null],["CLOCK FACE TEN OCLOCK","1F559","clock10",["clock10"],"Symbols",259,null,null,null],["CLOCK FACE ELEVEN OCLOCK","1F55A","clock11",["clock11"],"Symbols",260,null,null,null],["CLOCK FACE TWELVE OCLOCK","1F55B","clock12",["clock12"],"Symbols",261,null,null,null],["CLOCK FACE ONE-THIRTY","1F55C","clock130",["clock130"],"Symbols",262,null,null,null],["CLOCK FACE TWO-THIRTY","1F55D","clock230",["clock230"],"Symbols",263,null,null,null],["CLOCK FACE THREE-THIRTY","1F55E","clock330",["clock330"],"Symbols",264,null,null,null],["CLOCK FACE FOUR-THIRTY","1F55F","clock430",["clock430"],"Symbols",265,null,null,null],["CLOCK FACE FIVE-THIRTY","1F560","clock530",["clock530"],"Symbols",266,null,null,null],["CLOCK FACE SIX-THIRTY","1F561","clock630",["clock630"],"Symbols",267,null,null,null],["CLOCK FACE SEVEN-THIRTY","1F562","clock730",["clock730"],"Symbols",268,null,null,null],["CLOCK FACE EIGHT-THIRTY","1F563","clock830",["clock830"],"Symbols",269,null,null,null],["CLOCK FACE NINE-THIRTY","1F564","clock930",["clock930"],"Symbols",270,null,null,null],["CLOCK FACE TEN-THIRTY","1F565","clock1030",["clock1030"],"Symbols",271,null,null,null],["CLOCK FACE ELEVEN-THIRTY","1F566","clock1130",["clock1130"],"Symbols",272,null,null,null],["CLOCK FACE TWELVE-THIRTY","1F567","clock1230",["clock1230"],"Symbols",273,null,null,null],["CANDLE","1F56F","candle",["candle"],"Objects",43,null,null,null],["MANTELPIECE CLOCK","1F570","mantelpiece_clock",["mantelpiece_clock"],"Objects",35,null,null,null],["HOLE","1F573","hole",["hole"],"Objects",79,null,null,null],["MAN IN BUSINESS SUIT LEVITATING","1F574","man_in_business_suit_levitating",["man_in_business_suit_levitating"],"People",225,!0,null,null],["SLEUTH OR SPY","1F575","sleuth_or_spy",["sleuth_or_spy"],"People",160,!0,null,null],["DARK SUNGLASSES","1F576","dark_sunglasses",["dark_sunglasses"],"People",291,null,null,null],["SPIDER","1F577","spider",["spider"],"Nature",42,null,null,null],["SPIDER WEB","1F578","spider_web",["spider_web"],"Nature",43,null,null,null],["JOYSTICK","1F579","joystick",["joystick"],"Objects",10,null,null,null],["MAN DANCING","1F57A","man_dancing",["man_dancing"],"People",227,!0,null,null],["LINKED PAPERCLIPS","1F587","linked_paperclips",["linked_paperclips"],"Objects",155,null,null,null],["LOWER LEFT BALLPOINT PEN","1F58A","lower_left_ballpoint_pen",["lower_left_ballpoint_pen"],"Objects",161,null,null,null],["LOWER LEFT FOUNTAIN PEN","1F58B","lower_left_fountain_pen",["lower_left_fountain_pen"],"Objects",162,null,null,null],["LOWER LEFT PAINTBRUSH","1F58C","lower_left_paintbrush",["lower_left_paintbrush"],"Objects",164,null,null,null],["LOWER LEFT CRAYON","1F58D","lower_left_crayon",["lower_left_crayon"],"Objects",165,null,null,null],["RAISED HAND WITH FINGERS SPLAYED","1F590","raised_hand_with_fingers_splayed",["raised_hand_with_fingers_splayed"],"People",119,!0,null,null],["REVERSED HAND WITH MIDDLE FINGER EXTENDED","1F595","middle_finger",["middle_finger","reversed_hand_with_middle_finger_extended"],"People",124,!0,null,null],["RAISED HAND WITH PART BETWEEN MIDDLE AND RING FINGERS","1F596","spock-hand",["spock-hand"],"People",120,!0,null,null],["BLACK HEART","1F5A4","black_heart",["black_heart"],"Symbols",6,null,null,null],["DESKTOP COMPUTER","1F5A5","desktop_computer",["desktop_computer"],"Objects",6,null,null,null],["PRINTER","1F5A8","printer",["printer"],"Objects",7,null,null,null],["THREE BUTTON MOUSE","1F5B1","three_button_mouse",["three_button_mouse"],"Objects",8,null,null,null],["TRACKBALL","1F5B2","trackball",["trackball"],"Objects",9,null,null,null],["FRAME WITH PICTURE","1F5BC","frame_with_picture",["frame_with_picture"],"Objects",95,null,null,null],["CARD INDEX DIVIDERS","1F5C2","card_index_dividers",["card_index_dividers"],"Objects",140,null,null,null],["CARD FILE BOX","1F5C3","card_file_box",["card_file_box"],"Objects",134,null,null,null],["FILE CABINET","1F5C4","file_cabinet",["file_cabinet"],"Objects",136,null,null,null],["WASTEBASKET","1F5D1","wastebasket",["wastebasket"],"Objects",44,null,null,null],["SPIRAL NOTE PAD","1F5D2","spiral_note_pad",["spiral_note_pad"],"Objects",129,null,null,null],["SPIRAL CALENDAR PAD","1F5D3","spiral_calendar_pad",["spiral_calendar_pad"],"Objects",130,null,null,null],["COMPRESSION","1F5DC","compression",["compression"],"Objects",11,null,null,null],["OLD KEY","1F5DD","old_key",["old_key"],"Objects",90,null,null,null],["ROLLED-UP NEWSPAPER","1F5DE","rolled_up_newspaper",["rolled_up_newspaper"],"Objects",141,null,null,null],["DAGGER KNIFE","1F5E1","dagger_knife",["dagger_knife"],"Objects",66,null,null,null],["SPEAKING HEAD IN SILHOUETTE","1F5E3","speaking_head_in_silhouette",["speaking_head_in_silhouette"],"People",138,null,null,null],["LEFT SPEECH BUBBLE","1F5E8","left_speech_bubble",["left_speech_bubble"],"Symbols",240,null,null,null],["RIGHT ANGER BUBBLE","1F5EF","right_anger_bubble",["right_anger_bubble"],"Symbols",242,null,null,null],["BALLOT BOX WITH BALLOT","1F5F3","ballot_box_with_ballot",["ballot_box_with_ballot"],"Objects",135,null,null,null],["WORLD MAP","1F5FA","world_map",["world_map"],"Places",59,null,null,null],["MOUNT FUJI","1F5FB","mount_fuji",["mount_fuji"],"Places",75,null,null,null],["TOKYO TOWER","1F5FC","tokyo_tower",["tokyo_tower"],"Places",63,null,null,null],["STATUE OF LIBERTY","1F5FD","statue_of_liberty",["statue_of_liberty"],"Places",61,null,null,null],["SILHOUETTE OF JAPAN","1F5FE","japan",["japan"],"Places",105,null,null,null],["MOYAI","1F5FF","moyai",["moyai"],"Places",60,null,null,null],["GRINNING FACE","1F600","grinning",["grinning"],"People",1,null,":D",null],["GRINNING FACE WITH SMILING EYES","1F601","grin",["grin"],"People",4,null,null,null],["FACE WITH TEARS OF JOY","1F602","joy",["joy"],"People",7,null,null,null],["SMILING FACE WITH OPEN MOUTH","1F603","smiley",["smiley"],"People",2,null,":)",["=)","=-)"]],["SMILING FACE WITH OPEN MOUTH AND SMILING EYES","1F604","smile",["smile"],"People",3,null,":)",["C:","c:",":D",":-D"]],["SMILING FACE WITH OPEN MOUTH AND COLD SWEAT","1F605","sweat_smile",["sweat_smile"],"People",6,null,null,null],["SMILING FACE WITH OPEN MOUTH AND TIGHTLY-CLOSED EYES","1F606","laughing",["laughing","satisfied"],"People",5,null,null,[":>",":->"]],["SMILING FACE WITH HALO","1F607","innocent",["innocent"],"People",11,null,null,null],["SMILING FACE WITH HORNS","1F608","smiling_imp",["smiling_imp"],"People",76,null,null,null],["WINKING FACE","1F609","wink",["wink"],"People",14,null,";)",[";)",";-)"]],["SMILING FACE WITH SMILING EYES","1F60A","blush",["blush"],"People",10,null,":)",null],["FACE SAVOURING DELICIOUS FOOD","1F60B","yum",["yum"],"People",21,null,null,null],["RELIEVED FACE","1F60C","relieved",["relieved"],"People",15,null,null,null],["SMILING FACE WITH HEART-SHAPED EYES","1F60D","heart_eyes",["heart_eyes"],"People",16,null,null,null],["SMILING FACE WITH SUNGLASSES","1F60E","sunglasses",["sunglasses"],"People",28,null,null,["8)"]],["SMIRKING FACE","1F60F","smirk",["smirk"],"People",31,null,null,null],["NEUTRAL FACE","1F610","neutral_face",["neutral_face"],"People",47,null,null,[":|",":-|"]],["EXPRESSIONLESS FACE","1F611","expressionless",["expressionless"],"People",48,null,null,null],["UNAMUSED FACE","1F612","unamused",["unamused"],"People",32,null,":(",null],["FACE WITH COLD SWEAT","1F613","sweat",["sweat"],"People",63,null,null,null],["PENSIVE FACE","1F614","pensive",["pensive"],"People",34,null,null,null],["CONFUSED FACE","1F615","confused",["confused"],"People",36,null,null,[":\\",":-\\",":/",":-/"]],["CONFOUNDED FACE","1F616","confounded",["confounded"],"People",40,null,null,null],["KISSING FACE","1F617","kissing",["kissing"],"People",18,null,null,null],["FACE THROWING A KISS","1F618","kissing_heart",["kissing_heart"],"People",17,null,null,[":*",":-*"]],["KISSING FACE WITH SMILING EYES","1F619","kissing_smiling_eyes",["kissing_smiling_eyes"],"People",19,null,null,null],["KISSING FACE WITH CLOSED EYES","1F61A","kissing_closed_eyes",["kissing_closed_eyes"],"People",20,null,null,null],["FACE WITH STUCK-OUT TONGUE","1F61B","stuck_out_tongue",["stuck_out_tongue"],"People",24,null,":p",[":p",":-p",":P",":-P",":b",":-b"]],["FACE WITH STUCK-OUT TONGUE AND WINKING EYE","1F61C","stuck_out_tongue_winking_eye",["stuck_out_tongue_winking_eye"],"People",22,null,";p",[";p",";-p",";b",";-b",";P",";-P"]],["FACE WITH STUCK-OUT TONGUE AND TIGHTLY-CLOSED EYES","1F61D","stuck_out_tongue_closed_eyes",["stuck_out_tongue_closed_eyes"],"People",23,null,null,null],["DISAPPOINTED FACE","1F61E","disappointed",["disappointed"],"People",33,null,":(",["):",":(",":-("]],["WORRIED FACE","1F61F","worried",["worried"],"People",35,null,null,null],["ANGRY FACE","1F620","angry",["angry"],"People",44,null,null,[">:(",">:-("]],["POUTING FACE","1F621","rage",["rage"],"People",45,null,null,null],["CRYING FACE","1F622","cry",["cry"],"People",59,null,":'(",[":'("]],["PERSEVERING FACE","1F623","persevere",["persevere"],"People",39,null,null,null],["FACE WITH LOOK OF TRIUMPH","1F624","triumph",["triumph"],"People",43,null,null,null],["DISAPPOINTED BUT RELIEVED FACE","1F625","disappointed_relieved",["disappointed_relieved"],"People",60,null,null,null],["FROWNING FACE WITH OPEN MOUTH","1F626","frowning",["frowning"],"People",50,null,null,null],["ANGUISHED FACE","1F627","anguished",["anguished"],"People",51,null,null,["D:"]],["FEARFUL FACE","1F628","fearful",["fearful"],"People",57,null,null,null],["WEARY FACE","1F629","weary",["weary"],"People",42,null,null,null],["SLEEPY FACE","1F62A","sleepy",["sleepy"],"People",64,null,null,null],["TIRED FACE","1F62B","tired_face",["tired_face"],"People",41,null,null,null],["GRIMACING FACE","1F62C","grimacing",["grimacing"],"People",69,null,null,null],["LOUDLY CRYING FACE","1F62D","sob",["sob"],"People",62,null,":'(",null],["FACE WITH OPEN MOUTH","1F62E","open_mouth",["open_mouth"],"People",52,null,null,[":o",":-o",":O",":-O"]],["HUSHED FACE","1F62F","hushed",["hushed"],"People",49,null,null,null],["FACE WITH OPEN MOUTH AND COLD SWEAT","1F630","cold_sweat",["cold_sweat"],"People",58,null,null,null],["FACE SCREAMING IN FEAR","1F631","scream",["scream"],"People",56,null,null,null],["ASTONISHED FACE","1F632","astonished",["astonished"],"People",53,null,null,null],["FLUSHED FACE","1F633","flushed",["flushed"],"People",55,null,null,null],["SLEEPING FACE","1F634","sleeping",["sleeping"],"People",65,null,null,null],["DIZZY FACE","1F635","dizzy_face",["dizzy_face"],"People",54,null,null,null],["FACE WITHOUT MOUTH","1F636","no_mouth",["no_mouth"],"People",46,null,null,null],["FACE WITH MEDICAL MASK","1F637","mask",["mask"],"People",73,null,null,null],["GRINNING CAT FACE WITH SMILING EYES","1F638","smile_cat",["smile_cat"],"People",89,null,null,null],["CAT FACE WITH TEARS OF JOY","1F639","joy_cat",["joy_cat"],"People",90,null,null,null],["SMILING CAT FACE WITH OPEN MOUTH","1F63A","smiley_cat",["smiley_cat"],"People",88,null,null,null],["SMILING CAT FACE WITH HEART-SHAPED EYES","1F63B","heart_eyes_cat",["heart_eyes_cat"],"People",91,null,null,null],["CAT FACE WITH WRY SMILE","1F63C","smirk_cat",["smirk_cat"],"People",92,null,null,null],["KISSING CAT FACE WITH CLOSED EYES","1F63D","kissing_cat",["kissing_cat"],"People",93,null,null,null],["POUTING CAT FACE","1F63E","pouting_cat",["pouting_cat"],"People",96,null,null,null],["CRYING CAT FACE","1F63F","crying_cat_face",["crying_cat_face"],"People",95,null,null,null],["WEARY CAT FACE","1F640","scream_cat",["scream_cat"],"People",94,null,null,null],["SLIGHTLY FROWNING FACE","1F641","slightly_frowning_face",["slightly_frowning_face"],"People",37,null,null,null],["SLIGHTLY SMILING FACE","1F642","slightly_smiling_face",["slightly_smiling_face"],"People",12,null,null,[":)","(:",":-)"]],["UPSIDE-DOWN FACE","1F643","upside_down_face",["upside_down_face"],"People",13,null,null,null],["FACE WITH ROLLING EYES","1F644","face_with_rolling_eyes",["face_with_rolling_eyes"],"People",66,null,null,null],["FACE WITH NO GOOD GESTURE","1F645","no_good",["no_good"],"People",205,!0,null,null],["FACE WITH OK GESTURE","1F646","ok_woman",["ok_woman"],"People",207,!0,null,null],["PERSON BOWING DEEPLY","1F647","bow",["bow"],"People",202,!0,null,null],["SEE-NO-EVIL MONKEY","1F648","see_no_evil",["see_no_evil"],"Nature",17,null,null,null],["HEAR-NO-EVIL MONKEY","1F649","hear_no_evil",["hear_no_evil"],"Nature",18,null,null,null],["SPEAK-NO-EVIL MONKEY","1F64A","speak_no_evil",["speak_no_evil"],"Nature",19,null,null,null],["HAPPY PERSON RAISING ONE HAND","1F64B","raising_hand",["raising_hand"],"People",209,!0,null,null],["PERSON RAISING BOTH HANDS IN CELEBRATION","1F64C","raised_hands",["raised_hands"],"People",98,!0,null,null],["PERSON FROWNING","1F64D","person_frowning",["person_frowning"],"People",219,!0,null,null],["PERSON WITH POUTING FACE","1F64E","person_with_pouting_face",["person_with_pouting_face"],"People",217,!0,null,null],["PERSON WITH FOLDED HANDS","1F64F","pray",["pray"],"People",100,!0,null,null],["ROCKET","1F680","rocket",["rocket"],"Places",43,null,null,null],["HELICOPTER","1F681","helicopter",["helicopter"],"Places",38,null,null,null],["STEAM LOCOMOTIVE","1F682","steam_locomotive",["steam_locomotive"],"Places",33,null,null,null],["RAILWAY CAR","1F683","railway_car",["railway_car"],"Places",26,null,null,null],["HIGH-SPEED TRAIN","1F684","bullettrain_side",["bullettrain_side"],"Places",30,null,null,null],["HIGH-SPEED TRAIN WITH BULLET NOSE","1F685","bullettrain_front",["bullettrain_front"],"Places",31,null,null,null],["TRAIN","1F686","train2",["train2"],"Places",34,null,null,null],["METRO","1F687","metro",["metro"],"Places",35,null,null,null],["LIGHT RAIL","1F688","light_rail",["light_rail"],"Places",32,null,null,null],["STATION","1F689","station",["station"],"Places",37,null,null,null],["TRAM","1F68A","tram",["tram"],"Places",36,null,null,null],["TRAM CAR","1F68B","train",["train"],"Places",27,null,null,null],["BUS","1F68C","bus",["bus"],"Places",4,null,null,null],["ONCOMING BUS","1F68D","oncoming_bus",["oncoming_bus"],"Places",20,null,null,null],["TROLLEYBUS","1F68E","trolleybus",["trolleybus"],"Places",5,null,null,null],["BUS STOP","1F68F","busstop",["busstop"],"Places",56,null,null,null],["MINIBUS","1F690","minibus",["minibus"],"Places",10,null,null,null],["AMBULANCE","1F691","ambulance",["ambulance"],"Places",8,null,null,null],["FIRE ENGINE","1F692","fire_engine",["fire_engine"],"Places",9,null,null,null],["POLICE CAR","1F693","police_car",["police_car"],"Places",7,null,null,null],["ONCOMING POLICE CAR","1F694","oncoming_police_car",["oncoming_police_car"],"Places",19,null,null,null],["TAXI","1F695","taxi",["taxi"],"Places",2,null,null,null],["ONCOMING TAXI","1F696","oncoming_taxi",["oncoming_taxi"],"Places",22,null,null,null],["AUTOMOBILE","1F697","car",["car","red_car"],"Places",1,null,null,null],["ONCOMING AUTOMOBILE","1F698","oncoming_automobile",["oncoming_automobile"],"Places",21,null,null,null],["RECREATIONAL VEHICLE","1F699","blue_car",["blue_car"],"Places",3,null,null,null],["DELIVERY TRUCK","1F69A","truck",["truck"],"Places",11,null,null,null],["ARTICULATED LORRY","1F69B","articulated_lorry",["articulated_lorry"],"Places",12,null,null,null],["TRACTOR","1F69C","tractor",["tractor"],"Places",13,null,null,null],["MONORAIL","1F69D","monorail",["monorail"],"Places",29,null,null,null],["MOUNTAIN RAILWAY","1F69E","mountain_railway",["mountain_railway"],"Places",28,null,null,null],["SUSPENSION RAILWAY","1F69F","suspension_railway",["suspension_railway"],"Places",25,null,null,null],["MOUNTAIN CABLEWAY","1F6A0","mountain_cableway",["mountain_cableway"],"Places",24,null,null,null],["AERIAL TRAMWAY","1F6A1","aerial_tramway",["aerial_tramway"],"Places",23,null,null,null],["SHIP","1F6A2","ship",["ship"],"Places",52,null,null,null],["ROWBOAT","1F6A3","rowboat",["rowboat"],"Activity",48,!0,null,null],["SPEEDBOAT","1F6A4","speedboat",["speedboat"],"Places",49,null,null,null],["HORIZONTAL TRAFFIC LIGHT","1F6A5","traffic_light",["traffic_light"],"Places",58,null,null,null],["VERTICAL TRAFFIC LIGHT","1F6A6","vertical_traffic_light",["vertical_traffic_light"],"Places",57,null,null,null],["CONSTRUCTION SIGN","1F6A7","construction",["construction"],"Places",54,null,null,null],["POLICE CARS REVOLVING LIGHT","1F6A8","rotating_light",["rotating_light"],"Places",18,null,null,null],["TRIANGULAR FLAG ON POST","1F6A9","triangular_flag_on_post",["triangular_flag_on_post"],"Flags",4,null,null,null],["DOOR","1F6AA","door",["door"],"Objects",91,null,null,null],["NO ENTRY SIGN","1F6AB","no_entry_sign",["no_entry_sign"],"Symbols",74,null,null,null],["SMOKING SYMBOL","1F6AC","smoking",["smoking"],"Objects",69,null,null,null],["NO SMOKING SYMBOL","1F6AD","no_smoking",["no_smoking"],"Symbols",84,null,null,null],["PUT LITTER IN ITS PLACE SYMBOL","1F6AE","put_litter_in_its_place",["put_litter_in_its_place"],"Symbols",125,null,null,null],["DO NOT LITTER SYMBOL","1F6AF","do_not_litter",["do_not_litter"],"Symbols",79,null,null,null],["POTABLE WATER SYMBOL","1F6B0","potable_water",["potable_water"],"Objects",84,null,null,null],["NON-POTABLE WATER SYMBOL","1F6B1","non-potable_water",["non-potable_water"],"Symbols",81,null,null,null],["BICYCLE","1F6B2","bike",["bike"],"Places",15,null,null,null],["NO BICYCLES","1F6B3","no_bicycles",["no_bicycles"],"Symbols",80,null,null,null],["BICYCLIST","1F6B4","bicyclist",["bicyclist"],"Activity",51,!0,null,null],["MOUNTAIN BICYCLIST","1F6B5","mountain_bicyclist",["mountain_bicyclist"],"Activity",53,!0,null,null],["PEDESTRIAN","1F6B6","walking",["walking"],"People",231,!0,null,null],["NO PEDESTRIANS","1F6B7","no_pedestrians",["no_pedestrians"],"Symbols",78,null,null,null],["CHILDREN CROSSING","1F6B8","children_crossing",["children_crossing"],"Symbols",95,null,null,null],["MENS SYMBOL","1F6B9","mens",["mens"],"Symbols",121,null,null,null],["WOMENS SYMBOL","1F6BA","womens",["womens"],"Symbols",122,null,null,null],["RESTROOM","1F6BB","restroom",["restroom"],"Symbols",124,null,null,null],["BABY SYMBOL","1F6BC","baby_symbol",["baby_symbol"],"Symbols",123,null,null,null],["TOILET","1F6BD","toilet",["toilet"],"Objects",83,null,null,null],["WATER CLOSET","1F6BE","wc",["wc"],"Symbols",112,null,null,null],["SHOWER","1F6BF","shower",["shower"],"Objects",85,null,null,null],["BATH","1F6C0","bath",["bath"],"Objects",87,!0,null,null],["BATHTUB","1F6C1","bathtub",["bathtub"],"Objects",86,null,null,null],["PASSPORT CONTROL","1F6C2","passport_control",["passport_control"],"Symbols",117,null,null,null],["CUSTOMS","1F6C3","customs",["customs"],"Symbols",118,null,null,null],["BAGGAGE CLAIM","1F6C4","baggage_claim",["baggage_claim"],"Symbols",119,null,null,null],["LEFT LUGGAGE","1F6C5","left_luggage",["left_luggage"],"Symbols",120,null,null,null],["COUCH AND LAMP","1F6CB","couch_and_lamp",["couch_and_lamp"],"Objects",92,null,null,null],["SLEEPING ACCOMMODATION","1F6CC","sleeping_accommodation",["sleeping_accommodation"],"Objects",94,!0,null,null],["SHOPPING BAGS","1F6CD","shopping_bags",["shopping_bags"],"Objects",96,null,null,null],["BELLHOP BELL","1F6CE","bellhop_bell",["bellhop_bell"],"Objects",88,null,null,null],["BED","1F6CF","bed",["bed"],"Objects",93,null,null,null],["PLACE OF WORSHIP","1F6D0","place_of_worship",["place_of_worship"],"Symbols",27,null,null,null],["OCTAGONAL SIGN","1F6D1","octagonal_sign",["octagonal_sign"],"Symbols",71,null,null,null],["SHOPPING TROLLEY","1F6D2","shopping_trolley",["shopping_trolley"],"Objects",97,null,null,null],["HAMMER AND WRENCH","1F6E0","hammer_and_wrench",["hammer_and_wrench"],"Objects",58,null,null,null],["SHIELD","1F6E1","shield",["shield"],"Objects",68,null,null,null],["OIL DRUM","1F6E2","oil_drum",["oil_drum"],"Objects",45,null,null,null],["MOTORWAY","1F6E3","motorway",["motorway"],"Places",81,null,null,null],["RAILWAY TRACK","1F6E4","railway_track",["railway_track"],"Places",80,null,null,null],["MOTOR BOAT","1F6E5","motor_boat",["motor_boat"],"Places",48,null,null,null],["SMALL AIRPLANE","1F6E9","small_airplane",["small_airplane"],"Places",39,null,null,null],["AIRPLANE DEPARTURE","1F6EB","airplane_departure",["airplane_departure"],"Places",41,null,null,null],["AIRPLANE ARRIVING","1F6EC","airplane_arriving",["airplane_arriving"],"Places",42,null,null,null],["SATELLITE","1F6F0","satellite",["satellite"],"Places",44,null,null,null],["PASSENGER SHIP","1F6F3","passenger_ship",["passenger_ship"],"Places",50,null,null,null],["SCOOTER","1F6F4","scooter",["scooter"],"Places",14,null,null,null],["MOTOR SCOOTER","1F6F5","motor_scooter",["motor_scooter"],"Places",16,null,null,null],["CANOE","1F6F6","canoe",["canoe"],"Places",46,null,null,null],["ZIPPER-MOUTH FACE","1F910","zipper_mouth_face",["zipper_mouth_face"],"People",70,null,null,null],["MONEY-MOUTH FACE","1F911","money_mouth_face",["money_mouth_face"],"People",25,null,null,null],["FACE WITH THERMOMETER","1F912","face_with_thermometer",["face_with_thermometer"],"People",74,null,null,null],["NERD FACE","1F913","nerd_face",["nerd_face"],"People",27,null,null,null],["THINKING FACE","1F914","thinking_face",["thinking_face"],"People",67,null,null,null],["FACE WITH HEAD-BANDAGE","1F915","face_with_head_bandage",["face_with_head_bandage"],"People",75,null,null,null],["ROBOT FACE","1F916","robot_face",["robot_face"],"People",86,null,null,null],["HUGGING FACE","1F917","hugging_face",["hugging_face"],"People",26,null,null,null],["SIGN OF THE HORNS","1F918","the_horns",["the_horns","sign_of_the_horns"],"People",110,!0,null,null],["CALL ME HAND","1F919","call_me_hand",["call_me_hand"],"People",122,!0,null,null],["RAISED BACK OF HAND","1F91A","raised_back_of_hand",["raised_back_of_hand"],"People",118,!0,null,null],["LEFT-FACING FIST","1F91B","left-facing_fist",["left-facing_fist"],"People",106,!0,null,null],["RIGHT-FACING FIST","1F91C","right-facing_fist",["right-facing_fist"],"People",107,!0,null,null],["HANDSHAKE","1F91D","handshake",["handshake"],"People",101,null,null,null],["HAND WITH INDEX AND MIDDLE FINGERS CROSSED","1F91E","hand_with_index_and_middle_fingers_crossed",["hand_with_index_and_middle_fingers_crossed"],"People",108,!0,null,null],["FACE WITH COWBOY HAT","1F920","face_with_cowboy_hat",["face_with_cowboy_hat"],"People",30,null,null,null],["CLOWN FACE","1F921","clown_face",["clown_face"],"People",29,null,null,null],["NAUSEATED FACE","1F922","nauseated_face",["nauseated_face"],"People",71,null,null,null],["ROLLING ON THE FLOOR LAUGHING","1F923","rolling_on_the_floor_laughing",["rolling_on_the_floor_laughing"],"People",8,null,null,null],["DROOLING FACE","1F924","drooling_face",["drooling_face"],"People",61,null,null,null],["LYING FACE","1F925","lying_face",["lying_face"],"People",68,null,null,null],["FACE PALM","1F926","face_palm",["face_palm"],"People",211,!0,null,null],["SNEEZING FACE","1F927","sneezing_face",["sneezing_face"],"People",72,null,null,null],["PREGNANT WOMAN","1F930","pregnant_woman",["pregnant_woman"],"People",200,!0,null,null],["SELFIE","1F933","selfie",["selfie"],"People",126,!0,null,null],["PRINCE","1F934","prince",["prince"],"People",196,!0,null,null],["MAN IN TUXEDO","1F935","man_in_tuxedo",["man_in_tuxedo"],"People",198,!0,null,null],["MOTHER CHRISTMAS","1F936","mother_christmas",["mother_christmas"],"People",193,!0,null,null],["SHRUG","1F937","shrug",["shrug"],"People",214,!0,null,null],["PERSON DOING CARTWHEEL","1F938","person_doing_cartwheel",["person_doing_cartwheel"],"Activity",30,!0,null,null],["JUGGLING","1F939","juggling",["juggling"],"Activity",66,!0,null,null],["FENCER","1F93A","fencer",["fencer"],"Activity",26,null,null,null],["WRESTLERS","1F93C","wrestlers",["wrestlers"],"Activity",27,null,null,null],["WATER POLO","1F93D","water_polo",["water_polo"],"Activity",44,!0,null,null],["HANDBALL","1F93E","handball",["handball"],"Activity",35,!0,null,null],["WILTED FLOWER","1F940","wilted_flower",["wilted_flower"],"Nature",108,null,null,null],["DRUM WITH DRUMSTICKS","1F941","drum_with_drumsticks",["drum_with_drumsticks"],"Activity",76,null,null,null],["CLINKING GLASSES","1F942","clinking_glasses",["clinking_glasses"],"Foods",78,null,null,null],["TUMBLER GLASS","1F943","tumbler_glass",["tumbler_glass"],"Foods",80,null,null,null],["SPOON","1F944","spoon",["spoon"],"Foods",84,null,null,null],["GOAL NET","1F945","goal_net",["goal_net"],"Activity",11,null,null,null],["FIRST PLACE MEDAL","1F947","first_place_medal",["first_place_medal"],"Activity",57,null,null,null],["SECOND PLACE MEDAL","1F948","second_place_medal",["second_place_medal"],"Activity",58,null,null,null],["THIRD PLACE MEDAL","1F949","third_place_medal",["third_place_medal"],"Activity",59,null,null,null],["BOXING GLOVE","1F94A","boxing_glove",["boxing_glove"],"Activity",18,null,null,null],["MARTIAL ARTS UNIFORM","1F94B","martial_arts_uniform",["martial_arts_uniform"],"Activity",19,null,null,null],["CROISSANT","1F950","croissant",["croissant"],"Foods",27,null,null,null],["AVOCADO","1F951","avocado",["avocado"],"Foods",15,null,null,null],["CUCUMBER","1F952","cucumber",["cucumber"],"Foods",18,null,null,null],["BACON","1F953","bacon",["bacon"],"Foods",33,null,null,null],["POTATO","1F954","potato",["potato"],"Foods",22,null,null,null],["CARROT","1F955","carrot",["carrot"],"Foods",19,null,null,null],["BAGUETTE BREAD","1F956","baguette_bread",["baguette_bread"],"Foods",29,null,null,null],["GREEN SALAD","1F957","green_salad",["green_salad"],"Foods",45,null,null,null],["SHALLOW PAN OF FOOD","1F958","shallow_pan_of_food",["shallow_pan_of_food"],"Foods",46,null,null,null],["STUFFED FLATBREAD","1F959","stuffed_flatbread",["stuffed_flatbread"],"Foods",42,null,null,null],["EGG","1F95A","egg",["egg"],"Foods",31,null,null,null],["GLASS OF MILK","1F95B","glass_of_milk",["glass_of_milk"],"Foods",71,null,null,null],["PEANUTS","1F95C","peanuts",["peanuts"],"Foods",25,null,null,null],["KIWIFRUIT","1F95D","kiwifruit",["kiwifruit"],"Foods",14,null,null,null],["PANCAKES","1F95E","pancakes",["pancakes"],"Foods",34,null,null,null],["CRAB","1F980","crab",["crab"],"Nature",48,null,null,null],["LION FACE","1F981","lion_face",["lion_face"],"Nature",11,null,null,null],["SCORPION","1F982","scorpion",["scorpion"],"Nature",47,null,null,null],["TURKEY","1F983","turkey",["turkey"],"Nature",80,null,null,null],["UNICORN FACE","1F984","unicorn_face",["unicorn_face"],"Nature",34,null,null,null],["EAGLE","1F985","eagle",["eagle"],"Nature",28,null,null,null],["DUCK","1F986","duck",["duck"],"Nature",27,null,null,null],["BAT","1F987","bat",["bat"],"Nature",30,null,null,null],["SHARK","1F988","shark",["shark"],"Nature",56,null,null,null],["OWL","1F989","owl",["owl"],"Nature",29,null,null,null],["FOX FACE","1F98A","fox_face",["fox_face"],"Nature",6,null,null,null],["BUTTERFLY","1F98B","butterfly",["butterfly"],"Nature",37,null,null,null],["DEER","1F98C","deer",["deer"],"Nature",65,null,null,null],["GORILLA","1F98D","gorilla",["gorilla"],"Nature",70,null,null,null],["LIZARD","1F98E","lizard",["lizard"],"Nature",46,null,null,null],["RHINOCEROS","1F98F","rhinoceros",["rhinoceros"],"Nature",69,null,null,null],["SHRIMP","1F990","shrimp",["shrimp"],"Nature",51,null,null,null],["SQUID","1F991","squid",["squid"],"Nature",49,null,null,null],["CHEESE WEDGE","1F9C0","cheese_wedge",["cheese_wedge"],"Foods",30,null,null,null],["HASH KEY","0023-20E3","hash",["hash"],"Symbols",152,null,null,null],[null,"002A-20E3","keycap_star",["keycap_star"],"Symbols",153,null,null,null],["KEYCAP 0","0030-20E3","zero",["zero"],"Symbols",140,null,null,null],["KEYCAP 1","0031-20E3","one",["one"],"Symbols",141,null,null,null],["KEYCAP 2","0032-20E3","two",["two"],"Symbols",142,null,null,null],["KEYCAP 3","0033-20E3","three",["three"],"Symbols",143,null,null,null],["KEYCAP 4","0034-20E3","four",["four"],"Symbols",144,null,null,null],["KEYCAP 5","0035-20E3","five",["five"],"Symbols",145,null,null,null],["KEYCAP 6","0036-20E3","six",["six"],"Symbols",146,null,null,null],["KEYCAP 7","0037-20E3","seven",["seven"],"Symbols",147,null,null,null],["KEYCAP 8","0038-20E3","eight",["eight"],"Symbols",148,null,null,null],["KEYCAP 9","0039-20E3","nine",["nine"],"Symbols",149,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS AC","1F1E6-1F1E8","flag-ac",["flag-ac"],"Flags",254,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS AD","1F1E6-1F1E9","flag-ad",["flag-ad"],"Flags",11,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS AE","1F1E6-1F1EA","flag-ae",["flag-ae"],"Flags",239,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS AF","1F1E6-1F1EB","flag-af",["flag-af"],"Flags",6,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS AG","1F1E6-1F1EC","flag-ag",["flag-ag"],"Flags",15,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS AI","1F1E6-1F1EE","flag-ai",["flag-ai"],"Flags",13,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS AL","1F1E6-1F1F1","flag-al",["flag-al"],"Flags",8,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS AM","1F1E6-1F1F2","flag-am",["flag-am"],"Flags",17,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS AO","1F1E6-1F1F4","flag-ao",["flag-ao"],"Flags",12,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS AQ","1F1E6-1F1F6","flag-aq",["flag-aq"],"Flags",14,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS AR","1F1E6-1F1F7","flag-ar",["flag-ar"],"Flags",16,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS AS","1F1E6-1F1F8","flag-as",["flag-as"],"Flags",10,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS AT","1F1E6-1F1F9","flag-at",["flag-at"],"Flags",20,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS AU","1F1E6-1F1FA","flag-au",["flag-au"],"Flags",19,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS AW","1F1E6-1F1FC","flag-aw",["flag-aw"],"Flags",18,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS AX","1F1E6-1F1FD","flag-ax",["flag-ax"],"Flags",7,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS AZ","1F1E6-1F1FF","flag-az",["flag-az"],"Flags",21,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS BA","1F1E7-1F1E6","flag-ba",["flag-ba"],"Flags",34,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS BB","1F1E7-1F1E7","flag-bb",["flag-bb"],"Flags",25,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS BD","1F1E7-1F1E9","flag-bd",["flag-bd"],"Flags",24,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS BE","1F1E7-1F1EA","flag-be",["flag-be"],"Flags",27,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS BF","1F1E7-1F1EB","flag-bf",["flag-bf"],"Flags",41,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS BG","1F1E7-1F1EC","flag-bg",["flag-bg"],"Flags",40,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS BH","1F1E7-1F1ED","flag-bh",["flag-bh"],"Flags",23,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS BI","1F1E7-1F1EE","flag-bi",["flag-bi"],"Flags",42,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS BJ","1F1E7-1F1EF","flag-bj",["flag-bj"],"Flags",29,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS BL","1F1E7-1F1F1","flag-bl",["flag-bl"],"Flags",191,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS BM","1F1E7-1F1F2","flag-bm",["flag-bm"],"Flags",30,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS BN","1F1E7-1F1F3","flag-bn",["flag-bn"],"Flags",39,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS BO","1F1E7-1F1F4","flag-bo",["flag-bo"],"Flags",32,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS BQ","1F1E7-1F1F6","flag-bq",["flag-bq"],"Flags",33,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS BR","1F1E7-1F1F7","flag-br",["flag-br"],"Flags",36,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS BS","1F1E7-1F1F8","flag-bs",["flag-bs"],"Flags",22,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS BT","1F1E7-1F1F9","flag-bt",["flag-bt"],"Flags",31,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS BV","1F1E7-1F1FB","flag-bv",["flag-bv"],"Flags",255,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS BW","1F1E7-1F1FC","flag-bw",["flag-bw"],"Flags",35,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS BY","1F1E7-1F1FE","flag-by",["flag-by"],"Flags",26,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS BZ","1F1E7-1F1FF","flag-bz",["flag-bz"],"Flags",28,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS CA","1F1E8-1F1E6","flag-ca",["flag-ca"],"Flags",46,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS CC","1F1E8-1F1E8","flag-cc",["flag-cc"],"Flags",54,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS CD","1F1E8-1F1E9","flag-cd",["flag-cd"],"Flags",58,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS CF","1F1E8-1F1EB","flag-cf",["flag-cf"],"Flags",49,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS CG","1F1E8-1F1EC","flag-cg",["flag-cg"],"Flags",57,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS CH","1F1E8-1F1ED","flag-ch",["flag-ch"],"Flags",221,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS CI","1F1E8-1F1EE","flag-ci",["flag-ci"],"Flags",61,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS CK","1F1E8-1F1F0","flag-ck",["flag-ck"],"Flags",59,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS CL","1F1E8-1F1F1","flag-cl",["flag-cl"],"Flags",51,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS CM","1F1E8-1F1F2","flag-cm",["flag-cm"],"Flags",45,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS CN","1F1E8-1F1F3","flag-cn",["flag-cn","cn"],"Flags",52,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS CO","1F1E8-1F1F4","flag-co",["flag-co"],"Flags",55,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS CP","1F1E8-1F1F5","flag-cp",["flag-cp"],"Flags",256,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS CR","1F1E8-1F1F7","flag-cr",["flag-cr"],"Flags",60,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS CU","1F1E8-1F1FA","flag-cu",["flag-cu"],"Flags",63,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS CV","1F1E8-1F1FB","flag-cv",["flag-cv"],"Flags",43,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS CW","1F1E8-1F1FC","flag-cw",["flag-cw"],"Flags",64,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS CX","1F1E8-1F1FD","flag-cx",["flag-cx"],"Flags",53,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS CY","1F1E8-1F1FE","flag-cy",["flag-cy"],"Flags",65,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS CZ","1F1E8-1F1FF","flag-cz",["flag-cz"],"Flags",66,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS DE","1F1E9-1F1EA","flag-de",["flag-de","de"],"Flags",90,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS DG","1F1E9-1F1EC","flag-dg",["flag-dg"],"Flags",257,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS DJ","1F1E9-1F1EF","flag-dj",["flag-dj"],"Flags",68,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS DK","1F1E9-1F1F0","flag-dk",["flag-dk"],"Flags",67,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS DM","1F1E9-1F1F2","flag-dm",["flag-dm"],"Flags",69,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS DO","1F1E9-1F1F4","flag-do",["flag-do"],"Flags",70,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS DZ","1F1E9-1F1FF","flag-dz",["flag-dz"],"Flags",9,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS EA","1F1EA-1F1E6","flag-ea",["flag-ea"],"Flags",258,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS EC","1F1EA-1F1E8","flag-ec",["flag-ec"],"Flags",71,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS EE","1F1EA-1F1EA","flag-ee",["flag-ee"],"Flags",76,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS EG","1F1EA-1F1EC","flag-eg",["flag-eg"],"Flags",72,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS EH","1F1EA-1F1ED","flag-eh",["flag-eh"],"Flags",250,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS ER","1F1EA-1F1F7","flag-er",["flag-er"],"Flags",75,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS ES","1F1EA-1F1F8","flag-es",["flag-es","es"],"Flags",215,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS ET","1F1EA-1F1F9","flag-et",["flag-et"],"Flags",77,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS EU","1F1EA-1F1FA","flag-eu",["flag-eu"],"Flags",78,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS FI","1F1EB-1F1EE","flag-fi",["flag-fi"],"Flags",82,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS FJ","1F1EB-1F1EF","flag-fj",["flag-fj"],"Flags",81,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS FK","1F1EB-1F1F0","flag-fk",["flag-fk"],"Flags",79,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS FM","1F1EB-1F1F2","flag-fm",["flag-fm"],"Flags",150,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS FO","1F1EB-1F1F4","flag-fo",["flag-fo"],"Flags",80,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS FR","1F1EB-1F1F7","flag-fr",["flag-fr","fr"],"Flags",83,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS GA","1F1EC-1F1E6","flag-ga",["flag-ga"],"Flags",87,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS GB","1F1EC-1F1E7","flag-gb",["flag-gb","gb","uk"],"Flags",240,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS GD","1F1EC-1F1E9","flag-gd",["flag-gd"],"Flags",95,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS GE","1F1EC-1F1EA","flag-ge",["flag-ge"],"Flags",89,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS GF","1F1EC-1F1EB","flag-gf",["flag-gf"],"Flags",84,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS GG","1F1EC-1F1EC","flag-gg",["flag-gg"],"Flags",99,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS GH","1F1EC-1F1ED","flag-gh",["flag-gh"],"Flags",91,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS GI","1F1EC-1F1EE","flag-gi",["flag-gi"],"Flags",92,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS GL","1F1EC-1F1F1","flag-gl",["flag-gl"],"Flags",94,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS GM","1F1EC-1F1F2","flag-gm",["flag-gm"],"Flags",88,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS GN","1F1EC-1F1F3","flag-gn",["flag-gn"],"Flags",100,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS GP","1F1EC-1F1F5","flag-gp",["flag-gp"],"Flags",96,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS GQ","1F1EC-1F1F6","flag-gq",["flag-gq"],"Flags",74,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS GR","1F1EC-1F1F7","flag-gr",["flag-gr"],"Flags",93,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS GS","1F1EC-1F1F8","flag-gs",["flag-gs"],"Flags",212,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS GT","1F1EC-1F1F9","flag-gt",["flag-gt"],"Flags",98,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS GU","1F1EC-1F1FA","flag-gu",["flag-gu"],"Flags",97,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS GW","1F1EC-1F1FC","flag-gw",["flag-gw"],"Flags",101,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS GY","1F1EC-1F1FE","flag-gy",["flag-gy"],"Flags",102,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS HK","1F1ED-1F1F0","flag-hk",["flag-hk"],"Flags",105,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS HM","1F1ED-1F1F2","flag-hm",["flag-hm"],"Flags",259,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS HN","1F1ED-1F1F3","flag-hn",["flag-hn"],"Flags",104,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS HR","1F1ED-1F1F7","flag-hr",["flag-hr"],"Flags",62,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS HT","1F1ED-1F1F9","flag-ht",["flag-ht"],"Flags",103,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS HU","1F1ED-1F1FA","flag-hu",["flag-hu"],"Flags",106,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS IC","1F1EE-1F1E8","flag-ic",["flag-ic"],"Flags",47,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS ID","1F1EE-1F1E9","flag-id",["flag-id"],"Flags",109,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS IE","1F1EE-1F1EA","flag-ie",["flag-ie"],"Flags",112,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS IL","1F1EE-1F1F1","flag-il",["flag-il"],"Flags",114,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS IM","1F1EE-1F1F2","flag-im",["flag-im"],"Flags",113,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS IN","1F1EE-1F1F3","flag-in",["flag-in"],"Flags",108,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS IO","1F1EE-1F1F4","flag-io",["flag-io"],"Flags",37,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS IQ","1F1EE-1F1F6","flag-iq",["flag-iq"],"Flags",111,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS IR","1F1EE-1F1F7","flag-ir",["flag-ir"],"Flags",110,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS IS","1F1EE-1F1F8","flag-is",["flag-is"],"Flags",107,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS IT","1F1EE-1F1F9","flag-it",["flag-it","it"],"Flags",115,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS JE","1F1EF-1F1EA","flag-je",["flag-je"],"Flags",119,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS JM","1F1EF-1F1F2","flag-jm",["flag-jm"],"Flags",116,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS JO","1F1EF-1F1F4","flag-jo",["flag-jo"],"Flags",120,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS JP","1F1EF-1F1F5","flag-jp",["flag-jp","jp"],"Flags",117,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS KE","1F1F0-1F1EA","flag-ke",["flag-ke"],"Flags",122,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS KG","1F1F0-1F1EC","flag-kg",["flag-kg"],"Flags",126,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS KH","1F1F0-1F1ED","flag-kh",["flag-kh"],"Flags",44,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS KI","1F1F0-1F1EE","flag-ki",["flag-ki"],"Flags",123,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS KM","1F1F0-1F1F2","flag-km",["flag-km"],"Flags",56,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS KN","1F1F0-1F1F3","flag-kn",["flag-kn"],"Flags",193,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS KP","1F1F0-1F1F5","flag-kp",["flag-kp"],"Flags",171,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS KR","1F1F0-1F1F7","flag-kr",["flag-kr","kr"],"Flags",213,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS KW","1F1F0-1F1FC","flag-kw",["flag-kw"],"Flags",125,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS KY","1F1F0-1F1FE","flag-ky",["flag-ky"],"Flags",48,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS KZ","1F1F0-1F1FF","flag-kz",["flag-kz"],"Flags",121,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS LA","1F1F1-1F1E6","flag-la",["flag-la"],"Flags",127,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS LB","1F1F1-1F1E7","flag-lb",["flag-lb"],"Flags",129,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS LC","1F1F1-1F1E8","flag-lc",["flag-lc"],"Flags",194,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS LI","1F1F1-1F1EE","flag-li",["flag-li"],"Flags",133,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS LK","1F1F1-1F1F0","flag-lk",["flag-lk"],"Flags",216,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS LR","1F1F1-1F1F7","flag-lr",["flag-lr"],"Flags",131,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS LS","1F1F1-1F1F8","flag-ls",["flag-ls"],"Flags",130,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS LT","1F1F1-1F1F9","flag-lt",["flag-lt"],"Flags",134,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS LU","1F1F1-1F1FA","flag-lu",["flag-lu"],"Flags",135,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS LV","1F1F1-1F1FB","flag-lv",["flag-lv"],"Flags",128,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS LY","1F1F1-1F1FE","flag-ly",["flag-ly"],"Flags",132,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS MA","1F1F2-1F1E6","flag-ma",["flag-ma"],"Flags",156,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS MC","1F1F2-1F1E8","flag-mc",["flag-mc"],"Flags",152,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS MD","1F1F2-1F1E9","flag-md",["flag-md"],"Flags",151,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS ME","1F1F2-1F1EA","flag-me",["flag-me"],"Flags",154,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS MF","1F1F2-1F1EB","flag-mf",["flag-mf"],"Flags",260,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS MG","1F1F2-1F1EC","flag-mg",["flag-mg"],"Flags",138,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS MH","1F1F2-1F1ED","flag-mh",["flag-mh"],"Flags",144,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS MK","1F1F2-1F1F0","flag-mk",["flag-mk"],"Flags",137,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS ML","1F1F2-1F1F1","flag-ml",["flag-ml"],"Flags",142,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS MM","1F1F2-1F1F2","flag-mm",["flag-mm"],"Flags",158,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS MN","1F1F2-1F1F3","flag-mn",["flag-mn"],"Flags",153,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS MO","1F1F2-1F1F4","flag-mo",["flag-mo"],"Flags",136,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS MP","1F1F2-1F1F5","flag-mp",["flag-mp"],"Flags",170,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS MQ","1F1F2-1F1F6","flag-mq",["flag-mq"],"Flags",145,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS MR","1F1F2-1F1F7","flag-mr",["flag-mr"],"Flags",146,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS MS","1F1F2-1F1F8","flag-ms",["flag-ms"],"Flags",155,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS MT","1F1F2-1F1F9","flag-mt",["flag-mt"],"Flags",143,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS MU","1F1F2-1F1FA","flag-mu",["flag-mu"],"Flags",147,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS MV","1F1F2-1F1FB","flag-mv",["flag-mv"],"Flags",141,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS MW","1F1F2-1F1FC","flag-mw",["flag-mw"],"Flags",139,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS MX","1F1F2-1F1FD","flag-mx",["flag-mx"],"Flags",149,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS MY","1F1F2-1F1FE","flag-my",["flag-my"],"Flags",140,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS MZ","1F1F2-1F1FF","flag-mz",["flag-mz"],"Flags",157,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS NA","1F1F3-1F1E6","flag-na",["flag-na"],"Flags",159,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS NC","1F1F3-1F1E8","flag-nc",["flag-nc"],"Flags",163,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS NE","1F1F3-1F1EA","flag-ne",["flag-ne"],"Flags",166,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS NF","1F1F3-1F1EB","flag-nf",["flag-nf"],"Flags",169,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS NG","1F1F3-1F1EC","flag-ng",["flag-ng"],"Flags",167,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS NI","1F1F3-1F1EE","flag-ni",["flag-ni"],"Flags",165,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS NL","1F1F3-1F1F1","flag-nl",["flag-nl"],"Flags",162,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS NO","1F1F3-1F1F4","flag-no",["flag-no"],"Flags",172,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS NP","1F1F3-1F1F5","flag-np",["flag-np"],"Flags",161,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS NR","1F1F3-1F1F7","flag-nr",["flag-nr"],"Flags",160,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS NU","1F1F3-1F1FA","flag-nu",["flag-nu"],"Flags",168,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS NZ","1F1F3-1F1FF","flag-nz",["flag-nz"],"Flags",164,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS OM","1F1F4-1F1F2","flag-om",["flag-om"],"Flags",173,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS PA","1F1F5-1F1E6","flag-pa",["flag-pa"],"Flags",177,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS PE","1F1F5-1F1EA","flag-pe",["flag-pe"],"Flags",180,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS PF","1F1F5-1F1EB","flag-pf",["flag-pf"],"Flags",85,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS PG","1F1F5-1F1EC","flag-pg",["flag-pg"],"Flags",178,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS PH","1F1F5-1F1ED","flag-ph",["flag-ph"],"Flags",181,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS PK","1F1F5-1F1F0","flag-pk",["flag-pk"],"Flags",174,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS PL","1F1F5-1F1F1","flag-pl",["flag-pl"],"Flags",183,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS PM","1F1F5-1F1F2","flag-pm",["flag-pm"],"Flags",195,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS PN","1F1F5-1F1F3","flag-pn",["flag-pn"],"Flags",182,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS PR","1F1F5-1F1F7","flag-pr",["flag-pr"],"Flags",185,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS PS","1F1F5-1F1F8","flag-ps",["flag-ps"],"Flags",176,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS PT","1F1F5-1F1F9","flag-pt",["flag-pt"],"Flags",184,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS PW","1F1F5-1F1FC","flag-pw",["flag-pw"],"Flags",175,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS PY","1F1F5-1F1FE","flag-py",["flag-py"],"Flags",179,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS QA","1F1F6-1F1E6","flag-qa",["flag-qa"],"Flags",186,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS RE","1F1F7-1F1EA","flag-re",["flag-re"],"Flags",187,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS RO","1F1F7-1F1F4","flag-ro",["flag-ro"],"Flags",188,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS RS","1F1F7-1F1F8","flag-rs",["flag-rs"],"Flags",202,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS RU","1F1F7-1F1FA","flag-ru",["flag-ru","ru"],"Flags",189,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS RW","1F1F7-1F1FC","flag-rw",["flag-rw"],"Flags",190,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS SA","1F1F8-1F1E6","flag-sa",["flag-sa"],"Flags",200,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS SB","1F1F8-1F1E7","flag-sb",["flag-sb"],"Flags",209,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS SC","1F1F8-1F1E8","flag-sc",["flag-sc"],"Flags",203,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS SD","1F1F8-1F1E9","flag-sd",["flag-sd"],"Flags",217,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS SE","1F1F8-1F1EA","flag-se",["flag-se"],"Flags",220,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS SG","1F1F8-1F1EC","flag-sg",["flag-sg"],"Flags",205,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS SH","1F1F8-1F1ED","flag-sh",["flag-sh"],"Flags",192,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS SI","1F1F8-1F1EE","flag-si",["flag-si"],"Flags",208,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS SJ","1F1F8-1F1EF","flag-sj",["flag-sj"],"Flags",261,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS SK","1F1F8-1F1F0","flag-sk",["flag-sk"],"Flags",207,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS SL","1F1F8-1F1F1","flag-sl",["flag-sl"],"Flags",204,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS SM","1F1F8-1F1F2","flag-sm",["flag-sm"],"Flags",198,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS SN","1F1F8-1F1F3","flag-sn",["flag-sn"],"Flags",201,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS SO","1F1F8-1F1F4","flag-so",["flag-so"],"Flags",210,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS SR","1F1F8-1F1F7","flag-sr",["flag-sr"],"Flags",218,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS SS","1F1F8-1F1F8","flag-ss",["flag-ss"],"Flags",214,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS ST","1F1F8-1F1F9","flag-st",["flag-st"],"Flags",199,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS SV","1F1F8-1F1FB","flag-sv",["flag-sv"],"Flags",73,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS SX","1F1F8-1F1FD","flag-sx",["flag-sx"],"Flags",206,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS SY","1F1F8-1F1FE","flag-sy",["flag-sy"],"Flags",222,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS SZ","1F1F8-1F1FF","flag-sz",["flag-sz"],"Flags",219,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS TA","1F1F9-1F1E6","flag-ta",["flag-ta"],"Flags",262,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS TC","1F1F9-1F1E8","flag-tc",["flag-tc"],"Flags",235,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS TD","1F1F9-1F1E9","flag-td",["flag-td"],"Flags",50,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS TF","1F1F9-1F1EB","flag-tf",["flag-tf"],"Flags",86,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS TG","1F1F9-1F1EC","flag-tg",["flag-tg"],"Flags",228,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS TH","1F1F9-1F1ED","flag-th",["flag-th"],"Flags",226,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS TJ","1F1F9-1F1EF","flag-tj",["flag-tj"],"Flags",224,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS TK","1F1F9-1F1F0","flag-tk",["flag-tk"],"Flags",229,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS TL","1F1F9-1F1F1","flag-tl",["flag-tl"],"Flags",227,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS TM","1F1F9-1F1F2","flag-tm",["flag-tm"],"Flags",234,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS TN","1F1F9-1F1F3","flag-tn",["flag-tn"],"Flags",232,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS TO","1F1F9-1F1F4","flag-to",["flag-to"],"Flags",230,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS TR","1F1F9-1F1F7","flag-tr",["flag-tr"],"Flags",233,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS TT","1F1F9-1F1F9","flag-tt",["flag-tt"],"Flags",231,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS TV","1F1F9-1F1FB","flag-tv",["flag-tv"],"Flags",236,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS TW","1F1F9-1F1FC","flag-tw",["flag-tw"],"Flags",223,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS TZ","1F1F9-1F1FF","flag-tz",["flag-tz"],"Flags",225,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS UA","1F1FA-1F1E6","flag-ua",["flag-ua"],"Flags",238,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS UG","1F1FA-1F1EC","flag-ug",["flag-ug"],"Flags",237,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS UM","1F1FA-1F1F2","flag-um",["flag-um"],"Flags",263,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS UN","1F1FA-1F1F3","flag-un",["flag-un"],"Flags",264,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS US","1F1FA-1F1F8","flag-us",["flag-us","us"],"Flags",241,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS UY","1F1FA-1F1FE","flag-uy",["flag-uy"],"Flags",243,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS UZ","1F1FA-1F1FF","flag-uz",["flag-uz"],"Flags",244,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS VA","1F1FB-1F1E6","flag-va",["flag-va"],"Flags",246,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS VC","1F1FB-1F1E8","flag-vc",["flag-vc"],"Flags",196,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS VE","1F1FB-1F1EA","flag-ve",["flag-ve"],"Flags",247,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS VG","1F1FB-1F1EC","flag-vg",["flag-vg"],"Flags",38,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS VI","1F1FB-1F1EE","flag-vi",["flag-vi"],"Flags",242,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS VN","1F1FB-1F1F3","flag-vn",["flag-vn"],"Flags",248,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS VU","1F1FB-1F1FA","flag-vu",["flag-vu"],"Flags",245,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS WF","1F1FC-1F1EB","flag-wf",["flag-wf"],"Flags",249,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS WS","1F1FC-1F1F8","flag-ws",["flag-ws"],"Flags",197,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS XK","1F1FD-1F1F0","flag-xk",["flag-xk"],"Flags",124,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS YE","1F1FE-1F1EA","flag-ye",["flag-ye"],"Flags",251,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS YT","1F1FE-1F1F9","flag-yt",["flag-yt"],"Flags",148,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS ZA","1F1FF-1F1E6","flag-za",["flag-za"],"Flags",211,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS ZM","1F1FF-1F1F2","flag-zm",["flag-zm"],"Flags",252,null,null,null],["REGIONAL INDICATOR SYMBOL LETTERS ZW","1F1FF-1F1FC","flag-zw",["flag-zw"],"Flags",253,null,null,null],[null,"1F468-200D-1F33E","male-farmer",["male-farmer"],"People",164,!0,null,null],[null,"1F468-200D-1F373","male-cook",["male-cook"],"People",166,!0,null,null],[null,"1F468-200D-1F393","male-student",["male-student"],"People",168,!0,null,null],[null,"1F468-200D-1F3A4","male-singer",["male-singer"],"People",170,!0,null,null],[null,"1F468-200D-1F3A8","male-artist",["male-artist"],"People",184,!0,null,null],[null,"1F468-200D-1F3EB","male-teacher",["male-teacher"],"People",172,!0,null,null],[null,"1F468-200D-1F3ED","male-factory-worker",["male-factory-worker"],"People",174,!0,null,null],[null,"1F468-200D-1F466","man-boy",["man-boy"],"People",263,null,null,null],[null,"1F468-200D-1F467","man-girl",["man-girl"],"People",264,null,null,null],[null,"1F468-200D-1F4BB","male-technologist",["male-technologist"],"People",176,!0,null,null],[null,"1F468-200D-1F4BC","male-office-worker",["male-office-worker"],"People",178,!0,null,null],[null,"1F468-200D-1F527","male-mechanic",["male-mechanic"],"People",180,!0,null,null],[null,"1F468-200D-1F52C","male-scientist",["male-scientist"],"People",182,!0,null,null],[null,"1F468-200D-1F680","male-astronaut",["male-astronaut"],"People",190,!0,null,null],[null,"1F468-200D-1F692","male-firefighter",["male-firefighter"],"People",186,!0,null,null],[null,"1F469-200D-1F33E","female-farmer",["female-farmer"],"People",163,!0,null,null],[null,"1F469-200D-1F373","female-cook",["female-cook"],"People",165,!0,null,null],[null,"1F469-200D-1F393","female-student",["female-student"],"People",167,!0,null,null],[null,"1F469-200D-1F3A4","female-singer",["female-singer"],"People",169,!0,null,null],[null,"1F469-200D-1F3A8","female-artist",["female-artist"],"People",183,!0,null,null],[null,"1F469-200D-1F3EB","female-teacher",["female-teacher"],"People",171,!0,null,null],[null,"1F469-200D-1F3ED","female-factory-worker",["female-factory-worker"],"People",173,!0,null,null],[null,"1F469-200D-1F466","woman-boy",["woman-boy"],"People",258,null,null,null],[null,"1F469-200D-1F467","woman-girl",["woman-girl"],"People",259,null,null,null],[null,"1F469-200D-1F4BB","female-technologist",["female-technologist"],"People",175,!0,null,null],[null,"1F469-200D-1F4BC","female-office-worker",["female-office-worker"],"People",177,!0,null,null],[null,"1F469-200D-1F527","female-mechanic",["female-mechanic"],"People",179,!0,null,null],[null,"1F469-200D-1F52C","female-scientist",["female-scientist"],"People",181,!0,null,null],[null,"1F469-200D-1F680","female-astronaut",["female-astronaut"],"People",189,!0,null,null],[null,"1F469-200D-1F692","female-firefighter",["female-firefighter"],"People",185,!0,null,null],[null,"1F3C3-200D-2640-FE0F","woman-running",["woman-running"],"People",232,!0,null,null],[null,"1F3C3-200D-2642-FE0F","man-running",["man-running"],"People",304,!0,null,null],[null,"1F3C4-200D-2640-FE0F","woman-surfing",["woman-surfing"],"Activity",40,!0,null,null],[null,"1F3C4-200D-2642-FE0F","man-surfing",["man-surfing"],"Activity",89,!0,null,null],[null,"1F3CA-200D-2640-FE0F","woman-swimming",["woman-swimming"],"Activity",42,!0,null,null],[null,"1F3CA-200D-2642-FE0F","man-swimming",["man-swimming"],"Activity",90,!0,null,null],[null,"1F3CB-FE0F-200D-2640-FE0F","woman-lifting-weights",["woman-lifting-weights"],"Activity",24,!0,null,null],[null,"1F3CB-FE0F-200D-2642-FE0F","man-lifting-weights",["man-lifting-weights"],"Activity",87,!0,null,null],[null,"1F3CC-FE0F-200D-2640-FE0F","woman-golfing",["woman-golfing"],"Activity",38,!0,null,null],[null,"1F3CC-FE0F-200D-2642-FE0F","man-golfing",["man-golfing"],"Activity",88,!0,null,null],[null,"1F3F3-FE0F-200D-1F308","rainbow-flag",["rainbow-flag"],"Flags",5,null,null,null],[null,"1F441-FE0F-200D-1F5E8-FE0F","eye-in-speech-bubble",["eye-in-speech-bubble"],"Symbols",238,null,null,null],[null,"1F468-200D-1F466-200D-1F466","man-boy-boy",["man-boy-boy"],"People",266,null,null,null],[null,"1F468-200D-1F467-200D-1F466","man-girl-boy",["man-girl-boy"],"People",265,null,null,null],[null,"1F468-200D-1F467-200D-1F467","man-girl-girl",["man-girl-girl"],"People",267,null,null,null],[null,"1F468-200D-1F468-200D-1F466","man-man-boy",["man-man-boy"],"People",253,null,null,null],[null,"1F468-200D-1F468-200D-1F466-200D-1F466","man-man-boy-boy",["man-man-boy-boy"],"People",256,null,null,null],[null,"1F468-200D-1F468-200D-1F467","man-man-girl",["man-man-girl"],"People",254,null,null,null],[null,"1F468-200D-1F468-200D-1F467-200D-1F466","man-man-girl-boy",["man-man-girl-boy"],"People",255,null,null,null],[null,"1F468-200D-1F468-200D-1F467-200D-1F467","man-man-girl-girl",["man-man-girl-girl"],"People",257,null,null,null],[null,"1F468-200D-1F469-200D-1F466","man-woman-boy",["man-woman-boy","family"],"People",294,null,null,null],[null,"1F468-200D-1F469-200D-1F466-200D-1F466","man-woman-boy-boy",["man-woman-boy-boy"],"People",246,null,null,null],[null,"1F468-200D-1F469-200D-1F467","man-woman-girl",["man-woman-girl"],"People",244,null,null,null],[null,"1F468-200D-1F469-200D-1F467-200D-1F466","man-woman-girl-boy",["man-woman-girl-boy"],"People",245,null,null,null],[null,"1F468-200D-1F469-200D-1F467-200D-1F467","man-woman-girl-girl",["man-woman-girl-girl"],"People",247,null,null,null],[null,"1F468-200D-2695-FE0F","male-doctor",["male-doctor"],"People",162,!0,null,null],[null,"1F468-200D-2696-FE0F","male-judge",["male-judge"],"People",192,!0,null,null],[null,"1F468-200D-2708-FE0F","male-pilot",["male-pilot"],"People",188,!0,null,null],[null,"1F468-200D-2764-FE0F-200D-1F468","man-heart-man",["man-heart-man"],"People",239,null,null,null],[null,"1F468-200D-2764-FE0F-200D-1F48B-200D-1F468","man-kiss-man",["man-kiss-man"],"People",242,null,null,null],[null,"1F469-200D-1F466-200D-1F466","woman-boy-boy",["woman-boy-boy"],"People",261,null,null,null],[null,"1F469-200D-1F467-200D-1F466","woman-girl-boy",["woman-girl-boy"],"People",260,null,null,null],[null,"1F469-200D-1F467-200D-1F467","woman-girl-girl",["woman-girl-girl"],"People",262,null,null,null],[null,"1F469-200D-1F469-200D-1F466","woman-woman-boy",["woman-woman-boy"],"People",248,null,null,null],[null,"1F469-200D-1F469-200D-1F466-200D-1F466","woman-woman-boy-boy",["woman-woman-boy-boy"],"People",251,null,null,null],[null,"1F469-200D-1F469-200D-1F467","woman-woman-girl",["woman-woman-girl"],"People",249,null,null,null],[null,"1F469-200D-1F469-200D-1F467-200D-1F466","woman-woman-girl-boy",["woman-woman-girl-boy"],"People",250,null,null,null],[null,"1F469-200D-1F469-200D-1F467-200D-1F467","woman-woman-girl-girl",["woman-woman-girl-girl"],"People",252,null,null,null],[null,"1F469-200D-2695-FE0F","female-doctor",["female-doctor"],"People",161,!0,null,null],[null,"1F469-200D-2696-FE0F","female-judge",["female-judge"],"People",191,!0,null,null],[null,"1F469-200D-2708-FE0F","female-pilot",["female-pilot"],"People",187,!0,null,null],[null,"1F469-200D-2764-FE0F-200D-1F468","woman-heart-man",["woman-heart-man"],"People",295,null,null,null],[null,"1F469-200D-2764-FE0F-200D-1F469","woman-heart-woman",["woman-heart-woman"],"People",238,null,null,null],[null,"1F469-200D-2764-FE0F-200D-1F48B-200D-1F468","woman-kiss-man",["woman-kiss-man"],"People",296,null,null,null],[null,"1F469-200D-2764-FE0F-200D-1F48B-200D-1F469","woman-kiss-woman",["woman-kiss-woman"],"People",241,null,null,null],[null,"1F46E-200D-2640-FE0F","female-police-officer",["female-police-officer"],"People",153,!0,null,null],[null,"1F46E-200D-2642-FE0F","male-police-officer",["male-police-officer"],"People",297,!0,null,null],[null,"1F46F-200D-2640-FE0F","woman-with-bunny-ears-partying",["woman-with-bunny-ears-partying"],"People",303,null,null,null],[null,"1F46F-200D-2642-FE0F","man-with-bunny-ears-partying",["man-with-bunny-ears-partying"],"People",229,null,null,null],[null,"1F471-200D-2640-FE0F","blond-haired-woman",["blond-haired-woman"],"People",146,!0,null,null],[null,"1F471-200D-2642-FE0F","blond-haired-man",["blond-haired-man"],"People",298,!0,null,null],[null,"1F473-200D-2640-FE0F","woman-wearing-turban",["woman-wearing-turban"],"People",151,!0,null,null],[null,"1F473-200D-2642-FE0F","man-wearing-turban",["man-wearing-turban"],"People",299,!0,null,null],[null,"1F477-200D-2640-FE0F","female-construction-worker",["female-construction-worker"],"People",155,!0,null,null],[null,"1F477-200D-2642-FE0F","male-construction-worker",["male-construction-worker"],"People",300,!0,null,null],[null,"1F481-200D-2640-FE0F","woman-tipping-hand",["woman-tipping-hand"],"People",308,!0,null,null],[null,"1F481-200D-2642-FE0F","man-tipping-hand",["man-tipping-hand"],"People",204,!0,null,null],[null,"1F482-200D-2640-FE0F","female-guard",["female-guard"],"People",157,!0,null,null],[null,"1F482-200D-2642-FE0F","male-guard",["male-guard"],"People",301,!0,null,null],[null,"1F486-200D-2640-FE0F","woman-getting-massage",["woman-getting-massage"],"People",305,!0,null,null],[null,"1F486-200D-2642-FE0F","man-getting-massage",["man-getting-massage"],"People",224,!0,null,null],[null,"1F487-200D-2640-FE0F","woman-getting-haircut",["woman-getting-haircut"],"People",306,!0,null,null],[null,"1F487-200D-2642-FE0F","man-getting-haircut",["man-getting-haircut"],"People",222,!0,null,null],[null,"1F575-FE0F-200D-2640-FE0F","female-detective",["female-detective"],"People",159,!0,null,null],[null,"1F575-FE0F-200D-2642-FE0F","male-detective",["male-detective"],"People",302,!0,null,null],[null,"1F645-200D-2640-FE0F","woman-gesturing-no",["woman-gesturing-no"],"People",309,!0,null,null],[null,"1F645-200D-2642-FE0F","man-gesturing-no",["man-gesturing-no"],"People",206,!0,null,null],[null,"1F646-200D-2640-FE0F","woman-gesturing-ok",["woman-gesturing-ok"],"People",310,!0,null,null],[null,"1F646-200D-2642-FE0F","man-gesturing-ok",["man-gesturing-ok"],"People",208,!0,null,null],[null,"1F647-200D-2640-FE0F","woman-bowing",["woman-bowing"],"People",201,!0,null,null],[null,"1F647-200D-2642-FE0F","man-bowing",["man-bowing"],"People",311,!0,null,null],[null,"1F64B-200D-2640-FE0F","woman-raising-hand",["woman-raising-hand"],"People",312,!0,null,null],[null,"1F64B-200D-2642-FE0F","man-raising-hand",["man-raising-hand"],"People",210,!0,null,null],[null,"1F64D-200D-2640-FE0F","woman-frowning",["woman-frowning"],"People",313,!0,null,null],[null,"1F64D-200D-2642-FE0F","man-frowning",["man-frowning"],"People",220,!0,null,null],[null,"1F64E-200D-2640-FE0F","woman-pouting",["woman-pouting"],"People",314,!0,null,null],[null,"1F64E-200D-2642-FE0F","man-pouting",["man-pouting"],"People",218,!0,null,null],[null,"1F6A3-200D-2640-FE0F","woman-rowing-boat",["woman-rowing-boat"],"Activity",47,!0,null,null],[null,"1F6A3-200D-2642-FE0F","man-rowing-boat",["man-rowing-boat"],"Activity",91,!0,null,null],[null,"1F6B4-200D-2640-FE0F","woman-biking",["woman-biking"],"Activity",50,!0,null,null],[null,"1F6B4-200D-2642-FE0F","man-biking",["man-biking"],"Activity",92,!0,null,null],[null,"1F6B5-200D-2640-FE0F","woman-mountain-biking",["woman-mountain-biking"],"Activity",52,!0,null,null],[null,"1F6B5-200D-2642-FE0F","man-mountain-biking",["man-mountain-biking"],"Activity",93,!0,null,null],[null,"1F6B6-200D-2640-FE0F","woman-walking",["woman-walking"],"People",230,!0,null,null],[null,"1F6B6-200D-2642-FE0F","man-walking",["man-walking"],"People",307,!0,null,null],[null,"1F926-200D-2640-FE0F","woman-facepalming",["woman-facepalming"],"People",212,!0,null,null],[null,"1F926-200D-2642-FE0F","man-facepalming",["man-facepalming"],"People",213,!0,null,null],[null,"1F937-200D-2640-FE0F","woman-shrugging",["woman-shrugging"],"People",215,!0,null,null],[null,"1F937-200D-2642-FE0F","man-shrugging",["man-shrugging"],"People",216,!0,null,null],[null,"1F938-200D-2640-FE0F","woman-cartwheeling",["woman-cartwheeling"],"Activity",31,!0,null,null],[null,"1F938-200D-2642-FE0F","man-cartwheeling",["man-cartwheeling"],"Activity",32,!0,null,null],[null,"1F939-200D-2640-FE0F","woman-juggling",["woman-juggling"],"Activity",67,!0,null,null],[null,"1F939-200D-2642-FE0F","man-juggling",["man-juggling"],"Activity",68,!0,null,null],[null,"1F93C-200D-2640-FE0F","woman-wrestling",["woman-wrestling"],"Activity",28,null,null,null],[null,"1F93C-200D-2642-FE0F","man-wrestling",["man-wrestling"],"Activity",29,null,null,null],[null,"1F93D-200D-2640-FE0F","woman-playing-water-polo",["woman-playing-water-polo"],"Activity",45,!0,null,null],[null,"1F93D-200D-2642-FE0F","man-playing-water-polo",["man-playing-water-polo"],"Activity",46,!0,null,null],[null,"1F93E-200D-2640-FE0F","woman-playing-handball",["woman-playing-handball"],"Activity",36,!0,null,null],[null,"1F93E-200D-2642-FE0F","man-playing-handball",["man-playing-handball"],"Activity",37,!0,null,null],[null,"26F9-FE0F-200D-2640-FE0F","woman-bouncing-ball",["woman-bouncing-ball"],"Activity",33,!0,null,null],[null,"26F9-FE0F-200D-2642-FE0F","man-bouncing-ball",["man-bouncing-ball"],"Activity",86,!0,null,null]])
;return i.prototype.buildShortNameIndex=function(){var e={},t=[],n=function(t){return function(n,i){if(e.hasOwnProperty(n))return t&&console&&console.warn&&console.warn('duplicate short name "'+n+'" from',i,"first seen in:",e[n]),!0}}(this._warn_duplicates);this.data().forEach(function(i){n(i.short_name,i)&&e[i.short_name].short_name===i.short_name||(e[i.short_name]=i,t.push(i.short_name),i.short_names&&i.short_names.length&&i.short_names.forEach(function(o){o!==i.short_name&&(n(o,i)||(e[o]=i,t.push(o)))}))}),this.dataByShortName=e,this.allShortNames=t},i.prototype.codepoints=function(e,t){return e=e.toLowerCase(),this.data(),this.dataByShortName.hasOwnProperty(e)&&(t||this.dataByShortName[e].short_name===e)?this.dataByShortName[e].unified:null},i.prototype.encodeShortName=function(e,t){var i,o=/([^:]*)::(skin-tone-[2-6])/.exec(e);if(o){var r=this.codepoints(o[2],t),s=this.codepoints(o[1],t);if(r){if(s){var l=/(.*)-(200D-.*)/i.exec(s);return n(l?l[1]+"-"+r+"-"+l[2]:s+"-"+r)}}else if(s)return n(s)+":"+o[2]}else if(i=this.codepoints(e,t))return n(i);return e},i.prototype._replaceColonsStr=function(e){for(var t,n,i=0,o=/^:([^ :]+(::skin-tone-[2-6])?):/,r="";e.length;){if(!((i=e.indexOf(":"))>=0)){r+=e;break}r+=e.substring(0,i),e=e.substring(i),t=o.exec(e),t?(n=this.encodeShortName(t[1]),n!=t[1]?r+=n:r+=t[0],e=e.substring(t[0].length)):(r+=e.substring(0,1),e=e.substring(1))}return r},i.prototype._replaceColonsNode=function(t){var n=this;e(t,[]).forEach(function(e){var t=e.nodeValue,i=n._replaceColonsStr(t);if(i!==t){var o=document.createDocumentFragment();o.appendChild(document.createTextNode(i)),e.parentNode.replaceChild(o,e)}})},i.prototype.replaceColons=function(e){return"string"==typeof e?this._replaceColonsStr(e):this._replaceColonsNode(e)},i.prototype.primaryShortName=function(e){if(e=e.toLowerCase(),this.data(),this.dataByShortName.hasOwnProperty(e))return this.dataByShortName[e].short_name;var t=/([^:]*)::(skin-tone-[2-6])/.exec(e);if(t){var n=this.primaryShortName(t[1]);if(n&&this.dataByShortName.hasOwnProperty(n)&&this.dataByShortName[n].skin_variations){var i=this.primaryShortName(t[2]);if(n&&i)return n+"::"+i}}return null},i.prototype.possibleShortNames=function(e){var t=new RegExp(e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&"),"i");return this.data(),this.allShortNames.filter(function(e){return t.exec(e)})},i}),function(){function e(e){this.tokens=[],this.tokens.links={},this.options=e||u.defaults,this.rules=d.normal,this.options.gfm&&(this.options.tables?this.rules=d.tables:this.rules=d.gfm)}function t(e,t){if(this.options=t||u.defaults,this.links=e,this.rules=c.normal,this.renderer=this.options.renderer||new n,!this.links)throw new Error("Tokens array requires a `links` property.");this.options.gfm?this.options.breaks?this.rules=c.breaks:this.rules=c.gfm:this.options.pedantic&&(this.rules=c.pedantic)}function n(){}function i(e){this.tokens=[],this.token=null,this.options=e||u.defaults,this.options.renderer=this.options.renderer||new n,this.renderer=this.options.renderer}function o(e,t){return e.replace(t?/&/g:/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function r(e){return e.replace(/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/g,function(e,t){return t=t.toLowerCase(),"colon"===t?":":"#"===t.charAt(0)?"x"===t.charAt(1)?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""})}function s(e,t){return e=e.source,t=t||"",function n(i,o){return i?(o=o.source||o,o=o.replace(/(^|[^\[])\^/g,"$1"),e=e.replace(i,o),n):new RegExp(e,t)}}function l(){}function a(e){for(var t,n,i=1;i<arguments.length;i++){t=arguments[i];for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}function u(t,n,r){if(r||"function"==typeof n){r||(r=n,n=null),n=a({},u.defaults,n||{});var s,l=n.highlight;try{s=e.lex(t,n)}catch(e){return r(e)}s.length;return function(){var e,t;try{e=i.parse(s,n)}catch(e){t=e}return n.highlight=l,t?r(t):r(null,e)}()}try{return n&&(n=a({},u.defaults,n)),i.parse(e.lex(t,n),n)}catch(e){if(e.message+="\nPlease report this to oops@coggle.it",(n||u.defaults).silent)return'<div class="error" title="'+o(e.message+"",!0)+'">error</div>';throw e}}var d={newline:/^\n/,code:/^( {4}[^\n]+\n*)+/,fences:l,hr:/^( *[-*_]){3,} *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]*)(?:\n|$)/,nptable:l,lheading:/^([^\n]+)\n *(=|-){2,} *(?:\n+|$)/,blockquote:/^( *>[^\n]*(\n[^\n]+)*\n*)+/,list:/^( *)(bull) [\s\S]+?(?:hr|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:/^ *(?:comment|closed|closing) *(?:\n{2,}|\s*$)/,def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +["(']([^\n]+)[")'])?imgsize *(?:\n+|$)/,table:l,paragraph:/^((?:[^\n]+\n?(?!hr|heading|lheading|blockquote|tag|def))+)\n?/,text:/^[^\n]+/};d._imgsize=/(\s+([0-9]+)\s*x?\s*([0-9]+)?)?/,d.def=s(d.def)("imgsize",d._imgsize)(),d.taskbullet=/(- \[([xX/\\ ])\])/,d.olbullet=/\d+\.|taskbullet/,d.bullet=/(?:taskbullet|[*+-]|olbullet)/,d.bullet=s(d.bullet)("olbullet",d.olbullet)("taskbullet",d.taskbullet)(),d.item=/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/,d.item=s(d.item,"gm")(/bull/g,d.bullet)(),d.list=s(d.list)(/bull/g,d.bullet)("hr",/\n+(?=(?: *[-*_]){3,} *(?:\n+|$))/)(),d._tag="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:/|@)\\b",d.html=s(d.html)("comment",/<!--[\s\S]*?-->/)("closed",/<(tag)[\s\S]+?<\/\1>/)("closing",/<tag(?:"[^"]*"|'[^']*'|[^'">])*?>/)(/tag/g,d._tag)(),d.paragraph=s(d.paragraph)("hr",d.hr)("heading",d.heading)("lheading",d.lheading)("blockquote",d.blockquote)("tag","<"+d._tag)("def",d.def)(),d.normal=a({},d),d.gfm=a({},d.normal,{fences:/^ *(`{3,}|~{3,}) *(\S+)? *\n([\s\S]+?)\s*\1 *(?:\n+|$)/,paragraph:/^/}),d.gfm.paragraph=s(d.paragraph)("(?!","(?!"+d.gfm.fences.source.replace("\\1","\\2")+"|"+d.list.source.replace("\\1","\\3")+"|")(),d.tables=a({},d.gfm,{nptable:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/,table:/^ *\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/}),e.rules=d,e.lex=function(t,n){return new e(n).lex(t)},e.prototype.lex=function(e){return e=e.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n"),this.token(e,!0,0)},e.prototype.token=function(e,t,n){var i,o,r,s,l,a,u,c,h,p,f,g,e=e.replace(/^ +$/gm,"");for(n=n||0;e;)if(r=this.rules.newline.exec(e))e=e.substring(r[0].length),r[0].length&&this.tokens.push({type:"newline",position:n}),n+=r[0].length;else if(r=this.rules.code.exec(e))e=e.substring(r[0].length),r=r[0].replace(/^ {4}/gm,""),this.tokens.push({type:"code",position:n,text:this.options.pedantic?r:r.replace(/\n+$/,"")}),n+=r[0].length;else if(r=this.rules.fences.exec(e))e=e.substring(r[0].length),this.tokens.push({type:"code",position:n,lang:r[2],text:r[3]}),n+=r[0].length;else if(r=this.rules.heading.exec(e))e=e.substring(r[0].length),this.tokens.push({type:"heading",position:n+(r[0].length-r[2].length),depth:r[1].length,text:r[2]}),n+=r[0].length;else if(t&&(r=this.rules.nptable.exec(e))){for(e=e.substring(r[0].length),h={type:"table",position:n,header:r[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:r[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:r[3].replace(/\n$/,"").split("\n")},f=0;f<h.align.length;f++)/^ *-+: *$/.test(h.align[f])?h.align[f]="right":/^ *:-+: *$/.test(h.align[f])?h.align[f]="center":/^ *:-+ *$/.test(h.align[f])?h.align[f]="left":h.align[f]=null;for(f=0;f<h.cells.length;f++)h.cells[f]=h.cells[f].split(/ *\| */);this.tokens.push(h),n+=r[0].length}else if(r=this.rules.lheading.exec(e))e=e.substring(r[0].length),this.tokens.push({type:"heading",position:n,depth:"="===r[2]?1:2,text:r[1]}),n+=r[0].length;else if(r=this.rules.hr.exec(e))e=e.substring(r[0].length),this.tokens.push({type:"hr",position:n}),n+=r[0].length;else if(r=this.rules.blockquote.exec(e))e=e.substring(r[0].length),this.tokens.push({type:"blockquote_start",position:n}),n+=r[0].length,r=r[0].replace(/^ *> ?/gm,""),this.token(r,t),this.tokens.push({type:"blockquote_end"});else if(r=this.rules.list.exec(e)){e=e.substring(r[0].length),s=r[2],l=d.taskbullet.exec(s),this.tokens.push({type:"list_start",position:n,ordered:d.olbullet.test(s),olstart:s.replace(/[^0-9]/,""),tasklist:!!l}),r=r[0].match(this.rules.item),i=!1,g=r.length,f=0;for(var m=0;f<g;f++){h=r[f];var v=h.length;p=h.length,a=d.bullet.exec(h)[0],h=h.replace(a,""),c=d.taskbullet.exec(a),~h.indexOf("\n ")&&(p-=h.length,h=this.options.pedantic?h.replace(/^ {1,4}/gm,""):h.replace(new RegExp("^ {1,"+p+"}","gm"),"")),this.options.smartLists&&f!==g-1&&(u=d.bullet.exec(r[f+1])[0],s===u||c&&l||s.length>1&&u.length>1||(e=r.slice(f+1).join("\n")+e,f=g-1)),o=i||/\n\n(?!\s*$)/.test(h),f!==g-1&&(i="\n"===h.charAt(h.length-1),o||(o=i)),this.tokens.push({type:o?"loose_item_start":"list_item_start",position:n+m,taskstate:c?c[2]:void 0}),this.token(h,!1,n+m+v-h.length),this.tokens.push({type:"list_item_end"}),m+=r[f].length}this.tokens.push({type:"list_end"}),n+=r[0].length}else if(r=this.rules.html.exec(e))e=e.substring(r[0].length),this.tokens.push({type:this.options.sanitize?"paragraph":"html",position:n,pre:"pre"===r[1]||"script"===r[1]||"style"===r[1],text:r[0]}),this.tokens.push({type:"newline",position:n+r[0].length-1}),n+=r[0].length;else if(t&&(r=this.rules.def.exec(e)))e=e.substring(r[0].length),this.tokens.links[r[1].toLowerCase()]={href:r[2],title:r[3]},n+=r[0].length;else if(t&&(r=this.rules.table.exec(e))){for(e=e.substring(r[0].length),h={type:"table",position:n,header:r[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:r[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:r[3].replace(/(?: *\| *)?\n$/,"").split("\n")},f=0;f<h.align.length;f++)/^ *-+: *$/.test(h.align[f])?h.align[f]="right":/^ *:-+: *$/.test(h.align[f])?h.align[f]="center":/^ *:-+ *$/.test(h.align[f])?h.align[f]="left":h.align[f]=null;for(f=0;f<h.cells.length;f++)h.cells[f]=h.cells[f].replace(/^ *\| *| *\| *$/g,"").split(/ *\| */);this.tokens.push(h),n+=r[0].length}else if(t&&(r=this.rules.paragraph.exec(e)))e=e.substring(r[0].length),this.tokens.push({type:"paragraph",position:n,text:"\n"===r[1].charAt(r[1].length-1)?r[1].slice(0,-1):r[1]}),/\n\n$/.exec(r[0])&&this.tokens.push({type:"newline",position:n+r[0].length-1}),n+=r[0].length;else if(r=this.rules.text.exec(e))e=e.substring(r[0].length),this.tokens.push({type:"text",position:n,text:r[0]}),n+=r[0].length;else if(e)throw new Error("Infinite loop on byte: "+e.charCodeAt(0));return this.tokens};var c={escape:/^\\([\\@`*{}\[\]()#+\-.!_>])/,autolink:/^<([^ >]+(@|:\/)[^ >]+|#([^ >]+))>/,url:l,email:/^[^\s:[`\]]+@[a-zA-Z0-9.-]{2,200}/,tag:/^<!--[\s\S]*?-->|^<\/?\w+(?:"[^"]*"|'[^']*'|[^'">])*?>/,link:/^!?\[(inside)\]\(hrefimgsize\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\]]*\]|[^\[\]])*)\]/,strong:/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,em:/^\b_((?:[^_]|__)+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/,code:/^(`+)([\s\S]*?[^`])\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,del:l,text:/^(?:[\s\S]+?(?=[\\<!\[_*`@]| {2,}\n|$|\S+@\S+))/,latex:/^(\$\$([\s\S]*?)\$\$|\\\\\[([\s\S]*?)\\\\\]|\\\\\(([\s\S]*?)\\\\\))/,tagged:/^@(?:([^\s]+)|([a-zA-Z0-9_.-]+[a-zA-Z0-9.-]))/};c._inside=/(?:\[[^\]]*\]|[^\[\]]|\](?=[^\[]*\]))*/,c._href=/\s*<?([\s\S]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*/,c.link=s(c.link)("inside",c._inside)("href",c._href)("imgsize",d._imgsize)(),c.reflink=s(c.reflink)("inside",c._inside)(),c.normal=a({},c),c.pedantic=a({},c.normal,{strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/}),c.gfm=a({},c.normal,{escape:s(c.escape)("])","~|])")(),url:/^(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/,del:/^~~(?=\S)([\s\S]*?\S)~~/,text:s(c.text)("]|","~]|https?://|")()}),c.breaks=a({},c.gfm,{br:s(c.br)("{2,}","*")(),text:s(c.gfm.text)("{2,}","*")()}),t.rules=c,t.output=function(e,n,i,o){return new t(n,i).output(e,o||0)},t.prototype.output=function(e,t){var n,i,r,s,l="";for(t=t||0;e;)if(s=this.rules.latex.exec(e)){e=e.substring(s[0].length);for(var a=s[0];a;)if(s=this.rules.escape.exec(a))a=a.substring(s[0].length),l+=s[1];else if(s=this.rules.text.exec(a))a=a.substring(s[0].length),l+=s[0];else if(a)throw new Error("Infinite loop on latex byte: "+a.charCodeAt(0));t+=s[0].length}else if(s=this.rules.escape.exec(e))e=e.substring(s[0].length),l+=s[1],t+=s[0].length;else if(s=this.rules.autolink.exec(e))e=e.substring(s[0].length),"@"===s[2]?(i=":"===s[1].charAt(6)?this.mangle(s[1].substring(7)):this.mangle(s[1]),r=this.mangle("mailto:")+i):(i=o(s[1]),r=i),l+=this.renderer.link(r,null,i,t),t+=s[0].length;else if(s=this.rules.url.exec(e))e=e.substring(s[0].length),i=o(s[1]),r=i,l+=this.renderer.link(r,null,i,t),t+=s[0].length;else if(s=this.rules.email.exec(e))e=e.substring(s[0].length),i=o(s[0]),l+=this.renderer.link("mailto:"+o(s[0]),null,i,t),t+=s[0].length;else if(s=this.rules.tag.exec(e))e=e.substring(s[0].length),l+=this.options.sanitize?o(s[0]):s[0],t+=s[0].length;else if(s=this.rules.link.exec(e))e=e.substring(s[0].length),l+=this.outputLink(s,{href:s[2],title:s[3],width:s[5],height:s[6]},t),t+=s[0].length;else if((s=this.rules.reflink.exec(e))||(s=this.rules.nolink.exec(e))){if(e=e.substring(s[0].length),n=(s[2]||s[1]).replace(/\s+/g," "),!(n=this.links[n.toLowerCase()])||!n.href){l+=o(s[0].charAt(0)),e=s[0].substring(1)+e,t+=1;continue}l+=this.outputLink(s,n,t),t+=s[0].length}else if(s=this.rules.strong.exec(e))e=e.substring(s[0].length),l+=this.renderer.strong(this.output(s[2]||s[1],t)),t+=s[0].length;else if(s=this.rules.em.exec(e))e=e.substring(s[0].length),l+=this.renderer.em(this.output(s[2]||s[1],t)),t+=s[0].length;else if(s=this.rules.code.exec(e))e=e.substring(s[0].length),l+=this.renderer.codespan(o(s[2].trim(),!0)),t+=s[0].length;else if(s=this.rules.br.exec(e))e=e.substring(s[0].length),l+=this.renderer.br(),t+=s[0].length;else if(s=this.rules.del.exec(e))e=e.substring(s[0].length),l+=this.renderer.del(this.output(s[1],t)),t+=s[0].length;else if(s=this.rules.tagged.exec(e))e=e.substring(s[0].length),t+=s[0].length,l+=this.renderer.tagged(o(s[1]||s[2]));else if(s=this.rules.text.exec(e))e=e.substring(s[0].length),l+=o(this.smartypants(s[0])),t+=s[0].length;else if(e)throw new Error("Infinite loop on byte: "+e.charCodeAt(0));return l};var h=function(e){var t=parseInt(e);return t>0?t<=4e3?t:4e3:null};t.prototype.outputLink=function(e,t,n){var i=o(t.href),r=t.title?o(t.title):null,s=h(t.width)?h(t.width)+"px":null,l=h(t.height)?h(t.height)+"px":null;return"!"!==e[0].charAt(0)?this.renderer.link(i,r,this.output(e[1],n),n):this.renderer.image(i,r,o(e[1]),s,l)},t.prototype.smartypants=function(e){return this.options.smartypants?e.replace(/--/g,"—").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1‘").replace(/'/g,"’").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1“").replace(/"/g,"”").replace(/\.{3}/g,"…"):e},t.prototype.mangle=function(e){for(var t,n="",i=e.length,o=0;o<i;o++)t=e.charCodeAt(o),Math.random()>.5&&(t="x"+t.toString(16)),n+="&#"+t+";";return n},n.prototype.code=function(e,t){return t?'<pre><code class="lang-'+t+'">'+e+"\n</code></pre>\n":"<pre><code>"+e+"\n</code></pre>"},n.prototype.blockquote=function(e){return"<blockquote>"+e+"</blockquote>\n"},n.prototype.html=function(e){return e},n.prototype.heading=function(e,t,n,i){return"<h"+t+">"+e+"</h"+t+">\n"},n.prototype.hr=function(){return"<hr>\n"},n.prototype.br=function(){return"<br>\n"},n.prototype.list=function(e,t,n,i){var o=t?'ol start="'+n+'"':"ul";return"<"+o+(i?' class = "tasklist"':"")+">\n"+e+"</"+o+">\n"},n.prototype.listitem=function(e){return"<li>"+e+"</li>\n"};var p=0;n.prototype.checkbox=function(e){var t="";return p+=1,t+='<input type="checkbox" class="tasklist-checkbox" id="tasklist-checkable-'+p+'"',e&&(t+=" checked"),t+='><label class="tasklist-checkwidget" for="tasklist-checkable-'+p+'"></label>'},n.prototype.paragraph=function(e){return"<p><span>"+e+"</span></p>\n"},n.prototype.table=function(e,t){return"<table>\n<thead>\n"+e+"</thead>\n<tbody>\n"+t+"</tbody>\n</table>\n"},n.prototype.tablerow=function(e){return"<tr>\n"+e+"</tr>\n"},n.prototype.tablecell=function(e,t){var n=t.header?"th":"td";return(t.align?"<"+n+' style="text-align:'+t.align+'">':"<"+n+">")+e+"</"+n+">\n"},n.prototype.strong=function(e){return"<strong>"+e+"</strong>"},n.prototype.em=function(e){return"<em>"+e+"</em>"},n.prototype.codespan=function(e){return"<code>"+e+"</code>"},n.prototype.br=function(){return"<br>"},n.prototype.del=function(e){return"<del>"+e+"</del>"},n.prototype.tagged=function(e){return'<a class="at-tagged">'+e+"</a>"};var f=function(e){var t;return t=-1!=e.indexOf("://")?e.split("/")[2]:e.split("/")[0],t.split(":")[0]};n.prototype.link=function(e,t,n,i){var o={javascript:1,vbscript:1,data:1},s=decodeURIComponent(r(e)).replace(/[^\w:]/g,"").split(":")[0].toLowerCase(),l=e.split("?")[0].split("#")[0];s in o?e="":l.indexOf(".")>0&&!/^\.{0,2}\//.exec(l)&&!/^[a-zA-Z+]+:/.exec(l)&&(e="http://"+e);var a=/^#\S+$/.exec(e),u=f(e),d='rel="noopener nofollow" ';("coggle.it"===u||a)&&(d='rel="noopener"');var c="<a "+d+'href="'+e+'"';return t&&(c+=' title="'+t+'"'),i&&(c+=' data-marked="'+i+'"'),a&&(c+=' class="hashlink"'),c+=">"+n+"</a>"};var g=!/(staging[.]|ci[.])/.exec(window.location.hostname);n.prototype.image=function(e,t,n,i,o){var r=e,s=/^attached:(?:\/\/)?([a-zA-Z0-9_]+)/.exec(e),l="";if(s)l=' data-attachment-id="'+s[1]+'"',e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAAtJREFUCB1jYAACAAAFAAGNu5vzAAAAAElFTkSuQmCC";else{e="https://"+(g?"production.":"staging.")+"coggleuserlinks.com/"+encodeURIComponent(e)}var a='<img src="'+e+'"'+l+' data-origsrc="'+r+'" alt="'+n+'"';return t&&(a+=' title="'+t+'"'),i||o||(a+=' class="unsized"'),i&&(a+=' width="'+i+'"'),o&&(a+=' height="'+o+'"'),a+=">"},i.parse=function(e,t,n){return new i(t,n).parse(e)},i.prototype.parse=function(e){this.inline=new t(e.links,this.options,this.renderer),this.tokens=e.reverse();for(var n="";this.next();)n+=this.tok();return n},i.prototype.next=function(){return this.token=this.tokens.pop()},i.prototype.peek=function(){return this.tokens[this.tokens.length-1]||0},i.prototype.parseText=function(){for(var e=this.token.text;"text"===this.peek().type;)e+="\n"+this.next().text;return this.inline.output(e,0)},i.prototype.tok=function(){switch(this.token.type){case"space":return"";case"newline":return this.renderer.br();case"hr":return this.renderer.hr();case"heading":return this.renderer.heading(this.inline.output(this.token.text,this.token.position),this.token.depth);case"code":return this.renderer.code(o(this.token.text,!0),this.token.lang);case"table":var e,t,n,i,r="",s="";for(n="",e=0;e<this.token.header.length;e++)({header:!0,align:this.token.align[e]}),n+=this.renderer.tablecell(this.inline.output(this.token.header[e],this.token.position),{header:!0,align:this.token.align[e]});for(r+=this.renderer.tablerow(n),e=0;e<this.token.cells.length;e++){for(t=this.token.cells[e],n="",i=0;i<t.length;i++)n+=this.renderer.tablecell(this.inline.output(t[i],this.token.position),{header:!1,align:this.token.align[i]});s+=this.renderer.tablerow(n)}return this.renderer.table(r,s);case"blockquote_start":for(var s="";"blockquote_end"!==this.next().type;)s+=this.tok();return this.renderer.blockquote(s);case"list_start":for(var s="",l=this.token.ordered,a=isNaN(this.token.olstart)?1:this.token.olstart,u=this.token.tasklist;"list_end"!==this.next().type;)s+=this.tok();return this.renderer.list(s,l,a,u);case"list_item_start":var s="",d=void 0!==this.token.taskstate,c=this.token.taskstate&&/\S/.test(this.token.taskstate);for(d&&(s+=this.renderer.checkbox(c));"list_item_end"!==this.next().type;)s+="text"===this.token.type?this.parseText():this.tok();return this.renderer.listitem(s);case"loose_item_start":var s="",d=void 0!==this.token.taskstate,c=this.token.taskstate&&/\S/.test(this.token.taskstate);for(d&&(s+=this.renderer.checkbox(c));"list_item_end"!==this.next().type;)s+=this.tok();return this.renderer.listitem(s);case"html":var h=this.token.pre||this.options.pedantic?this.token.text:this.inline.output(this.token.text,this.token.position);return this.renderer.html(h);case"paragraph":return this.renderer.paragraph(this.inline.output(this.token.text,this.token.position));case"text":return this.renderer.paragraph(this.parseText())}},l.exec=l,u.options=u.setOptions=function(e){return a(u.defaults,e),u},u.defaults={gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!0,smartLists:!1,silent:!1,smartypants:!1,renderer:new n},u.Parser=i,u.parser=i.parse,u.Renderer=n,u.Lexer=e,u.lexer=e.lex,u.InlineLexer=t,u.inlineLexer=t.output,u.parse=u,"object"==typeof exports?module.exports=u:"function"==typeof define&&define.amd?define("marked",[],function(){return u}):this.marked=u}.call(function(){return this||("undefined"!=typeof window?window:global)}()),define("utils/LinkRenderer",["require","exports","module","underscore","marked"],function(e,t,n){function i(){}var o=(e("underscore"),e("marked")),r=function(e,t){return t||(t=""),'<span class="youtubecontainer"><iframe width="280" height="157" src="https://www.youtube-nocookie.com/embed/'+e+"?color=white&theme=light"+t+'" frameborder="0" allowfullscreen></iframe></span>'},s=function(e){var t=/t=(?:([0-9]+)h)?(?:([0-9]+)m)?(?:([0-9]+)s)?/.exec(e);if(t){return"&start="+(3600*parseInt(t[1]||0)+60*parseInt(t[2]||0)+parseInt(t[3]||0))}return""},l=function(e,t,n){if(n==e||!n.replace(/[\s]*/g,"")){var i=/v=([^&]+)/.exec(e);if(i&&i[1])return r(i[1],s(e))}},a=function(e,t,n){if(n==e||!n.replace(/[\s]*/g,"")){var i=/\.be\/([^&?#]+)/.exec(e);if(i&&i[1])return r(i[1],s(e))}},u={"youtube.com":l,"www.youtube.com":l,"youtu.be":a};i.prototype=new o.Renderer;var d=function(e){var t;return t=-1!=e.indexOf("://")?e.split("/")[2]:e.split("/")[0],t.split(":")[0]},c=function(e){return e.replace(/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/g,function(e,t){return t=t.toLowerCase(),"colon"===t?":":"#"===t.charAt(0)?"x"===t.charAt(1)?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""})},h=function(e){for(var t,n,i=[],o=0;o<e.length;o++)if("%"===e[o]){t=e.slice(o,o+2);try{n=decodeURIComponent(t)}catch(e){n=null}null!==n?(i.push(n),o+=2):i.push(e[o])}else i.push(e[o]);return i.join("")};i.prototype.link=function(e,t,n,i){var o={javascript:1,vbscript:1,data:1},r=h(c(e)).replace(/[^\w:]/g,"").split(":")[0].toLowerCase(),s=e.split("?")[0].split("#")[0];r in o?e="":s.indexOf(".")>0&&!/^\.{0,2}\//.exec(s)&&!/^[a-zA-Z+]+:/.exec(s)&&(e="http://"+e);var l,a=d(e),p=u[a.toLowerCase()];if(p&&(l=p(e,t,n)))return l;var f='rel="nofollow noopener ugc" ';return"coggle.it"===a&&(f='rel="noopener ugc" '),l="<a "+f+'href="'+e+'"',t&&(l+=' title="'+t+'"'),i&&(l+='data-marked="'+i+'"'),/^#\S+$/.exec(e)?l+=' class="hashlink"':l+=' target="blank"',l+=">"+n+"</a>"},n.exports=i}),define("utils/marked",["require","exports","module","marked","./LinkRenderer","utils/queryString"],function(e,t,n){var i=e("marked"),o=e("./LinkRenderer"),r=e("utils/queryString");i.setOptions({gfm:!0,tables:!1,breaks:!0,pedantic:!1,sanitize:!0,smartLists:!0,smartypants:!1,silent:!0});var s=r().print;s||i.setOptions({renderer:new o});var l=function(){return""},a=function(){this.hrefs=[]},u=a.prototype=new i.Renderer;u.code=l,u.blockquote=l,u.html=l,u.heading=l,u.hr=l,u.br=l,u.list=l,u.listitem=l,u.checkbox=l,u.paragraph=l,u.table=l,u.tablerow=l,u.tablecell=l,u.strong=l,u.em=l,u.codespan=l,u.del=l,u.tagged=l,u.link=function(e,t,n,i){return this.hrefs.push(e),""},u.image=l;var d=function(e){return e.replace(/&#39;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&")},c=function(e){return d(e)+" "},h=function(){return" "},p=function(){},f=p.prototype=new i.Renderer;f.code=c,f.blockquote=c,f.html=l,f.heading=c,f.hr=l,f.br=h,f.list=c,f.listitem=c,f.checkbox=h,f.paragraph=c,f.table=c,f.tablerow=c,f.tablecell=c,f.strong=c,f.em=c,f.codespan=c,f.del=c,f.tagged=c,f.link=function(e,t,n,i){return" "+d(n)+" "},f.image=function(e,t,n){return" "+d(n)+" "};var g=function(){};g.prototype=s?new i.Renderer:new o,g.prototype.image=function(e,t,n,i,o){var r=e;e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAAtJREFUCB1jYAACAAAFAAGNu5vzAAAAAElFTkSuQmCC";var s='<img src="'+e+'" data-origsrc="'+r+'" alt="'+n+'"';return t&&(s+=' title="'+t+'"'),i||o||(s+=' class="unsized"'),i&&(s+=' width="'+i+'"'),o&&(s+=' height="'+o+'"'),s+=">"},i.HrefCollector=a,i.PlaintextRenderer=p,i.NoImages=g,n.exports=i}),define("views/shapes",["require","exports","module","underscore"],function(e,t,n){var i=e("underscore"),o=function(){return function(e,t){var n=e/2,i=t/2,o=2.5;return"M "+(7-n)+",4.9 L "+-n+",0,"+(7-n)+","+-4.9+","+(7-n)+","+(9.5-i)+" A "+o+","+o+",0,0,1,"+(9.5-n)+","+(7-i)+" L "+-4.9+","+(7-i)+",0,"+-i+",4.9,"+(7-i)+","+(n-7-o)+","+(7-i)+" A "+o+","+o+",0,0,1,"+(n-7)+","+(9.5-i)+" L "+(n-7)+","+-4.9+","+n+",0,"+(n-7)+",4.9,"+(n-7)+","+(i-7-o)+" A "+o+","+o+",0,0,1,"+(n-7-o)+","+(i-7)+" L 4.9,"+(i-7)+",0,"+i+","+-4.9+","+(i-7)+","+(9.5-n)+","+(i-7)+" A "+o+","+o+",0,0,1,"+(7-n)+","+(i-7-o)+" Z"}},r=function(e,t,n,o){var r=[Math.atan2(1,e-n),Math.atan2(1,o-t),Math.atan2(1,t-o),Math.atan2(1,n-e)],s=i.map(r,function(e){return 4*Math.tan(e/2)}),l=[{start:{x:-Math.cos(r[0])*s[0],y:Math.sin(r[0])*s[0]},end:{x:s[0],y:0}},{start:{x:-s[1],y:0},end:{x:Math.cos(r[1])*s[1],y:Math.sin(r[1])*s[1]}},{start:{x:Math.cos(r[2])*s[2],y:-Math.sin(r[2])*s[2]},end:{x:-s[2],y:0}},{start:{x:s[3],y:0},end:{x:-Math.cos(r[3])*s[3],y:-Math.sin(r[3])*s[3]}}];return function(i,r){return"M "+(-i/2+e*r+l[0].start.x)+","+(-r/2+l[0].start.y)+" A 4,4,0,0,1,"+(-i/2+e*r+l[0].end.x)+","+(-r/2+l[0].end.y)+" L "+(i/2+t*r+l[1].start.x)+","+(-r/2+l[1].start.y)+" A 4,4,0,0,1,"+(i/2+t*r+l[1].end.x)+","+(-r/2+l[1].end.y)+" L "+(i/2+o*r+l[2].start.x)+","+(r/2+l[2].start.y)+" A 4,4,0,0,1,"+(i/2+o*r+l[2].end.x)+","+(r/2+l[2].end.y)+" L "+(-i/2+n*r+l[3].start.x)+","+(r/2+l[3].start.y)+" A 4,4,0,0,1,"+(-i/2+n*r+l[3].end.x)+","+(r/2+l[3].end.y)+" Z"}},s=function(){return function(e,t){return"M 0,"+-t/2+" A "+e/2+","+t/2+",0,0,1,0,"+t/2+" A "+e/2+","+t/2+",0,0,1,0,"+-t/2+" Z"}},l=function(){return function(e,t){var n=Math.min(e/2,t/2);return"M "+-e/2+","+(n-t/2)+" A "+n+","+n+",0,0,1,"+(n-e/2)+","+-t/2+" L "+(e/2-n)+","+-t/2+" A "+n+","+n+",0,0,1,"+e/2+","+(n-t/2)+" L "+e/2+","+(t/2-n)+" A "+n+","+n+",0,0,1,"+(e/2-n)+","+t/2+" L "+(n-e/2)+","+t/2+" A "+n+","+n+",0,0,1,"+-e/2+","+(t/2-n)+" Z"}},a=function(){return function(e,t){var n=Math.sqrt(e*e+t*t),i=4*e/n,o=i*e/t,r=4*t/n,s=r*t/e;return"M "+(o-e/2)+","+i+" A 4,4,0,0,1,"+(o-e/2)+","+-i+" L "+-r+","+(s-t/2)+" A 4,4,0,0,1,"+r+","+(s-t/2)+" L "+(e/2-o)+","+-i+" A 4,4,0,0,1,"+(e/2-o)+","+i+" L "+r+","+(t/2-s)+" A 4,4,0,0,1,"+-r+","+(t/2-s)+" Z"}},u={};u.root={connections:[{x:0,y:.5,x_off:0,y_off:2,direction:"down"},{x:0,y:-.5,x_off:0,y_off:-2,direction:"up"},{x:.5,y:0,x_off:2,y_off:0,direction:"right"},{x:-.5,y:0,x_off:-2,y_off:0,direction:"left"}],path:o(),padding:{w:0,w_off:22,h:0,h_off:26}},u.label={connections:[{x:0,y:.5,x_off:0,y_off:11,direction:"down"},{x:-.5,y:0,x_off:-7,y_off:0,direction:"left"},{x:0,y:-.5,x_off:0,y_off:-11,direction:"up"},{x:.5,y:0,x_off:7,y_off:0,direction:"right"}],path:null,padding:{w:0,w_off:0,h:0,h_off:0}},u.rect={connections:[{x:0,y:.5,x_off:0,y_off:7,direction:"down"},{x:-.5,y:0,x_off:-7,y_off:0,direction:"left"},{x:0,y:-.5,x_off:0,y_off:-7,direction:"up"},{x:.5,y:0,x_off:7,y_off:0,direction:"right"}],path:r(0,0,0,0),padding:{w:0,w_off:8,h:0,h_off:12}},u.lpara={connections:[{x:0,y:.5,xh:.1,x_off:0,y_off:7,direction:"down"},{x:-.5,y:0,xh:.1,x_off:-7,y_off:0,direction:"left"},{x:0,y:-.5,xh:-.1,x_off:0,y_off:-7,direction:"up"},{x:.5,y:0,xh:-.1,x_off:7,y_off:0,direction:"right"}],path:r(0,-.2,.2,0),padding:{w:0,wh:.4,w_off:8,h:0,h_off:12}},u.rpara={connections:[{x:0,y:.5,xh:-.1,x_off:0,y_off:7,direction:"down"},{x:-.5,y:0,xh:.1,x_off:-7,y_off:0,direction:"left"},{x:0,y:-.5,xh:.1,x_off:0,y_off:-7,direction:"up"},{x:.5,y:0,xh:-.1,x_off:7,y_off:0,direction:"right"}],path:r(.2,0,0,-.2),padding:{w:0,wh:.4,w_off:8,h:0,h_off:12}},u.ttrap={connections:[{x:0,y:.5,x_off:0,y_off:7,direction:"down"},{x:-.5,y:0,xh:.1,x_off:-7,y_off:0,direction:"left"},{x:0,y:-.5,x_off:0,y_off:-7,direction:"up"},{x:.5,y:0,xh:-.1,x_off:7,y_off:0,direction:"right"}],path:r(0,0,.2,-.2),padding:{w:0,wh:.4,w_off:8,h:0,h_off:12}},u.btrap={connections:[{x:0,y:.5,x_off:0,y_off:7,direction:"down"},{x:-.5,y:0,xh:.1,x_off:-7,y_off:0,direction:"left"},{x:0,y:-.5,x_off:0,y_off:-7,direction:"up"},{x:.5,y:0,xh:-.1,x_off:7,y_off:0,direction:"right"}],path:r(.2,-.2,0,0),padding:{w:0,wh:.4,w_off:8,h:0,h_off:12}},u.diamond={connections:[function(e,t){return{x:0,y:7+.5*t-(4*t/Math.sqrt(e*e+t*t)*(e/t+t/e)-4),direction:"down"}},function(e,t){return{x:7+.5*e-(4*e/Math.sqrt(e*e+t*t)*(e/t+t/e)-4),y:0,direction:"right"}},function(e,t){return{x:0,y:4*t/Math.sqrt(e*e+t*t)*(e/t+t/e)-4-.5*t-7,direction:"up"}},function(e,t){return{x:4*e/Math.sqrt(e*e+t*t)*(e/t+t/e)-4-.5*e-7,y:0,direction:"left"}}],path:a(),padding:{w:1,w_off:7,h:1,h_off:7}},u.oval={connections:[{x:0,y:.5,x_off:0,y_off:7,direction:"down"},{x:-.5,y:0,x_off:-7,y_off:0,direction:"left"},{x:0,y:-.5,x_off:0,y_off:-7,direction:"up"},{x:.5,y:0,x_off:7,y_off:0,direction:"right"}],path:s(),padding:{w:Math.sqrt(2)-1,w_off:7,h:Math.sqrt(2)-1,h_off:7}},u.rounded={connections:[{x:0,y:.5,x_off:0,y_off:7,direction:"down"},{x:-.5,y:0,x_off:-7,y_off:0,direction:"left"},{x:0,y:-.5,x_off:0,y_off:-7,direction:"up"},{x:.5,y:0,x_off:7,y_off:0,direction:"right"}],path:l(),padding:function(e,t){return{w:t<e?t/2+4:8,h:e<t?e/2+8:12}}},window._shapes_data=u;var d=function(e){return u.hasOwnProperty(e)||(console.warn("undefined shape encountered: "+e),e="rect"),e},c=function(e,t){var n=["root","rounded","rect"];return t&&(n=n.concat(["rpara","diamond","ttrap","label"])),e||n.push(null),n};n.exports.path=function(e,t,n){return e=d(e),u[e].path&&u[e].path(t,n)},n.exports.connectionsForSize=function(e,t){e=d(e);var n=1;return i.map(u[e].connections,function(e){return n+=1,"function"==typeof e?i.extend({id:n-1},e(t.w,t.h)):{x:e.x*t.w+e.x_off+(e.hasOwnProperty("xh")?e.xh*t.h:0),y:e.y*t.h+e.y_off,direction:e.direction,id:n-1}})},n.exports.padding=function(e,t){e=d(e);var n=u[e].padding;return"function"==typeof n?n(t.w,t.h):{w:n.w*t.w+n.w_off+(n.wh?t.h*n.wh:0),h:n.h*t.h+n.h_off+(n.hw?t.w*n.hw:0)}},n.exports.trapPath=r,n.exports.rootPath=o,n.exports.ovalPath=s,n.exports.roundedPath=l,n.exports.diamondPath=a,n.exports.free_shapes=["root","rect","rounded","label",null],n.exports.default_free_shape="rect",n.exports.shapesFor=c}),define("utils/controlPoints",["require","exports","module","views/shapes"],function(e,t,n){var i=e("views/shapes"),o=Array(16).join("9");n.exports.CP_ID_Length=15,n.exports.Max_CP_ID=o,n.exports.Min_CP_ID="0",n.exports.newIDBetween=function(e,t){return e=parseFloat("0."+e),t=parseFloat("0."+t),(e+.5*(t-e)).toFixed(15).substr(2).replace(/0+$/g,"")};var r=new RegExp("^[0-9]{1,15}$");n.exports.validID=function(e){return!!r.exec(e)};var s=function(e){return 4.54688*e/6},l=function(e,t){return(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)},a=function(e){switch(e){case"up":return"down";case"down":return"up";case"left":return"right";default:case"right":return"left"}},u=function(e,t,n,o){var r,u=-(s(n.lineWeight())+3),d=n.joinedNode();if(!d){var c=o||e.getNodeForId(n.id);c&&(d=c.ephemerallyJoinedNode())}var h,p,f,g,m={xf:0,yf:0,df:null,idf:0,xt:0,yt:0,dt:null,idt:0,reverses:!1,short:!1},v=t.shape(),y=n.shape(),b=d&&d.shape();if(v){var w=e.getNodeForId(t.id),_=w.getSize();f=i.connectionsForSize(v,_);var x=n.sortedControlPoints()[0]||{x:n.relX(),y:n.relY()};for(p=1/0,g=0;g<f.length;g++){var E=f[g].x,A=f[g].y;h=l({x:E,y:A},x),h<p&&(m.xf=E,m.yf=A,m.df=f[g].direction,m.idf=f[g].id,p=h)}}else m.xf=-1*t.ltr(),m.yf=0,m.df=t.ltr()<0?"left":"right";if(y&&!d||b){var S=n;b&&(y=b,n=d,o=null);var C=o||e.getNodeForId(n.id),F=C&&C.getSize()||{w:0,h:0}
;f=i.connectionsForSize(y,F);var k=b?n.x()-t.x():n.relX(),T=b?n.y()-t.y():n.relY(),O=S.lastCP()||{x:m.xf,y:m.yf};for(O.x-=k,O.y-=T,p=1/0,g=0;g<f.length;g++){var N=f[g].x,I=f[g].y;h=l({x:N,y:I},O),h<p&&(m.xt=N+k,m.yt=I+T,m.dt=a(f[g].direction),m.idt=f[g].id,p=h)}switch(m.dt){case"up":m.yt+=5;break;case"down":m.yt-=5;break;case"left":m.xt+=5;break;case"right":m.xt-=5}}else d?(r=d.ltr()!==n.ltr(),m.xt=d.x()-t.x()+u*d.ltr(),m.yt=d.y()-t.y(),m.reverses=r,m.dt=d.ltr()<0?"left":"right"):(m.xt=n.relX()+u*n.ltr(),m.yt=n.relY(),m.reverses=!v&&n.ltr()!==t.ltr(),m.dt=n.ltr()<0?"left":"right");return m.xt=Math.round(m.xt),m.yt=Math.round(m.yt),m.xf=Math.round(m.xf),m.yf=Math.round(m.yf),m.dt!=m.df||n.hasCP()||("left"===m.dt||"right"===m.dt?m.yt===m.yf&&Math.abs(m.xt-m.xf)<30&&(m.short=!0):m.xt===m.xf&&Math.abs(m.yt-m.yf)<30&&(m.short=!0)),m};n.exports.connectionParameters=u;var d=function(e,t,n){if(e.length<=2)return[e[0],t,n,e[1]];if(3==e.length){var i={x:.25*(n.x+4*e[1].x-t.x),y:.25*(n.y+4*e[1].y-t.y)},o={x:2*e[1].x-i.x,y:2*e[1].y-i.y};return[e[0],t,o,e[1],i,n,e[2]]}var r=e.length,s=[void 0].concat(e),l=[];l.push({x:4*s[2].x+2*s[3].x-t.x,y:4*s[2].y+2*s[3].y-t.y});var a;for(a=3;a<s.length-2;a++)l.push({x:4*s[a].x+2*s[a+1].x,y:4*s[a].y+2*s[a+1].y});l.push({x:4*s[r-1].x+n.x,y:4*s[r-1].y+n.y});var u=[.25];for(a=1;a<l.length;a++)u.push(1/(4-u[a-1]));for(l[0].x=l[0].x/4,l[0].y=l[0].y/4,a=1;a<l.length;a++)l[a].x=(l[a].x-l[a-1].x)/(4-u[a-1]),l[a].y=(l[a].y-l[a-1].y)/(4-u[a-1]);var d=new Array(l.length);for(d[l.length-1]={x:l[l.length-1].x,y:l[l.length-1].y},a=l.length-2;a>=0;a--)d[a]={x:l[a].x-u[a]*d[a+1].x,y:l[a].y-u[a]*d[a+1].y};var c=[];for(a=0;a<d.length;a++)c.push({x:2*e[a+1].x-d[a].x,y:2*e[a+1].y-d[a].y});var h=[e[0],t];for(a=0;a<d.length;a++)h.push(c[a]),h.push(e[a+1]),h.push(d[a]);return h.push(n),h.push(e[e.length-1]),h};n.exports.bezierCPForConnection=function(e,t,n,i,o){i=i||u(e,t,n);var r=i.xf,s=i.yf,a=i.xt,h=i.yt,p=i.reverses,f=0,g=0;"left"===i.df||"right"===i.df?(f=p?Math.max(.08*Math.abs(s-h)+40+Math.min(.1*Math.abs(r-a),400),16):Math.max(.08*Math.abs(s-h)+Math.min(.7*Math.abs(r-a),600),16),"left"===i.df&&(f=-f)):"up"===i.df?g=-Math.max((Math.abs(r-a)+Math.min(.6*Math.abs(s-h),1200))/2,8):"down"===i.df&&(g=Math.max((Math.abs(r-a)+Math.min(.6*Math.abs(s-h),1200))/2,8));var m=-Math.max((Math.abs(r-a)+Math.min(.6*Math.abs(s-h),1200))/2,8),v=0;"left"===i.dt?m=-m:"up"===i.dt?(v=-m,m=0):"down"===i.dt&&(v=m,m=0);var y=n.joinedNode(),b=e.getNodeForId(n.id);b&&(y=b.ephemerallyJoinedNode()||y),y&&!y.shape()&&(m*=1.5,v*=1.5);var w=o||n.sortedControlPoints();if(w.length>0){var _=l({x:r,y:s},{x:a,y:h}),x=l({x:r,y:s},w[0]),E=l({x:a,y:h},w[w.length-1]),A=Math.min(1,Math.sqrt(x/_)),S=Math.min(1,Math.sqrt(E/_));f*=A,g*=A,m*=S,v*=S}var C=r+f,F=s+g,k=a+m,T=h+v,O=[].concat([{x:r,y:s}],w,[{x:a,y:h}]),N=d(O,{x:C,y:F},{x:k,y:T});return c(N),N};var c=function(e){var t=l(e[0],e[3]),n=1;if(t<5625){var i={x:e[2].x-e[3].x,y:e[2].y-e[3].y};n=1-1/(t*t/390625+1),e[2].x=e[3].x+i.x*n,e[2].y=e[3].y+i.y*n}var o=e.length-1,r=o-3;if((t=l(e[o],e[r]))<5625){var s={x:e[r+1].x-e[r].x,y:e[r+1].y-e[r].y};n=1-1/(t*t/390625+1),e[r+1].x=e[r].x+s.x*n,e[r+1].y=e[r].y+s.y*n}};n.exports.straightCPForConnection=function(e,t,n,i,o){i=i||u(e,t,n);var r=i.xf,s=i.yf,l=i.xt,a=i.yt,d=(i.reverses,0),c=0;"left"===i.df?d=-30:"right"===i.df?d=30:"up"===i.df?c=-30:"down"===i.df&&(c=30);var h=0,p=0;return"left"===i.dt?h=30:"right"===i.dt?h=-30:"up"===i.dt?p=30:"down"===i.dt&&(p=-30),[].concat([{x:r,y:s},{x:r+d,y:s+c}],o||n.sortedControlPoints(),[{x:l+h,y:a+p},{x:l,y:a}])};var h=.5*(Math.sqrt(5)+1),p=function(e,t,n){for(var i,o,r=0;r<100&&(i=t-(t-e)/h,o=e+(t-e)/h,n(i)<n(o)?t=o:e=i,!(Math.abs(t-e)<1));r++);return(t+e)/2},f=function(e,t,n){if(Math.abs(t-e)<1)return(t+e)/2;var i,o=Math.max(3,Math.ceil((t-e)/10)),r=e,s=(t-e)/o,l=new Array(o),a=[];for(i=0;i<o;i++)l[i]={x:r,v:n(r)},i>1&&l[i]>=l[i-1]&&l[i-1]<=l[i-2]&&a.push({l:l[i-2],h:l[i],v:l[i-1].v}),r+=s;l[0]<=l[1]&&a.push({l:l[0],h:l[1],v:l[0].v}),l[o-2]>=l[o-1]&&a.push({l:l[o-2],h:l[o-1],v:l[o-1].v}),a.length||console.error("maths fail :( "+l);var u=null,d=null;for(i=0;i<a.length;i++)(null===d||a[i].v<d)&&(u=i,d=a[i].v);return p(a[u].l.x,a[u].h.x,n)},g=function(e,t){if(2===e.length)return[e[0],e[1]];for(var n,i=0,o=e.length-1,r=0;r<100;r++)if(n=Math.floor((o+i)/2),t(e[n])?o=n:i=n,o-i<=1)return[e[i],e[o]];return console.error("failed to find segment"),[e[i],e[o]]},m=function(e,t,n){var i=n.toFixed(1);return t.hasOwnProperty(i)||(t[i]=e.getPointAtLength(n)),t[i]};n.exports.findClosestPointsAlongPath=function(e,t,n,i){var r=e.getTotalLength(),s={},l=f(0,r,function(t){var o=m(e,s,t);return(o.x-n)*(o.x-n)+(o.y-i)*(o.y-i)});e.getPointAtLength(l);return g(t,function(t){return"0"===t.n?0:t.n===o?1:f(0,r,function(n){var i=m(e,s,n);return(i.x-t.x)*(i.x-t.x)+(i.y-t.y)*(i.y-t.y)})>l})}}),define("utils/textsize",["require","exports","module"],function(e,t,n){var i=[17,15.3,13,12];t.textSizeForLevel=function(e){var t=i.length;return e>=0&&e<t?i[e]:e>=t?i[t-1]:17},t.clamp=function(e){return e>=8&&e<=50?e:e<8?8:e>50?50:12},t.Default_Text_Sizes=i,t.Min_Text_Size=8,t.Max_Text_Size=50,t.Root_Parent_Text_Size=19}),function(){function e(e,t,n){e=r(e,255),t=r(t,255),n=r(n,255);var i,o=f(e,t,n),s=p(e,t,n),l=(o+s)/2;if(o==s)i=s=0;else{var a=o-s,s=.5<l?a/(2-o-s):a/(o+s);switch(o){case e:i=(t-n)/a+(t<n?6:0);break;case t:i=(n-e)/a+2;break;case n:i=(e-t)/a+4}i/=6}return{h:i,s:s,l:l}}function t(e,t,n){function i(e,t,n){return 0>n&&(n+=1),1<n&&(n-=1),n<1/6?e+6*(t-e)*n:.5>n?t:n<2/3?e+6*(t-e)*(2/3-n):e}if(e=r(e,360),t=r(t,100),n=r(n,100),0===t)n=t=e=n;else{var o=.5>n?n*(1+t):n+t-n*t,s=2*n-o;n=i(s,o,e+1/3),t=i(s,o,e),e=i(s,o,e-1/3)}return{r:255*n,g:255*t,b:255*e}}function n(e,t,n){e=r(e,255),t=r(t,255),n=r(n,255);var i,o=f(e,t,n),s=p(e,t,n),l=o-s;if(o==s)i=0;else{switch(o){case e:i=(t-n)/l+(t<n?6:0);break;case t:i=(n-e)/l+2;break;case n:i=(e-t)/l+4}i/=6}return{h:i,s:0===o?0:l/o,v:o}}function i(e,t,n,i){return[s(Math.round(255*parseFloat(i)).toString(16)),s(h(e).toString(16)),s(h(t).toString(16)),s(h(n).toString(16))].join("")}function o(e){return e=parseFloat(e),(isNaN(e)||0>e||1<e)&&(e=1),e}function r(e,t){"string"==typeof e&&-1!=e.indexOf(".")&&1===parseFloat(e)&&(e="100%");var n="string"==typeof e&&-1!=e.indexOf("%");return e=p(t,f(0,parseFloat(e))),n&&(e=parseInt(e*t,10)/100),1e-6>c.abs(e-t)?1:e%t/parseFloat(t)}function s(e){return 1==e.length?"0"+e:""+e}function l(e){return 1>=e&&(e=100*e+"%"),e}var a=/^[\s,#]+/,u=/\s+$/,d=0,c=Math,h=c.round,p=c.min,f=c.max,g=function e(n,i){var s,g,v,y,b;if(n=n||"",i=i||{},n instanceof e)return n;if(!(this instanceof e))return new e(n,i);g=n,b={r:0,g:0,b:0};var w=1;if(v=s=!1,"string"==typeof g&&(g=g.replace(a,"").replace(u,"").toLowerCase(),g=(y=m.rgb.exec(g))?{r:y[1],g:y[2],b:y[3]}:(y=m.rgba.exec(g))?{r:y[1],g:y[2],b:y[3],a:y[4]}:(y=m.hsl.exec(g))?{h:y[1],s:y[2],l:y[3]}:(y=m.hsla.exec(g))?{h:y[1],s:y[2],l:y[3],a:y[4]}:(y=m.hsv.exec(g))?{h:y[1],s:y[2],v:y[3]}:(y=m.hex8.exec(g))?{a:parseInt(y[1],16)/255,r:parseInt(y[2],16),g:parseInt(y[3],16),b:parseInt(y[4],16),format:"hex8"}:(y=m.hex6.exec(g))?{r:parseInt(y[1],16),g:parseInt(y[2],16),b:parseInt(y[3],16),format:"hex"}:!!(y=m.hex3.exec(g))&&{r:parseInt(y[1]+""+y[1],16),g:parseInt(y[2]+""+y[2],16),b:parseInt(y[3]+""+y[3],16),format:"hex"}),"object"==typeof g){if(g.hasOwnProperty("r")&&g.hasOwnProperty("g")&&g.hasOwnProperty("b"))b={r:255*r(g.r,255),g:255*r(g.g,255),b:255*r(g.b,255)},s=!0,v="%"===String(g.r).substr(-1)?"prgb":"rgb";else if(g.hasOwnProperty("h")&&g.hasOwnProperty("s")&&g.hasOwnProperty("v")){g.s=l(g.s),g.v=l(g.v),v=g.h;var _=g.s;b=g.v,v=6*r(v,360),_=r(_,100),b=r(b,100),s=c.floor(v);var x=v-s;v=b*(1-_),y=b*(1-x*_),_=b*(1-(1-x)*_),s%=6,b={r:255*[b,y,v,v,_,b][s],g:255*[_,b,b,y,v,v][s],b:255*[v,v,_,b,b,y][s]},s=!0,v="hsv"}else g.hasOwnProperty("h")&&g.hasOwnProperty("s")&&g.hasOwnProperty("l")&&(g.s=l(g.s),g.l=l(g.l),b=t(g.h,g.s,g.l),s=!0,v="hsl");g.hasOwnProperty("a")&&(w=g.a)}w=o(w),g=g.format||v,v=p(255,f(b.r,0)),y=p(255,f(b.g,0)),b=p(255,f(b.b,0)),this._r=v,this._g=y,this._b=b,this._a=w,this._roundA=h(100*this._a)/100,this._format=i.format||g,this._gradientType=i.gradientType,1>this._r&&(this._r=h(this._r)),1>this._g&&(this._g=h(this._g)),1>this._b&&(this._b=h(this._b)),this._ok=s,this._tc_id=d++};g.prototype={getAlpha:function(){return this._a},setAlpha:function(e){this._a=o(e),this._roundA=h(100*this._a)/100},toHsv:function(){var e=n(this._r,this._g,this._b);return{h:360*e.h,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=n(this._r,this._g,this._b),t=h(360*e.h),i=h(100*e.s),e=h(100*e.v);return 1==this._a?"hsv("+t+", "+i+"%, "+e+"%)":"hsva("+t+", "+i+"%, "+e+"%, "+this._roundA+")"},toHsl:function(){var t=e(this._r,this._g,this._b);return{h:360*t.h,s:t.s,l:t.l,a:this._a}},toHslString:function(){var t=e(this._r,this._g,this._b),n=h(360*t.h),i=h(100*t.s),t=h(100*t.l);return 1==this._a?"hsl("+n+", "+i+"%, "+t+"%)":"hsla("+n+", "+i+"%, "+t+"%, "+this._roundA+")"},toHex:function(e){var t=this._g,n=this._b,t=[s(h(this._r).toString(16)),s(h(t).toString(16)),s(h(n).toString(16))];return e=e&&t[0].charAt(0)==t[0].charAt(1)&&t[1].charAt(0)==t[1].charAt(1)&&t[2].charAt(0)==t[2].charAt(1)?t[0].charAt(0)+t[1].charAt(0)+t[2].charAt(0):t.join("")},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(){return i(this._r,this._g,this._b,this._a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:h(this._r),g:h(this._g),b:h(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+h(this._r)+", "+h(this._g)+", "+h(this._b)+")":"rgba("+h(this._r)+", "+h(this._g)+", "+h(this._b)+", "+this._roundA+")"},toFilter:function(e){var t="#"+i(this._r,this._g,this._b,this._a),n=t,o=this._gradientType?"GradientType = 1, ":"";return e&&(n=g(e).toHex8String()),"progid:DXImageTransform.Microsoft.gradient("+o+"startColorstr="+t+",endColorstr="+n+")"}},g.fromRatio=function(e,t){if("object"==typeof e){var n,i={};for(n in e)e.hasOwnProperty(n)&&(i[n]="a"===n?e[n]:l(e[n]));e=i}return g(e,t)},g.equals=function(e,t){return!(!e||!t)&&g(e).toRgbString()==g(t).toRgbString()},g.desaturate=function(e,t){t=0===t?0:t||10;var n=g(e).toHsl();return n.s-=t/100,n.s=p(1,f(0,n.s)),g(n)},g.saturate=function(e,t){t=0===t?0:t||10;var n=g(e).toHsl();return n.s+=t/100,n.s=p(1,f(0,n.s)),g(n)},g.greyscale=function(e){return g.desaturate(e,100)},g.lighten=function(e,t){t=0===t?0:t||10;var n=g(e).toHsl();return n.l+=t/100,n.l=p(1,f(0,n.l)),g(n)},g.darken=function(e,t){t=0===t?0:t||10;var n=g(e).toHsl();return n.l-=t/100,n.l=p(1,f(0,n.l)),g(n)},g.complement=function(e){return e=g(e).toHsl(),e.h=(e.h+180)%360,g(e)},g.triad=function(e){var t=g(e).toHsl(),n=t.h;return[g(e),g({h:(n+120)%360,s:t.s,l:t.l}),g({h:(n+240)%360,s:t.s,l:t.l})]},g.tetrad=function(e){var t=g(e).toHsl(),n=t.h;return[g(e),g({h:(n+90)%360,s:t.s,l:t.l}),g({h:(n+180)%360,s:t.s,l:t.l}),g({h:(n+270)%360,s:t.s,l:t.l})]},g.splitcomplement=function(e){var t=g(e).toHsl(),n=t.h;return[g(e),g({h:(n+72)%360,s:t.s,l:t.l}),g({h:(n+216)%360,s:t.s,l:t.l})]},g.analogous=function(e,t,n){t=t||6,n=n||30;var i=g(e).toHsl();for(n=360/n,e=[g(e)],i.h=(i.h-(n*t>>1)+720)%360;--t;)i.h=(i.h+n)%360,e.push(g(i));return e},g.monochromatic=function(e,t){t=t||6;for(var n=g(e).toHsv(),i=n.h,o=n.s,n=n.v,r=[],s=1/t;t--;)r.push(g({h:i,s:o,v:n})),n=(n+s)%1;return r};var m={rgb:RegExp("rgb[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),rgba:RegExp("rgba[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),hsl:RegExp("hsl[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),hsla:RegExp("hsla[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),hsv:RegExp("hsv[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};"undefined"!=typeof module&&module.exports?module.exports=g:"function"==typeof define&&define.amd?define("tinytinycolor",[],function(){return g}):window.tinytinycolor=g}(),define("utils/colours",["require","exports","module","tinytinycolor"],function(e,t,n){var i=e("tinytinycolor"),o=function(e,t){void 0===t&&(t=1);var n=i(e).toHsl();return i({h:n.h,s:n.s*=.7/t,l:n.l*=.5/t}).toHexString()},r=function(e,t){void 0===t&&(t=1);var n=i(e).toHsl();return i({h:n.h,s:n.s*(1-t)+.7*n.s*t,l:n.l*(1-t)+(.6*n.l+.4)*t}).toHexString()},s=function(e){var t=i(e).toHsl(),n=t.s-.7*t.s;return i({h:t.h,s:t.s-n,l:t.l*(1-n/2)}).toHexString()},l=function(e){var t=i(e).toHsl();return t.l>.9?o(e):t.l<.1?r(e):i(e).toHexString()},a=function(e){var t=i(e).toRgb();return.3*t.r/255+.59*t.g/255+.11*t.b/255},u=function(e){return i(e).toHsl().s},d=function(e,t){var n=i(e);return n.setAlpha(t),n.toRgbString()},c=function(e,t){var n=i(e).toHsl(),o=(n.s,i({h:n.h,s:Math.sqrt(Math.sqrt(n.s)),l:.3}));return o.setAlpha(t),o.toRgbString()},h=function(e){var t=["#7aa3e5","#67d7c4","#9ed56b","#ebd95f","#efa670","#e68782","#e096e9","#988ee3"],n=["#e8e525","#69b500","#0a660d","#3e8975","#0da7d3","#075978","#272727","#5f5f5f","#e23e2b","#a65427","#ffaa38"];return e?t.concat(n):t},p=function(e,t){return e=i(e).toHsl(),t=i(t).toHsl(),(e.h-t.h)*(e.h-t.h)+(e.s-t.s)*(e.s-t.s)+(e.l-t.l)*(e.l-t.l)},f=function(e,t){for(var n=h(t),i=-1,o=1/0,r=0;r<n.length;r++){var s=p(n[r],e);s<o&&(o=s,i=r)}return n[(i+1)%n.length]};t.darken=o,t.lighten=r,t.desaturate=s,t.mediate=l,t.luminance=a,t.setOpacity=d,t.glass=c,t.saturation=u,t.defaults=h,t.nextColour=f}),function(a,b){function m(e,t,r){var u=[],p=q(function e(t,n){var i,o=[],r=typeof t;if(n&&"object"==r)for(i in t)try{o.push(e(t[i],n-1))}catch(e){}return o.length?o:"string"==r?t:t+"\0"}((t=1==t?{entropy:!0}:t||{}).entropy?[e,s(a)]:null==e?function(){try{var e;return l&&(e=l.randomBytes)?e=e(d):(e=new Uint8Array(d),(c.crypto||c.msCrypto).getRandomValues(e)),s(e)}catch(e){var t=c.navigator,n=t&&t.plugins;return[+new Date,c,n,c.screen,s(a)]}}():e,3),u),f=new n(u),m=function(){for(var e=f.g(6),t=h,n=0;e<i;)e=(e+n)*d,t*=d,n=f.g(1);for(;j<=e;)e/=2,t/=2,n>>>=1;return(e+n)/t};return m.int32=function(){return 0|f.g(4)},m.quick=function(){return f.g(4)/4294967296},m.double=m,q(s(f.S),a),(t.pass||r||function(e,t,n,i){return i&&(i.S&&o(i,f),e.state=function(){return o(f,{})}),n?(b[g]=e,t):e})(m,p,"global"in t?t.global:this==b,t.state)}function n(e){var t,n=e.length,i=this,o=0,r=i.i=i.j=0,s=i.S=[];for(n||(e=[n++]);o<d;)s[o]=o++;for(o=0;o<d;o++)s[o]=s[r=k&r+e[o%n]+(t=s[o])],s[r]=t;(i.g=function(e){for(var t,n=0,o=i.i,r=i.j,s=i.S;e--;)t=s[o=k&o+1],n=n*d+s[k&(s[o]=s[r=k&r+t])+(s[r]=t)];return i.i=o,i.j=r,n})(d)}function o(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function q(e,t){for(var n,i=e+"",o=0;o<i.length;)t[k&o]=k&(n^=19*t[k&o])+i.charCodeAt(o++);return s(t)}function s(e){return String.fromCharCode.apply(0,e)}var l,c=eval("this"),d=256,g="random",h=b.pow(d,6),i=b.pow(2,52),j=2*i,k=d-1;if(b["seed"+g]=m,q(b.random(),a),"object"==typeof module&&module.exports){module.exports=m;try{l=require("crypto")}catch(n){}}else"function"==typeof define&&define.amd&&define("seedrandom",[],function(){return m})}([],Math),define("utils/randomhex",["require","exports","module","underscore","seedrandom"],function(e,t,n){var i,o=e("underscore"),r=window.crypto||window.msCrypto;r&&"function"==typeof r.getRandomValues&&"Uint8Array"in window?i=function(e){var t=new Uint8Array(Math.ceil(e/2));return r.getRandomValues(t),o.map(t,function(e){var t=e.toString(16);return("00"+t).substring(t.length,t.length+2)}).join("").substr(0,e)}:(console.error("using un-random random"),e("seedrandom"),i=function(e){!window.randomSeeded&&Math.seedrandom&&(Math.seedrandom(),window.randomSeeded=!0);for(var t,n="",i=0;i<Math.ceil(e/8);i++)t=Math.floor(4294967296*Math.random()).toString(16),n+=("00000000"+t).substring(t.length,t.length+8);return n.substr(0,e)}),n.exports=i}),define("models/Node",["require","exports","module","underscore","backbone","utils/marked","utils/controlPoints","utils/textsize","utils/colours","utils/randomhex","utils/queryString"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=e("utils/marked"),s=e("utils/controlPoints"),l=e("utils/textsize"),a=e("utils/colours"),u=e("utils/randomhex"),d=e("utils/queryString"),c=new Date("2021-02-1").getTime(),h=Object.prototype.hasOwnProperty;d().joinsStationary&&(window._joins_stationary=!0),d().joinsAverage&&(window._join_move_averageing=!0);var p=function(e){var t,n=null;for(var i in e)h.call(e,i)&&(t=parseFloat("0."+i),(null===n||t>n.v)&&(n={n:i,v:t}));return n?{n:n.n,x:e[n.n].x,y:e[n.n].y}:null},f=l.Default_Text_Sizes,g=o.Model.extend({defaults:{scale:1,width:null,line_weight:null,line_style:"solid",line_shape:"smooth",join:null,text:"",text_size:null,hidden:!1,colour:"#b4b4b4",direction:null,control_points:{},shape:null,text_alignment:null,attachments:{}},idAttribute:"node_id",initialize:function(){this._x=this._y=this._path_to_root=this.destroyed=void 0,this.has_children=0,this._children={},this._child_flips=0,this._normalised_text=null,this.local_timestamp=new Date,this.last_sync_state=i.clone(this.attributes),this._children_needing_deltarizing=[],this.on("change:pos change:parent_id ancestor_moved",function(){this._x=void 0,this._y=void 0}),this.on("path_changed",function(){this._path_to_root=void 0}.bind(this)),this.on("change:pos change:parent_id",function(){this.depthFirst(function(e){e.trigger("ancestor_moved")})}.bind(this)),this.on("change:parent_id",function(){this.depthFirst(function(e){e.trigger("path_changed")});var e=this.collection.get(this.previous("parent_id")),t=this.parent();t&&t.trigger("child_added",this),e&&e.trigger("child_removed",this)}.bind(this)),this.on("child_added",function(e){if(!e)throw new Error("child_added event is missing target child");this._children[e.id]=e,this.has_children+=1}.bind(this)),this.on("child_removed",function(e){if(!e)throw new Error("child_removed event is missing target child");this._children[e.id]=void 0,this.has_children-=1}.bind(this)),this.on("remove",function(){var e=this.parent();e&&e.collection&&e.trigger("child_removed",this)}.bind(this)),this.on("destroy",function(){this.children().map(function(e){e.destroy()})}.bind(this)),this.on("change:text",function(){var e=this.get("text");e&&e.length>g.MAX_TEXT_LENGTH&&this.set("text",e.slice(0,g.MAX_TEXT_LENGTH)),this._normalised_text=null}.bind(this))},set:function(){this.local_timestamp=new Date,o.Model.prototype.set.apply(this,arguments)},shortId:function(){return this.id.substr(0,6)},stillExists:function(){return!!this.collection&&!!this.collection.get(this.id)},isRoot:function(){return"root parent"===this.get("parent_id")},isTitle:function(){return!(!this.isRoot()||!(this.collection&&1===this.collection.getRoots().length||this.get("title")))},isOnlyRoot:function(){return this.isRoot()&&this.collection&&1===this.collection.getRoots().length},rootIdx:function(){return this.collection?this.collection.getRoots().indexOf(this):-1},parent:function(){if(!this.collection)return console.error("no collection",this);var e=this.get("parent_id");return"root parent"==e?null:this.collection.get(e)},isDescendedFrom:function(e){var t=this.parent();return this===e||t&&t.isDescendedFrom(e)},isLoopedWith:function(e){return!!this.isDescendedFrom(e)||-1!==this.allChildren().indexOf(e)},reparentTo:function(e,t){if(!this.isTitle()){var n=this.parent()&&this.parent().textSize()||l.Root_Parent_Text_Size;if(e){if(this.id==e.id)return;var i=this.parent();if(i&&i.id==e.id)return;if(e.isDescendedFrom(this))return console.error("cannot reparent to a descendant");this.set("parent_id",e.id)}else{if(!this.parent())return;this.set("parent_id","root parent")}var o=this.parent()&&this.parent().textSize()||l.Root_Parent_Text_Size,r=o/n;if(t&&Math.abs(r-1)>.01){var s=function(e){e.get("shape")||(e.children().forEach(function(e){s(e)}),e.set("text_size",e.textSize()*r),e!==this&&this._children_needing_deltarizing.push(e))}.bind(this);s(this)}}},setJoinedNode:function(e){e&&e.id&&this.set("join",e.id)},joinedNode:function(){if(this.stillExists()){var e=this.collection.get(this.get("join"));return e?e.destroyed?void 0:e:void 0}},level:function(){return this.pathToRoot().length-1},pathToRoot:function(){if(!this.parent())return[this];if(!this._path_to_root){var e=this.parent().pathToRoot().slice(0);e.push(this),this._path_to_root=e}return this._path_to_root},children:function(){return this.stillExists()&&this._children?i.compact(i.values(this._children)):[]},hasChildren:function(){return!!this.has_children},allChildren:function(){var e=[],t=[],n=function(o){o.children().map(function(t){e=i.union(e,[t]),n(t)});var r=o.joinedNode();r&&-1===t.indexOf(r)&&(t=i.union(t,[r]),n(r))};return n(this),i.union(e,t)},addChild:function(e){e.node_id||(e.node_id=g.newNodeId()),e||(e={}),e.pos||(e.pos={x:50,y:50}),e.colour||(e.colour=this.colour()),e.parent_id=this.id,e.control_points&&e.control_points.length&&(e.control_points=i.indexBy(e.control_points,"n"));var t=this.collection.add(e);return this.trigger("child_added",t),t},text:function(){var e=this.get("text");return e&&0!==e.trim().length?e:""},normalisedText:function(){if(null===this._normalised_text){var e=r(this.text(),{renderer:new r.PlaintextRenderer}),t=i.filter(i.map(e.split(/[\s_#[\]()&.,;:!<>-]/,20),function(e){return e.replace(/'/g,"").toLowerCase()}),function(e){return e.length});this._normalised_text=t?t.join("-"):""}return this._normalised_text},width:function(){return this.get("width")},textSize:function(){return this.get("text_size")||l.textSizeForLevel(this.level())*this._scale()},textSizeForChild:function(){for(var e=this.textSize(),t=0;t<f.length;t++)if(e>f[t])return f[t];return e},_scale:function(){var e=this.get("scale");return void 0!==e&&null!==e||(e=1),e},scale:function(){return console.error("scale() is deprecated"),this._scale()},colour:function(){var e=this.get("colour");return e?e&&"#"!=e.slice(0,1)?"#"+e:e:"#b4b4b4"},setColour:function(e,t){/^#?[0-9a-f]{6}$/i.exec(e)||(console.error("invalid colour "+e),e="b4b4b4"),this.set("colour",e),t&&this.children().map(function(n){n.setColour(e,t)})},lineWeight:function(){var e=this.get("line_weight");if(e)return e;var t=(18*Math.pow(.91,this.level())+2)/2;return Math.max(2,t)},setLineWeight:function(e,t){this.set("line_weight",e),t&&this.children().map(function(n){n.setLineWeight(e,t)})},sortedControlPoints:function(){var e=this.controlPoints();return i.sortBy(e,function(e){return parseFloat("0."+e.n)})},controlPoints:function(){for(var e=this.get("control_points"),t=i.keys(e),n=new Array(t.length),o=0;o<t.length;o++)n[o]={n:t[o],x:e[t[o]].x,y:e[t[o]].y};return n},setCP:function(e,t){var n=parseFloat(t.x),o=parseFloat(t.y);if(isNaN(n)||isNaN(o))throw new Error("CP properties must be numbers");if("string"!=typeof e||!s.validID(e))throw new Error("Invalid CPID");var r=i.clone(this.get("control_points"));r[e]={x:t.x,y:t.y},this.set("control_points",r)},removeCP:function(e){var t=i.clone(this.get("control_points"));delete t[e],this.set("control_points",t)},lastCP:function(e){return p(e||this.get("control_points"))},hasCP:function(){var e=this.get("control_points");return e&&!!Object.keys(e).length},addAttachment:function(e,t){var n=this.attachments();n[e]=t,this.set("attachments",n)},removeAttachment:function(e){var t=this.attachments();delete t[e],this.set("attachments",t)},attachments:function(){return i.clone(this.get("attachments")||{})},attachmentIds:function(){var e=this.get("attachments");return e?Object.keys(e):[]},getAttachment:function(e){return i.clone(this.get("attachments")[e])},shape:function(){return this.get("shape")||(this.isRoot()?"root":null)},lineShape:function(){return this.get("line_shape")||"smooth"},setLineShape:function(e,t){this.set("line_shape",e),t&&this.children().map(function(n){n.setLineShape(e,t)})},lineStyle:function(){return this.get("line_style")||"solid"},setLineStyle:function(e,t){this.set("line_style",e),t&&this.children().map(function(n){n.setLineStyle(e,t)})},textAlignment:function(){return this.get("text_alignment")||null},pos:function(){return this.get("pos")||{x:10,y:10}},absolutePosition:function(){return{x:this.x(),y:this.y()}},x:function(){if(!this._x){var e=this.parent();this._x=e?this.relX()+e.x():this.relX()}return this._x},y:function(){if(!this._y){var e=this.parent();this._y=e?this.relY()+e.y():this.relY()}return this._y},relX:function(){return this.pos().x},relY:function(){return this.pos().y},ltr:function(e,t){if(!(void 0!==t?t:this.parent()))return 1;var n=this.lastCP(),i=void 0!==e?e:this.relX();return n?i<n.x?-1:1:i<0?-1:1},ttb:function(e){var t=this.parent();if(!e&&!t)return 1;var n;if(e)n=e.y();else{var i=this.lastCP();n=i?t.y()+i.y:t.y()}return 2*(this.y()>1+n)-1},distanceTo:function(e,t){return Math.sqrt((this.x()-e)*(this.x()-e)+(this.y()-t)*(this.y()-t))},flipChildrenUntilShape:function(){this._child_flips+=1;var e=function(t,n){t.shape()||t.children().forEach(function(t){e(t,!0)});var o=t.pos();if(t.set("pos",{x:-o.x,y:o.y}),n){var r=i.mapObject(t.get("control_points"),function(e){return{x:-e.x,y:e.y}});t.set("control_points",r)}this._children_needing_deltarizing.push(t)}.bind(this);this.children().forEach(function(t){e(t,!0)})},positionAbsolutely:function(e,t,n){var o,r,s;this.isRoot()?(o=e,r=t):(s=this.parent())&&(o=e-s.x(),r=t-s.y()),o=Math.round(o),r=Math.round(r),n||this.shape()||this.ltr()===this.ltr(o)||this.flipChildrenUntilShape();var l=this.get("pos"),a=o-l.x,u=r-l.y;if(this.set("pos",{x:o,y:r}),window._join_move_averageing&&this.children().forEach(function(e){var t=this.collection.joinedFrom(e).length,n=e.joinedNode();t>0?(e.positionAbsolutely(e.x()-a*t/(1+t),e.y()-u*t/(1+t)),this._children_needing_deltarizing.push(e)):n&&(t=this.collection.joinedFrom(n).length,n.positionAbsolutely(n.x()+a/(1+t),n.y()+u/(1+t)),this._children_needing_deltarizing.push(n))}.bind(this)),window._joins_stationary){var d=function(e){var t=this.collection.joinedFrom(e);if(t.length){i.every(t,function(e){return e.isDescendedFrom(this)}.bind(this))||(e.positionAbsolutely(e.x()-a,e.y()-u),this._children_needing_deltarizing.push(e))}else e.children().forEach(d)}.bind(this);this.children().forEach(d)}},hidden:function(){return this.get("hidden")},collapseAllChildren:function(e){void 0===e&&(e=!0),this.children().map(function(t){t.set("hidden",!0),e&&t.collapseAllChildren(e)}.bind(this))},expandAllChildren:function(e){void 0===e&&(e=!1),this.children().map(function(t){t.set("hidden",!1),e&&t.expandAllChildren(e)}.bind(this))},depthFirst:function(e){e(this);for(var t=this.children(),n=t.length,i=0;i<n;i++)t[i].depthFirst(e)},url:function(){return""},save:function(){console.error("save should not be called on node")},sync:function(){},deltarize:function(e){var t=this._children_needing_deltarizing;if(this._children_needing_deltarizing=[],t.forEach(function(e){e.deltarize()}),!this.last_sync_state)throw"Expected last_sync_state to be set already!";var n=i.clone(this.last_sync_state);e||(e=i.clone(this.attributes)),e=i.omit(e,function(e,t){return i.isEqual(e,n[t])}),this.set(e);var o=i.omit(n,function(t,n){return!h.call(e,n)});0!==i.values(e).length&&this.trigger("delta",this,e,o),e.parent_id&&("root parent"!==e.parent_id&&"root parent"===this.last_sync_state.parent_id?getCoggleUser().getActions().unique("node:attach"):"root parent"===e.parent_id&&"root parent"!==this.last_sync_state.parent_id&&getCoggleUser().getActions().unique("node:detach")),i.extend(this.last_sync_state,e)},matchesLink:function(e,t){return!(e.length<1)&&(0===this.id.toLowerCase().indexOf(e.toLowerCase())||!t&&0===this.normalisedText().indexOf(e.toLowerCase()))},extractLocalLinks:function(){var e=new r.HrefCollector;r(this.text(),{renderer:e});var t=[];return e.hrefs.forEach(function(e){e&&0===e.indexOf("#")&&t.push(e.slice(0))}),t},linksTo:function(){var e=this.extractLocalLinks(),t={};return e.map(function(e){if(this.collection){var n=this.collection.matchingLink(e);n&&(t[e]=n)}}.bind(this)),t},serialise:function(){var e=this.toJSON();return delete e.tagged,delete e.hidden,delete e.highlight,delete e.action_ts,delete e.owner_id,delete e.parent_id,delete e.title,e.root=this.isRoot(),e.text_size=this.textSize(),delete e.scale,e.children=this.children().map(function(e){return e.serialise()}),e},closest:function(e){function t(t){return t!=n&&(!e||e(t))}if(!this.collection)return null;var n=this;return this.collection.closest(this.x(),this.y(),t)},isInRegion:function(e){return this.x()>e.left&&this.x()<e.right&&this.y()>e.top&&this.y()<e.bottom},textColour:function(){var e=this.colour(),t=this.shape();return e=t&&"label"!==t&&("root"!==t||!this.isRoot()||this.isTitle()||this.hasChildren())?a.luminance(e)<.5?"#ffffff":a.darken(e,1.6):a.darken(e)},hAnchor:function(){return this.shape()?"center":this.hasChildren()?this.ltr()>0?"right":"left":this.ltr()>0?"left":"right"},vAnchor:function(){return this.shape()||!this.hasChildren()?"center":this.ttb()>0?"top":"bottom"},destroy:function(){return this.destroyed=!0,o.Model.prototype.destroy.call(this)}});g.newNodeId=function(){return u(24)};var m=["patch","node edited","root edited","node painted","node resized","node scaled","node moved","node reparented"],v=function(e){if("node reparented"==e.type?(e.data.parent_id=e.data.new_parent_id,e.old_data||(e.old_data={parent_id:e.data.old_parent_id}),delete e.data.new_parent_id,delete e.data.old_parent_id):"root node added"===e.type&&(e.data.parent_id="root parent"),e.data.old){e.old_data||(e.old_data={});for(var t in e.data.old)h.call(e.data,t)&&(e.old_data[t]=e.data.old[t]);delete e.data.old}},y=function(e){return e.id+"_join_events"},b=function(e,t){t.off(void 0,void 0,y(e)),e.off(void 0,void 0,y(e))},w=function(e){i.bindAll(this,"onJoinChanged","onAdd","onRm"),this._joins_from={},this._joins_to={},this._collection=e,e.once("loaded",function(){e.on("change:join",this.onJoinChanged),e.on("remove",this.onRm),e.on("add",this.onAdd),e.each(this.onJoinChanged)}.bind(this)),e.on("reset",function(){this._joins_from={},this._joins_to={},e.each(this.onJoinChanged)}.bind(this))};w.prototype.onAdd=function(e){this.onJoinChanged(e),h.call(this._joins_from,e.id)&&this._joins_from[e.id].forEach(function(e){var t=this._collection.get(e);t&&this.onJoinChanged(t)}.bind(this))},w.prototype.onRm=function(e){this.onJoinChanged(e),h.call(this._joins_to,e.id)&&(this._joins_from[this._joins_to[e.id]]=i.without(this._joins_from[this._joins_to[e.id]],e.id),delete this._joins_to[e.id])},w.prototype.onJoinChanged=function(e){var t=e.get("join");t?h.call(this._joins_from,t)?(h.call(this._joins_to,e.id)&&(this._joins_from[this._joins_to[e.id]]=i.without(this._joins_from[this._joins_to[e.id]],e.id)),this._joins_from[t].push(e.id),this._joins_to[e.id]=e.get("join")):(this._joins_from[t]=[e.id],this._joins_to[e.id]=e.get("join")):h.call(this._joins_to,e.id)&&(this._joins_from[this._joins_to[e.id]]=i.without(this._joins_from[this._joins_to[e.id]],e.id),delete this._joins_to[e.id]);var n=e.joinedNode();if(n){var o=0,r=function(){o+=1;var t=e.joinedNode();t&&t.id!==e.get("parent_id")&&t.get("parent_id")!==e.id&&(o>2||(e.positionAbsolutely(t.x(),t.y(),!0),o-=1))};e.on("ancestor_moved path_changed",r,y(e)),n.on("ancestor_moved path_changed change:pos",r,y(e)),r();var s=function(){b(e,n)}
;n.once("destroy",s,y(e)),e.once("destroy change:join",s,y(e))}},w.prototype.joinedFrom=function(e){return h.call(this._joins_from,e)?this._joins_from[e]:[]};var _=o.Collection.extend({model:g,initialize:function(){this._join_tracking=new w(this),this.on("change",function(e){var t=e.changedAttributes();(h.call(t,"control_points")||h.call(t,"shape")||h.call(t,"text")||h.call(t,"width")||h.call(t,"text_size")||h.call(t,"scale"))&&this.joinedFrom(e).forEach(function(e){e.trigger("joinedchange",e)})}.bind(this)),this.on("destroy",function(e){this.joinedFrom(e).forEach(function(e){e.trigger("joinedchange",e)})}.bind(this)),this.on("add",function(e){this.joinedFrom(e).forEach(function(e){e.trigger("joinedchange",e)})}.bind(this))},getRoots:function(){var e=this.where({parent_id:"root parent"});return e.sort(function(e,t){return new Date(e.get("action_ts")).getTime()-new Date(t.get("action_ts")).getTime()}),e},addRoot:function(e){e.node_id||(e.node_id=g.newNodeId()),e||(e={}),e.pos||(e.pos={x:50,y:50}),e.colour||(e.colour="#b4b4b4"),e.parent_id="root parent";var t=this.add(e);return this.trigger("node_added",t),t},onDelta:function(e,t){return-1!==m.indexOf(e.type)&&v(e),h.call(e,"version")&&1!=e.version?2==e.version?this.onDeltaV2(e):void this.trigger("must-update"):void console.error("unsupported deltaversion "+e.version)},onDeltaV2:function(e){if(!e.node_id)return console.error("delta missing node_id",e);"node removed"==e.type?this.onNodeRemovedV2(e):"node added"==e.type||"root node added"==e.type?this.onNodeAddedV2(e):"patch"==e.type&&this.onPatch(e)},onNodeRemovedV2:function(e){var t=this.get(e.node_id);if(!t)return console.warn("tried to remove non-existent node",e);t.destroy()},onNodeAddedV2:function(e){var t=this.get(e.node_id);if(t)return console.error("will not add node "+e.node_id+": already exists");if(e.data&&e.data.parent_id||(console.error("node "+e.node_id+" is misssing parent ID",e),e.data.parent_id="root parent",!(Date.now()<c))){e.data.pos||(e.data.pos={x:0,y:0}),"number"!=typeof e.data.pos.x&&(e.data.pos.x=0),"number"!=typeof e.data.pos.y&&(e.data.pos.y=0);var n;"root node added"!==e.type&&e.data&&e.data.parent_id&&"root parent"!=e.data.parent_id&&!(n=this.get(e.data.parent_id))&&(e.data.parent_id="root parent",console.warn("parent (",e.data.parent_id,") doesn't exist for node",e.node_id),Date.now()<c)||(t=new g(i.extend({},e.data,{node_id:e.node_id,action_ts:e.action_ts,owner_id:e.owner_id,hidden:n&&n.hidden(),highlight:null})),this.add(t),n&&n.trigger("child_added",t))}},onPatch:function(e){var t=this.get(e.node_id);if(!t)return console.warn("node doesn't exist",e);if(e.data.parent_id){var n=!1;if("root parent"!==e.data.parent_id){var i=this.get(e.data.parent_id);if(!i)return console.warn("new parent doesn't exist",e);n=i.hidden()}var o=t.parent();o&&o.id==e.data.parent_id||(t.set("parent_id",e.data.parent_id),n?(t.set("hidden",!0),t.collapseAllChildren(!0)):t.hidden()&&(t.set("hidden",!1),t.expandAllChildren(!0)))}t.set(e.data),e.action_ts&&t.set("action_ts",e.action_ts),e.owner_id&&t.set("owner_id",e.owner_id)},closest:function(e,t,n,i){var o=null,r=null,s=function(n){var i=n.x(),o=n.y();return(i-e)*(i-e)+(o-t)*(o-t)};return this.each(function(e){n&&!n(e)||(null===r||s(e)<r)&&(o=e,r=s(e))}),void 0===i||r<i*i?o:null},matchingLink:function(e){return e&&0===e.indexOf("#")&&(e=e.slice(1)),this.find(function(t){return t.matchesLink(e)})},matchingSearch:function(e){if(e){var t=e.toLowerCase().split(/\s/);return this.find(function(e){for(var n=e.text().toLowerCase(),i=0;i<t.length;i++)if(-1===n.indexOf(t[i]))return!1;return!0})}},nonEmpty:function(){return this.filter(function(e){return e.text().length>0})},joinedFrom:function(e){return i.compact(this._join_tracking.joinedFrom(e.id).map(this.get.bind(this)))}});g.MAX_TEXT_LENGTH=4e3,n.exports.NodeModel=g,n.exports.NodeCollection=_}),define("models/Notification",["require","exports","module","underscore","backbone"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=o.Model.extend({idAttribute:"_id",parse:function(e){return e.tags=i.union(e.tags||[],r.extractTags(e.message)),e},messageAndTags:function(){var e=this.get("message"),t=r.extractTags(e);t.map(function(t){var n="#"+t;e=e.replace("<"+n+">",n),e=e.replace(n,"<"+n+">")});var n=i.difference(this.get("tags"),t),o=n.map(function(e){return" <#"+e+">"});return{message:e,searchText:o.join(""),tagsNotInText:n}},tagsNotInText:function(){}});r.extractTags=function(e){if(!e)return[];var t=i.compact(i.uniq(e.trim().split(" ")));return i.uniq(i.compact(i.map(t,function(e){return e=e.replace("<","").replace(">",""),0===e.lastIndexOf("#")&&e.length>1&&e.substr(1)})))};var s=o.Collection.extend({model:r,comparator:function(e){return new Date(e.get("timestamp")).getTime()},initialize:function(e,t){this.options=t},url:function(){return this.options.resource.url()+"/notifications"},endReached:!1,more:i.debounce(function(){if(this.endReached)return!1;return this.skip=this.length,this.fetch({data:{skip:this.skip,limit:500},merge:!0,remove:!1,add:!0,success:function(e,t){this.endReached=0===t.length,this.endReached&&this.trigger("ended")}.bind(this)}),!0},20,!0),withTags:function(e){return this.filter(function(t){var n=t.get("tags");return i.intersection(n,e).length>0})},lastNotifiction:function(){return this.at(this.length-1)},addWidget:function(e,t){t||(t={}),void 0===t.time&&(t.time=(new Date).toISOString());var n={_id:t.id,type:"widget",timestamp:t.time,view:e};t.id&&(n.id=t.id),this.add(new r(n))},addAttachment:function(e){var t={_id:e.get("local_id"),type:"attachment",timestamp:e.get("uploaded_at"),attachment:e,owner:e.get("uploaded_by")};this.add(new r(t))},usersTagged:function(e,t){if(!e||0===e.length)return null;var n=e.map(function(e){return e.get("name")});return this.create({tagged:i.pluck(e,"id"),type:"tag",message:getCoggleUser().get("given_name")+" tagged "+n.join(", ")+" in [an item](#"+t.shortId()+")"},{wait:!0})},poll:function(e){var t=this.lastNotifiction(),n=t?t.get("timestamp"):new Date;this.fetch({data:{from:n},wait:!0,add:!0,remove:!1,merge:!0,success:function(t,n){e&&e(!1,n)},error:function(){e&&e(!0)}})},loadAllNew:function(){this.poll(function(e,t){e||0!==t.length&&this.loadAllNew()}.bind(this))}});n.exports.NotificationModel=r,n.exports.NotificationCollection=s}),define("models/Activity",["require","exports","module","underscore","backbone"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=o.Model.extend({idAttribute:"session"}),s=o.Collection.extend({model:r,initialize:function(e,t){i.bindAll(this,"checkIdle"),this.acl=t.acl,this.nodes=t.nodes,this.listenTo(this.nodes,"add remove",function(e){var t=e.id;this.forEach(function(e){(e.get("object")||{}).id===t&&e.set({node_model:this.nodes.get(t)})}.bind(this))})},active:function(e){var t=this.get(e.session);e.ts=Date.now(),e.user_model=this.acl.get(e.user),e.object&&"node"===e.object.type?e.node_model=this.nodes.get(e.object.id):e.node_model=null,t?t.set(e):this.add(new r(e)),setTimeout(this.checkIdle,35e3)},idle:function(e){this.remove(e.session)},checkIdle:function(){var e=Date.now(),t=[];this.each(function(n){e-n.get("ts")>=35e3&&t.push(n)}.bind(this)),t.forEach(function(e){this.remove(e)}.bind(this))}});n.exports.ActivityCollection=s}),define("models/Diagram",["require","exports","module","backbone","async","backbone.fetchOrQueue","models/Access","models/Invite","models/PrivateLink","models/Delta","models/Attachment","models/Node","models/Notification","models/Activity","utils/marked","utils/queryString","env","env","env","env","env","env","env"],function(e,t,n){var i=e("backbone"),o=e("async");e("backbone.fetchOrQueue");var r=e("models/Access").AccessCollection,s=e("models/Invite").InviteCollection,l=e("models/PrivateLink").PrivateLinkCollection,a=e("models/Delta").DeltaCollection,u=e("models/Attachment").AttachmentCollection,d=e("models/Node").NodeCollection,c=e("models/Notification").NotificationCollection,h=e("models/Activity").ActivityCollection,p=e("utils/marked"),f=e("utils/queryString"),g=function(e,t,n){return new Error(e&&e.responseJSON&&e.responseJSON.description||e&&e.status&&e.statusText||"request failed")},m=i.Model.extend({idAttribute:"short_id",initialize:function(e,t){t.cidIsId&&(this.idAttribute="_cid"),this.options=t,this._waiting_for_attachments=[]},urlRoot:e("env").api.url+"/api/1/diagrams",docURL:function(){return"/diagram/"+this.get("short_id")},url:function(){var e=this.options.token?"/"+this.options.token:"";return i.Model.prototype.url.apply(this)+e},attachmentsURL:function(){var t=e("env").api.url+"/api/1/diagrams/"+this.id+"/attachments";return f().access_token?t+="?access_token="+f().access_token:this.options.token&&(t+="?token="+this.options.token),t},socketUrl:function(){if(!this.get("short_id"))throw new Error("not synced: no id available to connect socket");var t=this.options.token?"/"+this.options.token:"",n=e("env").sockets.url,i=n+"/services/sockets/api/1/diagrams/"+this.get("short_id")+t+"/changes?version="+Coggle_JS_Version,o=this.getDeltas().lastDeltaWithServerId();return o?i+"&from="+o.get("_id")+"&from_date="+o.get("action_ts"):i},lastSavedModified:function(){var e=Date.parse(this.get("timestamp")),t=Date.parse(this.get("last_modified")),n=t,i=this.getDeltas().lastDeltaWithServerId();return i&&(n=Date.parse(i.get("action_ts"))),new Date(Math.max(e,t,n))},setToken:function(e){this.options||(this.options={}),this.options.token=e,this.deltas&&(this.deltas.url=this.url()+"/changes"),this.attachments&&(this.attachments.url=this.attachmentsURL())},version:function(){return parseInt(this.get("version")||1)},cleanTitle:function(){return p(this.get("title"),{renderer:new p.PlaintextRenderer})},isModified:function(){var e=new Date(this.get("last_modified")),t=new Date(this.get("last_viewed"));return e.getTime()>t.getTime()},accessViaToken:function(){return!!this.options.token},subscribe:function(){this.save({subscribed:!0}),getCoggleUser().getActions().perform("emails:transactional:subscribe")},unsubscribe:function(){this.save({subscribed:!1}),getCoggleUser().getActions().perform("emails:transactional:unsubscribe")},getAccess:function(e){return this.accessCollection||(this.accessCollection=new r([],{resource:this})),this.accessCollection.fetchOrQueue(e)},canList:function(){return this.get("my_access")&&-1!==this.get("my_access").indexOf("list")},canRead:function(){return this.get("my_access")&&-1!==this.get("my_access").indexOf("read")},canClone:function(){return this.get("my_access")&&-1!==this.get("my_access").indexOf("clone")},canShare:function(){return this.get("my_access")&&-1!==this.get("my_access").indexOf("share")},canWrite:function(){return this.get("my_access")&&-1!==this.get("my_access").indexOf("write")},accessIsEphemeral:function(){return this.get("ephemeral_access")&&-1!==this.get("ephemeral_access").indexOf("read")},isAwesome:function(){return console.error("diagram.isAwesome is deprecated, use diagram.myEditing instead"),this.get("editorsGetAwesome")},myEditing:function(){return this.get("my_editing")},getInvites:function(e){return this.inviteCollection||(this.inviteCollection=new s([],{resource:this})),this.inviteCollection.fetchOrQueue(e)},getPrivateLinks:function(e){return this.privateLinkCollection||(this.privateLinkCollection=new l([],{resource:this})),this.privateLinkCollection.fetchOrQueue(e)},getDeltas:function(){return this.deltas||(this.deltas=new a,this.deltas.url=this.url()+"/changes"),this.deltas},getNodes:function(){return this.nodes||(this.nodes=new d([])),this.nodes},getNotifications:function(){return this.notifications||(this.notifications=new c([],{resource:this})),this.notifications},getAttachments:function(e){return this.attachments||(this.attachments=new u([],{resource:this}),this.attachments.url=this.attachmentsURL()),this.attachments.fetchOrQueue(e)},getActivity:function(){return this.activity||(this.activity=new h([],{acl:this.getAccess(),nodes:this.getNodes()})),this.activity},waitForAttachment:function(e){this._waiting_for_attachments.push(e)},stopWaitingForAttachment:function(e){-1!==this._waiting_for_attachments.indexOf(e)&&(this._waiting_for_attachments.splice(this._waiting_for_attachments.indexOf(e),1),0===this._waiting_for_attachments.length&&this.trigger("all-attachments-loaded"))},attachmentsLoaded:function(){return this.attachments&&this.attachments.loaded},onAllAttachments:function(e){if(0===this._waiting_for_attachments.length)return e();this.once("all-attachments-loaded",e)},removeBookmark:function(e){if(!this.get("my_bookmark"))return e(null);$.ajax({url:"/api/1/bookmarks/"+this.get("my_bookmark")._id,type:"DELETE"}).fail(function(t,n,i){return e(g(t))}).done(function(){this.fetch().done(function(){return e(null)}.bind(this)).fail(function(t,n,i){return e(g(t))})}.bind(this))},setBookmark:function(e){var t={diagram:this.get("_id")};this.options.token&&(t.token=this.options.token),$.ajax({url:"/api/1/bookmarks",type:"POST",data:JSON.stringify(t),contentType:"application/json"}).fail(function(t,n,i){return e(g(t))}).done(function(){this.fetch().done(function(){return e(null,this.get("my_bookmark"))}.bind(this)).fail(function(t,n,i){return e(g(t))})}.bind(this))},resetState:function(){this.nodes&&(this.nodes.off(),this.nodes.stopListening(),this.nodes.reset([]),this.nodes=void 0),this.deltas&&(this.deltas.reset([]),this.deltas=void 0),this.notifications&&(this.notifications.reset([]),this.notifications=void 0),this.inviteCollection&&(this.inviteCollection=void 0),this.privateLinkCollection&&(this.privateLinkCollection=void 0),this.accessCollection&&(this.accessCollection=void 0),this.attachments&&(this.attachments=void 0),this.activity&&(this.activity.reset(),this.activity=void 0)}}),v=i.Collection.extend({model:m,comparator:function(e,t){var n=parseFloat(e.get("order")),i=parseFloat(t.get("order"));if(n>i)return-1;if(i>n)return 1;var o=e.get("last_modified"),r=t.get("last_modified");if(o&&r){if(o>r)return-1;if(o<r)return 1}return 0},fixDuplicateOrders:function(){var e=1e6;this.each(function(t){t.set("order",e),e-=20}),o.eachLimit(this.toArray(),3,function(e,t){if(!e.hasChanged())return t();e.save({},{success:function(){return t(null)},error:function(e,n){return t(n)},wait:!0})},function(e){console.log("completed re-order of diagrams with duplicate order",e)})},url:e("env").api.url+"/api/1/diagrams",makeClone:function(e,t){getCoggleUser().getActions().perform("diagram:clone"),ga("send","event","Clone","Current"),this.create({},{type:"post",url:this.url+"/"+e+"?clone[]=content&clone[]=folder&clone[]=title",wait:!0,success:t})}});v.getPublicGallery=function(t,n){return"function"==typeof t&&(n=t,t={}),this.public_gallery||(this.public_gallery=new v,this.public_gallery.url=e("env").api.url+"/api/1/gallery"),this.public_gallery.fetchOrQueue(n,t)},v.getPublicReviewCollection=function(t,n){if("function"==typeof t&&(n=t,t={}),!this.public_gallery_review){var i=v.extend({model:m.extend({urlRoot:e("env").api.url+"/api/1/gallery/review"}),url:e("env").api.url+"/api/1/gallery/review"});this.public_gallery_review=new i}return this.public_gallery_review.fetchOrQueue(n,t)},n.exports.DiagramModel=m,n.exports.DiagramCollection=v}),define("models/Folder",["require","exports","module","underscore","backbone","backbone.fetchOrQueue","models/Access","models/Invite","models/Diagram","env","env"],function(e,t,n){var i=e("underscore"),o=e("backbone");e("backbone.fetchOrQueue");var r=e("models/Access").AccessCollection,s=e("models/Invite").InviteCollection,l=e("models/Diagram").DiagramCollection,a=o.Model.extend({idAttribute:"_id",url:function(){return e("env").api.url+"/api/1/folders"+(this.id?"/"+this.id:"")},getDiagrams:function(e,t){if(!this.diagrams){var n={};"recent"===this.id&&(n.comparator=!1),this.diagrams=new l([],n)}return t||(t={}),t.data||(t.data={}),t.data.folder=this.id,this.diagrams.fetchOrQueue(e,t)},getAccess:function(e){return this.accessCollection||(this.accessCollection=new r([],{resource:this})),this.accessCollection.fetchOrQueue(e)},getInvites:function(e){return this.inviteCollection||(this.inviteCollection=new s([],{resource:this})),this.inviteCollection.fetchOrQueue(e)},getFolders:function(e){return this.folders||(this.folders=new u([])),this.folders.fetchOrQueue(e,{data:{folder:this.id}})},createDiagram:function(e){var t=i.max(this.getDiagrams().pluck("order")),n=getCoggleUser().reachedPrivateLimit();getCoggleUser().getActiveOrg().id&&(n=!1),this.getDiagrams().create({folder:this.isShared()?"root":this.id,order:t+1,public:n},{wait:!0,success:function(t){var n=t.get("public");return setTimeout(function(){getCoggleUser().getActions().perform("created-diagram"),getCoggleUser().getActions().perform("diagram:created:"+(n?"public":"private"))},1e3),ga("send","event","CreateDiagram","Create",n?"Public":"Private"),e(!1,t)},error:function(t){return e(!0)}})},isVirtual:function(){return this.isShared()||this.isRoot()||this.get("virtual")},isShared:function(){return"shared"==this.id},isRoot:function(){return"root"==this.id},canRead:function(){return this.get("my_access")&&-1!==this.get("my_access").indexOf("read")},canWrite:function(){return this.get("my_access")&&-1!==this.get("my_access").indexOf("write")},isAdmin:function(){return this.get("my_access")&&-1!==this.get("my_access").indexOf("admin")}}),u=o.Collection.extend({model:a,initialize:function(){},comparator:function(e,t){return e.isRoot()?-1:t.isRoot()?1:e.isVirtual()&&!t.isVirtual()?-1:t.isVirtual()&&!e.isVirtual()?1:e.get("order")&&(void 0===t.get("order")||e.get("order")<t.get("order"))?-1:t.get("order")&&(void 0===e.get("order")||t.get("order")<e.get("order"))?1:(e=e.get("name"),t=t.get("name"),void 0===e?-1:void 0===t?1:e.localeCompare(t))},url:e("env").api.url+"/api/1/folders",createFolder:function(e){var t=this.create({},{wait:!0,success:function(n,i){ga("send","event","Folder","Create"),e(!1,t)},error:function(){e(!0)}})}});n.exports.FolderModel=a,n.exports.FolderCollection=u}),define("models/Customer",["require","exports","module","backbone","env"],function(e,t,n){var i=e("backbone"),o=i.Model.extend({idAttribute:"id",url:function(){return e("env").api.url+"/api/1/me/customer"}});n.exports=o}),define("models/CheckoutSession",["require","exports","module","env","backbone","env"],function(e,t,n){var i=null,o=!1,r=[],s=window.location;if(-1===s.search.indexOf("print=1")&&!window.Coggle_App_Main){o=!0;var l=s.pathname.startsWith&&s.pathname.startsWith("/diagram/");setTimeout(function(){var t=document.createElement("script");t.setAttribute("src","https://js.stripe.com/v3/"),t.onload=function(){i=Stripe(e("env").stripe.publishable_key),r.forEach(function(e){e()}),r=[]},t.onerror=function(){o=!1,r.forEach(function(e){e()}),r=[]};var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n)},l?8e3:0)}var a=e("backbone"),u=a.Model.extend({idAttribute:"id",url:function(){return e("env").api.url+"/api/1/me/checkout"},redirectImmediately:function(e){if(!i)return e(new Error("Stripe is not loaded: are you online?"));this.save({},{success:function(t){i.redirectToCheckout({sessionId:t.id}).then(function(t){t.error?e(new Error(t.error.message)):e()})},error:function(t,n){e(new Error(n&&n.responseJSON&&n.responseJSON.description||"Sorry there was an error, are you online?"))}})},redirect:function(e){if(!o||i)return this.redirectImmediately(e);r.push(function(){this.redirectImmediately(e)}.bind(this))}});n.exports=u}),define("models/Invoice",["require","exports","module","backbone","env","env"],function(e,t,n){var i=e("backbone"),o=i.Model.extend({idAttribute:"id",url:function(){return this.collection?this.collection().url()+"/"+this.id:e("env").api.url+"/api/1/me/invoices/"+this.id}}),r=i.Collection.extend({model:o,url:e("env").api.url+"/api/1/me/invoices"});n.exports.InvoiceModel=o,n.exports.InvoiceCollection=r}),define("models/Plans",["require","exports","module","backbone"],function(e,t,n){var i=e("backbone"),o=i.Model.extend({idAttribute:"plan",overduePaymentLink:function(e){$.getJSON(this.url()+"/paymentlink").done(function(t){e(null,t)}).fail(function(){e(new Error("request failed"))})}}),r=i.Collection.extend({model:o,initialize:function(e,t){this.url=function(){return t.resource.url()+"/plans"},this.options=t},switchTo:function(e,t){var n={wait:!0,success:function(){t(!1,this.getActivePlan())}.bind(this),error:function(e,n){var i=n.responseJSON||!0;t(i,this.getActivePlan())}.bind(this)},i=this.get(e);i?i.save({active:!0},n):i=this.create({plan:e,active:!0},n)},getActivePlan:function(){var e=this.find(function(e){return e.get("active")&&!e.get("ending")});return e||this.find(function(e){return e.get("active")&&e.get("ending")})}});n.exports.PlanModel=o,n.exports.PlansCollection=r}),define("models/Domain",["require","exports","module","backbone"],function(e,t,n){var i=e("backbone"),o=i.Model.extend({idAttribute:"id"}),r=i.Collection.extend({model:o});n.exports.DomainModel=o,n.exports.DomainCollection=r}),define("models/GuestMember",["require","exports","module","underscore","backbone"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=o.Model.extend({idAttribute:"_id"}),s=o.Collection.extend({model:r,comparator:"name",search:function(e){return e=e.toLowerCase(),this.filter(function(t){var n=i.union([t.get("name").toLowerCase(),t.get("email").toLowerCase()],t.get("name").toLowerCase().split(/[\s,]+/),t.get("email").toLowerCase().split(/[\s,@]+/));return i.any(n,function(t){return 0===t.indexOf(e)})})}});n.exports.GuestMember=r,n.exports.GuestMemberCollection=s}),define("models/Bookmark",["require","exports","module","backbone","backbone.fetchOrQueue","env"],function(e,t,n){var i=e("backbone");e("backbone.fetchOrQueue");var o=i.Model.extend({idAttribute:"_id"}),r=i.Collection.extend({model:o,url:e("env").api.url+"/api/1/bookmarks",initialize:function(){},comparator:function(e,t){var n=parseFloat(e.get("order")),i=parseFloat(t.get("order"));if(n>i)return-1;if(i>n)return 1;var o=e.id,r=t.id;if(o&&r){if(o>r)return-1;if(o<r)return 1}return 0}});n.exports.BookmarkModel=o,n.exports.BookmarkCollection=r}),define("models/Organisation",["require","exports","module","underscore","backbone","backbone.fetchOrQueue","models/Access","models/Invite","models/Folder","models/Diagram","models/Customer","models/CheckoutSession","models/Invoice","models/Plans","models/Domain","models/GuestMember","models/Attachment","models/Bookmark","env","env","env"],function(e,t,n){var i=e("underscore"),o=e("backbone");e("backbone.fetchOrQueue");var r=e("models/Access").AccessCollection,s=e("models/Invite").InviteCollection,l=e("models/Folder").FolderCollection,a=e("models/Diagram").DiagramCollection,u=e("models/Customer"),d=e("models/CheckoutSession"),c=e("models/Invoice").InvoiceCollection,h=e("models/Plans").PlansCollection,p=e("models/Domain").DomainCollection,f=e("models/GuestMember").GuestMemberCollection,g=e("models/Attachment").AttachmentCollection,m=e("models/Bookmark").BookmarkCollection,v=o.Model.extend({idAttribute:"_id",urlRoot:e("env").api.url+"/api/1/organisations",defaults:{slug:null,picture:null},getAccess:function(e){return this.accessCollection||(this.accessCollection=new r([],{resource:this})),this.accessCollection.fetchOrQueue(e)},getInvites:function(e){return this.inviteCollection||(this.inviteCollection=new s([],{resource:this})),this.inviteCollection.fetchOrQueue(e)},createCheckoutSession:function(e){var t=new d(e);return t.url=this.url()+"/checkout",t},getCustomer:function(e){if(this.id)return this.customer||(this.customer=new u,this.customer.url=this.url()+"/customer"),this.customer.fetchOrQueue(e)},getInvoices:function(e){if(this.id)return this.invoiceCollection||(this.invoiceCollection=new c,this.invoiceCollection.url=this.url()+"/invoices"),this.invoiceCollection.fetchOrQueue(e)},getPlans:function(e){return this.plansCollection||(this.plansCollection=new h(void 0,{resource:this})),this.plansCollection.fetchOrQueue(e)},setupIncomplete:function(){return this.get("setup_incomplete")},getDiagrams:function(e){return this.diagrams||(this.diagrams=new a([]),this.diagrams.url=this.url()+"/diagrams"),this.diagrams.fetchOrQueue(e)},getFolders:function(e){return this.folders||(this.folders=new l),this.folders.fetchOrQueue(e)},getBookmarks:function(e){return this.bookmarks||(this.bookmarks=new m),this.bookmarks.fetchOrQueue(e)},getAllAttachments:function(e){return this.allAttachments||(this.allAttachments=new g([],{resource:this}),this.allAttachments.url=this.url()+"/attachments"),this.allAttachments.fetchOrQueue(e)},allowsSharing:function(){return!this.id||this.get("allow_sharing")},getDomains:function(e){return this.domainCollection||(this.domainCollection=new p([]),this.domainCollection.url=this.url()+"/domains"),this.domainCollection.fetchOrQueue(e)},getGuestMembers:function(e){return this.guestMemberCollection||(this.guestMemberCollection=new f([]),this.guestMemberCollection.url=this.url()+"/guests"),this.guestMemberCollection.fetchOrQueue(e)},hasActivePlan:function(){return i.filter(this.get("plans"),function(e){return"organisation"===e.split("-")[0]||"organisation"===e.split("_")[0]||"organisation"===e.split(":")[0]}).length>0},hasActiveEnterprisePlan:function(){return-1!==this.get("plans").indexOf("organisation:enterprise")},canRead:function(){return this.get("my_access")&&-1!==this.get("my_access").indexOf("read")},canWrite:function(){return this.get("my_access")&&-1!==this.get("my_access").indexOf("write")},isAdmin:function(){return this.get("my_access")&&-1!==this.get("my_access").indexOf("admin")},search:function(t){var n=new a([]);return n.url=e("env").api.url+"/api/1/search",n.fetch({data:{query:t},error:function(e,t){n.trigger("search-failed",t)}.bind(this)}),n},findDiagramById:function(e){var t=null,n=function(t){return t.get("_id")==e||t.get("short_id")==e};return this.getFolders().each(function(e){t||(t=e.diagrams&&e.diagrams.find(n))}),t},hasSamlConfig:function(){return(this.get("sso")||{}).configured},loginUrl:function(){return this.hasSamlConfig()?"/auth/saml/"+this.get("slug"):"/auth/google?redirectTo="+encodeURIComponent("/"+this.get("slug"))}}),y=o.Collection.extend({model:v,url:e("env").api.url+"/api/1/organisations",forSlug:function(e){return e?this.findWhere({slug:e.toLowerCase()}):null},comparator:function(e,t){return e=e.get("name"),t=t.get("name"),void 0===e?-1:void 0===t?1:e.localeCompare(t)}});n.exports.OrganisationModel=v,n.exports.OrganisationCollection=y}),define("utils/cogglitude",["require","exports","module"],function(e,t,n){var i=[],o={},r=null,s=null;o.onAmplitude=function(e){if(r||s)return e(r,s);i.push(e)};var l=function(e,t){r=e,s=t;for(var n=0;n<i.length;n++)"function"==typeof i[n]&&i[n](e,t);i=[]};if(-1!==window.location.search.indexOf("print=1"))l(new Error("print"));else if(window.Coggle_App_Main)l(new Error("app"));else try{requirejs.config({paths:{amplitude:"https://cdn.amplitude.com/libs/amplitude-4.4.0-min.gz"},shim:{amplitude:{exports:"amplitude"}}}),e(["amplitude"],function(e){e?(e.init("6bb159fba6bd913ded69ee8586109b94",void 0,{includeUtm:!0,includeReferrer:!0,trackingOptions:{ip_address:!1,dma:!1,city:!1}}),l(null,e)):l(new Error,null)},function(e){console.log(e),l(e||new Error,null)})}catch(e){console.log(e),l(e||new Error,null)}return o}),define("models/Action",["require","exports","module","underscore","backbone","utils/cogglitude","env"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=e("utils/cogglitude").onAmplitude,s=o.Model.extend({idAttribute:"id",parse:function(e){return e&&e.id?e:{id:e}}}),l=o.Collection.extend({url:e("env").api.url+"/api/1/me/actions",model:s,isProduction:function(){return"coggle.it"==window.location.hostname||"static.coggle.it"==window.location.hostname},unique:function(e,t){this.get(e)||this.perform(e,t)},perform:function(e,t){"print=1"!==window.location.search.substring(1,8)&&(getCoggleUser().isGuest()||this.create({id:e}),window._debug_actions&&console.log(e),this.logEventExternally(e,t))},logEventExternally:function(e,t){if(!this.isProduction())return void(console.debug&&console.debug("log event:",e,t));ga("send","event","CoggleAction",e),getCoggleUser().isGuest()||r(function(n,i){n||i&&(this.setExternalUserProperties({}),i.logEvent(e,t))}.bind(this))},setExternalUserProperties:function(e){var t=getCoggleUser();if(!t.isGuest()){var n=new Date(t.get("firstLogin")),o={allow_communication:t.get("allow_communication"),allow_transactional_communication:t.get("allow_transactional_communication"),google_drive:t.get("drive_user"),cohort_year:n.getFullYear()+"",cohort_month:n.getFullYear()+"-"+(n.getMonth()+1),is_awesome:t.isAwesome()?"true":"false",is_sso:t.get("org_only"),plans:t.get("plans")},s=i.extend(e,o);this.isProduction()?r(function(e,t){e||t&&(t.setUserId(getCoggleUser().id),t.setUserProperties(s))}):console.debug&&console.debug("update user properties:",s)}}});n.exports.ActionModel=s,n.exports.ActionCollection=l}),define("models/User",["require","exports","module","underscore","backbone","jquery","js-cookie","backbone.fetchOrQueue","models/Organisation","models/Organisation","models/Customer","models/Invoice","models/Plans","models/Action","utils/cogglitude","models/Attachment","env","env"],function(e,t,n){var i=Object.prototype.hasOwnProperty,o=e("underscore"),r=e("backbone");e("jquery");var s=e("js-cookie");e("backbone.fetchOrQueue");var l=e("models/Organisation").OrganisationModel,a=e("models/Organisation").OrganisationCollection,u=e("models/Customer"),d=e("models/Invoice").InvoiceCollection,c=e("models/Plans").PlansCollection,h=e("models/Action").ActionCollection,p=e("utils/cogglitude").onAmplitude,f=e("models/Attachment").AttachmentCollection,g=r.Model.extend({idAttribute:"_id",url:function(){return e("env").api.url+"/api/1/me"},attachmentsSupported:function(){return this.get("enable_attachments")||!!s.get("enable_attachments")},bookmarksSupported:function(){return this.get("enable_bookmarks")},isGuest:function(){return!this.id},experimentIndex:function(e){if(e||(e=""),this.id){for(var t=this.id+e,n=0,i=0;i<t.length;i++)n=31*n+t.charCodeAt(i),n|=0;return Math.abs(n)}return 0|Math.round(1e11*Math.random())},science:function(e,t){if(this._science_cache||(this._science_cache={}),i.call(this._science_cache,e))return this._science_cache[e];var n=this.experimentIndex(e),o=t[n%t.length];return this._science_cache[e]=o,p(function(t,n){"coggle.it"!=window.location.hostname&&"static.coggle.it"!=window.location.hostname||n&&n.getInstance().setGroup(e,o)}),o},getOrganisations:function(e){return this.organisationCollection||(this.organisationCollection=new a),this.organisationCollection.fetchOrQueue(e)},getCustomer:function(e){return this.customerModel||(this.customerModel=new u),this.customerModel.fetchOrQueue(e)},getInvoices:function(e){return this.invoiceCollection||(this.invoiceCollection=new d),this.invoiceCollection.fetchOrQueue(e)},getInvites:function(t){return this.inviteCollection||(this.inviteCollection=new r.Collection,this.inviteCollection.url=e("env").api.url+"/api/1/invites"),this.inviteCollection.fetchOrQueue(t)},getPlans:function(e){return this.plansCollection||(this.plansCollection=new c(void 0,{resource:this})),this.plansCollection.fetchOrQueue(e)},isSupporter:function(){return(this.get("plans")||[]).indexOf("supporter")>=0},isAwesome:function(){var e=this.get("plans")||[];return o.any(e,function(e){return 0===e.indexOf("awesome")})||this.isSupporter()},isOrgOrAwesome:function(){return this.isAwesome()||!!this.getActiveOrg().id},isTriallingAwesome:function(){return this.get("awesome_trial_expires")&&new Date(this.get("awesome_trial_expires")).getTime()>Date.now()},hasPrivatePlan:function(){var e=this.get("plans")||[];return this.isOrgOrAwesome()||e.indexOf("private")>=0},privateDiagramAllowance:function(){var e=this.get("limits");return e&&e.private_diagrams&&e.private_diagrams.available?e.private_diagrams.available:null},privateDiagramsUsed:function(){var e=this.get("limits")
;return e&&e.private_diagrams&&e.private_diagrams.used?e.private_diagrams.used:0},reachedPrivateLimit:function(){return null!==this.privateDiagramAllowance()&&(!this.getActiveOrg().id&&this.privateDiagramsUsed()>=this.privateDiagramAllowance())},getActions:function(e){return this.userActions||(this.userActions=new h),this.userActions.fetchOrQueue(e)},getAllAttachments:function(e){return this.allAttachments||(this.allAttachments=new f([],{resource:this}),this.allAttachments.url=this.url()+"/attachments"),this.allAttachments.fetchOrQueue(e)},setActiveOrg:function(e){e&&(this.activeOrg!=e||this.activeOrg&&this.activeOrg.id!==e.id)&&(this.activeOrg=e,this.trigger("organisation_changed",e))},getActiveOrg:function(){return this.activeOrg||this.getOwnOrg()},getOwnOrg:function(){return this.ownOrg||(this.ownOrg=new l),this.ownOrg},hasOwnOrg:function(){return!this.get("org_only")},isStaff:function(){return this.get("staff")},colour:function(){return this.get("colour")||"#bbb"},isOlderThan:function(e){return e=new Date(e),new Date(this.get("firstLogin")).getTime()<e.getTime()},menuExperiment:function(){return!1},paysForColours:function(){return!this.isOlderThan("2017-08-24T18:00:00.000Z")},referralTrialEligiblilityState:function(e){this.getInvites(function(t,n){if(t)return e(t);this.getActions(function(t,i){if(t)return e(t);var o=Math.max(3-n.length,0);this.isOrgOrAwesome()&&!this.isTriallingAwesome()&&(o=0);var r=n.length>=3;this.isOrgOrAwesome()&&!this.isTriallingAwesome()&&(r=!1),i.get("coupon:recommend-3")&&(r=!1),e(!1,r,n,o)}.bind(this))}.bind(this))}});g.me=function(){return g._user||(g._user=new g),g._user},window.getCoggleUser=function(){return g.me()},n.exports=g}),define("views/ErrorView",["require","exports","module","underscore","backbone"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=i.template("<div class='face'>⊙ ⊙<br/>﹏</div><div class='message'><%-message%></div><a href='<%- link %>' data-bypass class='button'>Reload</a>");n.exports=o.View.extend({tagName:"div",className:"error-screen",initialize:function(e){i.bindAll(this,"render"),this.options=e},render:function(){var e={link:this.options.link||window.location.href,message:this.options.message||"Uh-oh, something went wrong."};return $(this.el).html(r(e)),this}})}),define("views/UserLoginView",["require","exports","module","underscore","backbone","utils/queryString"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=e("utils/queryString"),s=o.View.extend({tagName:"div",className:"user-login",template:i.template("<div class='identity<%-(slug && userIsOrgAdmin)?' org-admin':''%>'><% if(org.length) { %><div class='org-name'><div class='org-icon' style='background-image:url(<%- org_icon %>); background-color: <%- org_colour %>;'></div><% if(userIsOrgAdmin) { %><a class='settings' onclick='return false;' href='/<%-slug%>/dashboard' data-l10n-id='org-settings' title='Manage Organisation'></a><span data-l10n-id='org-admin' data-l10n-args='{\"orgName\":\"<%-org%>\"}'>Administrator of <%-org%></span><% } else if(userIsOrgGuest) { %>Guest of <%-org%><% } else { %>Member of <%-org%><% } %></div><% } %><div class='user-identity'><a href='/me'><div class='user-icon' style='<% if (!printing) { %>background-image:url(<%- avatar.url %>); <% } %>background-color: <%- avatar.colour %>;'></div></a><div class='identity-lines'><div class='email'><%-emails[0]%></div><div class='name'><%-name%></div><% if(!org.length) { %><% if (limits && limits.private_diagrams) { %><div class='diagram-limit' data-l10n-id='diagrams-<%-limits.private_diagrams.available? '' : 'un' %>limited' data-l10n-args='{\"privateDiagrams_available\":<%-limits.private_diagrams.available || 0 %>, \"privateDiagrams_used\":\"<%- limits.private_diagrams.used %>\" }'><% if (limits.private_diagrams.available) { %><span class='count' data-l10n-name='count'><%- limits.private_diagrams.used %> of <%- limits.private_diagrams.available %></span> private diagrams used<% } else { %><span class='count' data-l10n-name='count'>Unlimited</span> private diagrams<% } %></div><% } %><% } %></div></div></div><div class='float-menu controls user-controls'><% if (!slug) { %><a class='float-menu-item settings' href='/me' data-l10n-id='my-settings'>My Settings & Billing</a><% } else { %><a class='float-menu-item settings' href='/me' data-l10n-id='my-settings-only'>My Settings</a><% } %><% if (has_google_login && !slug) { %><a class='float-menu-item google-drive' href='/auth/google/drive' data-bypass data-l10n-id='user-link-drive'>Link Google Drive</a><% } %><div class='float-menu-separator'/><a class='float-menu-item' href='/about' data-bypass data-l10n-id='user-about'>About Coggle</a><a class='float-menu-item' href='mailto:hello@coggle.it' data-bypass data-l10n-id='user-contact'>Contact Us</a><a class='float-menu-item' href='/privacy' data-bypass data-l10n-id='user-privacy'>Privacy Policy</a><a class='float-menu-item' href='/terms' data-bypass data-l10n-id='user-terms'>Terms and Conditions</a><div class='float-menu-separator'/><a class='float-menu-item logout' href='/logout' data-bypass onclick=\"ga('send', 'event', 'Login', 'Logout')\" data-l10n-id='logout' data-bypass>Logout</a></div>"),events:{"click .user-identity":"toggleOptions","click .org-admin .org-name":"openOrgSettings",mousedownoutside:"closeOptions"},initialize:function(e){i.bindAll(this,"render","setOrganisation","toggleOptions","closeOptions","openOrgSettings"),this.options=e,this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"organisation_changed",this.setOrganisation),this.setOrganisation(this.model.getActiveOrg())},openOrgSettings:function(e){if(this.organisation)return o.history.navigate("/"+this.organisation.get("slug")+"/dashboard",!0),e?(e.stopPropagation(),e.preventDefault(),!1):void 0},toggleOptions:function(){this.$el.toggleClass("user-open")},closeOptions:function(){this.$el.removeClass("user-open")},setOrganisation:function(e){this.organisation&&this.organisation.off("change",this.render),this.organisation=e,e&&this.listenTo(e,"change",this.render),this.render()},render:function(){var e=this.model.toJSON();e.printing=!!r().print,e.org="",e.slug=!1,e.has_google_login=!this.model.has("has_google_login")||this.model.get("has_google_login"),e.limits||(e.limits={}),e.limits.private_diagrams&&e.limits.private_diagrams.maxcount&&e.limits.private_diagrams.used===e.limits.private_diagrams.maxcount&&(e.limits.private_diagrams.used=">"+e.limits.private_diagrams.used);var t=this.organisation;return t&&t.id&&(e.org=t.get("name"),e.org_icon=t.get("picture"),e.org_colour=t.get("colour"),e.slug=t.get("slug"),e.userIsOrgGuest=!t.canRead(),e.userIsOrgAdmin=t&&t.get("my_access")&&-1!==t.get("my_access").indexOf("admin")),this.$el.html(this.template(e)),this}});n.exports=s}),define("views/BannerViews",["require","exports","module","underscore","backbone"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=i.template("<div data-l10n-id='<%-translation_id%>'<% if(type == 'error' || type == 'warning') { %> role='alert'<% } %>><%=message%></div>"),s=i.template("<div<% if(type == 'error' || type == 'warning') { %> role='alert'<% } %>><%=message%></div>"),l=o.View.extend({tagName:"li",className:"banner",events:{"click .close-handle":"close"},initialize:function(e){i.bindAll(this,"render","close"),this.options=e,this.listenToOnce(this.model,"remove",this.close),this.listenTo(this.model,"change",this.render),this.$el.attr("data-id",this.model.id)},close:function(){this.model.timeout(0),this.$el.remove()},render:function(){this.$el.empty(),!1!==this.model.get("active")?this.$el.show():this.$el.hide(),this.$el.addClass(this.model.get("type"));var e=this.model.toJSON();return this.model.id&&!e.translation_id&&(e.translation_id="banner-"+this.model.id),e.translation_id?this.$el.html(r(e)):this.$el.html(s(e)),this}}),a=o.View.extend({tagName:"ul",className:"banners",initialize:function(e){i.bindAll(this,"render","addOne","addAll"),this.options=e,this.listenTo(this.collection,"add change:active",this.addOne),this.listenTo(this.collection,"reset",this.addAll)},render:function(){return this.addAll(),this},addOne:function(e){if(this.$el.find(".banner[data-id='"+e.id+"']").remove(),e.get("active")){var t=new l({model:e});this.$el.append(t.render().$el),t.$el.attr("data-id",e.id)}var n=0;this.collection.forEach(function(e){e.get("active")&&(n+=1)}),n?this.$el.css({height:"30px"}):this.$el.css({height:"0"})},addAll:function(){this.$el.empty(),this.collection.each(this.addOne)}});n.exports.BannerView=l,n.exports.BannerStack=a}),function(e){"function"==typeof define&&define.amd?define("jquery-ui/version",["jquery"],e):e(jQuery)}(function(e){return e.ui=e.ui||{},e.ui.version="1.12.1"}),function(e){"function"==typeof define&&define.amd?define("jquery-ui/ie",["jquery","./version"],e):e(jQuery)}(function(e){return e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase())}),function(e){"function"==typeof define&&define.amd?define("jquery-ui/widget",["jquery","./version"],e):e(jQuery)}(function(e){var t=0,n=Array.prototype.slice;return e.cleanData=function(t){return function(n){var i,o,r;for(r=0;null!=(o=n[r]);r++)try{i=e._data(o,"events"),i&&i.remove&&e(o).triggerHandler("remove")}catch(e){}t(n)}}(e.cleanData),e.widget=function(t,n,i){var o,r,s,l={},a=t.split(".")[0];t=t.split(".")[1];var u=a+"-"+t;return i||(i=n,n=e.Widget),e.isArray(i)&&(i=e.extend.apply(null,[{}].concat(i))),e.expr[":"][u.toLowerCase()]=function(t){return!!e.data(t,u)},e[a]=e[a]||{},o=e[a][t],r=e[a][t]=function(e,t){if(!this._createWidget)return new r(e,t);arguments.length&&this._createWidget(e,t)},e.extend(r,o,{version:i.version,_proto:e.extend({},i),_childConstructors:[]}),s=new n,s.options=e.widget.extend({},s.options),e.each(i,function(t,i){if(!e.isFunction(i))return void(l[t]=i);l[t]=function(){function e(){return n.prototype[t].apply(this,arguments)}function o(e){return n.prototype[t].apply(this,e)}return function(){var t,n=this._super,r=this._superApply;return this._super=e,this._superApply=o,t=i.apply(this,arguments),this._super=n,this._superApply=r,t}}()}),r.prototype=e.widget.extend(s,{widgetEventPrefix:o?s.widgetEventPrefix||t:t},l,{constructor:r,namespace:a,widgetName:t,widgetFullName:u}),o?(e.each(o._childConstructors,function(t,n){var i=n.prototype;e.widget(i.namespace+"."+i.widgetName,r,n._proto)}),delete o._childConstructors):n._childConstructors.push(r),e.widget.bridge(t,r),r},e.widget.extend=function(t){for(var i,o,r=n.call(arguments,1),s=0,l=r.length;s<l;s++)for(i in r[s])o=r[s][i],r[s].hasOwnProperty(i)&&void 0!==o&&(e.isPlainObject(o)?t[i]=e.isPlainObject(t[i])?e.widget.extend({},t[i],o):e.widget.extend({},o):t[i]=o);return t},e.widget.bridge=function(t,i){var o=i.prototype.widgetFullName||t;e.fn[t]=function(r){var s="string"==typeof r,l=n.call(arguments,1),a=this;return s?this.length||"instance"!==r?this.each(function(){var n,i=e.data(this,o);return"instance"===r?(a=i,!1):i?e.isFunction(i[r])&&"_"!==r.charAt(0)?(n=i[r].apply(i,l),n!==i&&void 0!==n?(a=n&&n.jquery?a.pushStack(n.get()):n,!1):void 0):e.error("no such method '"+r+"' for "+t+" widget instance"):e.error("cannot call methods on "+t+" prior to initialization; attempted to call method '"+r+"'")}):a=void 0:(l.length&&(r=e.widget.extend.apply(null,[r].concat(l))),this.each(function(){var t=e.data(this,o);t?(t.option(r||{}),t._init&&t._init()):e.data(this,o,new i(r,this))})),a}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(n,i){i=e(i||this.defaultElement||this)[0],this.element=e(i),this.uuid=t++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=e(),this.hoverable=e(),this.focusable=e(),this.classesElementLookup={},i!==this&&(e.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===i&&this.destroy()}}),this.document=e(i.style?i.ownerDocument:i.document||i),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this.options=e.widget.extend({},this.options,this._getCreateOptions(),n),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){var t=this;this._destroy(),e.each(this.classesElementLookup,function(e,n){t._removeClass(n,e)}),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).removeAttr("aria-disabled"),this.bindings.off(this.eventNamespace)},_destroy:e.noop,widget:function(){return this.element},option:function(t,n){var i,o,r,s=t;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof t)if(s={},i=t.split("."),t=i.shift(),i.length){for(o=s[t]=e.widget.extend({},this.options[t]),r=0;r<i.length-1;r++)o[i[r]]=o[i[r]]||{},o=o[i[r]];if(t=i.pop(),1===arguments.length)return void 0===o[t]?null:o[t];o[t]=n}else{if(1===arguments.length)return void 0===this.options[t]?null:this.options[t];s[t]=n}return this._setOptions(s),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return"classes"===e&&this._setOptionClasses(t),this.options[e]=t,"disabled"===e&&this._setOptionDisabled(t),this},_setOptionClasses:function(t){var n,i,o;for(n in t)o=this.classesElementLookup[n],t[n]!==this.options.classes[n]&&o&&o.length&&(i=e(o.get()),this._removeClass(o,n),i.addClass(this._classes({element:i,keys:n,classes:t,add:!0})))},_setOptionDisabled:function(e){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!e),e&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(t){function n(n,r){var s,l;for(l=0;l<n.length;l++)s=o.classesElementLookup[n[l]]||e(),s=e(t.add?e.unique(s.get().concat(t.element.get())):s.not(t.element).get()),o.classesElementLookup[n[l]]=s,i.push(n[l]),r&&t.classes[n[l]]&&i.push(t.classes[n[l]])}var i=[],o=this;return t=e.extend({element:this.element,classes:this.options.classes||{}},t),this._on(t.element,{remove:"_untrackClassesElement"}),t.keys&&n(t.keys.match(/\S+/g)||[],!0),t.extra&&n(t.extra.match(/\S+/g)||[]),i.join(" ")},_untrackClassesElement:function(t){var n=this;e.each(n.classesElementLookup,function(i,o){-1!==e.inArray(t.target,o)&&(n.classesElementLookup[i]=e(o.not(t.target).get()))})},_removeClass:function(e,t,n){return this._toggleClass(e,t,n,!1)},_addClass:function(e,t,n){return this._toggleClass(e,t,n,!0)},_toggleClass:function(e,t,n,i){i="boolean"==typeof i?i:n;var o="string"==typeof e||null===e,r={extra:o?t:n,keys:o?e:t,element:o?this.element:e,add:i};return r.element.toggleClass(this._classes(r),i),this},_on:function(t,n,i){var o,r=this;"boolean"!=typeof t&&(i=n,n=t,t=!1),i?(n=o=e(n),this.bindings=this.bindings.add(n)):(i=n,n=this.element,o=this.widget()),e.each(i,function(i,s){function l(){if(t||!0!==r.options.disabled&&!e(this).hasClass("ui-state-disabled"))return("string"==typeof s?r[s]:s).apply(r,arguments)}"string"!=typeof s&&(l.guid=s.guid=s.guid||l.guid||e.guid++);var a=i.match(/^([\w:-]*)\s*(.*)$/),u=a[1]+r.eventNamespace,d=a[2];d?o.on(u,d,l):n.on(u,l)})},_off:function(t,n){n=(n||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.off(n).off(n),this.bindings=e(this.bindings.not(t).get()),this.focusable=e(this.focusable.not(t).get()),this.hoverable=e(this.hoverable.not(t).get())},_delay:function(e,t){function n(){return("string"==typeof e?i[e]:e).apply(i,arguments)}var i=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){this._addClass(e(t.currentTarget),null,"ui-state-hover")},mouseleave:function(t){this._removeClass(e(t.currentTarget),null,"ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){this._addClass(e(t.currentTarget),null,"ui-state-focus")},focusout:function(t){this._removeClass(e(t.currentTarget),null,"ui-state-focus")}})},_trigger:function(t,n,i){var o,r,s=this.options[t];if(i=i||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],r=n.originalEvent)for(o in r)o in n||(n[o]=r[o]);return this.element.trigger(n,i),!(e.isFunction(s)&&!1===s.apply(this.element[0],[n].concat(i))||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(i,o,r){"string"==typeof o&&(o={effect:o});var s,l=o?!0===o||"number"==typeof o?n:o.effect||n:t;o=o||{},"number"==typeof o&&(o={duration:o}),s=!e.isEmptyObject(o),o.complete=r,o.delay&&i.delay(o.delay),s&&e.effects&&e.effects.effect[l]?i[t](o):l!==t&&i[l]?i[l](o.duration,o.easing,r):i.queue(function(n){e(this)[t](),r&&r.call(i[0]),n()})}}),e.widget}),function(e){"function"==typeof define&&define.amd?define("jquery-ui/widgets/mouse",["jquery","../ie","../version","../widget"],e):e(jQuery)}(function(e){var t=!1;return e(document).on("mouseup",function(){t=!1}),e.widget("ui.mouse",{version:"1.12.1",options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.on("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).on("click."+this.widgetName,function(n){if(!0===e.data(n.target,t.widgetName+".preventClickEvent"))return e.removeData(n.target,t.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.off("."+this.widgetName),this._mouseMoveDelegate&&this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(n){if(!t){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(n),this._mouseDownEvent=n;var i=this,o=1===n.which,r=!("string"!=typeof this.options.cancel||!n.target.nodeName)&&e(n.target).closest(this.options.cancel).length;return!(o&&!r&&this._mouseCapture(n))||(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(n)&&this._mouseDelayMet(n)&&(this._mouseStarted=!1!==this._mouseStart(n),!this._mouseStarted)?(n.preventDefault(),!0):(!0===e.data(n.target,this.widgetName+".preventClickEvent")&&e.removeData(n.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return i._mouseMove(e)},this._mouseUpDelegate=function(e){return i._mouseUp(e)},this.document.on("mousemove."+this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,this._mouseUpDelegate),n.preventDefault(),t=!0,!0))}},_mouseMove:function(t){if(this._mouseMoved){if(e.ui.ie&&(!document.documentMode||document.documentMode<9)&&!t.button)return this._mouseUp(t);if(!t.which)if(t.originalEvent.altKey||t.originalEvent.ctrlKey||t.originalEvent.metaKey||t.originalEvent.shiftKey)this.ignoreMissingWhich=!0;else if(!this.ignoreMissingWhich)return this._mouseUp(t)}return(t.which||t.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,t),this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(n){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,n.target===this._mouseDownEvent.target&&e.data(n.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(n)),this._mouseDelayTimer&&(clearTimeout(this._mouseDelayTimer),delete this._mouseDelayTimer),this.ignoreMissingWhich=!1,t=!1,n.preventDefault()},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}),function(e){"function"==typeof define&&define.amd?define("jquery-ui/data",["jquery","./version"],e):e(jQuery)}(function(e){return e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t)}}):function(t,n,i){return!!e.data(t,i[3])}})}),function(e){"function"==typeof define&&define.amd?define("jquery-ui/plugin",["jquery","./version"],e):e(jQuery)}(function(e){return e.ui.plugin={add:function(t,n,i){var o,r=e.ui[t].prototype;for(o in i)r.plugins[o]=r.plugins[o]||[],r.plugins[o].push([n,i[o]])},call:function(e,t,n,i){var o,r=e.plugins[t];if(r&&(i||e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType))for(o=0;o<r.length;o++)e.options[r[o][0]]&&r[o][1].apply(e.element,n)}}}),function(e){"function"==typeof define&&define.amd?define("jquery-ui/safe-active-element",["jquery","./version"],e):e(jQuery)}(function(e){return e.ui.safeActiveElement=function(e){var t;try{t=e.activeElement}catch(n){t=e.body}return t||(t=e.body),t.nodeName||(t=e.body),t}}),function(e){"function"==typeof define&&define.amd?define("jquery-ui/safe-blur",["jquery","./version"],e):e(jQuery)}(function(e){return e.ui.safeBlur=function(t){t&&"body"!==t.nodeName.toLowerCase()&&e(t).trigger("blur")}}),function(e){"function"==typeof define&&define.amd?define("jquery-ui/scroll-parent",["jquery","./version"],e):e(jQuery)}(function(e){return e.fn.scrollParent=function(t){var n=this.css("position"),i="absolute"===n,o=t?/(auto|scroll|hidden)/:/(auto|scroll)/,r=this.parents().filter(function(){var t=e(this);return(!i||"static"!==t.css("position"))&&o.test(t.css("overflow")+t.css("overflow-y")+t.css("overflow-x"))}).eq(0);return"fixed"!==n&&r.length?r:e(this[0].ownerDocument||document)}}),function(e){"function"==typeof define&&define.amd?define("jquery-ui/widgets/draggable",["jquery","./mouse","../data","../plugin","../safe-active-element","../safe-blur","../scroll-parent","../version","../widget"],e):e(jQuery)}(function(e){return e.widget("ui.draggable",e.ui.mouse,{version:"1.12.1",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this._addClass("ui-draggable"),this._setHandleClassName(),this._mouseInit()},_setOption:function(e,t){this._super(e,t),"handle"===e&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){if((this.helper||this.element).is(".ui-draggable-dragging"))return void(this.destroyOnClear=!0);this._removeHandleClassName(),this._mouseDestroy()},_mouseCapture:function(t){var n=this.options;return!(this.helper||n.disabled||e(t.target).closest(".ui-resizable-handle").length>0)&&(this.handle=this._getHandle(t),!!this.handle&&(this._blurActiveElement(t),this._blockFrames(!0===n.iframeFix?"iframe":n.iframeFix),!0))},_blockFrames:function(t){this.iframeBlocks=this.document.find(t).map(function(){var t=e(this);return e("<div>").css("position","absolute").appendTo(t.parent()).outerWidth(t.outerWidth()).outerHeight(t.outerHeight()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(t){var n=e.ui.safeActiveElement(this.document[0]);e(t.target).closest(n).length||e.ui.safeBlur(n)},_mouseStart:function(t){var n=this.options;return this.helper=this._createHelper(t),this._addClass(this.helper,"ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===e(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(t),this.originalPosition=this.position=this._generatePosition(t,!1),this.originalPageX=t.pageX,this.originalPageY=t.pageY,n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt),this._setContainment(),!1===this._trigger("start",t)?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_refreshOffsets:function(e){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:e.pageX-this.offset.left,top:e.pageY-this.offset.top}},_mouseDrag:function(t,n){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t,!0),this.positionAbs=this._convertPositionTo("absolute"),!n){var i=this._uiHash();if(!1===this._trigger("drag",t,i))return this._mouseUp(new e.Event("mouseup",t)),!1;this.position=i.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var n=this,i=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(i=e.ui.ddmanager.drop(this,t)),this.dropped&&(i=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!i||"valid"===this.options.revert&&i||!0===this.options.revert||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,i)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){!1!==n._trigger("stop",t)&&n._clear()}):!1!==this._trigger("stop",t)&&this._clear(),!1},_mouseUp:function(t){return this._unblockFrames(),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),this.handleElement.is(t.target)&&this.element.trigger("focus"),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp(new e.Event("mouseup",{target:this.element[0]})):this._clear(),this},_getHandle:function(t){return!this.options.handle||!!e(t.target).closest(this.element.find(this.options.handle)).length},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this._addClass(this.handleElement,"ui-draggable-handle")},_removeHandleClassName:function(){this._removeClass(this.handleElement,"ui-draggable-handle")},_createHelper:function(t){var n=this.options,i=e.isFunction(n.helper),o=i?e(n.helper.apply(this.element[0],[t])):"clone"===n.helper?this.element.clone().removeAttr("id"):this.element;return o.parents("body").length||o.appendTo("parent"===n.appendTo?this.element[0].parentNode:n.appendTo),i&&o[0]===this.element[0]&&this._setPositionRelative(),o[0]===this.element[0]||/(fixed|absolute)/.test(o.css("position"))||o.css("position","absolute"),o},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_isRootNode:function(e){return/(html|body)/i.test(e.tagName)||e===this.document[0]},_getParentOffset:function(){var t=this.offsetParent.offset(),n=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==n&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var e=this.element.position(),t=this._isRootNode(this.scrollParent[0]);return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+(t?0:this.scrollParent.scrollTop()),left:e.left-(parseInt(this.helper.css("left"),10)||0)+(t?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,n,i,o=this.options,r=this.document[0];return this.relativeContainer=null,o.containment?"window"===o.containment?void(this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||r.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===o.containment?void(this.containment=[0,0,e(r).width()-this.helperProportions.width-this.margins.left,(e(r).height()||r.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):o.containment.constructor===Array?void(this.containment=o.containment):("parent"===o.containment&&(o.containment=this.helper[0].parentNode),n=e(o.containment),void((i=n[0])&&(t=/(scroll|auto)/.test(n.css("overflow")),this.containment=[(parseInt(n.css("borderLeftWidth"),10)||0)+(parseInt(n.css("paddingLeft"),10)||0),(parseInt(n.css("borderTopWidth"),10)||0)+(parseInt(n.css("paddingTop"),10)||0),(t?Math.max(i.scrollWidth,i.offsetWidth):i.offsetWidth)-(parseInt(n.css("borderRightWidth"),10)||0)-(parseInt(n.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(i.scrollHeight,i.offsetHeight):i.offsetHeight)-(parseInt(n.css("borderBottomWidth"),10)||0)-(parseInt(n.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=n))):void(this.containment=null)},_convertPositionTo:function(e,t){t||(t=this.position);var n="absolute"===e?1:-1,i=this._isRootNode(this.scrollParent[0]);return{top:t.top+this.offset.relative.top*n+this.offset.parent.top*n-("fixed"===this.cssPosition?-this.offset.scroll.top:i?0:this.offset.scroll.top)*n,left:t.left+this.offset.relative.left*n+this.offset.parent.left*n-("fixed"===this.cssPosition?-this.offset.scroll.left:i?0:this.offset.scroll.left)*n}},_generatePosition:function(e,t){var n,i,o,r,s=this.options,l=this._isRootNode(this.scrollParent[0]),a=e.pageX,u=e.pageY;return l&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),t&&(this.containment&&(this.relativeContainer?(i=this.relativeContainer.offset(),n=[this.containment[0]+i.left,this.containment[1]+i.top,this.containment[2]+i.left,this.containment[3]+i.top]):n=this.containment,e.pageX-this.offset.click.left<n[0]&&(a=n[0]+this.offset.click.left),e.pageY-this.offset.click.top<n[1]&&(u=n[1]+this.offset.click.top),e.pageX-this.offset.click.left>n[2]&&(a=n[2]+this.offset.click.left),
e.pageY-this.offset.click.top>n[3]&&(u=n[3]+this.offset.click.top)),s.grid&&(o=s.grid[1]?this.originalPageY+Math.round((u-this.originalPageY)/s.grid[1])*s.grid[1]:this.originalPageY,u=n?o-this.offset.click.top>=n[1]||o-this.offset.click.top>n[3]?o:o-this.offset.click.top>=n[1]?o-s.grid[1]:o+s.grid[1]:o,r=s.grid[0]?this.originalPageX+Math.round((a-this.originalPageX)/s.grid[0])*s.grid[0]:this.originalPageX,a=n?r-this.offset.click.left>=n[0]||r-this.offset.click.left>n[2]?r:r-this.offset.click.left>=n[0]?r-s.grid[0]:r+s.grid[0]:r),"y"===s.axis&&(a=this.originalPageX),"x"===s.axis&&(u=this.originalPageY)),{top:u-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:l?0:this.offset.scroll.top),left:a-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:l?0:this.offset.scroll.left)}},_clear:function(){this._removeClass(this.helper,"ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_trigger:function(t,n,i){return i=i||this._uiHash(),e.ui.plugin.call(this,t,[n,i,this],!0),/^(drag|start|stop)/.test(t)&&(this.positionAbs=this._convertPositionTo("absolute"),i.offset=this.positionAbs),e.Widget.prototype._trigger.call(this,t,n,i)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,n,i){var o=e.extend({},n,{item:i.element});i.sortables=[],e(i.options.connectToSortable).each(function(){var n=e(this).sortable("instance");n&&!n.options.disabled&&(i.sortables.push(n),n.refreshPositions(),n._trigger("activate",t,o))})},stop:function(t,n,i){var o=e.extend({},n,{item:i.element});i.cancelHelperRemoval=!1,e.each(i.sortables,function(){var e=this;e.isOver?(e.isOver=0,i.cancelHelperRemoval=!0,e.cancelHelperRemoval=!1,e._storedCSS={position:e.placeholder.css("position"),top:e.placeholder.css("top"),left:e.placeholder.css("left")},e._mouseStop(t),e.options.helper=e.options._helper):(e.cancelHelperRemoval=!0,e._trigger("deactivate",t,o))})},drag:function(t,n,i){e.each(i.sortables,function(){var o=!1,r=this;r.positionAbs=i.positionAbs,r.helperProportions=i.helperProportions,r.offset.click=i.offset.click,r._intersectsWith(r.containerCache)&&(o=!0,e.each(i.sortables,function(){return this.positionAbs=i.positionAbs,this.helperProportions=i.helperProportions,this.offset.click=i.offset.click,this!==r&&this._intersectsWith(this.containerCache)&&e.contains(r.element[0],this.element[0])&&(o=!1),o})),o?(r.isOver||(r.isOver=1,i._parent=n.helper.parent(),r.currentItem=n.helper.appendTo(r.element).data("ui-sortable-item",!0),r.options._helper=r.options.helper,r.options.helper=function(){return n.helper[0]},t.target=r.currentItem[0],r._mouseCapture(t,!0),r._mouseStart(t,!0,!0),r.offset.click.top=i.offset.click.top,r.offset.click.left=i.offset.click.left,r.offset.parent.left-=i.offset.parent.left-r.offset.parent.left,r.offset.parent.top-=i.offset.parent.top-r.offset.parent.top,i._trigger("toSortable",t),i.dropped=r.element,e.each(i.sortables,function(){this.refreshPositions()}),i.currentItem=i.element,r.fromOutside=i),r.currentItem&&(r._mouseDrag(t),n.position=r.position)):r.isOver&&(r.isOver=0,r.cancelHelperRemoval=!0,r.options._revert=r.options.revert,r.options.revert=!1,r._trigger("out",t,r._uiHash(r)),r._mouseStop(t,!0),r.options.revert=r.options._revert,r.options.helper=r.options._helper,r.placeholder&&r.placeholder.remove(),n.helper.appendTo(i._parent),i._refreshOffsets(t),n.position=i._generatePosition(t,!0),i._trigger("fromSortable",t),i.dropped=!1,e.each(i.sortables,function(){this.refreshPositions()}))})}}),e.ui.plugin.add("draggable","cursor",{start:function(t,n,i){var o=e("body"),r=i.options;o.css("cursor")&&(r._cursor=o.css("cursor")),o.css("cursor",r.cursor)},stop:function(t,n,i){var o=i.options;o._cursor&&e("body").css("cursor",o._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,n,i){var o=e(n.helper),r=i.options;o.css("opacity")&&(r._opacity=o.css("opacity")),o.css("opacity",r.opacity)},stop:function(t,n,i){var o=i.options;o._opacity&&e(n.helper).css("opacity",o._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(e,t,n){n.scrollParentNotHidden||(n.scrollParentNotHidden=n.helper.scrollParent(!1)),n.scrollParentNotHidden[0]!==n.document[0]&&"HTML"!==n.scrollParentNotHidden[0].tagName&&(n.overflowOffset=n.scrollParentNotHidden.offset())},drag:function(t,n,i){var o=i.options,r=!1,s=i.scrollParentNotHidden[0],l=i.document[0];s!==l&&"HTML"!==s.tagName?(o.axis&&"x"===o.axis||(i.overflowOffset.top+s.offsetHeight-t.pageY<o.scrollSensitivity?s.scrollTop=r=s.scrollTop+o.scrollSpeed:t.pageY-i.overflowOffset.top<o.scrollSensitivity&&(s.scrollTop=r=s.scrollTop-o.scrollSpeed)),o.axis&&"y"===o.axis||(i.overflowOffset.left+s.offsetWidth-t.pageX<o.scrollSensitivity?s.scrollLeft=r=s.scrollLeft+o.scrollSpeed:t.pageX-i.overflowOffset.left<o.scrollSensitivity&&(s.scrollLeft=r=s.scrollLeft-o.scrollSpeed))):(o.axis&&"x"===o.axis||(t.pageY-e(l).scrollTop()<o.scrollSensitivity?r=e(l).scrollTop(e(l).scrollTop()-o.scrollSpeed):e(window).height()-(t.pageY-e(l).scrollTop())<o.scrollSensitivity&&(r=e(l).scrollTop(e(l).scrollTop()+o.scrollSpeed))),o.axis&&"y"===o.axis||(t.pageX-e(l).scrollLeft()<o.scrollSensitivity?r=e(l).scrollLeft(e(l).scrollLeft()-o.scrollSpeed):e(window).width()-(t.pageX-e(l).scrollLeft())<o.scrollSensitivity&&(r=e(l).scrollLeft(e(l).scrollLeft()+o.scrollSpeed)))),!1!==r&&e.ui.ddmanager&&!o.dropBehaviour&&e.ui.ddmanager.prepareOffsets(i,t)}}),e.ui.plugin.add("draggable","snap",{start:function(t,n,i){var o=i.options;i.snapElements=[],e(o.snap.constructor!==String?o.snap.items||":data(ui-draggable)":o.snap).each(function(){var t=e(this),n=t.offset();this!==i.element[0]&&i.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:n.top,left:n.left})})},drag:function(t,n,i){var o,r,s,l,a,u,d,c,h,p,f=i.options,g=f.snapTolerance,m=n.offset.left,v=m+i.helperProportions.width,y=n.offset.top,b=y+i.helperProportions.height;for(h=i.snapElements.length-1;h>=0;h--)a=i.snapElements[h].left-i.margins.left,u=a+i.snapElements[h].width,d=i.snapElements[h].top-i.margins.top,c=d+i.snapElements[h].height,v<a-g||m>u+g||b<d-g||y>c+g||!e.contains(i.snapElements[h].item.ownerDocument,i.snapElements[h].item)?(i.snapElements[h].snapping&&i.options.snap.release&&i.options.snap.release.call(i.element,t,e.extend(i._uiHash(),{snapItem:i.snapElements[h].item})),i.snapElements[h].snapping=!1):("inner"!==f.snapMode&&(o=Math.abs(d-b)<=g,r=Math.abs(c-y)<=g,s=Math.abs(a-v)<=g,l=Math.abs(u-m)<=g,o&&(n.position.top=i._convertPositionTo("relative",{top:d-i.helperProportions.height,left:0}).top),r&&(n.position.top=i._convertPositionTo("relative",{top:c,left:0}).top),s&&(n.position.left=i._convertPositionTo("relative",{top:0,left:a-i.helperProportions.width}).left),l&&(n.position.left=i._convertPositionTo("relative",{top:0,left:u}).left)),p=o||r||s||l,"outer"!==f.snapMode&&(o=Math.abs(d-y)<=g,r=Math.abs(c-b)<=g,s=Math.abs(a-m)<=g,l=Math.abs(u-v)<=g,o&&(n.position.top=i._convertPositionTo("relative",{top:d,left:0}).top),r&&(n.position.top=i._convertPositionTo("relative",{top:c-i.helperProportions.height,left:0}).top),s&&(n.position.left=i._convertPositionTo("relative",{top:0,left:a}).left),l&&(n.position.left=i._convertPositionTo("relative",{top:0,left:u-i.helperProportions.width}).left)),!i.snapElements[h].snapping&&(o||r||s||l||p)&&i.options.snap.snap&&i.options.snap.snap.call(i.element,t,e.extend(i._uiHash(),{snapItem:i.snapElements[h].item})),i.snapElements[h].snapping=o||r||s||l||p)}}),e.ui.plugin.add("draggable","stack",{start:function(t,n,i){var o,r=i.options,s=e.makeArray(e(r.stack)).sort(function(t,n){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(n).css("zIndex"),10)||0)});s.length&&(o=parseInt(e(s[0]).css("zIndex"),10)||0,e(s).each(function(t){e(this).css("zIndex",o+t)}),this.css("zIndex",o+s.length))}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,n,i){var o=e(n.helper),r=i.options;o.css("zIndex")&&(r._zIndex=o.css("zIndex")),o.css("zIndex",r.zIndex)},stop:function(t,n,i){var o=i.options;o._zIndex&&e(n.helper).css("zIndex",o._zIndex)}}),e.ui.draggable}),function(e){"function"==typeof define&&define.amd?define("jquery-ui/widgets/droppable",["jquery","./draggable","./mouse","../version","../widget"],e):e(jQuery)}(function(e){e.widget("ui.droppable",{version:"1.12.1",widgetEventPrefix:"drop",options:{accept:"*",addClasses:!0,greedy:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var t,n=this.options,i=n.accept;this.isover=!1,this.isout=!0,this.accept=e.isFunction(i)?i:function(e){return e.is(i)},this.proportions=function(){if(!arguments.length)return t||(t={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight});t=arguments[0]},this._addToManager(n.scope),n.addClasses&&this._addClass("ui-droppable")},_addToManager:function(t){e.ui.ddmanager.droppables[t]=e.ui.ddmanager.droppables[t]||[],e.ui.ddmanager.droppables[t].push(this)},_splice:function(e){for(var t=0;t<e.length;t++)e[t]===this&&e.splice(t,1)},_destroy:function(){var t=e.ui.ddmanager.droppables[this.options.scope];this._splice(t)},_setOption:function(t,n){if("accept"===t)this.accept=e.isFunction(n)?n:function(e){return e.is(n)};else if("scope"===t){var i=e.ui.ddmanager.droppables[this.options.scope];this._splice(i),this._addToManager(n)}this._super(t,n)},_activate:function(t){var n=e.ui.ddmanager.current;this._addActiveClass(),n&&this._trigger("activate",t,this.ui(n))},_deactivate:function(t){var n=e.ui.ddmanager.current;this._removeActiveClass(),n&&this._trigger("deactivate",t,this.ui(n))},_over:function(t){var n=e.ui.ddmanager.current;n&&(n.currentItem||n.element)[0]!==this.element[0]&&this.accept.call(this.element[0],n.currentItem||n.element)&&(this._addHoverClass(),this._trigger("over",t,this.ui(n)))},_out:function(t){var n=e.ui.ddmanager.current;n&&(n.currentItem||n.element)[0]!==this.element[0]&&this.accept.call(this.element[0],n.currentItem||n.element)&&(this._removeHoverClass(),this._trigger("out",t,this.ui(n)))},_drop:function(n,i){var o=i||e.ui.ddmanager.current,r=!1;return!(!o||(o.currentItem||o.element)[0]===this.element[0])&&(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var i=e(this).droppable("instance");if(i.options.greedy&&!i.options.disabled&&i.options.scope===o.options.scope&&i.accept.call(i.element[0],o.currentItem||o.element)&&t(o,e.extend(i,{offset:i.element.offset()}),i.options.tolerance,n))return r=!0,!1}),!r&&(!!this.accept.call(this.element[0],o.currentItem||o.element)&&(this._removeActiveClass(),this._removeHoverClass(),this._trigger("drop",n,this.ui(o)),this.element)))},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}},_addHoverClass:function(){this._addClass("ui-droppable-hover")},_removeHoverClass:function(){this._removeClass("ui-droppable-hover")},_addActiveClass:function(){this._addClass("ui-droppable-active")},_removeActiveClass:function(){this._removeClass("ui-droppable-active")}});var t=e.ui.intersect=function(){function e(e,t,n){return e>=t&&e<t+n}return function(t,n,i,o){if(!n.offset)return!1;var r=(t.positionAbs||t.position.absolute).left+t.margins.left,s=(t.positionAbs||t.position.absolute).top+t.margins.top,l=r+t.helperProportions.width,a=s+t.helperProportions.height,u=n.offset.left,d=n.offset.top,c=u+n.proportions().width,h=d+n.proportions().height;switch(i){case"fit":return u<=r&&l<=c&&d<=s&&a<=h;case"intersect":return u<r+t.helperProportions.width/2&&l-t.helperProportions.width/2<c&&d<s+t.helperProportions.height/2&&a-t.helperProportions.height/2<h;case"pointer":return e(o.pageY,d,n.proportions().height)&&e(o.pageX,u,n.proportions().width);case"touch":return(s>=d&&s<=h||a>=d&&a<=h||s<d&&a>h)&&(r>=u&&r<=c||l>=u&&l<=c||r<u&&l>c);default:return!1}}}();return e.ui.ddmanager={current:null,droppables:{default:[]},prepareOffsets:function(t,n){var i,o,r=e.ui.ddmanager.droppables[t.options.scope]||[],s=n?n.type:null,l=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();e:for(i=0;i<r.length;i++)if(!(r[i].options.disabled||t&&!r[i].accept.call(r[i].element[0],t.currentItem||t.element))){for(o=0;o<l.length;o++)if(l[o]===r[i].element[0]){r[i].proportions().height=0;continue e}r[i].visible="none"!==r[i].element.css("display"),r[i].visible&&("mousedown"===s&&r[i]._activate.call(r[i],n),r[i].offset=r[i].element.offset(),r[i].proportions({width:r[i].element[0].offsetWidth,height:r[i].element[0].offsetHeight}))}},drop:function(n,i){var o=!1;return e.each((e.ui.ddmanager.droppables[n.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&t(n,this,this.options.tolerance,i)&&(o=this._drop.call(this,i)||o),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],n.currentItem||n.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),o},dragStart:function(t,n){t.element.parentsUntil("body").on("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,n)})},drag:function(n,i){n.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(n,i),e.each(e.ui.ddmanager.droppables[n.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var o,r,s,l=t(n,this,this.options.tolerance,i),a=!l&&this.isover?"isout":l&&!this.isover?"isover":null;a&&(this.options.greedy&&(r=this.options.scope,s=this.element.parents(":data(ui-droppable)").filter(function(){return e(this).droppable("instance").options.scope===r}),s.length&&(o=e(s[0]).droppable("instance"),o.greedyChild="isover"===a)),o&&"isover"===a&&(o.isover=!1,o.isout=!0,o._out.call(o,i)),this[a]=!0,this["isout"===a?"isover":"isout"]=!1,this["isover"===a?"_over":"_out"].call(this,i),o&&"isout"===a&&(o.isout=!1,o.isover=!0,o._over.call(o,i)))}})},dragStop:function(t,n){t.element.parentsUntil("body").off("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,n)}},!1!==e.uiBackCompat&&e.widget("ui.droppable",e.ui.droppable,{options:{hoverClass:!1,activeClass:!1},_addActiveClass:function(){this._super(),this.options.activeClass&&this.element.addClass(this.options.activeClass)},_removeActiveClass:function(){this._super(),this.options.activeClass&&this.element.removeClass(this.options.activeClass)},_addHoverClass:function(){this._super(),this.options.hoverClass&&this.element.addClass(this.options.hoverClass)},_removeHoverClass:function(){this._super(),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass)}}),e.ui.droppable}),define("views/OrganisationPicker",["require","exports","module","underscore","jquery-ui/widgets/droppable","backbone","env"],function(e,t,n){var i=e("underscore");e("jquery-ui/widgets/droppable");var o=e("backbone"),r=i.template("<a href='<%- link %>' class='switch'>    <div class='org-icon' style='background-color: <%- colour %>; background-image: url(<%- picture %>);'/></a>"),s=o.View.extend({tagName:"li",className:"organisation",initialize:function(e){i.bindAll(this,"render","switchToOrg"),this.options=e},switchToOrg:function(e){o.history.navigate("/"+(this.model.get("slug")?this.model.get("slug"):""),!0)},addDropTarget:function(){this.model.canWrite()&&this.model.hasActivePlan()&&this.$el.droppable({accept:function(e){if(!e.hasClass("diagram"))return!1;var t=e[0].model;if(t){var n=t.get("owner_id");if(n&&n===getCoggleUser().get("_id"))return!0}return!1},tolerance:"pointer",hoverClass:"dragHover",activeClass:"dropActive",drop:function(e,t){var n=t.draggable[0].model;t.draggable.remove(),n.getAccess().getMe().grant(["read","write","list"],function(e,t){if(e)return $(window).trigger("notify-warning",e.responseJSON.description?e.responseJSON.description:"Sorry, you don't have permission to move that diagram. Try asking its creator to move it."),void getCoggleUser().getActions().perform("org:dragdrop:error");n.set("organisation",this.model.get("slug")),n.set("folder",null),n.save({},{wait:!0,success:function(){getCoggleUser().getActions().perform("org:dragdrop:success"),this.switchToOrg(),window.location.reload()}.bind(this),error:function(e,t){getCoggleUser().getActions().perform("org:dragdrop:error"),n.set("organisation",n.previous("organisation")),n.set("folder",n.previous("folder")),$(window).trigger("notify-warning",t.responseJSON.description?t.responseJSON.description:"Sorry, there was error completeing your request.")}.bind(this)})}.bind(this))}.bind(this)})},render:function(){var t=this.model.toJSON();return t.picture||(t.picture=e("env").cdn.url+"/img/anon-member-2x.png"),t.link=t.slug?"/"+t.slug:"",this.options.path_suffix&&(t.link+=this.options.path_suffix),this.$el.html(r(t)),this.addDropTarget(),this}}),l=o.View.extend({tagName:"ul",className:"organisations",events:{},initialize:function(e){i.bindAll(this,"addOne","addAll","render"),this.options=e,this.listenTo(this.collection,"reset",this.addAll),this.listenTo(this.collection,"add",this.addOne),this.listenTo(getCoggleUser(),"organisation_changed",this.render),this.listenTo(getCoggleUser(),"change",this.render)},renderOwnOrg:function(){var e=(getCoggleUser().getActiveOrg(),$('<li class="organisation">')),t=getCoggleUser().get("avatar");e.prepend(r({picture:t.url,name:getCoggleUser().get("name"),link:this.options.melink||"/?org=0",colour:t.colour})),getCoggleUser().getActiveOrg().id||e.addClass("active"),this.$el.prepend(e)},render:function(){return this.$el.empty(),this.options.hide_own_org||this.renderOwnOrg(),this.addAll(),this},addOne:function(e){var t=new s({model:e,path_suffix:this.options.path_suffix});this.addChildView(t),this.$el.append(t.render().$el),getCoggleUser().getActiveOrg().id==e.id&&t.$el.addClass("active")},addAll:function(){this.collection.each(this.addOne)}});n.exports.OrganisationPickerEntry=s,n.exports.OrganisationPicker=l}),function(e){"function"==typeof define&&define.amd?define("jquery.timeago",["jquery"],e):e("object"==typeof module&&"object"==typeof module.exports?require("jquery"):jQuery)}(function(e){function t(){var t=r.settings;if(t.autoDispose&&!e.contains(document.documentElement,this))return e(this).timeago("dispose"),this;var s=n(this);return isNaN(s.datetime)||(0===t.cutoff||Math.abs(o(s.datetime))<t.cutoff?e(this).text(i(s.datetime)):e(this).attr("title").length>0&&e(this).text(e(this).attr("title"))),this}function n(t){if(t=e(t),!t.data("timeago")){t.data("timeago",{datetime:r.datetime(t)});var n=e.trim(t.text());r.settings.localeTitle?t.attr("title",t.data("timeago").datetime.toLocaleString()):!(n.length>0)||r.isTime(t)&&t.attr("title")||t.attr("title",n)}return t.data("timeago")}function i(e){return r.inWords(o(e))}function o(e){return(new Date).getTime()-e.getTime()}e.timeago=function(t){return i(t instanceof Date?t:"string"==typeof t?e.timeago.parse(t):"number"==typeof t?new Date(t):e.timeago.datetime(t))};var r=e.timeago;e.extend(e.timeago,{settings:{refreshMillis:6e4,allowPast:!0,allowFuture:!1,localeTitle:!1,cutoff:0,autoDispose:!0,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",inPast:"any moment now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",wordSeparator:" ",numbers:[]}},inWords:function(t){function n(n,o){var r=e.isFunction(n)?n(o,t):n,s=i.numbers&&i.numbers[o]||o;return r.replace(/%d/i,s)}if(!this.settings.allowPast&&!this.settings.allowFuture)throw"timeago allowPast and allowFuture settings can not both be set to false.";var i=this.settings.strings,o=i.prefixAgo,r=i.suffixAgo;if(this.settings.allowFuture&&t<0&&(o=i.prefixFromNow,r=i.suffixFromNow),!this.settings.allowPast&&t>=0)return this.settings.strings.inPast;var s=Math.abs(t)/1e3,l=s/60,a=l/60,u=a/24,d=u/365,c=s<45&&n(i.seconds,Math.round(s))||s<90&&n(i.minute,1)||l<45&&n(i.minutes,Math.round(l))||l<90&&n(i.hour,1)||a<24&&n(i.hours,Math.round(a))||a<42&&n(i.day,1)||u<30&&n(i.days,Math.round(u))||u<45&&n(i.month,1)||u<365&&n(i.months,Math.round(u/30))||d<1.5&&n(i.year,1)||n(i.years,Math.round(d)),h=i.wordSeparator||"";return void 0===i.wordSeparator&&(h=" "),e.trim([o,c,r].join(h))},parse:function(t){var n=e.trim(t);return n=n.replace(/\.\d+/,""),n=n.replace(/-/,"/").replace(/-/,"/"),n=n.replace(/T/," ").replace(/Z/," UTC"),n=n.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),n=n.replace(/([\+\-]\d\d)$/," $100"),new Date(n)},datetime:function(t){var n=r.isTime(t)?e(t).attr("datetime"):e(t).attr("title");return r.parse(n)},isTime:function(t){return"time"===e(t).get(0).tagName.toLowerCase()}});var s={init:function(){s.dispose.call(this);var n=e.proxy(t,this);n();var i=r.settings;i.refreshMillis>0&&(this._timeagoInterval=setInterval(n,i.refreshMillis))},update:function(n){var i=n instanceof Date?n:r.parse(n);e(this).data("timeago",{datetime:i}),r.settings.localeTitle&&e(this).attr("title",i.toLocaleString()),t.apply(this)},updateFromDOM:function(){e(this).data("timeago",{datetime:r.parse(r.isTime(this)?e(this).attr("datetime"):e(this).attr("title"))}),t.apply(this)},dispose:function(){this._timeagoInterval&&(window.clearInterval(this._timeagoInterval),this._timeagoInterval=null)}};e.fn.timeago=function(e,t){var n=e?s[e]:s.init;if(!n)throw new Error("Unknown function name '"+e+"' for timeago");return this.each(function(){n.call(this,t)}),this},document.createElement("abbr"),document.createElement("time")}),define("utils/coggle-timeago",["require","exports","module","jquery.timeago","async","env"],function(e,t,n){e("jquery.timeago");for(var i=e("async"),o={},r=null,s=[],l=$('script[type="application/l20n"]').map(function(){return $(this).attr("data-l10n-locale")}),a=[],u=0;u<l.length;u++){a.push(l[u]);var d=l[u].split("-");d.length>1&&a.push(d[0])}var c=function(t,n){var i=t.toLowerCase();i.startsWith("en-")||"en"===i?(r=t,setTimeout(n,0)):requirejs([e("env").cdn.url+"/bower_components/jquery-timeago/locales/jquery.timeago."+t+".js"],function(){console.log("timago loaded language",t),r=t,n()},function(e){return n(e)})},h=function(e){null!==r||s.length?s.length?s.push(e):setTimeout(function(){e()},0):(s.push(e),i.eachSeries(a,function(e,t){c(e,function(n){n?(console.log("timeago failed to load language "+e,n),t()):t("success")})},function(e){"success"===e?s.forEach(function(e){e()}):(r=new Error("no preferred language found"),s.forEach(function(t){t(e||r)})),s=[]}))};return o.loadLanguages=h,o.timeago=function(e,t){return h(function(n){n?"function"==typeof t&&t(n):(e.timeago(),"function"==typeof t&&t())}),e},o}),function(e){"function"==typeof define&&define.amd?define("jquery-ui/widgets/sortable",["jquery","./mouse","../data","../ie","../scroll-parent","../version","../widget"],e):e(jQuery)}(function(e){return e.widget("ui.sortable",e.ui.mouse,{version:"1.12.1",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(e,t,n){return e>=t&&e<t+n},_isFloating:function(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))},_create:function(){this.containerCache={},this._addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(e,t){this._super(e,t),"handle"===e&&this._setHandleClassName()},_setHandleClassName:function(){var t=this;this._removeClass(this.element.find(".ui-sortable-handle"),"ui-sortable-handle"),e.each(this.items,function(){t._addClass(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item,"ui-sortable-handle")})},_destroy:function(){this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(t,n){var i=null,o=!1,r=this;return!this.reverting&&(!this.options.disabled&&"static"!==this.options.type&&(this._refreshItems(t),e(t.target).parents().each(function(){if(e.data(this,r.widgetName+"-item")===r)return i=e(this),!1}),e.data(t.target,r.widgetName+"-item")===r&&(i=e(t.target)),!!i&&(!(this.options.handle&&!n&&(e(this.options.handle,i).find("*").addBack().each(function(){this===t.target&&(o=!0)}),!o))&&(this.currentItem=i,this._removeCurrentsFromItems(),!0))))},_mouseStart:function(t,n,i){var o,r,s=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,s.cursorAt&&this._adjustOffsetFromHelper(s.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),s.containment&&this._setContainment(),s.cursor&&"auto"!==s.cursor&&(r=this.document.find("body"),this.storedCursor=r.css("cursor"),r.css("cursor",s.cursor),this.storedStylesheet=e("<style>*{ cursor: "+s.cursor+" !important; }</style>").appendTo(r)),s.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",s.opacity)),s.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",s.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!i)for(o=this.containers.length-1;o>=0;o--)this.containers[o]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!s.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this._addClass(this.helper,"ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var n,i,o,r,s=this.options,l=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<s.scrollSensitivity?this.scrollParent[0].scrollTop=l=this.scrollParent[0].scrollTop+s.scrollSpeed:t.pageY-this.overflowOffset.top<s.scrollSensitivity&&(this.scrollParent[0].scrollTop=l=this.scrollParent[0].scrollTop-s.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<s.scrollSensitivity?this.scrollParent[0].scrollLeft=l=this.scrollParent[0].scrollLeft+s.scrollSpeed:t.pageX-this.overflowOffset.left<s.scrollSensitivity&&(this.scrollParent[0].scrollLeft=l=this.scrollParent[0].scrollLeft-s.scrollSpeed)):(t.pageY-this.document.scrollTop()<s.scrollSensitivity?l=this.document.scrollTop(this.document.scrollTop()-s.scrollSpeed):this.window.height()-(t.pageY-this.document.scrollTop())<s.scrollSensitivity&&(l=this.document.scrollTop(this.document.scrollTop()+s.scrollSpeed)),t.pageX-this.document.scrollLeft()<s.scrollSensitivity?l=this.document.scrollLeft(this.document.scrollLeft()-s.scrollSpeed):this.window.width()-(t.pageX-this.document.scrollLeft())<s.scrollSensitivity&&(l=this.document.scrollLeft(this.document.scrollLeft()+s.scrollSpeed))),!1!==l&&e.ui.ddmanager&&!s.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),n=this.items.length-1;n>=0;n--)if(i=this.items[n],o=i.item[0],(r=this._intersectsWithPointer(i))&&i.instance===this.currentContainer&&!(o===this.currentItem[0]||this.placeholder[1===r?"next":"prev"]()[0]===o||e.contains(this.placeholder[0],o)||"semi-dynamic"===this.options.type&&e.contains(this.element[0],o))){if(this.direction=1===r?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(i))break;this._rearrange(t,i),this._trigger("change",t,this._uiHash());break}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,n){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var i=this,o=this.placeholder.offset(),r=this.options.axis,s={};r&&"x"!==r||(s.left=o.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),r&&"y"!==r||(s.top=o.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,e(this.helper).animate(s,parseInt(this.options.revert,10)||500,function(){i._clear(t)})}else this._clear(t,n);return!1}},cancel:function(){if(this.dragging){this._mouseUp(new e.Event("mouseup",{target:null})),"original"===this.options.helper?(this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var n=this._getItemsAsjQuery(t&&t.connected),i=[];return t=t||{},e(n).each(function(){var n=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);n&&i.push((t.key||n[1]+"[]")+"="+(t.key&&t.expression?n[1]:n[2]))}),!i.length&&t.key&&i.push(t.key+"="),i.join("&")},toArray:function(t){var n=this._getItemsAsjQuery(t&&t.connected),i=[];return t=t||{},n.each(function(){i.push(e(t.item||this).attr(t.attribute||"id")||"")}),i},_intersectsWith:function(e){var t=this.positionAbs.left,n=t+this.helperProportions.width,i=this.positionAbs.top,o=i+this.helperProportions.height,r=e.left,s=r+e.width,l=e.top,a=l+e.height,u=this.offset.click.top,d=this.offset.click.left,c="x"===this.options.axis||i+u>l&&i+u<a,h="y"===this.options.axis||t+d>r&&t+d<s,p=c&&h
;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?p:r<t+this.helperProportions.width/2&&n-this.helperProportions.width/2<s&&l<i+this.helperProportions.height/2&&o-this.helperProportions.height/2<a},_intersectsWithPointer:function(e){var t,n,i="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top,e.height),o="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left,e.width);return!(!i||!o)&&(t=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection(),this.floating?"right"===n||"down"===t?2:1:t&&("down"===t?2:1))},_intersectsWithSides:function(e){var t=this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),n=this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),i=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return this.floating&&o?"right"===o&&n||"left"===o&&!n:i&&("down"===i&&t||"up"===i&&!t)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!==e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!==e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){function n(){l.push(this)}var i,o,r,s,l=[],a=[],u=this._connectWith();if(u&&t)for(i=u.length-1;i>=0;i--)for(r=e(u[i],this.document[0]),o=r.length-1;o>=0;o--)(s=e.data(r[o],this.widgetFullName))&&s!==this&&!s.options.disabled&&a.push([e.isFunction(s.options.items)?s.options.items.call(s.element):e(s.options.items,s.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),s]);for(a.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),i=a.length-1;i>=0;i--)a[i][0].each(n);return e(l)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var n=0;n<t.length;n++)if(t[n]===e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var n,i,o,r,s,l,a,u,d=this.items,c=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],h=this._connectWith();if(h&&this.ready)for(n=h.length-1;n>=0;n--)for(o=e(h[n],this.document[0]),i=o.length-1;i>=0;i--)(r=e.data(o[i],this.widgetFullName))&&r!==this&&!r.options.disabled&&(c.push([e.isFunction(r.options.items)?r.options.items.call(r.element[0],t,{item:this.currentItem}):e(r.options.items,r.element),r]),this.containers.push(r));for(n=c.length-1;n>=0;n--)for(s=c[n][1],l=c[n][0],i=0,u=l.length;i<u;i++)a=e(l[i]),a.data(this.widgetName+"-item",s),d.push({item:a,instance:s,width:0,height:0,left:0,top:0})},refreshPositions:function(t){this.floating=!!this.items.length&&("x"===this.options.axis||this._isFloating(this.items[0].item)),this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var n,i,o,r;for(n=this.items.length-1;n>=0;n--)i=this.items[n],i.instance!==this.currentContainer&&this.currentContainer&&i.item[0]!==this.currentItem[0]||(o=this.options.toleranceElement?e(this.options.toleranceElement,i.item):i.item,t||(i.width=o.outerWidth(),i.height=o.outerHeight()),r=o.offset(),i.left=r.left,i.top=r.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(n=this.containers.length-1;n>=0;n--)r=this.containers[n].element.offset(),this.containers[n].containerCache.left=r.left,this.containers[n].containerCache.top=r.top,this.containers[n].containerCache.width=this.containers[n].element.outerWidth(),this.containers[n].containerCache.height=this.containers[n].element.outerHeight();return this},_createPlaceholder:function(t){t=t||this;var n,i=t.options;i.placeholder&&i.placeholder.constructor!==String||(n=i.placeholder,i.placeholder={element:function(){var i=t.currentItem[0].nodeName.toLowerCase(),o=e("<"+i+">",t.document[0]);return t._addClass(o,"ui-sortable-placeholder",n||t.currentItem[0].className)._removeClass(o,"ui-sortable-helper"),"tbody"===i?t._createTrPlaceholder(t.currentItem.find("tr").eq(0),e("<tr>",t.document[0]).appendTo(o)):"tr"===i?t._createTrPlaceholder(t.currentItem,o):"img"===i&&o.attr("src",t.currentItem.attr("src")),n||o.css("visibility","hidden"),o},update:function(e,o){n&&!i.forcePlaceholderSize||(o.height()||o.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),o.width()||o.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}),t.placeholder=e(i.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),i.placeholder.update(t,t.placeholder)},_createTrPlaceholder:function(t,n){var i=this;t.children().each(function(){e("<td>&#160;</td>",i.document[0]).attr("colspan",e(this).attr("colspan")||1).appendTo(n)})},_contactContainers:function(t){var n,i,o,r,s,l,a,u,d,c,h=null,p=null;for(n=this.containers.length-1;n>=0;n--)if(!e.contains(this.currentItem[0],this.containers[n].element[0]))if(this._intersectsWith(this.containers[n].containerCache)){if(h&&e.contains(this.containers[n].element[0],h.element[0]))continue;h=this.containers[n],p=n}else this.containers[n].containerCache.over&&(this.containers[n]._trigger("out",t,this._uiHash(this)),this.containers[n].containerCache.over=0);if(h)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(o=1e4,r=null,d=h.floating||this._isFloating(this.currentItem),s=d?"left":"top",l=d?"width":"height",c=d?"pageX":"pageY",i=this.items.length-1;i>=0;i--)e.contains(this.containers[p].element[0],this.items[i].item[0])&&this.items[i].item[0]!==this.currentItem[0]&&(a=this.items[i].item.offset()[s],u=!1,t[c]-a>this.items[i][l]/2&&(u=!0),Math.abs(t[c]-a)<o&&(o=Math.abs(t[c]-a),r=this.items[i],this.direction=u?"up":"down"));if(!r&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return void(this.currentContainer.containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash()),this.currentContainer.containerCache.over=1));r?this._rearrange(t,r,null,!0):this._rearrange(t,null,this.containers[p].element,!0),this._trigger("change",t,this._uiHash()),this.containers[p]._trigger("change",t,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(t){var n=this.options,i=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t,this.currentItem])):"clone"===n.helper?this.currentItem.clone():this.currentItem;return i.parents("body").length||e("parent"!==n.appendTo?n.appendTo:this.currentItem[0].parentNode)[0].appendChild(i[0]),i[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),i[0].style.width&&!n.forceHelperSize||i.width(this.currentItem.width()),i[0].style.height&&!n.forceHelperSize||i.height(this.currentItem.height()),i},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,n,i,o=this.options;"parent"===o.containment&&(o.containment=this.helper[0].parentNode),"document"!==o.containment&&"window"!==o.containment||(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===o.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===o.containment?this.document.height()||document.body.parentNode.scrollHeight:this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(o.containment)||(t=e(o.containment)[0],n=e(o.containment).offset(),i="hidden"!==e(t).css("overflow"),this.containment=[n.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,n.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,n.left+(i?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,n.top+(i?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(t,n){n||(n=this.position);var i="absolute"===t?1:-1,o="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,r=/(html|body)/i.test(o[0].tagName);return{top:n.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():r?0:o.scrollTop())*i,left:n.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():r?0:o.scrollLeft())*i}},_generatePosition:function(t){var n,i,o=this.options,r=t.pageX,s=t.pageY,l="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(l[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(r=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(s=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(r=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(s=this.containment[3]+this.offset.click.top)),o.grid&&(n=this.originalPageY+Math.round((s-this.originalPageY)/o.grid[1])*o.grid[1],s=this.containment?n-this.offset.click.top>=this.containment[1]&&n-this.offset.click.top<=this.containment[3]?n:n-this.offset.click.top>=this.containment[1]?n-o.grid[1]:n+o.grid[1]:n,i=this.originalPageX+Math.round((r-this.originalPageX)/o.grid[0])*o.grid[0],r=this.containment?i-this.offset.click.left>=this.containment[0]&&i-this.offset.click.left<=this.containment[2]?i:i-this.offset.click.left>=this.containment[0]?i-o.grid[0]:i+o.grid[0]:i)),{top:s-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():a?0:l.scrollTop()),left:r-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():a?0:l.scrollLeft())}},_rearrange:function(e,t,n,i){n?n[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var o=this.counter;this._delay(function(){o===this.counter&&this.refreshPositions(!i)})},_clear:function(e,t){function n(e,t,n){return function(i){n._trigger(e,i,t._uiHash(t))}}this.reverting=!1;var i,o=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(i in this._storedCSS)"auto"!==this._storedCSS[i]&&"static"!==this._storedCSS[i]||(this._storedCSS[i]="");this.currentItem.css(this._storedCSS),this._removeClass(this.currentItem,"ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!t&&o.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||o.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(t||(o.push(function(e){this._trigger("remove",e,this._uiHash())}),o.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),o.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer)))),i=this.containers.length-1;i>=0;i--)t||o.push(n("deactivate",this,this.containers[i])),this.containers[i].containerCache.over&&(o.push(n("out",this,this.containers[i])),this.containers[i].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!t){for(i=0;i<o.length;i++)o[i].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){!1===e.Widget.prototype._trigger.apply(this,arguments)&&this.cancel()},_uiHash:function(t){var n=t||this;return{helper:n.helper,placeholder:n.placeholder||e([]),position:n.position,originalPosition:n.originalPosition,offset:n.positionAbs,item:n.currentItem,sender:t?t.element:null}}})}),define("views/PlanSelectionView",["require","exports","module","underscore","backbone","../models/CheckoutSession"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=e("../models/CheckoutSession"),s=o.View.extend({tagName:"div",className:"plan-selection",events:{"click .switch-monthly":function(){this.doCheckout("awesome")},"click .switch-yearly":function(){this.doCheckout("awesome:yearly")}},template:i.template("<a href='<%-close%>' class='close-button'>✕</a><error></error><div class='picker'>    <div class='plans-gotquestions container'>        <h3>Got Questions About Upgrading? <a href='#sub-faqs'>Check out the FAQs</a></h3>    </div>    <div class='plans row'>        <div class='plan col-sm-4 plan-free'>            <div class='plan-overview-wrapper'>                <div class='plan-overview'>                    <div class='plan-title freeforever' data-l10n-id='plans-free-forever-title'>Free Forever</div>                    <div class='plan-description' data-l10n-id='plans-free-description'>Ideal for discovering Coggle and occasional use.</div>                    <div class='plan-pricing'><span class='currency'>$</span><span class='price'>0</span><span class='period' data-l10n-id='forever'>forever</span></div>                    <a href='/me/billing' class='button outline select-free' data-l10n-id='manage-subscription'>Manage Subscription</a>                    <div class='button outline current' style='pointer-events: none' data-l10n-id='current-plan'>Your current plan</div>                </div>            </div>            <div class='plan-features'>                <div class='feature'><b data-l10n-id='feature-nprivate' data-l10n-args='{\"privateDiagrams_available\":\"<%- private_diagrams || 0%>\"}'><%- private_diagrams %> private diagram<%- (private_diagrams>1)?'s':'' %></b></div>                <div class='feature' data-l10n-id='feature-diagrams'><b>Unlimited</b> public diagrams</div>                <div class='feature' data-l10n-id='feature-realtime'><b>Real-time</b> collaboration</div>                <div class='feature' data-l10n-id='feature-rearrange'><b>Auto-arrange branches</b></div>                <div class='feature' data-l10n-id='feature-emoji'>Over <b>1600</b> <a data-l10n-name='icons-link' href='http://bloggle.coggle.it/post/147537221917/introducing-emoji-in-coggle-to-celebrate'>beautiful icons</a></div>                <div class='feature' data-l10n-id='feature-images'><b>Unlimited</b> image uploads</div>                <div class='feature' data-l10n-id='feature-downloads'><b>PDF & Image</b> download</div>                <div class='feature' data-l10n-id='feature-folders'><b>Shared folders</b></div>                <div class='feature' data-l10n-id='feature-labels'>Unconnected <b>text boxes</b></div>                <div class='feature' data-l10n-id='feature-exports'>Export as <b>.mm and text</b></div>                <div class='feature' data-l10n-id='feature-visio'>Export for <b>Microsoft Visio</b></div>                <div class='feature' data-l10n-id='feature-multiroot'><b>Multiple start points</b></div>                <div class='feature' data-l10n-id='feature-chat'>Comments & Chat</div>            </div>        </div>        <div class='plan col-sm-4 plan-awesome'>            <div class='plan-overview-wrapper'>                <div class='plan-overview'>                    <a href='/awesome' target='_blank' class='plan-title' data-l10n-id='plans-awesome-title'>Awesome</a>                    <div class='plan-description' data-l10n-id='plans-awesome-description'>Ideal for <b>personal</b> or <b>professional</b> use, with privacy and advanced features.</div>                    <div class='plan-pricing'><span class='currency'>$</span><span class='price'>5</span><span class='period' data-l10n-id='per-month'>per month</div>                    <a href='/me/billing' class='button outline manage' data-l10n-id='manage-subscription'>Manage Subscription</a>                    <a class='button outline switch-monthly' data-l10n-id='awesome-upgrade-monthly'>Upgrade (<b>$5</b>/month)</a>                    <a class='button outline switch-yearly' data-l10n-id='awesome-upgrade-yearly'>Upgrade (<b>$50</b>/year)</a>                    <div class='benefit' data-l10n-id='yearly-discount'>Pay yearly and get 2 months free!</div>                </div>            </div>            <div class='plan-features'>                <div class='feature secondary includes' data-l10n-id='feature-include-free'>Everything in <b>Free</b></div>                <div class='feature' data-l10n-id='feature-unlimited-private'><b>Unlimited private diagrams</b></div>                <div class='feature' data-l10n-id='feature-shapes'><b>More Item Shapes</b></div>                <div class='feature' data-l10n-id='feature-linestyles'><b>Control line style</b></div>                <div class='feature' data-l10n-id='feature-controlpoints'><b>Control line paths</b></div>                <div class='feature' data-l10n-id='feature-textalign'>Change <b>text alignment</b></div>                <div class='feature' data-l10n-id='feature-chathistory'><b>Full</b> chat history</div>                <div class='feature' data-l10n-id='feature-bigimages'><b>High-res image</b> uploads</div>                \x3c!--div class='feature' data-l10n-id='feature-attachments'>Attach <b>files</b></div--\x3e                <div class='feature' data-l10n-id='feature-editable-links'>Collaborate by <b>link</b></div>            </div>        </div>        <div class='plan col-sm-4 plan-organisation'>            <div class='plan-overview-wrapper'>                <div class='plan-overview'>                    <a href='/organisations' target='_blank' class='plan-title' data-l10n-id='plans-org-title'>Organisation</a>                    <div class='plan-description' data-l10n-id='plans-org-description'>Ideal for <b>teams</b> that want to control access to their data and consolidate billing.</div>                    <div class='plan-pricing'><span class='currency'>$</span><span class='price'>8</span><span class='period' data-l10n-id='per-member-per-month'>per member per month</span></div>                    <% if(existingOrg) { %>                        <div class='already-in-org'>You are already a member of the <a href='/<%- existingOrg.get('slug') %>'><%- existingOrg.get('name') %> Organisation.</a></div>                        <a href='/<%- existingOrg.get('slug') %>' data-bypass class='button outline select-organisation'  data-l10n-id='plans-view-existing-org'>View your Organisation</a>                        <a href='/organisations' data-bypass class='button outline select-organisation'  data-l10n-id='plans-create-new-org'>Create a new Organisation</a>                    <% } else { %>                         <a href='/organisations' data-bypass class='button outline select-organisation'  data-l10n-id='plans-findoutmore'>Find out more</a>                    <% } %>                 </div>            </div>            <div class='plan-features'>                <div class='feature includes' data-l10n-id='feature-org-awesome'>Everything from <b>Awesome</b></div>                <div class='feature' data-l10n-id='feature-org-saml-sso'>SAML Single Sign On</div>                <div class='feature' data-l10n-id='feature-org-separate'>Separate Personal workspace</div>                <div class='feature' data-l10n-id='feature-org-billing'><b>Consolidated billing</b></div>                <div class='feature' data-l10n-id='feature-bulkexport'><b>Bulk export</b></div>                <div class='feature' data-l10n-id='feature-adminpanel'><b>User & data</b> management</div>                <div class='feature' data-l10n-id='feature-branding'>Branded diagrams</div>            </div>        </div>        <div class='load-overlay'>            <div class='loadspinner'></div>        </div>    </div>    <div class='faqs container' id='sub-faqs'>        <div class='row'>            <div class='faq col-md-6'>                <div class='question'>What's your cancellation policy?</div>                <div class='answer'>You can always cancel at any time, with no further payments. All paid plans are completely flexible, with no contracts.</div>            </div>            <div class='faq col-md-6'>                <div class='question'>What happens if I cancel my plan?</div>                <div class='answer'>If you choose to cancel your Awesome plan you'll keep access to all the diagrams you've created, and all your private diagrams stay private. You'll be moved back to the free version.</div>            </div>            <div class='faq col-md-6'>                <div class='question'>How do I manage my account?</div>                <div class='answer'>Manage your account from your <a href='/me'>settings page</a>, via the menu in the top left of your documents list page.</div>            </div>            <div class='faq col-md-6'>                <div class='question'>Will all my collaborators need a paid plan?</div>                <div class='answer'>No, you can invite anyone else to work with you on any of your private or public diagrams, whether or not they have their own subscription.</div>            </div>            <div class='faq col-md-6'>                <div class='question'>What if I have a problem?</div>                <div class='answer'>If you have a problem with your subscription or ever need to get in touch just drop us an email at <b>hello@coggle.it</b>, or reply to any receipt email, and we'll make things right.</div>            </div>            <div class='faq col-md-6'>                <div class='question'>I've still got questions!</div>                <div class='answer'>Check our our <a href='https://coggle.help' target='_blank'>knowledge base</a> for detailed guides on features, or email them to us at <b>hello@coggle.it</b>!</div>            </div>        </div>    </div></div>"),initialize:function(e){i.bindAll(this,"render","error"),this.options=e,e.src&&(s._latest_src=e.src),this.$el.addClass("working");this.model.getPlans(function(e){if(this.render(),e)return this.$el.find("error").first().text("Failed to load current plan, please try again."),void this.$el.addClass("working");this.$el.removeClass("working"),this.options.plan&&("free"===this.currentPlan()?this.doCheckout(this.options.plan):this.options.coupon&&this.$el.find("error").first().text("You already have an active subscription so this coupon cannot be applied automatically - please email us at hello@coggle.it instead"))}.bind(this))},currentPlan:function(){var e=this.model.getPlans(),t=e.getActivePlan(),n=t?t.id:"free";return this.model.isTriallingAwesome()&&(n="free"),t&&t.get("ending")&&(n="free"),n},render:function(){var e=this.currentPlan(),t=this.model.privateDiagramAllowance();return this.$el.html(this.template({private_diagrams:t||3,close:this.options.close||"/",existingOrg:this.model.getOrganisations().at(0)})),this.$el.attr("data-plan",e),this.options.compact&&this.$el.find(".plans-gotquestions a").attr("href","/plans#sub-faqs").attr("target","_blank"),this},doCheckout:function(e){this.$el.addClass("working"),new r({plan:e,coupon:this.options.coupon}).redirect(this.error)},error:function(e){this.$el.removeClass("working"),e?(this.$el.find("error").first().text(e.message),console.error("Stripe Checkout Creation Error:"+e.message)):this.$el.find("error").first().text("")}});n.exports=s}),define("views/PitchView",["require","exports","module","underscore","backbone","views/PlanSelectionView","env","env"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=e("views/PlanSelectionView"),s={},l=o.View.extend({tagName:"div",className:"pitch-view",events:{"click .close-modal":"remove"},template:i.template("<div class='pitch-contents container'>    <div class='pitch-info col-md-8'>        <% if(teaser) { %>            <div class='teaser' style='background-image: url(<%=teaser%>)'/>        <% } %>        <% if(message) { %>            <div class='message'><%=message%></div>            <div class='pitch-features'>                <span>Unlimited Private Diagrams</span>                <span>Line Styles</span>                <span>Control Line Paths</span>                <span>Advanced Shapes</span>            </div>        <% } %>    </div>    <div class='pitch-plan col-md-4'></div>    <div class='close-modal close-button'>✕</div></div>"),initialize:function(e){i.bindAll(this,"render","remove"),this.options=e,this.plan=new r({model:getCoggleUser(),src:e.id,compact:!0}),this.addChildView(this.plan),this.listenToOnce(this.plan,"show_billing",function(){this.$el.addClass("signup")}.bind(this))},render:function(){return this.$el.html(this.template({message:this.options.message,teaser:this.options.teaser})),this.plan.$el.addClass("compact"),this.$el.find(".pitch-plan").append(this.plan.render().$el),this}});i.extend(l,o.Events);var a=null;o.View.extend({tagName:"div",className:"compact-pitch-view",events:{"click .close-modal":"close"},template:i.template("<div class='pitch-contents'><div class='pitch-info'><% if(teaser) { %><div class='teaser' style='background-image: url(<%=teaser%>)'/><% } %><div class='text-content'><a class='message' href='/me/billing'><%=message%></a><div class='pitch-features'><span>Unlimited Private Diagrams</span><span>Line Styles</span><span>Control Line Paths</span><span>Advanced Shapes</span></div></div></div><div class='close-modal close-button'></div></div>"),initialize:function(e){i.bindAll(this,"render","close"),this.options=e,a&&a.remove&&(a.remove(),a=null),a=this},render:function(){return this.$el.html(this.template({message:this.options.compact_message||this.options.message||"The Awesome plan includes powerful features for more advanced control.",teaser:this.options.teaser})),this},close:function(){a=null,this.remove()}});l.show=function(e){if(l.trigger("pitch",e),!window.Coggle_App_Main){e.id&&(getCoggleUser().getActions().perform(e.id),s.hasOwnProperty(e.id)?!0:s[e.id]=1);var t;t=new l(e),$("body").append(t.render().$el),this.listenTo(o.history,"route",function(){t.remove()})}},l.MultiRoot=function(){l.show({id:"pitch:multiroot",title:"Multiple Root Items",teaser:e("env").cdn.url+"/img/features/labels-to-roots.gif",message:"The Awesome plans comes with loads of great features, including creating multiple trees in one Coggle diagram! Upgrade now to turn labels into new root items."})},l.attachments=function(){l.show({id:"pitch:attachments",title:"Attach files to your Diagrams",teaser:e("env").cdn.url+"/img/features/attach.png",message:"Upgrade to Awesome to attach files to your diagrams! With a free account you can add icons and images."})},n.exports=l}),define("views/FolderViews",["require","exports","module","underscore","backbone","utils/queryString","models/User","jquery-ui/widgets/sortable","views/PitchView"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=e("utils/queryString"),s=e("models/User");e("jquery-ui/widgets/sortable");var l=(e("views/PitchView"),o.View.extend({tagName:"li",className:"folder entry",template:i.template("<input type='text' name='title' class='title' data-l10n-attrs='value,placeholder' data-l10n-args='{\"name\":\"<%- name %>\"}' value='<%- name %>' <% if(l10n_id){ %> data-l10n-id='<%- l10n_id %>' <% } %> <% if(!name){ %> placeholder='Enter a folder name' <% } %>/><a class='leave tip'>  <span class='areyousure'><span data-l10n-id='folder-areyousure'>are you sure?</span> <span class='yes' data-l10n-id='folder-sure'>I&#39;m sure</span></span></a>"),events:{"click .leave":"leaveAreYouSure","touchstart .leave":"leaveAreYouSure","click .leave .areyousure .yes":"removeFolder","touchstart .leave .areyousure .yes":"removeFolder",keyup:"updateOnEnter","blur .title":"save",click:"navigate"},initialize:function(e){i.bindAll(this,"render","remove","destroy","save","navigate"),this.options=e,this.model.get("my_access")&&this.model.get("my_access").map(function(e){this.$el.addClass("permission-"+e)}.bind(this)),this.listenTo(this.model,"change",this.render),this.listenTo(this.model.getAccess(),"left",this.destroy),
this.$el.attr("data-id",this.model.id),this.model.isVirtual()&&this.$el.addClass("virtual"),this.el.view=this},addDropTarget:function(){(this.model.isShared()||this.model.canWrite())&&this.$el.sortable({connectWith:".folders .folder",items:".nothing",update:function(e,t){var n=t.item[0].model,i=$(e.target).attr("data-id");t.item.remove(),n.save({folder:i},{success:function(){n.collection.remove(n);var e=s.me().getActiveOrg().getFolders().get(i);e&&e.getDiagrams().add(n)},error:function(){o.history.fragment=null,o.history.navigate(window.location.pathname+window.location.search,{trigger:!0})}.bind(this)})}.bind(this)})},destroy:function(){this.$el.slideUp()},leaveAreYouSure:function(e){this.$el.addClass("leaving"),setTimeout(function(){this.$el.one("mouseleave",function(){window.setTimeout(function(){this.$el.removeClass("leaving")}.bind(this),1e3)}.bind(this))}.bind(this),0),e.stopImmediatePropagation()},removeFolder:function(){this.model.getAccess().trigger("left"),this.model.getAccess().getMe().destroy(),this.model.collection&&this.model.collection.remove(this.model);var e=s.me().getActiveOrg().get("slug");e=e?"/"+e:"",o.history.navigate(e+"/",!0),ga("send","event","Folder","Left")},render:function(){return this.$el.html(this.template(i.extend({l10n_id:"folder-title"},this.model.toJSON()))),this.$el.hasClass("selected")&&!this.model.isVirtual()||this.$el.find("input").prop("readonly",!0),this.addDropTarget(),this},save:function(){var e=this.$el.find("input").val();console.log("save folder name with value:",this.$el.find("input").val(),this.$el.find("input")),e&&e.trim()||(e=""),e!=this.model.get("name")&&(this.model.save({name:e}),ga("send","event","Folder","Renamed")),this.$el.removeClass("editing")},navigate:function(){var e=s.me().getActiveOrg().get("slug");e=e?"/"+e:"";var t=this.options.member;t=t?"?member="+t:"",r().org&&(t+=(t?"&":"?")+"org="+r().org),this.model.isRoot()?o.history.navigate(e+"/"+t,!0):o.history.navigate(e+"/folder/"+this.model.id+t,!0)},updateOnEnter:function(e){13==e.keyCode&&this.save()}})),a=i.template("<ul class='entries virtual'>    <li class='entry bookmarks' data-id='bookmarks'><a class='title' href='<%- orgslug? ('/'+orgslug) : '' %>/bookmarks' data-l10n-id='bookmarked'>Bookmarked for Review</a></li>    <li class='entry gallery' data-id='gallery'><a class='title' href='/folder/gallery' data-l10n-id='view-gallery'>Gallery</a></li></ul><div class='subtitle' data-l10n-id='shared-folders'>Shared Folders</div><ul class='entries folders'></ul><div class='create-folder'><div class='text' data-l10n-id='create-folder'>Create Folder</div></div>"),u=o.View.extend({tagName:"div",className:"folders",events:{"click .create-folder":"createFolder","touchstart .create-folder":"createFolder"},initialize:function(e){i.bindAll(this,"addOne","addAll","render","createFolder"),this.options=e,this.listenTo(this.collection,"reset",this.addAll),this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"change:name",function(){this.collection.sort(),this.render()}.bind(this)),this.options.member&&this.$el.find(".create-folder").remove(),this.addAll()},render:function(){var e=s.me();return this.$el.html(a({orgslug:e.getActiveOrg().get("slug")})),"gallery"==this.options.selected&&this.$el.find(".gallery").addClass("selected"),"bookmarks"==this.options.selected&&this.$el.find(".bookmarks").addClass("selected"),this.addAll(),e.getActiveOrg()===e.getOwnOrg()&&e.bookmarksSupported()||this.$el.find(".bookmarks").remove(),this},addOne:function(e){if(!(this.$el.find(".folder[data-id="+e.id+"]").length>0)){var t=new l({model:e,member:this.options.member});this.addChildView(t),e.isVirtual()?this.$el.find(".entries .bookmarks").before(t.$el):this.$el.find(".entries.folders").append(t.$el),this.options.selected==e.id&&t.$el.addClass("selected"),t.render()}},addAll:function(){this.collection.each(this.addOne)},setSelected:function(e){this.$el.find(".selected").removeClass("selected"),this.$el.find('[data-id="'+e+'"]').addClass("selected")},createFolder:function(){this.collection.createFolder(function(e,t){if(e)return o.history.navigate("/");var n=s.me().getActiveOrg().get("slug");n=n?"/"+n:"",o.history.navigate(n+"/folder/"+t.id,!0),setTimeout(function(){$(".folder[data-id="+t.id+"]").find("input").focus()}.bind(this),0)}.bind(this))}});n.exports.FolderView=l,n.exports.FolderList=u}),define("plugins/Backbone.childViews",["require","underscore"],function(e){var t=e("underscore");Backbone.View.prototype.addChildView=function(e){if(!e)throw new Error("invalid view");return this._child_views||(this._child_views=[]),this._child_views.push(e),this},Backbone.View.prototype.removeChildView=function(e){if(this._child_views)return this._child_views=t.without(this._child_views,e),this},Backbone.View.prototype.findByModel=function(e){return t.find(this._child_views,function(t){return t.model===e})};var n=Backbone.View.prototype.remove;Backbone.View.prototype.remove=function(){this._child_views&&(this._child_views.map(function(e){e.remove()}),this._child_views=[]),n.apply(this,arguments)}}),define("views/MemberIconView",["require","exports","module","underscore","backbone","models/User","env"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=e("models/User"),s=i.template("<div title='<%- name %>' style='background-image:url(<%- avatar.url %>); background-color: <%- avatar.colour %>;' class='user-icon'><% if(initials) { %><div class='initials'><%- initials %></div><% } %></div>"),l=function(e){return e.length&&e.codePointAt&&String&&String.fromCodePoint?String.fromCodePoint(e.codePointAt(0)):e.length?e[0]:""};n.exports=o.View.extend({tagName:"li",className:"member",events:{click:"selected"},initialize:function(){i.bindAll(this,"render","selected"),this.listenTo(this.model,"remove",this.remove)},render:function(){var t=this.model.toJSON();return t.initials="",t.name||(t.name=t.email),t.name||(t.name=t.emails?t.emails[0]:"??"),t.avatar||(t.avatar={url:e("env").cdn.url+"/img/anon-member-2x.png",source:"default"}),t.name&&"default"===t.avatar.source&&(t.initials=t.name.toUpperCase().split(" ").map(l).join("")),t.avatar.colour||(t.avatar.colour="#bbbbbb"),this.$el.html(s(t)),this.model.id==r.me().id&&this.$el.addClass("self"),this},selected:function(){this.trigger("selected",this)}})}),define("views/AccessListView",["require","exports","module","underscore","backbone","views/MemberIconView"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=e("views/MemberIconView"),s=i.template("<li class='member invite'>    <div class='user-icon' role='button' data-l10n-id='<%- l10nId %>' title='Invite'></div></li>");n.exports=o.View.extend({tagName:"ul",className:"members",events:{"click .member":"lockOpen"},initialize:function(e){i.bindAll(this,"addOne","addAll","render","addSharing","lockOpen","unlock"),this.options=e,this.collections=e.collections,this.l10nId=e.overridel10nId||"tooltip-invite",this.collections.map(function(e){e.listenTo(e,"add",this.addOne),e.listenTo(e,"reset",this.render)}.bind(this))},render:function(){return this.$el.empty(),this.addAll(),this.sharing&&this.$el.prepend(s({l10nId:this.l10nId})),this},addSharing:function(){return this.sharing=!0,this.render()},unlock:function(){this.$el.find(".lock-open").removeClass("lock-open"),this.$el.find(".lock-prev").removeClass("lock-prev"),this.$el.find(".lock-next").removeClass("lock-next")},lockOpen:function(e){this.unlock();var t=$(e.currentTarget);this.unlock(),t.addClass("lock-open"),t.next().addClass("lock-prev"),t.prev().addClass("lock-next"),t.one("mousedownoutside",this.unlock)},addOne:function(e){if(e.get("email")||e.get("direct")){var t=new r({model:e});this.addChildView(t),this.listenTo(t,"selected",function(){this.trigger("selected",e,t)}.bind(this)),this.$el.append(t.render().$el),this.$el.children().length>8&&this.$el.addClass("busy"),this.$el.children().length>32&&this.$el.addClass("vbusy")}},addAll:function(){this.collections.map(function(e){e.each(this.addOne)}.bind(this))}})}),function(e){"function"==typeof define&&define.amd?define("plugins/jquery.discreteSlider",["jquery","jquery-ui/widgets/draggable"],e):e(jQuery)}(function(e,t){e.fn.discreteSlider=function(t){function n(){var t=e(this),n=t.position().top+t.outerHeight()/2,o=1/0,r=null;if(t.siblings().each(function(){var t=e(this),i=t.position().top+t.outerHeight()/2,s=Math.abs(n-i);s<o&&(o=s,r=t)}),r){var s=Math.floor(r.position().top+r.outerHeight()/2-t.outerHeight()/2);t.animate({top:s},30),i.trigger("positionchange",r)}}var i=e(this),o=e.extend({draggable:{containment:"parent",axis:"y",stop:n}},t),r={addStop:function(t){var o=e("<li data="+t.data+">");t.class&&o.addClass(t.class);var s=e('<div class="marker">');if(t.label){var l=e('<div class="label">');t["data-l10n-id"]&&l.attr("data-l10n-id",t["data-l10n-id"]),t["data-l10n-args"]&&l.attr("data-l10n-args",t["data-l10n-args"]),l.append(t.label),t.title&&l.prop("title",t.title),o.append(l)}return o.append(s),e(this).append(o),o.click(function(t){e(this).hasClass("working")||(r.slideTo(o),t.stopPropagation(),i.one("movedto",function(){n.apply(i.find(".slider"))}))}.bind(this)),o}.bind(this),working:function(t){e(this).toggleClass("working",t),e(this).find(".slider").draggable({disabled:t})}.bind(this),addSlider:function(){var t=e('<div class="slider">');e(this).append(t),e(t).draggable(o.draggable)}.bind(this),slideTo:function(t,n){void 0===n&&(n=30),t=e(t);var o=t.siblings(".slider"),r=Math.floor(t.position().top+(t.outerHeight()/2-o.outerHeight()/2));0!==o.length&&o.animate({top:r},n,function(){i.trigger("movedto",t)}.bind(this))}.bind(this)};return r}}),function(e,t,n){function i(i,o){function r(t){e(s).each(function(){var n=e(this);this===t.target||n.has(t.target).length||n.triggerHandler(o,[t.target])})}o=o||i+n;var s=e(),l=i+"."+o+"-special-event";e.event.special[o]={setup:function(){s=s.add(this),1===s.length&&e(t).bind(l,r)},teardown:function(){s=s.not(this),0===s.length&&e(t).unbind(l)},add:function(e){var t=e.handler;e.handler=function(e,n){e.target=n,t.apply(this,arguments)}}}}e.map("click dblclick mousemove mousedown mouseup mouseover mouseout change select submit keydown keypress keyup".split(" "),function(e){i(e)}),i("focusin","focus"+n),i("focusout","blur"+n),e.addOutsideEvent=i}(jQuery,document,"outside"),define("jquery.outsideEvents",function(){}),define("views/AwesomePromotionView",["require","exports","module","underscore","backbone","env","env","env","views/PitchView"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=[e("env").cdn.url+"/img/features/choose-shape.gif",e("env").cdn.url+"/img/features/straight-connections.gif",e("env").cdn.url+"/img/features/control-paths.gif"],s=i.template('<div class="orgsupporter"><p class="tip" data-l10n-id="me-as-awesome-orgmember-p1">This is you &mdash; you\'re viewing Coggle as an <b>organisation member</b>.</p><p class="tip" data-l10n-id="me-as-awesome-orgmember-p2">This means you get all the great features from the <a data-l10n-name="awesome" data-bypass href="/awesome">Coggle Awesome</a> plan too!</p></div>'),l=i.template('<img class="feature-teaser" style="width:100%" src="<%- GIFs[Math.floor(GIFs.length*Math.random())]%>" /><div class="benefits"><p><span data-l10n-id="feature-private">Private Diagrams</span><b> ✓</b></p><p><span data-l10n-id="feature-controlpoints">Control line paths</span><b> ✓</b></p><p><span data-l10n-id="feature-shapes">More Item Shapes</span><b> ✓</b></p><p><span data-l10n-id="feature-chathistory"><b>Full</b> Chat History</span><b> ✓</b></p><p><span data-l10n-id="feature-linesstyles">Control line style</span><b> ✓</b></p><a class="button upgrade-now" data-l10n-id="upgrade-now">Upgrade Now</a><p><a href="/me/recommend" data-l10n-id="free-awesome">Want Awesome for free?</a></p></div>'),a=i.template('<div class="benefits"><p class="tip" data-l10n-id="me-support-awesomethanks-p1"><b>Thanks for supporting Coggle!</b></p><p class="tip" data-l10n-id="me-support-awesomethanks-p2">For being an early Coggle supporter, you get all the benefits of the <a data-l10n-name="awesome" data-bypass href="/awesome">Coggle Awesome</a> plan included in your subscription!</p><a data-l10n-id="me-manage-plan" href="/me/billing">Manage your plan</a></div>'),u=i.template('<div class="benefits" ><p data-l10n-id="me-awesome" class="tip">This is you &mdash;<b>You\'re Awesome!</b></p><a data-l10n-id="me-manage-plan" href="/me/billing">Manage your plan</a></div>'),d=o.View.extend({tagName:"div",className:"awesome",events:{"click .upgrade-now":"openSignup"},initialize:function(){i.bindAll(this,"render"),this.customerModel=this.model.getCustomer(function(e){e&&console.warn("failed to load customer",e),this.render()}.bind(this))},render:function(){return this.$el.empty(),getCoggleUser().getActiveOrg().id?this.$el.html(s()):this.model.isSupporter()?this.$el.html(a()):this.model.isAwesome()?this.$el.html(u()):(getCoggleUser().getActions().perform("pitch:awesome:ownicon"),this.$el.html(l({GIFs:r}))),this},openSignup:function(){var t=e("views/PitchView");return $("body").click(),t.show({id:"pitch:awesomesignup",big:!0,title:"Become Awesome!",teaser:r[Math.floor(r.length*Math.random())],message:"Join branches, create folders, make diagrams private, and lots more with Coggle Awesome! So why not upgrade now?"})}});n.exports=d}),define("views/AccessSliderView",["require","exports","module","underscore","backbone","plugins/jquery.discreteSlider","jquery.outsideEvents","views/AwesomePromotionView"],function(e,t,n){var i=e("underscore"),o=e("backbone");e("plugins/jquery.discreteSlider"),e("jquery.outsideEvents");var r=e("views/AwesomePromotionView"),s=i.template("<error></error><ul class='permissions discrete-slider'></ul><% if (is_removable) { %><a class='remove' data-l10n-id='access-remove' data-l10n-args='{\"user_givenName\":\"<%-name%>\"}'>Remove <%-name%></a><% } %>");n.exports=o.View.extend({tagName:"div",className:"access-slider",defaultRoles:[{label:'Read only<br/><span data-l10n-name="tip" class="tip">Only allow them to view</span>',data:"read","data-l10n-id":"access-readonly"},{label:'Read & create copies<br/><span data-l10n-name="tip" class="tip">Also allow downloading and copying</span>',data:"clone","data-l10n-id":"access-readclone"},{label:'Author<br/><span data-l10n-name="tip" class="tip">Allow editing and inviting others</span>',data:"write","data-l10n-id":"access-author"}],events:{"click .remove":"removeAccess","positionchange .permissions":"setRole"},initialize:function(e){i.bindAll(this,"render","error","removeAccess","update"),this.listenTo(this.model,"change",this.update),this.options=e,this.options.roles||(this.options.roles=this.defaultRoles)},render:function(){var e=this.model.toJSON();if(e.name||(e.name=e.email||"unknown"),e.is_removable=this.options.removable,this.model.get("user")&&this.model.get("user")==this.model.collection.myId()){var t=window.getCoggleUser(),n=new r({model:t});this.addChildView(n),this.$el.empty().append(n.render().$el)}else this.$el.html(s(e)),this.slider=this.$el.find(".permissions").discreteSlider(),this.options.roles.map(function(e){this.slider[e.data]=this.slider.addStop(e)}.bind(this)),this.slider.addSlider(),setTimeout(function(){this.update()}.bind(this),0);return this},error:function(e){this.$el.find("error").text(e)},update:function(){var e;return this.options.roles.map(function(t){-1!=this.model.get("permissions").indexOf(t.data)&&(e=t.data)}.bind(this)),this.slider.slideTo(this.slider[e],0),this},setRole:function(e,t){this.model.applyRole($(t).attr("data"),function(e){e?this.error("Failed to update role"):this.error(null)}.bind(this))},removeAccess:function(){this.model.destroy({success:function(){$(this.el).remove()}.bind(this)})}})}),function(e){"function"==typeof define&&define.amd?define("plugins/jquery.textover",["jquery","jquery.outsideEvents"],e):e(jQuery)}(function(e,t){e.fn.textover=function(t,n){function i(){if(n.loop||!(l>=t.length)){var r=t[l%t.length];l++,o.attr("placeholder",e(r).text()),s=window.setTimeout(i,n.fadeAfter)}}var o=e(this),r={fadeAfter:1e3,fadeDuration:200,loop:!1,hideOn:"keydown keyup keypress",showOn:"focusoutside keyup"};n=e.extend(r,n);var s,l=0,a={start:function(){l=0,i()}.bind(this),stop:function(){clearTimeout(s)}.bind(this)};return o.on(n.hideOn,a.stop),o.on(n.showOn,a.start),i(),a}}),function(e){"function"==typeof define&&define.amd?define("jquery-ui/keycode",["jquery","./version"],e):e(jQuery)}(function(e){return e.ui.keyCode={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),function(e){"function"==typeof define&&define.amd?define("jquery-ui/position",["jquery","./version"],e):e(jQuery)}(function(e){return function(){function t(e,t,n){return[parseFloat(e[0])*(c.test(e[0])?t/100:1),parseFloat(e[1])*(c.test(e[1])?n/100:1)]}function n(t,n){return parseInt(e.css(t,n),10)||0}function i(t){var n=t[0];return 9===n.nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(n)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:n.preventDefault?{width:0,height:0,offset:{top:n.pageY,left:n.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}var o,r=Math.max,s=Math.abs,l=/left|center|right/,a=/top|center|bottom/,u=/[\+\-]\d+(\.[\d]+)?%?/,d=/^\w+/,c=/%$/,h=e.fn.position;e.position={scrollbarWidth:function(){if(void 0!==o)return o;var t,n,i=e("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),r=i.children()[0];return e("body").append(i),t=r.offsetWidth,i.css("overflow","scroll"),n=r.offsetWidth,t===n&&(n=i[0].clientWidth),i.remove(),o=t-n},getScrollInfo:function(t){var n=t.isWindow||t.isDocument?"":t.element.css("overflow-x"),i=t.isWindow||t.isDocument?"":t.element.css("overflow-y"),o="scroll"===n||"auto"===n&&t.width<t.element[0].scrollWidth;return{width:"scroll"===i||"auto"===i&&t.height<t.element[0].scrollHeight?e.position.scrollbarWidth():0,height:o?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var n=e(t||window),i=e.isWindow(n[0]),o=!!n[0]&&9===n[0].nodeType;return{element:n,isWindow:i,isDocument:o,offset:i||o?{left:0,top:0}:e(t).offset(),scrollLeft:n.scrollLeft(),scrollTop:n.scrollTop(),width:n.outerWidth(),height:n.outerHeight()}}},e.fn.position=function(o){if(!o||!o.of)return h.apply(this,arguments);o=e.extend({},o);var c,p,f,g,m,v,y=e(o.of),b=e.position.getWithinInfo(o.within),w=e.position.getScrollInfo(b),_=(o.collision||"flip").split(" "),x={};return v=i(y),y[0].preventDefault&&(o.at="left top"),p=v.width,f=v.height,g=v.offset,m=e.extend({},g),e.each(["my","at"],function(){var e,t,n=(o[this]||"").split(" ");1===n.length&&(n=l.test(n[0])?n.concat(["center"]):a.test(n[0])?["center"].concat(n):["center","center"]),n[0]=l.test(n[0])?n[0]:"center",n[1]=a.test(n[1])?n[1]:"center",e=u.exec(n[0]),t=u.exec(n[1]),x[this]=[e?e[0]:0,t?t[0]:0],o[this]=[d.exec(n[0])[0],d.exec(n[1])[0]]}),1===_.length&&(_[1]=_[0]),"right"===o.at[0]?m.left+=p:"center"===o.at[0]&&(m.left+=p/2),"bottom"===o.at[1]?m.top+=f:"center"===o.at[1]&&(m.top+=f/2),c=t(x.at,p,f),m.left+=c[0],m.top+=c[1],this.each(function(){var i,l,a=e(this),u=a.outerWidth(),d=a.outerHeight(),h=n(this,"marginLeft"),v=n(this,"marginTop"),E=u+h+n(this,"marginRight")+w.width,A=d+v+n(this,"marginBottom")+w.height,S=e.extend({},m),C=t(x.my,a.outerWidth(),a.outerHeight());"right"===o.my[0]?S.left-=u:"center"===o.my[0]&&(S.left-=u/2),"bottom"===o.my[1]?S.top-=d:"center"===o.my[1]&&(S.top-=d/2),S.left+=C[0],S.top+=C[1],i={marginLeft:h,marginTop:v},e.each(["left","top"],function(t,n){e.ui.position[_[t]]&&e.ui.position[_[t]][n](S,{targetWidth:p,targetHeight:f,elemWidth:u,elemHeight:d,collisionPosition:i,collisionWidth:E,collisionHeight:A,offset:[c[0]+C[0],c[1]+C[1]],my:o.my,at:o.at,within:b,elem:a})}),o.using&&(l=function(e){var t=g.left-S.left,n=t+p-u,i=g.top-S.top,l=i+f-d,c={target:{element:y,left:g.left,top:g.top,width:p,height:f},element:{element:a,left:S.left,top:S.top,width:u,height:d},horizontal:n<0?"left":t>0?"right":"center",vertical:l<0?"top":i>0?"bottom":"middle"};p<u&&s(t+n)<p&&(c.horizontal="center"),f<d&&s(i+l)<f&&(c.vertical="middle"),r(s(t),s(n))>r(s(i),s(l))?c.important="horizontal":c.important="vertical",o.using.call(this,e,c)}),a.offset(e.extend(S,{using:l}))})},e.ui.position={fit:{left:function(e,t){var n,i=t.within,o=i.isWindow?i.scrollLeft:i.offset.left,s=i.width,l=e.left-t.collisionPosition.marginLeft,a=o-l,u=l+t.collisionWidth-s-o;t.collisionWidth>s?a>0&&u<=0?(n=e.left+a+t.collisionWidth-s-o,e.left+=a-n):e.left=u>0&&a<=0?o:a>u?o+s-t.collisionWidth:o:a>0?e.left+=a:u>0?e.left-=u:e.left=r(e.left-l,e.left)},top:function(e,t){var n,i=t.within,o=i.isWindow?i.scrollTop:i.offset.top,s=t.within.height,l=e.top-t.collisionPosition.marginTop,a=o-l,u=l+t.collisionHeight-s-o;t.collisionHeight>s?a>0&&u<=0?(n=e.top+a+t.collisionHeight-s-o,e.top+=a-n):e.top=u>0&&a<=0?o:a>u?o+s-t.collisionHeight:o:a>0?e.top+=a:u>0?e.top-=u:e.top=r(e.top-l,e.top)}},flip:{left:function(e,t){var n,i,o=t.within,r=o.offset.left+o.scrollLeft,l=o.width,a=o.isWindow?o.scrollLeft:o.offset.left,u=e.left-t.collisionPosition.marginLeft,d=u-a,c=u+t.collisionWidth-l-a,h="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,p="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,f=-2*t.offset[0];d<0?((n=e.left+h+p+f+t.collisionWidth-l-r)<0||n<s(d))&&(e.left+=h+p+f):c>0&&((i=e.left-t.collisionPosition.marginLeft+h+p+f-a)>0||s(i)<c)&&(e.left+=h+p+f)},top:function(e,t){var n,i,o=t.within,r=o.offset.top+o.scrollTop,l=o.height,a=o.isWindow?o.scrollTop:o.offset.top,u=e.top-t.collisionPosition.marginTop,d=u-a,c=u+t.collisionHeight-l-a,h="top"===t.my[1],p=h?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,f="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,g=-2*t.offset[1];d<0?((i=e.top+p+f+g+t.collisionHeight-l-r)<0||i<s(d))&&(e.top+=p+f+g):c>0&&((n=e.top-t.collisionPosition.marginTop+p+f+g-a)>0||s(n)<c)&&(e.top+=p+f+g)}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}}}(),e.ui.position}),function(e){"function"==typeof define&&define.amd?define("jquery-ui/unique-id",["jquery","./version"],e):e(jQuery)}(function(e){return e.fn.extend({uniqueId:function(){var e=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&e(this).removeAttr("id")})}})}),function(e){"function"==typeof define&&define.amd?define("jquery-ui/widgets/menu",["jquery","../keycode","../position","../safe-active-element","../unique-id","../version","../widget"],e):e(jQuery)}(function(e){return e.widget("ui.menu",{version:"1.12.1",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-caret-1-e"},items:"> *",menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().attr({role:this.options.role,tabIndex:0}),this._addClass("ui-menu","ui-widget ui-widget-content"),this._on({"mousedown .ui-menu-item":function(e){e.preventDefault()},"click .ui-menu-item":function(t){var n=e(t.target),i=e(e.ui.safeActiveElement(this.document[0]));!this.mouseHandled&&n.not(".ui-state-disabled").length&&(this.select(t),t.isPropagationStopped()||(this.mouseHandled=!0),n.has(".ui-menu").length?this.expand(t):!this.element.is(":focus")&&i.closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(t){if(!this.previousFilter){var n=e(t.target).closest(".ui-menu-item"),i=e(t.currentTarget);n[0]===i[0]&&(this._removeClass(i.siblings().children(".ui-state-active"),null,"ui-state-active"),this.focus(t,i))}},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(e,t){var n=this.active||this.element.find(this.options.items).eq(0);t||this.focus(e,n)},blur:function(t){this._delay(function(){!e.contains(this.element[0],e.ui.safeActiveElement(this.document[0]))&&this.collapseAll(t)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(e){this._closeOnDocumentClick(e)&&this.collapseAll(e),this.mouseHandled=!1}})},_destroy:function(){var t=this.element.find(".ui-menu-item").removeAttr("role aria-disabled"),n=t.children(".ui-menu-item-wrapper").removeUniqueId().removeAttr("tabIndex role aria-haspopup");this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeAttr("role aria-labelledby aria-expanded aria-hidden aria-disabled tabIndex").removeUniqueId().show(),n.children().each(function(){var t=e(this);t.data("ui-menu-submenu-caret")&&t.remove()})},_keydown:function(t){var n,i,o,r,s=!0;switch(t.keyCode){case e.ui.keyCode.PAGE_UP:this.previousPage(t);break;case e.ui.keyCode.PAGE_DOWN:this.nextPage(t);break;case e.ui.keyCode.HOME:this._move("first","first",t);break;case e.ui.keyCode.END:this._move("last","last",t);break;case e.ui.keyCode.UP:this.previous(t);break;case e.ui.keyCode.DOWN:this.next(t);break;case e.ui.keyCode.LEFT:this.collapse(t);break;case e.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(t);break;case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:this._activate(t);break;case e.ui.keyCode.ESCAPE:this.collapse(t);break;default:s=!1,i=this.previousFilter||"",r=!1,o=t.keyCode>=96&&t.keyCode<=105?(t.keyCode-96).toString():String.fromCharCode(t.keyCode),clearTimeout(this.filterTimer),o===i?r=!0:o=i+o,n=this._filterMenuItems(o),n=r&&-1!==n.index(this.active.next())?this.active.nextAll(".ui-menu-item"):n,n.length||(o=String.fromCharCode(t.keyCode),n=this._filterMenuItems(o)),n.length?(this.focus(t,n),this.previousFilter=o,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter}s&&t.preventDefault()},_activate:function(e){this.active&&!this.active.is(".ui-state-disabled")&&(this.active.children("[aria-haspopup='true']").length?this.expand(e):this.select(e))},refresh:function(){var t,n,i,o,r,s=this,l=this.options.icons.submenu,a=this.element.find(this.options.menus);this._toggleClass("ui-menu-icons",null,!!this.element.find(".ui-icon").length),i=a.filter(":not(.ui-menu)").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var t=e(this),n=t.prev(),i=e("<span>").data("ui-menu-submenu-caret",!0);s._addClass(i,"ui-menu-icon","ui-icon "+l),n.attr("aria-haspopup","true").prepend(i),t.attr("aria-labelledby",n.attr("id"))}),this._addClass(i,"ui-menu","ui-widget ui-widget-content ui-front"),t=a.add(this.element),n=t.find(this.options.items),n.not(".ui-menu-item").each(function(){var t=e(this);s._isDivider(t)&&s._addClass(t,"ui-menu-divider","ui-widget-content")}),o=n.not(".ui-menu-item, .ui-menu-divider"),r=o.children().not(".ui-menu").uniqueId().attr({tabIndex:-1,role:this._itemRole()}),this._addClass(o,"ui-menu-item")._addClass(r,"ui-menu-item-wrapper"),n.filter(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!e.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(e,t){if("icons"===e){var n=this.element.find(".ui-menu-icon");this._removeClass(n,null,this.options.icons.submenu)._addClass(n,null,t.submenu)}this._super(e,t)},_setOptionDisabled:function(e){this._super(e),this.element.attr("aria-disabled",String(e)),this._toggleClass(null,"ui-state-disabled",!!e)},focus:function(e,t){var n,i,o;this.blur(e,e&&"focus"===e.type),this._scrollIntoView(t),this.active=t.first(),i=this.active.children(".ui-menu-item-wrapper"),this._addClass(i,null,"ui-state-active"),this.options.role&&this.element.attr("aria-activedescendant",i.attr("id")),o=this.active.parent().closest(".ui-menu-item").children(".ui-menu-item-wrapper"),this._addClass(o,null,"ui-state-active"),e&&"keydown"===e.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),n=t.children(".ui-menu"),n.length&&e&&/^mouse/.test(e.type)&&this._startOpening(n),this.activeMenu=t.parent(),this._trigger("focus",e,{item:t})},_scrollIntoView:function(t){var n,i,o,r,s,l;this._hasScroll()&&(n=parseFloat(e.css(this.activeMenu[0],"borderTopWidth"))||0,i=parseFloat(e.css(this.activeMenu[0],"paddingTop"))||0,o=t.offset().top-this.activeMenu.offset().top-n-i,r=this.activeMenu.scrollTop(),s=this.activeMenu.height(),l=t.outerHeight(),o<0?this.activeMenu.scrollTop(r+o):o+l>s&&this.activeMenu.scrollTop(r+o-s+l))},blur:function(e,t){t||clearTimeout(this.timer),this.active&&(this._removeClass(this.active.children(".ui-menu-item-wrapper"),null,"ui-state-active"),this._trigger("blur",e,{item:this.active}),this.active=null)},_startOpening:function(e){clearTimeout(this.timer),"true"===e.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(e)},this.delay))},_open:function(t){var n=e.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(t.parents(".ui-menu")).hide().attr("aria-hidden","true"),t.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(n)},collapseAll:function(t,n){clearTimeout(this.timer),this.timer=this._delay(function(){var i=n?this.element:e(t&&t.target).closest(this.element.find(".ui-menu"));i.length||(i=this.element),this._close(i),this.blur(t),this._removeClass(i.find(".ui-state-active"),null,"ui-state-active"),this.activeMenu=i},this.delay)},_close:function(e){e||(e=this.active?this.active.parent():this.element),e.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false")},_closeOnDocumentClick:function(t){return!e(t.target).closest(".ui-menu").length},_isDivider:function(e){return!/[^\-\u2014\u2013\s]/.test(e.text())},collapse:function(e){var t=this.active&&this.active.parent().closest(".ui-menu-item",this.element);t&&t.length&&(this._close(),this.focus(e,t))},expand:function(e){var t=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();t&&t.length&&(this._open(t.parent()),this._delay(function(){this.focus(e,t)}))},next:function(e){this._move("next","first",e)},previous:function(e){this._move("prev","last",e)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(e,t,n){var i;this.active&&(i="first"===e||"last"===e?this.active["first"===e?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[e+"All"](".ui-menu-item").eq(0)),i&&i.length&&this.active||(i=this.activeMenu.find(this.options.items)[t]()),this.focus(n,i)},nextPage:function(t){var n,i,o;if(!this.active)return void this.next(t);this.isLastItem()||(this._hasScroll()?(i=this.active.offset().top,o=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return n=e(this),n.offset().top-i-o<0}),this.focus(t,n)):this.focus(t,this.activeMenu.find(this.options.items)[this.active?"last":"first"]()))},previousPage:function(t){var n,i,o;if(!this.active)return void this.next(t);this.isFirstItem()||(this._hasScroll()?(i=this.active.offset().top,o=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return n=e(this),n.offset().top-i+o>0}),this.focus(t,n)):this.focus(t,this.activeMenu.find(this.options.items).first()))},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(t){this.active=this.active||e(t.target).closest(".ui-menu-item");var n={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(t,!0),this._trigger("select",t,n)},_filterMenuItems:function(t){
var n=t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),i=new RegExp("^"+n,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return i.test(e.trim(e(this).children(".ui-menu-item-wrapper").text()))})}})}),function(e){"function"==typeof define&&define.amd?define("jquery-ui/widgets/autocomplete",["jquery","./menu","../keycode","../position","../safe-active-element","../version","../widget"],e):e(jQuery)}(function(e){return e.widget("ui.autocomplete",{version:"1.12.1",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var t,n,i,o=this.element[0].nodeName.toLowerCase(),r="textarea"===o,s="input"===o;this.isMultiLine=r||!s&&this._isContentEditable(this.element),this.valueMethod=this.element[r||s?"val":"text"],this.isNewMenu=!0,this._addClass("ui-autocomplete-input"),this.element.attr("autocomplete","off"),this._on(this.element,{keydown:function(o){if(this.element.prop("readOnly"))return t=!0,i=!0,void(n=!0);t=!1,i=!1,n=!1;var r=e.ui.keyCode;switch(o.keyCode){case r.PAGE_UP:t=!0,this._move("previousPage",o);break;case r.PAGE_DOWN:t=!0,this._move("nextPage",o);break;case r.UP:t=!0,this._keyEvent("previous",o);break;case r.DOWN:t=!0,this._keyEvent("next",o);break;case r.ENTER:this.menu.active&&(t=!0,o.preventDefault(),this.menu.select(o));break;case r.TAB:this.menu.active&&this.menu.select(o);break;case r.ESCAPE:this.menu.element.is(":visible")&&(this.isMultiLine||this._value(this.term),this.close(o),o.preventDefault());break;default:n=!0,this._searchTimeout(o)}},keypress:function(i){if(t)return t=!1,void(this.isMultiLine&&!this.menu.element.is(":visible")||i.preventDefault());if(!n){var o=e.ui.keyCode;switch(i.keyCode){case o.PAGE_UP:this._move("previousPage",i);break;case o.PAGE_DOWN:this._move("nextPage",i);break;case o.UP:this._keyEvent("previous",i);break;case o.DOWN:this._keyEvent("next",i)}}},input:function(e){if(i)return i=!1,void e.preventDefault();this._searchTimeout(e)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(e){if(this.cancelBlur)return void delete this.cancelBlur;clearTimeout(this.searching),this.close(e),this._change(e)}}),this._initSource(),this.menu=e("<ul>").appendTo(this._appendTo()).menu({role:null}).hide().menu("instance"),this._addClass(this.menu.element,"ui-autocomplete","ui-front"),this._on(this.menu.element,{mousedown:function(t){t.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,this.element[0]!==e.ui.safeActiveElement(this.document[0])&&this.element.trigger("focus")})},menufocus:function(t,n){var i,o;if(this.isNewMenu&&(this.isNewMenu=!1,t.originalEvent&&/^mouse/.test(t.originalEvent.type)))return this.menu.blur(),void this.document.one("mousemove",function(){e(t.target).trigger(t.originalEvent)});o=n.item.data("ui-autocomplete-item"),!1!==this._trigger("focus",t,{item:o})&&t.originalEvent&&/^key/.test(t.originalEvent.type)&&this._value(o.value),(i=n.item.attr("aria-label")||o.value)&&e.trim(i).length&&(this.liveRegion.children().hide(),e("<div>").text(i).appendTo(this.liveRegion))},menuselect:function(t,n){var i=n.item.data("ui-autocomplete-item"),o=this.previous;this.element[0]!==e.ui.safeActiveElement(this.document[0])&&(this.element.trigger("focus"),this.previous=o,this._delay(function(){this.previous=o,this.selectedItem=i})),!1!==this._trigger("select",t,{item:i})&&this._value(i.value),this.term=this._value(),this.close(t),this.selectedItem=i}}),this.liveRegion=e("<div>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible"),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(e,t){this._super(e,t),"source"===e&&this._initSource(),"appendTo"===e&&this.menu.element.appendTo(this._appendTo()),"disabled"===e&&t&&this.xhr&&this.xhr.abort()},_isEventTargetInWidget:function(t){var n=this.menu.element[0];return t.target===this.element[0]||t.target===n||e.contains(n,t.target)},_closeOnClickOutside:function(e){this._isEventTargetInWidget(e)||this.close()},_appendTo:function(){var t=this.options.appendTo;return t&&(t=t.jquery||t.nodeType?e(t):this.document.find(t).eq(0)),t&&t[0]||(t=this.element.closest(".ui-front, dialog")),t.length||(t=this.document[0].body),t},_initSource:function(){var t,n,i=this;e.isArray(this.options.source)?(t=this.options.source,this.source=function(n,i){i(e.ui.autocomplete.filter(t,n.term))}):"string"==typeof this.options.source?(n=this.options.source,this.source=function(t,o){i.xhr&&i.xhr.abort(),i.xhr=e.ajax({url:n,data:t,dataType:"json",success:function(e){o(e)},error:function(){o([])}})}):this.source=this.options.source},_searchTimeout:function(e){clearTimeout(this.searching),this.searching=this._delay(function(){var t=this.term===this._value(),n=this.menu.element.is(":visible"),i=e.altKey||e.ctrlKey||e.metaKey||e.shiftKey;t&&(!t||n||i)||(this.selectedItem=null,this.search(null,e))},this.options.delay)},search:function(e,t){return e=null!=e?e:this._value(),this.term=this._value(),e.length<this.options.minLength?this.close(t):!1!==this._trigger("search",t)?this._search(e):void 0},_search:function(e){this.pending++,this._addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:e},this._response())},_response:function(){var t=++this.requestIndex;return e.proxy(function(e){t===this.requestIndex&&this.__response(e),--this.pending||this._removeClass("ui-autocomplete-loading")},this)},__response:function(e){e&&(e=this._normalize(e)),this._trigger("response",null,{content:e}),!this.options.disabled&&e&&e.length&&!this.cancelSearch?(this._suggest(e),this._trigger("open")):this._close()},close:function(e){this.cancelSearch=!0,this._close(e)},_close:function(e){this._off(this.document,"mousedown"),this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",e))},_change:function(e){this.previous!==this._value()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(t){return t.length&&t[0].label&&t[0].value?t:e.map(t,function(t){return"string"==typeof t?{label:t,value:t}:e.extend({},t,{label:t.label||t.value,value:t.value||t.label})})},_suggest:function(t){var n=this.menu.element.empty();this._renderMenu(n,t),this.isNewMenu=!0,this.menu.refresh(),n.show(),this._resizeMenu(),n.position(e.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next(),this._on(this.document,{mousedown:"_closeOnClickOutside"})},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(t,n){var i=this;e.each(n,function(e,n){i._renderItemData(t,n)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-autocomplete-item",t)},_renderItem:function(t,n){return e("<li>").append(e("<div>").text(n.label)).appendTo(t)},_move:function(e,t){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(e)||this.menu.isLastItem()&&/^next/.test(e)?(this.isMultiLine||this._value(this.term),void this.menu.blur()):void this.menu[e](t):void this.search(null,t)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(e,t){this.isMultiLine&&!this.menu.element.is(":visible")||(this._move(e,t),t.preventDefault())},_isContentEditable:function(e){if(!e.length)return!1;var t=e.prop("contentEditable");return"inherit"===t?this._isContentEditable(e.parent()):"true"===t}}),e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(t,n){var i=new RegExp(e.ui.autocomplete.escapeRegex(n),"i");return e.grep(t,function(e){return i.test(e.label||e.value||e)})}}),e.widget("ui.autocomplete",e.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(e){return e+(e>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(t){var n;this._superApply(arguments),this.options.disabled||this.cancelSearch||(n=t&&t.length?this.options.messages.results(t.length):this.options.messages.noResults,this.liveRegion.children().hide(),e("<div>").text(n).appendTo(this.liveRegion))}}),e.ui.autocomplete}),define("views/PrivateLinkViews",["require","exports","module","underscore","backbone","env","env","env","env","env"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r="<div class='icons'><% if(writable && write){ %><img src='"+e("env").cdn.url+"/img/writable.png' class='icon writable' data-l10n-id='viewers-can-edit' title='Viewers can edit the diagram.'><% } else if (writable && !write) { %><img src='"+e("env").cdn.url+"/img/nonwritable.png' class='icon nonwritable' data-l10n-id='viewers-readonly' title='Viewers can only view the diagram.'><% } %><% if(clonable){ %><img src='"+e("env").cdn.url+"/img/clonable.png' class='icon clonable' data-l10n-id='viewers-can-copy' title='Viewers may create their own copies.'><% } else { %><img src='"+e("env").cdn.url+"/img/nonclonable.png' class='icon nonclonable' data-l10n-id='viewers-nocopy' title='Viewers may not create copies.'><% } %><img src='"+e("env").cdn.url+"/img/bin.png' class='icon delete' data-l10n-id='revoke-link' title='Delete this link.'></div><div class='content'><span class='tags'><% _.each(tags, function(tag) { %><span class='tag' data-l10n-id='share-tag-<%- tag %>'><%- tag %></span><% }); %></span><input class='link' readonly value='<%-link%>'></input></div>",s=o.View.extend({tagName:"li",className:"privatelink",template:i.template(r),events:{"click .delete":"removeLink","click .clonable":"toggleClone","click .nonclonable":"toggleClone","click .writable":"toggleWrite","click .nonwritable":"toggleWrite","click .link":"select"},initialize:function(e){i.bindAll(this,"render","removeLink","select"),this.options=e,this.listenTo(this.model,"change",this.render)},render:function(){var e=this.model.toJSON();return e.link=window.location.protocol+"//"+window.location.host+window.location.pathname+"/"+this.model.get("key"),e.writable=this.options.writableAllowed&&-1===this.model.get("tags").indexOf("embed"),e.write=-1!==this.model.get("permissions").indexOf("write"),e.clonable=-1!==this.model.get("permissions").indexOf("clone"),this.$el.html(this.template(e)),e.write&&this.$el.find(".tags").append("<span class='tag write' data-l10n-id='share-tag-writable'>writable</span>"),this},select:function(){var e=this.$el.find(".link");e.select();var t=e[0];void 0!==t.selectionStart&&(t.selectionStart=0,t.selectionEnd=t.value.length)},removeLink:function(){this.model.destroy({success:function(){$(this.el).remove()}.bind(this)})},toggleClone:function(){this.model.toggleClone()},toggleWrite:function(){this.model.toggleWrite()}}),l=o.View.extend({tagName:"ul",className:"cogglelist",events:{},initialize:function(e){i.bindAll(this,"addOne","addAll","render"),this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"reset",this.addAll),this.writableAllowed="awesome"===e.diagram.myEditing(),this.addAll()},render:function(){return this.addAll(),this},addOne:function(e){var t=new s({model:e,writableAllowed:this.writableAllowed});this.addChildView(t),this.$el.append(t.render().$el)},addAll:function(){this.$el.empty(),this.collection.each(this.addOne)}});n.exports.PrivateLinkView=s,n.exports.PrivateLinkList=l}),define("views/ShareViews",["require","exports","module","underscore","backbone","async","l10n","plugins/jquery.textover","jquery-ui/widgets/autocomplete","views/PrivateLinkViews","env","env","env","env","env"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=e("async"),s=e("l10n");e("plugins/jquery.textover"),e("jquery-ui/widgets/autocomplete");var l=e("views/PrivateLinkViews").PrivateLinkList,a=" <div class='green button sendbutton hasInput' data-l10n-id='share-send-email'>SEND</div><div class='inputs'> <input type='text' name='emails' class='emails hasButton' placeholder='friend@example.com' /> <img src='"+e("env").cdn.url+"/img/spin.gif' class='spinner'> </div> <div style='clear:both'/>",u=o.View.extend({tagName:"div",className:"share-view",template:i.template(a),events:{"keypress .emails":"acceptOnEnter","keypress input":"addAutocomplete","click .green.sendbutton":"submit","touchstart .green.sendbutton":"submit"},initialize:function(e){i.bindAll(this,"render","remove","acceptOnEnter","submit","addAutocomplete"),this.options=e},render:function(){return this.$el.html(this.template(this.model.toJSON())),this.$el.find("input").textover($("<div>"+s.getSync("share-email-hints","<span>to invite, type an email</span><span>then hit enter</span><span>friend@example.com</span>")+"</div>").find("span")),this},error:function(e){this.trigger("error",e)},acceptOnEnter:function(e){13==e.keyCode&&this.submit()},submit:i.debounce(function(e){var t=this.$el.find(".emails").val();if(/^\s*$/.exec(t))return void this.error("Enter one or more email addresses first!");var n=t.match(/^\s*([a-zA-Z0-9-]+)\@orgs\.coggle\.it[, ;]*$/);if(n){var o=n[1];return void this.model.getAccess().getMe().grant(["read","write","list"],function(){this.model.set("organisation",o),this.model.set("folder",null),this.model.save({},{wait:!0,success:function(){window.location.reload()},error:function(e,t){this.model.set("organisation",this.model.previous("organisation")),this.model.set("folder",this.model.previous("folder")),this.error(t.responseJSON.description?t.responseJSON.description:"Sorry, there was error completeing your request.")}.bind(this)})}.bind(this))}if(this.$el.addClass("working"),t=t.split(/([^@]*@[^\s,;@]*)[\s,;@]*/),t=i.map(t,function(e){var t=/.*<(.+@.+)>/.exec(e);return t?t[1]:e}),t=t.map(function(e){return e.replace(/[<> \s\u00A0\u200B\t]/g,"").replace(/^mailto:/g,"")}),t=i.reject(t,function(e){return""===e}),t=i.filter(t,function(e){return!!/[^\s]+@[^\s]+\.[^\s]+/.exec(e)||(this.error('"'+e+'" is not a valid email address.'),!1)}.bind(this)),0===t.length)return this.$el.removeClass("working"),void this.error("Sorry, we couldn't understand that email address! Enter a single address, or several separated by commas or semicolons.");var s=this.model.getInvites(),l=[];r.eachSeries(t,function(e,t){s.create({email:e,permissions:["read","list","write","clone"]},{wait:!0,resend:!0,success:function(){t()},error:function(e,n){l.push(n),t()}})},function(){if(l.length){var e="Sorry, there was error completeing your request.";l[0].responseJSON.description&&(e=l[0].responseJSON.description),l.length>1&&(e="Sending emails to "+l.length+" recipients failed: "+e),this.error(e)}else this.$el.find("input").val("");this.model.getAccess().fetch(),this.model.getInvites().fetch(),this.$el.removeClass("working")}.bind(this)),this.model.getInvites().length+this.model.getAccess().length>2&&getCoggleUser().getActions().unique("invited multiple to diagram"),getCoggleUser().getActions().perform("invited-someone"),ga("send","event","Invite","Invite")},1e3,!0),addAutocomplete:function(){function t(e){return e.split(/,\s*/)}function n(e){return t(e).pop()}this.autoCompleteAdded||(this.autoCompleteAdded=!0,$.ajax({url:e("env").api.url+"/api/1/me/invited"}).done(function(e){this.$el.find(".emails").autocomplete({delay:100,minLength:2,appendTo:this.$el,source:function(t,i){i($.ui.autocomplete.filter(e,n(t.term)))}.bind(this),focus:function(){return!1},select:function(e,n){var i=t(this.value);return i.pop(),i.push(n.item.value),i.push(""),this.value=i.join(", "),getCoggleUser().getActions().unique("autocomplete:share:email"),!1}})}.bind(this)))}}),d=" <error></error><div class='public'>    <div class='checkbox-slider-frame'>        <span class='public-diagram slider-button <%-(public)?'on':''%>'><%-(!public)?'NO':'YES'%></span>    </div>    <input type='checkbox' name='public'/>    <div data-l10n-id='share-open' class='tip title'>Can everyone view this diagram?</div>    <div data-l10n-id='share-open-detail' class='tip description'>Public diagrams can be viewed by anyone and may appear in our <a data-l10n-name='gallery' target='_blank' data-bypass href='https://coggle.it/gallery'>Gallery</a>.</div></div><div  class='privatelinks'>     <h3>Private Links</h3>     <div class='social'>         <a class='embed' title='Embed in a website'>             <img src='"+e("env").cdn.url+"/img/embed.png' style='height:35px'/>         </a>         <a href='/diagram/<%- _id %>/share/facebook' class='facebook' title='Share on Facebook'>             <img src='"+e("env").cdn.url+"/img/facebook.png' style='height:35px'/>         </a>         <a href='/diagram/<%- _id %>/share/twitter' class='twitter' title='Share on X'>             <img src='"+e("env").cdn.url+"/img/twitter.png' style='height:35px'/>         </a>     </div>     <a class='newLink'>         <span class='small' data-l10n-id='share-newlink'>New Link</span>    </a>     <span class='tip' data-l10n-id='share-newlink-tip'>These let you share your diagram with people who aren't logged in, but be careful, they let <strong>anyone</strong> with the link see your work!</span> </div> <textarea class='embed-code'></textarea>",c=o.View.extend({template:i.template(d),embedTemplate:i.template("<iframe width='853' height='480' src='https://embed.coggle.it/diagram/<%- diagram %>/<%- key %>' frameborder='0' allowfullscreen></iframe>"),className:"social-share-view",events:{"click .facebook":"facebook","click .twitter":"twitter","click .newLink":"newLink","click .embed":"embed","changed .slider-button.public-diagram":"togglePublic"},initialize:function(){i.bindAll(this,"render","error"),this.privateLinkCollection=this.model.getPrivateLinks(function(e,t){e&&this.error("Failed to load private links")}.bind(this)),this.privatelinks=new l({collection:this.privateLinkCollection,diagram:this.model}),this.addChildView(this.privatelinks),this.listenTo(this.privateLinkCollection,"add",this.render),this.listenTo(this.privateLinkCollection,"remove",this.render),this.listenTo(this.model,"change",this.render)},render:function(){return this.model.canShare()?this.$el.html(this.template(this.model.toJSON())):this.$el.html("<div class='tip'>Sharing with people outside your Organisation, and creating public diagrams, have been disabled by your Organisation's administrators.</div>"),this.$(".privatelinks h3").after(this.privatelinks.render().$el),this.$el.find(".slider-button").booleanSlider(),this.showEmbed(),this},error:function(e){this.render(),this.$el.find("error").first().html(e)},showEmbed:function(e){var t=this.privateLinkCollection.find(function(e){return e.hasTag("embed")});if(t){this.$el.addClass("embedded");var n=t.toJSON();n.diagram=this.model.id,this.$el.find(".embed-code").text(this.embedTemplate(n))}else this.$el.removeClass("embedded"),this.$el.find(".embed-code").text("")},newLink:function(){this.model.getPrivateLinks().create({},{wait:!0}),getCoggleUser().getActions().perform("share:privatelink:create"),ga("send","event","Invite","Link")},embed:function(){this.model.getPrivateLinks().create({type:"embed"},{wait:!0}),ga("send","event","Share","Embed")},facebook:function(e,t){this.$el.find(".facebook")[0];ga("send","event","Share","Facebook")},twitter:function(e){var t=this.$el.find(".twitter")[0];return ga("send","event","Share","Twitter"),window.open(t.href),e.stopPropagation(),!1},togglePublic:function(e,t){this.model.save({public:t.state},{wait:!0,success:function(){this.error()}.bind(this),error:function(e,t){this.error(t.responseJSON.description)}.bind(this)})}});n.exports.ShareView=u,n.exports.DiagramShareView=c}),define("views/GlobalSearchView",["require","exports","module","underscore","backbone"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=i.template("<div class='search-box'><input type='text' class='search' data-l10n-id='search-diagrams' placeholder='Search your diagrams' value='<%- query %>'/></div>"),s=i.template("<div class='search-box'><input type='text' class='search' data-l10n-id='search-public-diagrams' placeholder='Search public diagrams' value='<%- query %>'/></div>"),l=o.View.extend({tagName:"div",className:"search-view",events:{"keydown input.search":"search"},initialize:function(e){i.bindAll(this,"render","search"),this.options=e},render:function(){return this.options.publicSearch?this.$el.html(s({query:this.options.query})):this.$el.html(r({query:this.options.query})),this},search:function(e){var t=getCoggleUser().getActiveOrg();if(27==e.keyCode&&this.$el.find(".search").val(""),27==e.keyCode||13==e.keyCode){var n=this.$el.find(".search").val();if(this.options.publicSearch)n="site:coggle.it "+n,getCoggleUser().getActions().unique("searched:public"),window.location="https://www.google.com/search?safe=on&q="+encodeURIComponent(n);else{getCoggleUser().getActions().unique("searched");var i="";t&&t.id&&(i=t.get("slug")),n.length?o.history.navigate(i+"/search/"+n,{trigger:!0,replace:!0}):o.history.navigate(i,!0)}}}});n.exports=l}),function(e){define("BrowserDetect",[],function(){return function(){var t={init:function(){this.browser=this.searchString(this.dataBrowser)||"unknown",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"unknown",this.OS=this.searchString(this.dataOS)||"unknown"},searchString:function(e){for(var t=0;t<e.length;t++){var n=e[t].string,i=e[t].prop;if(this.versionSearchString=e[t].versionSearch||e[t].identity,n){if(-1!=n.indexOf(e[t].subString))return e[t].identity}else if(i)return e[t].identity}},searchVersion:function(e){var t=e.indexOf(this.versionSearchString);if(-1!=t)return parseFloat(e.substring(t+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"Googlebot",identity:"Googlebot"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.userAgent,subString:"AppleWebKit",identity:"Safari",versionSearch:"AppleWebKit"},{string:navigator.userAgent,subString:" Qt/",identity:"WebKit",versionSearch:"WebKit"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Trident",identity:"Explorer",versionSearch:"rv"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"android",identity:"Android"},{string:navigator.appVersion,subString:"Android",identity:"Android"},{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iOS"},{string:navigator.userAgent,subString:"iPad",identity:"iOS"},{string:navigator.platform,subString:"Linux",identity:"Linux"},{string:navigator.platform,subString:"BlackBerry",identity:"BlackBerry"}]};return t.init(),e.BrowserDetect=t}.apply(e,arguments)})}(this),define("views/HomeActionsView",["require","exports","module","underscore","backbone","plugins/Backbone.childViews","views/AccessListView","views/AccessSliderView","views/ShareViews","views/GlobalSearchView","BrowserDetect","views/PitchView","env"],function(e,t,n){var i=e("underscore"),o=e("backbone");e("plugins/Backbone.childViews");var r=e("views/AccessListView"),s=e("views/AccessSliderView"),l=e("views/ShareViews").ShareView,a=e("views/GlobalSearchView"),u=e("BrowserDetect"),d=e("views/PitchView");n.exports=o.View.extend({tagName:"div",className:"home-actions-view",template:i.template("<div class='row'>    <div class='col-xs-12 implied-access'>        <div data-l10n-id='limitedaccess' data-l10n-args='{\"resourceName\":\"<%-name%>\"}'=>You have limited access to <%-name%> as you're re not a member</div>    </div>    <div class='col-xs-12 impersonated-access'>        <div data-l10n-id='impersonatedaccess'>You're viewing Coggle as an Organisation member. <a data-l10n-name='back' class='return button orange' href='/<%-slug%>/dashboard/membership'>Return to admin panel</a></div>  </div>  <div class='col-sm-7 resource-actions'>    <div class='open-nav-button'></div>    <a class='create-diagram button disabled' data-l10n-id='create-diagram-2-nothere' title='You cannot create new diagrams here, select a different folder first.'>      <span data-l10n-name='icon' class='buttonicon plusicon'></span>      <span data-l10n-name='label'>Create Diagram</span>    </a>    <a href='/plans?src=resource-actions' class='button orange upgrade' data-l10n-id='upgrade-now'>Upgrade Now</a>  </div>  <div class='col-sm-5 search-container'></div>  <div class='col-xs-12 access-list'></div>  <div class='col-xs-12 error'><error></error></div></div>"),events:{"click .create-diagram":"createDiagram","click .member.invite":"shareFolder"},initialize:function(e){i.bindAll(this,"render","error","createDiagram","openPermissions","shareFolder"),this.options=e,this.organisation=e.organisation,this.user=e.user,this.folder=e.folder,this.folders=e.folders,this.folders.on("sync",this.render),this.searchView=new a({model:this.user,query:this.options.search,publicSearch:"gallery"==this.folder}),this.addChildView(this.searchView)},render:function(){var e=this.organisation.id?this.organisation.toJSON():{_id:""};if(e.slug=this.organisation.get("slug"),this.$el.html(this.template(e)),this.user.isOrgOrAwesome()&&this.$el.find(".button.upgrade").remove(),this.options.member||this.$el.find(".impersonated-access").remove(),this.organisation.id&&!this.organisation.canRead()||this.$el.find(".implied-access").remove(),"bookmarks"===this.folder)return this;this.$el.find(".search-container").append(this.searchView.render().$el),this.searchView.delegateEvents();var t=this.folders.get(this.folder);if(t&&(!this.options.member&&t.canWrite()&&this.$el.find(".create-diagram").removeClass("disabled").attr("title","Create a new Coggle").attr("data-l10n-id","create-diagram-2-allowed"),!t.isVirtual())){var n=this.getAccessList();t.isAdmin()?this.$el.find(".access-list").append(n.render().addSharing(!0).$el):this.$el.find(".access-list").append(n.render().$el),n.delegateEvents()}return this},getAccessList:function(){var e=this.folders.get(this.folder);return e&&!this.memberList&&(this.memberList=new r({collections:[e.getAccess(function(){}),e.getInvites(function(){})],overridel10nId:"tooltip-invite-folder"}),this.listenTo(this.memberList,"selected",this.openPermissions),this.addChildView(this.memberList)),this.memberList},openPermissions:function(e,t){var n=this.folders.get(this.folder);if(n&&n.isAdmin()){if(this.accessSliders||(this.accessSliders={}),!this.accessSliders[e.id]){var i=[{label:'Read only<br/><span data-l10n-name="tip" class="tip">Only allow them to view</span>',data:"read","data-l10n-id":"access-folder-readonly"},{label:'Read & create copies<br/><span data-l10n-name="tip" class="tip">Also allow downloading and copying</span>',data:"clone","data-l10n-id":"access-folder-readclone"},{label:'Author<br/><span data-l10n-name="tip" class="tip">Allow creating and editing documents</span>',data:"write","data-l10n-id":"access-folder-author"},{label:'Administer<br/><span data-l10n-name="tip" class="tip">Add and remove people and documents</span>',data:"admin","data-l10n-id":"access-folder-admin"}],o=new s({model:e,roles:i,removable:!0}).render();this.addChildView(o),this.accessSliders[e.id]=t.$el.callout(o.$el,{my:"right top",at:"center bottom"})}this.accessSliders[e.id].open()}},shareFolder:function(e){var t=this.folders.get(this.folder);t&&(this.shareView||(this.shareView=new l({model:t}).render(),this.listenTo(this.shareView,"error",this.error),this.addChildView(this.shareView)),this.sharingCallout||(this.sharingCallout=this.$el.find(".member.invite").callout(this.shareView.$el,{my:"right top",at:"center bottom"})),this.sharingCallout.open(),this.shareView.delegateEvents(),"Explorer"===u.browser&&10==u.version||this.shareView.$el.find("input").focus(),ga("send","event","Folder","OpenShare"))},createDiagram:i.debounce(function(t){var n=this.folders.get(this.folder);if(n&&n.canWrite()){var i=this.user.getActions().get("diagram:created:public"),r=this.$el.find(".create-diagram");r.addClass("working disabled"),n.createDiagram(function(t,n){r.removeClass("working disabled"),t?this.error("Sorry, something went wrong while trying to create your diagram! Are you online?"):(o.history.navigate(n.docURL(),!0),n.get("public")&&!i&&d.show({id:"pitch:firstpublicdiagram",big:!0,title:"Public Diagram",teaser:e("env").cdn.url+"/img/features/public-diagram.gif",message:"<h3>This is a Public Diagram</h3><p>You've used up the private diagrams available to you for free. You can still create an unlimited number of public diagrams, or upgrade to create more private diagrams.</p><p>Read more about <a target='_blank' rel='noopener' href='https://coggle.help/article/76-what-is-a-public-diagram'>public diagrams</a>."}))}.bind(this))}},300,!0),error:function(e){this.$el.trigger("notify-warning",e||"Uh-oh, something unexpected happened!")}})}),define("views/RecommendProgressView",["require","exports","module","underscore","backbone"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=i.template("<% if (!has_redeemed) { %>    <a href='/me/recommend'>        <div class='blobs'>            <div class='blob filled'></div>            <div class='blob <%- invites.length > 0 ? 'filled' : ''%>' ></div>            <div class='blob <%- invites.length > 1 ? 'filled' : ''%>' ></div>            <div class='blob <%- invites.length > 2 ? 'filled' : ''%>' ></div>        </div>        <% if (!is_eligible) { %>            <% if (remaining_count == 1) { %>                <p data-l10n-id='invite-n-more' data-l10n-args='{\"introduceCount\":\"1\"}'>One more invite to try Awesome for free!</p>            <% } else { %>                <p data-l10n-id='invite-n-more' data-l10n-args='{\"introduceCount\":\"<%-remaining_count%>\"}'>Invite <span class='count'><%-remaining_count%></span> more people to try Awesome for free!</p>            <% } %>        <% } else { %>            <p>Claim your free month of Awesome!</p>        <% } %>    </a><% } %>"),s=o.View.extend({tagName:"div",className:"recommend-progress-view",initialize:function(e){i.bindAll(this,"render"),this.options=e,this.model.referralTrialEligiblilityState(function(e,t,n,i){e||(this.eligability={invites:n||[],remaining_count:i,is_eligible:t,has_redeemed:this.model.getActions().get("coupon:recommend-3")},this.render())}.bind(this))},render:function(){return this.eligability?(this.eligability.has_redeemed=this.model.getActions().get("coupon:recommend-3"),this.$el.html(r(this.eligability))):this.$el.html(""),this}});s.instance=function(e){return s._instance||(s._instance=new s(e)),s._instance},n.exports=s}),define("views/HomeView",["require","exports","module","underscore","backbone","views/UserLoginView","views/BannerViews","views/OrganisationPicker","utils/coggle-timeago","views/FolderViews","views/HomeActionsView","views/RecommendProgressView","jquery"],function(e,t,n){
var i=e("underscore"),o=e("backbone"),r=e("views/UserLoginView"),s=e("views/BannerViews").BannerStack,l=e("views/OrganisationPicker").OrganisationPicker,a=e("utils/coggle-timeago"),u=e("views/FolderViews").FolderList,d=e("views/HomeActionsView"),c=e("views/RecommendProgressView"),h=e("jquery"),p=i.template("<div class='coggle-sidebar'>    <div class='login'></div>    <div class='content'></div>    <div class='announcements'></div></div><div class='home-overlay'></div><div class='home-resources'></div>"),f=i.template("<a class='highlighted' href='/plans' class='awesome'><div data-l10n-id='awesome-time-remaining' class='title'>    Awesome trial expires <time data-l10n-name='remaining' datetime='<%- awesome_trial_expires %>'/></div><div data-l10n-id='awesome-trial-after' class='description'>Then you'll be moved onto the free plan</div></a>"),g=n.exports=o.View.extend({tagName:"div",className:"home-view scrollable",events:{"mousedown .open-nav-button":"toggleNavigation","touchstart .open-nav-button":"toggleNavigation","click .home-overlay":"hideNavigation","touchmove .home-overlay":"hideNavigation","touchstart .home-overlay":"hideNavigation","scroll .home-overlay":"soakEvent"},initialize:function(e){i.bindAll(this,"render","hideNavigation","toggleNavigation"),this.options=e,this.loginView=new r({model:this.options.user}),this.addChildView(this.loginView),this.bannerView=new s({collection:Messages}),this.addChildView(this.bannerView),this.foldersView=new u({collection:this.options.folders,selected:this.options.folder,member:this.options.member}),this.addChildView(this.foldersView),this.homeActionsView=new d({organisation:this.options.organisation,user:this.options.user,folders:this.options.folders,folder:this.options.folder,member:this.options.member,search:this.options.search}),this.addChildView(this.homeActionsView),this.orgPicker=new l({collection:this.options.user.getOrganisations(),hide_own_org:!this.options.user.hasOwnOrg()}),this.addChildView(this.orgPicker)},render:function(){return this.$el.html(p()),g.navigationOpen&&this.openNavigation(),this.renderSidebar(),this.renderAnnouncements(),this.$el.find(".home-resources").append(this.bannerView.render().$el),this.bannerView.delegateEvents(),this.$el.find(".home-resources").append(this.homeActionsView.render().$el),this.homeActionsView.delegateEvents(),this.contentView&&this.$el.find(".home-resources").append(this.contentView.render().$el),this},renderSidebar:function(){this.$el.find(".coggle-sidebar .login").html(this.loginView.render().$el),this.loginView.delegateEvents(),this.$el.find(".coggle-sidebar .content").html(this.foldersView.render().$el),this.foldersView.delegateEvents(),0!==this.options.user.getOrganisations().length&&(this.$el.find(".coggle-sidebar").prepend(this.orgPicker.render().$el),this.$el.addClass("has-organisation"),this.orgPicker.delegateEvents())},renderAnnouncements:function(){if(this.options.user.isTriallingAwesome()&&!this.options.organisation.id)this.$el.find(".announcements").html(f(this.options.user.toJSON()));else if(!this.options.user.isOrgOrAwesome()){var e=c.instance({model:this.options.user});this.$el.find(".announcements").html(e.render().$el)}h&&h.timeago&&h.timeago.settings&&(h.timeago.settings.allowFuture=!0),a.loadLanguages(function(){a.timeago(this.$el.find("time"))}.bind(this))},setContentView:function(e){this.contentView=e,this.addChildView(e),this.render()},toggleNavigation:i.throttle(function(e){return g.navigationOpen=!g.navigationOpen,this.$el.toggleClass("nav-open",g.navigationOpen),e.stopPropagation(),!1},100),hideNavigation:function(e){return g.navigationOpen=!1,this.$el.removeClass("nav-open"),e&&e.stopPropagation(),e&&e.preventDefault(),!1},openNavigation:function(){g.navigationOpen=!0,this.$el.addClass("nav-open")},soakEvent:function(e){return e.preventDefault(),e.stopPropagation(),!1}})}),define("twemoji",[],function(){return function(){"use strict";function e(e,t){return document.createTextNode(t?e.replace(y,""):e)}function t(e){return e.replace(w,l)}function n(e,t){return"".concat(t.base,t.size,"/",e,t.ext)}function i(e,t){for(var n,o,r=e.childNodes,s=r.length;s--;)n=r[s],o=n.nodeType,3===o?t.push(n):1!==o||"ownerSVGElement"in n||_.test(n.nodeName.toLowerCase())||i(n,t);return t}function o(e){return f(e.indexOf(b)<0?e.replace(y,""):e)}function r(t,n){for(var r,s,l,a,u,d,c,h,p,f,g,m,y,b=i(t,[]),w=b.length;w--;){for(l=!1,a=document.createDocumentFragment(),u=b[w],d=u.nodeValue,h=0;c=v.exec(d);){if(p=c.index,p!==h&&a.appendChild(e(d.slice(h,p),!0)),g=c[0],m=o(g),h=p+g.length,y=n.callback(m,n),m&&y){f=new Image,f.onerror=n.onerror,f.setAttribute("draggable","false"),r=n.attributes(g,m);for(s in r)r.hasOwnProperty(s)&&0!==s.indexOf("on")&&!f.hasAttribute(s)&&f.setAttribute(s,r[s]);f.className=n.className,f.alt=g,f.src=y,l=!0,a.appendChild(f)}f||a.appendChild(e(g,!1)),f=null}l&&(h<d.length&&a.appendChild(e(d.slice(h),!0)),u.parentNode.replaceChild(a,u))}return t}function s(e,n){return h(e,function(e){var i,r,s=e,l=o(e),a=n.callback(l,n);if(l&&a){s="<img ".concat('class="',n.className,'" ','draggable="false" ','alt="',e,'"',' src="',a,'"'),i=n.attributes(e,l);for(r in i)i.hasOwnProperty(r)&&0!==r.indexOf("on")&&-1===s.indexOf(" "+r+"=")&&(s=s.concat(" ",r,'="',t(i[r]),'"'));s=s.concat("/>")}return s})}function l(e){return m[e]}function a(){return null}function u(e){return"number"==typeof e?e+"x"+e:e}function d(e){var t="string"==typeof e?parseInt(e,16):e;return t<65536?x(t):(t-=65536,x(55296+(t>>10),56320+(1023&t)))}function c(e,t){return t&&"function"!=typeof t||(t={callback:t}),("string"==typeof e?s:r)(e,{callback:t.callback||n,attributes:"function"==typeof t.attributes?t.attributes:a,base:"string"==typeof t.base?t.base:g.base,ext:t.ext||g.ext,size:t.folder||u(t.size||g.size),className:t.className||g.className,onerror:t.onerror||g.onerror})}function h(e,t){return String(e).replace(v,t)}function p(e){v.lastIndex=0;var t=v.test(e);return v.lastIndex=0,t}function f(e,t){for(var n=[],i=0,o=0,r=0;r<e.length;)i=e.charCodeAt(r++),o?(n.push((65536+(o-55296<<10)+(i-56320)).toString(16)),o=0):55296<=i&&i<=56319?o=i:n.push(i.toString(16));return n.join(t||"-")}var g={base:"https://twemoji.maxcdn.com/v/13.0.0/",ext:".png",size:"72x72",className:"emoji",convert:{fromCodePoint:d,toCodePoint:f},onerror:function(){this.parentNode&&this.parentNode.replaceChild(e(this.alt,!1),this)},parse:c,replace:h,test:p},m={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"},v=/(?:\ud83d\udc68\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffc-\udfff]|\ud83d\udc68\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffd-\udfff]|\ud83d\udc68\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc68\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd\udfff]|\ud83d\udc68\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffc-\udfff]|\ud83d\udc69\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffc-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffd-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb\udffd-\udfff]|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd\udfff]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffd\udfff]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffe]|\ud83e\uddd1\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\u200d\ud83e\udd1d\u200d\ud83e\uddd1|\ud83d\udc6b\ud83c[\udffb-\udfff]|\ud83d\udc6c\ud83c[\udffb-\udfff]|\ud83d\udc6d\ud83c[\udffb-\udfff]|\ud83d[\udc6b-\udc6d])|(?:\ud83d[\udc68\udc69]|\ud83e\uddd1)(?:\ud83c[\udffb-\udfff])?\u200d(?:\u2695\ufe0f|\u2696\ufe0f|\u2708\ufe0f|\ud83c[\udf3e\udf73\udf7c\udf84\udf93\udfa4\udfa8\udfeb\udfed]|\ud83d[\udcbb\udcbc\udd27\udd2c\ude80\ude92]|\ud83e[\uddaf-\uddb3\uddbc\uddbd])|(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75]|\u26f9)((?:\ud83c[\udffb-\udfff]|\ufe0f)\u200d[\u2640\u2642]\ufe0f)|(?:\ud83c[\udfc3\udfc4\udfca]|\ud83d[\udc6e\udc70\udc71\udc73\udc77\udc81\udc82\udc86\udc87\ude45-\ude47\ude4b\ude4d\ude4e\udea3\udeb4-\udeb6]|\ud83e[\udd26\udd35\udd37-\udd39\udd3d\udd3e\uddb8\uddb9\uddcd-\uddcf\uddd6-\udddd])(?:\ud83c[\udffb-\udfff])?\u200d[\u2640\u2642]\ufe0f|(?:\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f|\ud83c\udff3\ufe0f\u200d\ud83c\udf08|\ud83c\udff4\u200d\u2620\ufe0f|\ud83d\udc15\u200d\ud83e\uddba|\ud83d\udc3b\u200d\u2744\ufe0f|\ud83d\udc41\u200d\ud83d\udde8|\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc6f\u200d\u2640\ufe0f|\ud83d\udc6f\u200d\u2642\ufe0f|\ud83e\udd3c\u200d\u2640\ufe0f|\ud83e\udd3c\u200d\u2642\ufe0f|\ud83e\uddde\u200d\u2640\ufe0f|\ud83e\uddde\u200d\u2642\ufe0f|\ud83e\udddf\u200d\u2640\ufe0f|\ud83e\udddf\u200d\u2642\ufe0f|\ud83d\udc08\u200d\u2b1b)|[#*0-9]\ufe0f?\u20e3|(?:[©®\u2122\u265f]\ufe0f)|(?:\ud83c[\udc04\udd70\udd71\udd7e\udd7f\ude02\ude1a\ude2f\ude37\udf21\udf24-\udf2c\udf36\udf7d\udf96\udf97\udf99-\udf9b\udf9e\udf9f\udfcd\udfce\udfd4-\udfdf\udff3\udff5\udff7]|\ud83d[\udc3f\udc41\udcfd\udd49\udd4a\udd6f\udd70\udd73\udd76-\udd79\udd87\udd8a-\udd8d\udda5\udda8\uddb1\uddb2\uddbc\uddc2-\uddc4\uddd1-\uddd3\udddc-\uddde\udde1\udde3\udde8\uddef\uddf3\uddfa\udecb\udecd-\udecf\udee0-\udee5\udee9\udef0\udef3]|[\u203c\u2049\u2139\u2194-\u2199\u21a9\u21aa\u231a\u231b\u2328\u23cf\u23ed-\u23ef\u23f1\u23f2\u23f8-\u23fa\u24c2\u25aa\u25ab\u25b6\u25c0\u25fb-\u25fe\u2600-\u2604\u260e\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262a\u262e\u262f\u2638-\u263a\u2640\u2642\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267b\u267f\u2692-\u2697\u2699\u269b\u269c\u26a0\u26a1\u26a7\u26aa\u26ab\u26b0\u26b1\u26bd\u26be\u26c4\u26c5\u26c8\u26cf\u26d1\u26d3\u26d4\u26e9\u26ea\u26f0-\u26f5\u26f8\u26fa\u26fd\u2702\u2708\u2709\u270f\u2712\u2714\u2716\u271d\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u2764\u27a1\u2934\u2935\u2b05-\u2b07\u2b1b\u2b1c\u2b50\u2b55\u3030\u303d\u3297\u3299])(?:\ufe0f|(?!\ufe0e))|(?:(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75\udd90]|[\u261d\u26f7\u26f9\u270c\u270d])(?:\ufe0f|(?!\ufe0e))|(?:\ud83c[\udf85\udfc2-\udfc4\udfc7\udfca]|\ud83d[\udc42\udc43\udc46-\udc50\udc66-\udc69\udc6e\udc70-\udc78\udc7c\udc81-\udc83\udc85-\udc87\udcaa\udd7a\udd95\udd96\ude45-\ude47\ude4b-\ude4f\udea3\udeb4-\udeb6\udec0\udecc]|\ud83e[\udd0c\udd0f\udd18-\udd1c\udd1e\udd1f\udd26\udd30-\udd39\udd3d\udd3e\udd77\uddb5\uddb6\uddb8\uddb9\uddbb\uddcd-\uddcf\uddd1-\udddd]|[\u270a\u270b]))(?:\ud83c[\udffb-\udfff])?|(?:\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc73\udb40\udc63\udb40\udc74\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc77\udb40\udc6c\udb40\udc73\udb40\udc7f|\ud83c\udde6\ud83c[\udde8-\uddec\uddee\uddf1\uddf2\uddf4\uddf6-\uddfa\uddfc\uddfd\uddff]|\ud83c\udde7\ud83c[\udde6\udde7\udde9-\uddef\uddf1-\uddf4\uddf6-\uddf9\uddfb\uddfc\uddfe\uddff]|\ud83c\udde8\ud83c[\udde6\udde8\udde9\uddeb-\uddee\uddf0-\uddf5\uddf7\uddfa-\uddff]|\ud83c\udde9\ud83c[\uddea\uddec\uddef\uddf0\uddf2\uddf4\uddff]|\ud83c\uddea\ud83c[\udde6\udde8\uddea\uddec\udded\uddf7-\uddfa]|\ud83c\uddeb\ud83c[\uddee-\uddf0\uddf2\uddf4\uddf7]|\ud83c\uddec\ud83c[\udde6\udde7\udde9-\uddee\uddf1-\uddf3\uddf5-\uddfa\uddfc\uddfe]|\ud83c\udded\ud83c[\uddf0\uddf2\uddf3\uddf7\uddf9\uddfa]|\ud83c\uddee\ud83c[\udde8-\uddea\uddf1-\uddf4\uddf6-\uddf9]|\ud83c\uddef\ud83c[\uddea\uddf2\uddf4\uddf5]|\ud83c\uddf0\ud83c[\uddea\uddec-\uddee\uddf2\uddf3\uddf5\uddf7\uddfc\uddfe\uddff]|\ud83c\uddf1\ud83c[\udde6-\udde8\uddee\uddf0\uddf7-\uddfb\uddfe]|\ud83c\uddf2\ud83c[\udde6\udde8-\udded\uddf0-\uddff]|\ud83c\uddf3\ud83c[\udde6\udde8\uddea-\uddec\uddee\uddf1\uddf4\uddf5\uddf7\uddfa\uddff]|\ud83c\uddf4\ud83c\uddf2|\ud83c\uddf5\ud83c[\udde6\uddea-\udded\uddf0-\uddf3\uddf7-\uddf9\uddfc\uddfe]|\ud83c\uddf6\ud83c\udde6|\ud83c\uddf7\ud83c[\uddea\uddf4\uddf8\uddfa\uddfc]|\ud83c\uddf8\ud83c[\udde6-\uddea\uddec-\uddf4\uddf7-\uddf9\uddfb\uddfd-\uddff]|\ud83c\uddf9\ud83c[\udde6\udde8\udde9\uddeb-\udded\uddef-\uddf4\uddf7\uddf9\uddfb\uddfc\uddff]|\ud83c\uddfa\ud83c[\udde6\uddec\uddf2\uddf3\uddf8\uddfe\uddff]|\ud83c\uddfb\ud83c[\udde6\udde8\uddea\uddec\uddee\uddf3\uddfa]|\ud83c\uddfc\ud83c[\uddeb\uddf8]|\ud83c\uddfd\ud83c\uddf0|\ud83c\uddfe\ud83c[\uddea\uddf9]|\ud83c\uddff\ud83c[\udde6\uddf2\uddfc]|\ud83c[\udccf\udd8e\udd91-\udd9a\udde6-\uddff\ude01\ude32-\ude36\ude38-\ude3a\ude50\ude51\udf00-\udf20\udf2d-\udf35\udf37-\udf7c\udf7e-\udf84\udf86-\udf93\udfa0-\udfc1\udfc5\udfc6\udfc8\udfc9\udfcf-\udfd3\udfe0-\udff0\udff4\udff8-\udfff]|\ud83d[\udc00-\udc3e\udc40\udc44\udc45\udc51-\udc65\udc6a\udc6f\udc79-\udc7b\udc7d-\udc80\udc84\udc88-\udca9\udcab-\udcfc\udcff-\udd3d\udd4b-\udd4e\udd50-\udd67\udda4\uddfb-\ude44\ude48-\ude4a\ude80-\udea2\udea4-\udeb3\udeb7-\udebf\udec1-\udec5\uded0-\uded2\uded5-\uded7\udeeb\udeec\udef4-\udefc\udfe0-\udfeb]|\ud83e[\udd0d\udd0e\udd10-\udd17\udd1d\udd20-\udd25\udd27-\udd2f\udd3a\udd3c\udd3f-\udd45\udd47-\udd76\udd78\udd7a-\uddb4\uddb7\uddba\uddbc-\uddcb\uddd0\uddde-\uddff\ude70-\ude74\ude78-\ude7a\ude80-\ude86\ude90-\udea8\udeb0-\udeb6\udec0-\udec2\uded0-\uded6]|[\u23e9-\u23ec\u23f0\u23f3\u267e\u26ce\u2705\u2728\u274c\u274e\u2753-\u2755\u2795-\u2797\u27b0\u27bf\ue50a])|\ufe0f/g,y=/\uFE0F/g,b=String.fromCharCode(8205),w=/[&<>'"]/g,_=/^(?:iframe|noframes|noscript|script|select|style|textarea)$/,x=String.fromCharCode;return g}()}),define("utils/coggle-encodeji",["require","exports","module","encodeji","twemoji","env"],function(e,t,n){var i=e("encodeji"),o=e("twemoji"),r=new i({extendData:[{unified:"1F4A9",short_name:"poop"},{unified:"2705",short_name:"check",short_names:["tick","true","check","done"],coggleSort:1},{unified:"274E",short_name:"green_cross",short_names:["green x","green false","green not"],coggleSort:2},{unified:"274C",short_name:"red_cross",short_names:["red x","red false","red not"],coggleSort:2.1},{unified:"26D4",short_names:["no entry","forbidden entry"],coggleSort:2.2},{unified:"1F6AB",short_name:"forbidden",short_names:["no","not allowed","forbidden","banned"],coggleSort:2.25},{unified:"26A0",short_names:["warning","warn","alert warn","beware","be aware","exclamation triangle","yellow exclamation","warning triangle"],coggleSort:2.3},{unified:"1F6A9",short_name:"red_flag",short_names:["red flag","highlight red"],coggleSort:3},{unified:"1F3F3",short_name:"white_flag",short_names:["white","white flag","highlight white","surrender"],coggleSort:1e6},{unified:"1F3F4",short_name:"black_flag",short_names:["black","black flag","highlight black"],coggleSort:4.1},{unified:"1F3C1",short_names:["race done","finished","complete","winner","win"],coggleSort:5},{unified:"1F1EC-1F1E7",short_names:["flag-gb","britain","british"],coggleSort:1e6},{unified:"2757",short_name:"!",short_names:["red exclamation","red exclamation point","alert","high priority","important"],coggleSort:6},{unified:"2753",short_names:["?","red question","query","unsure"],coggleSort:6.1},{unified:"203C",short_name:"!!",short_names:["double exclamation","high alert","very high priority","very important"],coggleSort:7},{unified:"2049",short_name:"!?",short_names:["exclamation question","confused alert","unknown problem"],coggleSort:8},{unified:"2764",short_name:"<3",short_names:["red heart","love"],coggleSort:2.9},{unified:"267B",short_name:"recycle",short_names:["reuse"],coggleSort:2.9},{unified:"2B50",short_name:"star",short_names:["favourite","favorite"],coggleSort:4.5},{unified:"1F4A5",short_name:"explode",short_names:["collide","bang","explosion"],coggleSort:9},{unified:"1F525",coggleSort:9.1},{unified:"270F",short_names:["note pencil","write pencil"],coggleSort:9.15},{unified:"2712",short_name:"fountain_pen",short_names:["note pen","write pen","fountain pen","nib pen"],coggleSort:9.16},{unified:"1F58A",short_name:"pen",short_names:["note ballpoint pen","write ballpooint pen","ballpoint pen"],coggleSort:9.16},{unified:"1F512",short_names:["lock","locked"],coggleSort:9.17},{unified:"1F513",short_names:["unlock","unlocked"],coggleSort:9.18},{unified:"1F389",short_names:["celebrate party popper","yay party"],coggleSort:9.2},{unified:"1F38A",short_names:["celebrate confetti","yay confeti","confeti"],coggleSort:9.3},{unified:"1F37E",short_name:"champagne",short_names:["celebrate champage","yay champagne","win champagne","victory champagne"],coggleSort:9.4},{unified:"1F37B",short_name:"beer_mugs",short_names:["cheers","congratulations beer","celebrate beer"],coggleSort:9.5},{unified:"1F464",short_name:"silhouette",short_names:["person silhouette","man silhouette","woman silhouette","person shadow"],coggleSort:10},{unified:"1F465",short_name:"silhouettes",short_names:["people silhouette","men silhouette","women silhouette","people shadow"],coggleSort:10.1},{unified:"1F603",short_names:[")","-)","happy face"],coggleSort:11},{unified:"1F612",short_names:["(","-(","sad face disappointed"],coggleSort:11.05},{unified:"2639",short_name:"frowning_face",short_names:["frowning sad face disappointed"],coggleSort:11.05},{unified:"1F622",short_names:["'(","'-(","sad cry"],coggleSort:11.1},{unified:"1F62E",short_names:["O","-o","shocked face"],coggleSort:11.2},{unified:"1F61B",short_names:["p","-p","toungue sticking out face"],coggleSort:11.3},{unified:"1F610",short_names:["|","-|","unimpressed face"],coggleSort:11.4},{unified:"1F617",short_names:["3","-3"],coggleSort:11.5},{unified:"1F44D",short_name:"+1",short_names:["thumbs","thumb up","thumbs up"],coggleSort:12},{unified:"1F44E",short_name:"-1",short_names:["thumb down","thumbs down"],coggleSort:12.1},{unified:"26BD",short_names:["football soccer","foot ball","real football"],coggleSort:13},{unified:"26A1",short_names:["lightning zap","electric zap","high voltage"],coggleSort:14},{unified:"1F4A1",short_names:["lightbulb","light bulb","electric bulb","idea bulb"],coggleSort:15},{unified:"2B06",short_names:["arrow_up","increase"]},{unified:"2B07",short_names:["arrow_down","decrease"]},{unified:"1F44A",short_name:"fist-2",coggleSort:1e6+1}]}),s=function(e){var t=[],n=r.dataByShortName;return e.forEach(function(e){if(t.push(e),n.hasOwnProperty(e)&&n[e].skin_variations)for(var i=2;i<7;i++)t.push(e+"::skin-tone-"+i)}),t},l=r.possibleShortNames;r.possibleShortNames=function(e){return s(l.call(this,e).sort(function(e,t){var n=r.dataByShortName;return(n[e].coggleSort||1e6)-(n[t].coggleSort||1e6)}))};var a=e("env").cdn.url+"/img/";return r.parse=function(e){return o.parse(e,{base:a,ext:".svg",folder:"twe",className:"twemoji"})},r.replaceAndRender=function(e){return"string"==typeof e?o.parse(this.replaceColons(e),{base:a,ext:".svg",folder:"twe",className:"twemoji"}):(this.replaceColons(e),o.parse(e,{base:a,ext:".svg",folder:"twe",className:"twemoji"}))},r}),define("utils/coordsFromEvent",["require","exports","module"],function(e,t,n){n.exports=function(e,t){function n(n){if(!n)return null;var i={x:!1,y:!1};return"number"==typeof i.x&&"number"==typeof i.y||(i.x=n.changedTouches&&n.changedTouches[0]&&n.changedTouches[0][e],i.y=n.changedTouches&&n.changedTouches[0]&&n.changedTouches[0][t]),"number"==typeof i.x&&"number"==typeof i.y||(i={x:n[e],y:n[t]}),"number"!=typeof i.x||"number"!=typeof i.y?null:i}function i(e){return n(e)||n(e.originalEvent)||n(e.srcEvent)||n(e.gesture&&e.gesture.srcEvent)||n(e.gesture&&e.gesture.originalEvent)||n(e.originalEvent&&e.originalEvent.gesture&&e.originalEvent.gesture.srcEvent)}return i}}),function(e){"use strict";"function"==typeof define&&define.amd?define("jquery.scrollTo",["jquery"],e):"undefined"!=typeof module&&module.exports?module.exports=e(require("jquery")):e(jQuery)}(function(e){"use strict";function t(t){return!t.nodeName||-1!==e.inArray(t.nodeName.toLowerCase(),["iframe","#document","html","body"])}function n(e){return"function"==typeof e}function i(t){return n(t)||e.isPlainObject(t)?t:{top:t,left:t}}var o=e.scrollTo=function(t,n,i){return e(window).scrollTo(t,n,i)};return o.defaults={axis:"xy",duration:0,limit:!0},e.fn.scrollTo=function(r,s,l){"object"==typeof s&&(l=s,s=0),"function"==typeof l&&(l={onAfter:l}),"max"===r&&(r=9e9),l=e.extend({},o.defaults,l),s=s||l.duration;var a=l.queue&&l.axis.length>1;return a&&(s/=2),l.offset=i(l.offset),l.over=i(l.over),this.each(function(){function u(t){var n=e.extend({},l,{queue:!0,duration:s,complete:t&&function(){t.call(h,f,l)}});p.animate(g,n)}if(null!==r){var d,c=t(this),h=c?this.contentWindow||window:this,p=e(h),f=r,g={};switch(typeof f){case"number":case"string":if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(f)){f=i(f);break}f=c?e(f):e(f,h);case"object":if(0===f.length)return;(f.is||f.style)&&(d=(f=e(f)).offset())}var m=n(l.offset)&&l.offset(h,f)||l.offset;e.each(l.axis.split(""),function(e,t){var n="x"===t?"Left":"Top",i=n.toLowerCase(),r="scroll"+n,s=p[r](),v=o.max(h,t);if(d)g[r]=d[i]+(c?0:s-p.offset()[i]),l.margin&&(g[r]-=parseInt(f.css("margin"+n),10)||0,g[r]-=parseInt(f.css("border"+n+"Width"),10)||0),g[r]+=m[i]||0,l.over[i]&&(g[r]+=f["x"===t?"width":"height"]()*l.over[i]);else{var y=f[i];g[r]=y.slice&&"%"===y.slice(-1)?parseFloat(y)/100*v:y}l.limit&&/^\d+$/.test(g[r])&&(g[r]=g[r]<=0?0:Math.min(g[r],v)),!e&&l.axis.length>1&&(s===g[r]?g={}:a&&(u(l.onAfterFirst),g={}))}),u(l.onAfter)}})},o.max=function(n,i){var o="x"===i?"Width":"Height",r="scroll"+o;if(!t(n))return n[r]-e(n)[o.toLowerCase()]();var s="client"+o,l=n.ownerDocument||n.document,a=l.documentElement,u=l.body;return Math.max(a[r],u[r])-Math.min(a[s],u[s])},e.Tween.propHooks.scrollLeft=e.Tween.propHooks.scrollTop={get:function(t){return e(t.elem)[t.prop]()},set:function(t){var n=this.get(t);if(t.options.interrupt&&t._last&&t._last!==n)return e(t.elem).stop();var i=Math.round(t.now);n!==i&&(e(t.elem)[t.prop](i),t._last=this.get(t))}},o}),function(e){"function"==typeof define&&define.amd?define("plugins/jquery.fullscreen",["jquery"],e):e(jQuery)}(function(e){var t=document;e.fullscreen=function(e){var n=t.documentElement;e?n.requestFullScreen?n.requestFullScreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullScreen&&n.webkitRequestFullScreen():t.cancelFullScreen?t.cancelFullScreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitCancelFullScreen&&t.webkitCancelFullScreen()}}),define("controllers/checkbox",["require","exports","module"],function(e,t){t.check=function(e,t,n){var i=/^( {0,3}- \[)[xX/\\ ](\])/gm,o=n?"X":" ",r=0;return e.replace(i,function(e,n,i,s,l){return r++===t?n+o+i:e})}}),define("views/AttachmentView",["require","exports","module","jquery","async","underscore","backbone"],function(e,t,n){var i=e("jquery"),o=(e("async"),e("underscore")),r=e("backbone"),s=function(e){var t=document.createElement("div");return t.appendChild(document.createTextNode(e)),t.innerHTML},l=function(e){return s(e).replace(/"/g,"&#34;").replace(/'/g,"&#39;")},a=function(e,t,n){var i=u(n&&n.get("mimetype")||"unknown");return n&&n.get("deleted_at")?'<div class="file-attachment deleted" data-attachment-id="'+e+'"><div class="attachment-icon unknown"></div><div class="attachment-title">'+s(t)+"</div></div>":'<div class="file-attachment" data-attachment-id="'+e+'" title="'+l(t)+'"><div class="'+i+'"></div><div class="attachment-title">'+s(t)+"</div></div>"},u=function(e){var t="unknown";return"text/rtf"===e||"application/msword"===e||"application/vnd.openxmlformats-officedocument.wordprocessingml.document"===e||/[.-]pages/.exec(e)?t="document":/\.spreadsheet/.exec(e)||/[.-]numbers/.exec(e)||"application/vnd.ms-excel"===e?t="spreadsheet":/\.presentation/.exec(e)||/[.-]keynote/.exec(e)||"application/vnd.ms-powerpoint"===e?t="presentation":/^video\/.*$/.exec(e)?t="video":/^audio\/.*$/.exec(e)?t="audio":/^image\/.*$/.exec(e)?t="image/png"===e?"png":"image":"text/plain"===e?t="text":"application/pdf"===e?t="pdf":"application/freemind"===e&&(t="mm"),"attachment-icon "+t},d=function(e,t,n){var i=e.toString();return i.length>=t?i:Array(1+t-i.length).join(n)+i},c=function(e){var t=new Date(e);return t.getFullYear()+"-"+d(t.getMonth()+1,2,"0")+"-"+d(t.getDate(),2,"0")+" "+d(t.getHours(),2,"0")+":"+d(t.getMinutes(),2,"0")},h=r.View.extend({className:"attachment-detail-container",events:{"click .delete":"removeAttachment"},template:function(e){if(e.download_url){if(e.deleted_at)return'<div class="error">Attachment file has been deleted.<a class="icon delete" title="Remove Reference to Deleted File"/></div>';var t=e.thumbnails&&e.thumbnails[0]&&e.thumbnails[0].url;return'<div class="attachment-detail-preview">'+(t?'<div class="attachment-thumb" style="background-image: url('+l(t)+')"></div>':"")+'<div class="'+u(e.mimetype)+'"></div><a class="icon download" href="'+l(e.download_url)+'" download="'+l(e.filename)+'" target="_blank" rel="noopener" title="Download attachment"></a><a class="icon delete" title="Remove Attachment"/></div><div class="attachment-detail-title">'+s(e.filename)+'</div><div class="attachment-detail-date">updated '+c(e.uploaded_at)+"</div>"}return'<div class="error">failed to load attachment</div>'},initialize:function(e){o.bindAll(this,"render","removeAttachment"),this.options=e},render:function(){var e=this.options.attachment_id,t=this.options.nodeView.model.getAttachment(e),n=this.options.diagram.model.getAttachments(),i=n&&n.getByLocalId(e),o={filename:t.title};return i&&(o.mimetype=i.get("mimetype")||"unknown",o.download_url=i.getUrl()||"about:blank",o.uploaded_at=i.get("uploaded_at"),o.deleted_at=i.get("deleted_at"),o.thumbnails=i.get("thumbnails")),this.$el.html(this.template(o)),this.options.diagram.readOnly()&&this.$el.find(".delete").remove(),this},removeAttachment:function(){var e=this.options.nodeView;e&&(e.model.removeAttachment(this.options.attachment_id),e.model.deltarize()),this.trigger("removed"),this.remove()}}),p={};p.renderAttachments=function(e,t,n){if(!n.length)return"";for(var i=t.getAttachments(),o='<div class="file-attachments">',r=0;r<n.length;r++)o+=a(n[r],e.getAttachment(n[r]).title,i.getByLocalId(n[r]));return o+="</div>"};var f=function(e){return e?e>=1e9?Math.round(e/1e8)/10+" GB":e>=1e6?Math.round(e/1e5)/10+" MB":Math.round(e/100)/10+" KB":"0 B"},g=function(e){return'<div class="'+u(e&&e.get("mimetype")||"unknown")+'"></div><div class="attachment-size">'+f(e.get("size"))+'</div><div class="attachment-title">'+s(e.get("name"))+'</div><div class="icons"><a class="button compact secondary" target="_blank" rel="noopener" href="'+l(e.getUrl())+'">Download File</a><a class="button compact secondary" target="_blank" rel="noopener" href="/diagram/'+e.get("diagram")+'">View Diagram</a><div class="button danger compact remove">Remove File</div><div class="areyousure">Are you Sure?</div><div class="button danger compact yesimsure" data-attachment-id="'+e.get("_id")+'">Yes</div></div>'},m=r.View.extend({tagName:"li",className:"manage-file-attachment",initialize:function(e){o.bindAll(this,"render"),this.options=e},render:function(){return this.$el.html(g(this.model)),this}}),v=r.View.extend({tagName:"div",className:"attachment-list-container",events:{"click .button.remove":"deleteFile","click .button.yesimsure":"deleteFileImSure"},initialize:function(e){this.options=e,o.bindAll(this,"render","removeOne","addOne","addAll","deleteFile","deleteFileImSure"),this.listenTo(this.collection,"remove",this.removeOne),this.listenTo(this.collection,"add",this.addOne),this.loaded=this.collection.loaded||this.collection.length,this.listenToOnce(this.collection,"sync",function(){this.loaded||(this.loaded=!0,this.render())}.bind(this))},render:function(){return this.loaded?(this.$el.html("<ul class='cogglelist attachment-list'></ul>"),this.addAll(),this.$el.fadeOut(0).fadeIn(150),this):(this.$el.html("<div class='loadspinner'>"),this)},removeOne:function(e){this.$el.find(".manage-file-attachment[data-id="+e.get("_id")+"]").remove()},addOne:function(e){if(this.$el.removeClass("empty"),!this.$el.find(".manage-file-attachment[data-id="+e.get("_id")+"]").length){var t=new m({model:e});this.addChildView(t);var n=t.render().$el;n.attr("data-id",e.get("_id")),this.$el.find(".attachment-list").append(n)}},addAll:function(){this.collection.forEach(function(e){this.addOne(e)}.bind(this))},deleteFile:function(e){return i(e.target).parent().addClass("deleting"),setTimeout(function(){i(e.target).parent().removeClass("deleting")},2e3),e.stopPropagation(),!1},deleteFileImSure:function(e){var t=i(e.target).attr("data-attachment-id");this.collection.get(t).destroy({error:function(){i(e.target).parent().removeClass("working")},wait:!0}),i(e.target).parent().addClass("working")}}),y=function(e){var t=e.attachment,n=e.user.name||"Unknown",i=t.getUrl()||"about:blank",o=t.get("name")||"unnamed";return"<div class='attachment-notification' style='border-color:"+l(e.user.colour)+"' title='"+l(n)+" attached this file to the diagram'><div class='"+u(t.get("mimetype"))+"'></div><div class='attachment-info'><span class='attachment-name'>"+s(o)+"</span><span class='attachment-info-details'>"+f(t.get("size"))+'</span></div><a class="icon download" href="'+i+'" download="'+l(o)+'" target="_blank" rel="noopener" title="Download attachment"></a></div>'};n.exports={AttachmentView:p,AttachmentDetailView:h,AttachmentsListView:v,attachmentNotificationTemplate:y}}),define("utils/lightbox",["require","exports","module","jquery"],function(e,t,n){function i(e,t,n){var i,r=e[0].naturalHeight,s=e[0].naturalWidth;if(s>128||r>96){if(e.addClass("lightboxable"),t)i=e;else{i=o('<div class="lightboxicon"></div>');var l=e.parent();l.is(".ui-wrapper,.lightboxable-wrapper")||(e.wrap("<div class='lightboxable-wrapper'></div>"),l=e.parent()),l.append(i)}i.on("tap click",function(t){if(!o(".modal-editing-background").length){var i=o('<div class="modal-editing-background">'),r=o("body");i.appendTo(r);var s=o('<img class="lightboxed"/>').attr("src",e.attr("src")).appendTo(r);return s.on("error",function(){var t=e.attr("data-attachment-id");t&&n.getAttachments(function(e,n){if(!e){var i=n.getByLocalId(t);i&&i.getUrl(function(e,t){e||s.attr("src",t)})}})}),i.on("tap click",function(){i.remove(),s.remove()}),t.preventDefault(),t.stopPropagation(),!1}})}}var o=e("jquery");n.exports.addLightbox=i}),define("utils/loadmathjax",["require","exports","module","jquery"],function(e,t,n){
function i(e){if(o("head").append(o('    <script type="text/x-mathjax-config">    MathJax.Ajax.config.root = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1",    MathJax.Hub.Config({      messageStyle:"none",      TeX:{extensions:["AMSmath.js", "mhchem.js"]},       skipStartupTypeset:true,    });    MathJax.Hub.processUpdateDelay = 0;    MathJax.Hub.processSectionDelay = 0;    MathJax.Hub.processUpdateTime = 0;    <\/script>')),r.push(e),"loaded"==a){for(var t=0;t<r.length;t++)r[t]&&r[t]();r=[]}else"loading"==a||(console.log("loading mathjax..."),o.getScript("https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML,Safe",function(){a="loaded",i()}),a="loading")}var o=e("jquery"),r=[],s=[],l=0,a="none",u=window.ensureMathJax=function(e){l++,i(e)},d=window.doneMathJax=function(){if(0===--l){for(var e=0;e<s.length;e++)s[e]();s=[]}};return{ensureMathJax:u,onMathJaxComplete:window.onMathJaxComplete=function(e){l?s.push(e):window.setTimeout(e,0)},doneMathJax:d}}),function(e){"function"==typeof define&&define.amd?define("plugins/jquery.checkable-md",["jquery"],e):e(jQuery)}(function(e){function t(e,t){if(e in t)return t[e];throw'missing required option: "'+e+'"'}function n(e,t,n){return e in t?t[e]:n}var i=require("controllers/checkbox").check,o=require("utils/trackModifiers");e.fn.checkable=function(r){var s=n("checkIndex",r,0),l=t("text",r),a=t("setTextFn",r),u=t("checkRecursively",r),d=this,c=e(d);e.each([c,c.siblings("label")],function(){e(this).bind("tap click mousedown",function(e){void 0!==e.stopPropagation?e.stopPropagation():void 0!==e.cancelBubble&&(e.cancelBubble=!0)})}),c.bind("change",function(){a(i(l,s,this.checked)),o.shift_key_pressed&&u(this.checked)}),c.bind("mousedown mouseup pointerdown pointerup touchstart touchend MSPointerDown MSPointerUp",function(e){e.stopPropagation()})}}),function(e){"function"==typeof define&&define.amd?define("jquery-ui/disable-selection",["jquery","./version"],e):e(jQuery)}(function(e){return e.fn.extend({disableSelection:function(){var e="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.on(e+".ui-disableSelection",function(e){e.preventDefault()})}}(),enableSelection:function(){return this.off(".ui-disableSelection")}})}),function(e){"function"==typeof define&&define.amd?define("jquery-ui/widgets/resizable",["jquery","./mouse","../disable-selection","../plugin","../version","../widget"],e):e(jQuery)}(function(e){return e.widget("ui.resizable",e.ui.mouse,{version:"1.12.1",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,classes:{"ui-resizable-se":"ui-icon ui-icon-gripsmall-diagonal-se"},containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(e){return parseFloat(e)||0},_isNumber:function(e){return!isNaN(parseFloat(e))},_hasScroll:function(t,n){if("hidden"===e(t).css("overflow"))return!1;var i=n&&"left"===n?"scrollLeft":"scrollTop",o=!1;return t[i]>0||(t[i]=1,o=t[i]>0,t[i]=0,o)},_create:function(){var t,n=this.options,i=this;this._addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!n.aspectRatio,aspectRatio:n.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:n.helper||n.ghost||n.animate?n.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,t={marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom"),marginLeft:this.originalElement.css("marginLeft")},this.element.css(t),this.originalElement.css("margin",0),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css(t),this._proportionallyResize()),this._setupHandles(),n.autoHide&&e(this.element).on("mouseenter",function(){n.disabled||(i._removeClass("ui-resizable-autohide"),i._handles.show())}).on("mouseleave",function(){n.disabled||i.resizing||(i._addClass("ui-resizable-autohide"),i._handles.hide())}),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t,n=function(t){e(t).removeData("resizable").removeData("ui-resizable").off(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(n(this.element),t=this.element,this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),n(this.originalElement),this},_setOption:function(e,t){switch(this._super(e,t),e){case"handles":this._removeHandles(),this._setupHandles()}},_setupHandles:function(){var t,n,i,o,r,s=this.options,l=this;if(this.handles=s.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=e(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),i=this.handles.split(","),this.handles={},n=0;n<i.length;n++)t=e.trim(i[n]),o="ui-resizable-"+t,r=e("<div>"),this._addClass(r,"ui-resizable-handle "+o),r.css({zIndex:s.zIndex}),this.handles[t]=".ui-resizable-"+t,this.element.append(r);this._renderAxis=function(t){var n,i,o,r;t=t||this.element;for(n in this.handles)this.handles[n].constructor===String?this.handles[n]=this.element.children(this.handles[n]).first().show():(this.handles[n].jquery||this.handles[n].nodeType)&&(this.handles[n]=e(this.handles[n]),this._on(this.handles[n],{mousedown:l._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(i=e(this.handles[n],this.element),r=/sw|ne|nw|se|n|s/.test(n)?i.outerHeight():i.outerWidth(),o=["padding",/ne|nw|n/.test(n)?"Top":/se|sw|s/.test(n)?"Bottom":/^e$/.test(n)?"Right":"Left"].join(""),t.css(o,r),this._proportionallyResize()),this._handles=this._handles.add(this.handles[n])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.on("mouseover",function(){l.resizing||(this.className&&(r=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),l.axis=r&&r[1]?r[1]:"se")}),s.autoHide&&(this._handles.hide(),this._addClass("ui-resizable-autohide"))},_removeHandles:function(){this._handles.remove()},_mouseCapture:function(t){var n,i,o=!1;for(n in this.handles)((i=e(this.handles[n])[0])===t.target||e.contains(i,t.target))&&(o=!0);return!this.options.disabled&&o},_mouseStart:function(t){var n,i,o,r=this.options,s=this.element;return this.resizing=!0,this._renderProxy(),n=this._num(this.helper.css("left")),i=this._num(this.helper.css("top")),r.containment&&(n+=e(r.containment).scrollLeft()||0,i+=e(r.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:n,top:i},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:s.width(),height:s.height()},this.originalSize=this._helper?{width:s.outerWidth(),height:s.outerHeight()}:{width:s.width(),height:s.height()},this.sizeDiff={width:s.outerWidth()-s.width(),height:s.outerHeight()-s.height()},this.originalPosition={left:n,top:i},this.originalMousePosition={left:t.pageX,top:t.pageY},this.aspectRatio="number"==typeof r.aspectRatio?r.aspectRatio:this.originalSize.width/this.originalSize.height||1,o=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor","auto"===o?this.axis+"-resize":o),this._addClass("ui-resizable-resizing"),this._propagate("start",t),!0},_mouseDrag:function(t){var n,i,o=this.originalMousePosition,r=this.axis,s=t.pageX-o.left||0,l=t.pageY-o.top||0,a=this._change[r];return this._updatePrevProperties(),!!a&&(n=a.apply(this,[t,s,l]),this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(n=this._updateRatio(n,t)),n=this._respectSize(n,t),this._updateCache(n),this._propagate("resize",t),i=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),e.isEmptyObject(i)||(this._updatePrevProperties(),this._trigger("resize",t,this.ui()),this._applyChanges()),!1)},_mouseStop:function(t){this.resizing=!1;var n,i,o,r,s,l,a,u=this.options,d=this;return this._helper&&(n=this._proportionallyResizeElements,i=n.length&&/textarea/i.test(n[0].nodeName),o=i&&this._hasScroll(n[0],"left")?0:d.sizeDiff.height,r=i?0:d.sizeDiff.width,s={width:d.helper.width()-r,height:d.helper.height()-o},l=parseFloat(d.element.css("left"))+(d.position.left-d.originalPosition.left)||null,a=parseFloat(d.element.css("top"))+(d.position.top-d.originalPosition.top)||null,u.animate||this.element.css(e.extend(s,{top:a,left:l})),d.helper.height(d.size.height),d.helper.width(d.size.width),this._helper&&!u.animate&&this._proportionallyResize()),e("body").css("cursor","auto"),this._removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var e={};return this.position.top!==this.prevPosition.top&&(e.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(e.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(e.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(e.height=this.size.height+"px"),this.helper.css(e),e},_updateVirtualBoundaries:function(e){var t,n,i,o,r,s=this.options;r={minWidth:this._isNumber(s.minWidth)?s.minWidth:0,maxWidth:this._isNumber(s.maxWidth)?s.maxWidth:1/0,minHeight:this._isNumber(s.minHeight)?s.minHeight:0,maxHeight:this._isNumber(s.maxHeight)?s.maxHeight:1/0},(this._aspectRatio||e)&&(t=r.minHeight*this.aspectRatio,i=r.minWidth/this.aspectRatio,n=r.maxHeight*this.aspectRatio,o=r.maxWidth/this.aspectRatio,t>r.minWidth&&(r.minWidth=t),i>r.minHeight&&(r.minHeight=i),n<r.maxWidth&&(r.maxWidth=n),o<r.maxHeight&&(r.maxHeight=o)),this._vBoundaries=r},_updateCache:function(e){this.offset=this.helper.offset(),this._isNumber(e.left)&&(this.position.left=e.left),this._isNumber(e.top)&&(this.position.top=e.top),this._isNumber(e.height)&&(this.size.height=e.height),this._isNumber(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,n=this.size,i=this.axis;return this._isNumber(e.height)?e.width=e.height*this.aspectRatio:this._isNumber(e.width)&&(e.height=e.width/this.aspectRatio),"sw"===i&&(e.left=t.left+(n.width-e.width),e.top=null),"nw"===i&&(e.top=t.top+(n.height-e.height),e.left=t.left+(n.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,n=this.axis,i=this._isNumber(e.width)&&t.maxWidth&&t.maxWidth<e.width,o=this._isNumber(e.height)&&t.maxHeight&&t.maxHeight<e.height,r=this._isNumber(e.width)&&t.minWidth&&t.minWidth>e.width,s=this._isNumber(e.height)&&t.minHeight&&t.minHeight>e.height,l=this.originalPosition.left+this.originalSize.width,a=this.originalPosition.top+this.originalSize.height,u=/sw|nw|w/.test(n),d=/nw|ne|n/.test(n);return r&&(e.width=t.minWidth),s&&(e.height=t.minHeight),i&&(e.width=t.maxWidth),o&&(e.height=t.maxHeight),r&&u&&(e.left=l-t.minWidth),i&&u&&(e.left=l-t.maxWidth),s&&d&&(e.top=a-t.minHeight),o&&d&&(e.top=a-t.maxHeight),e.width||e.height||e.left||!e.top?e.width||e.height||e.top||!e.left||(e.left=null):e.top=null,e},_getPaddingPlusBorderDimensions:function(e){for(var t=0,n=[],i=[e.css("borderTopWidth"),e.css("borderRightWidth"),e.css("borderBottomWidth"),e.css("borderLeftWidth")],o=[e.css("paddingTop"),e.css("paddingRight"),e.css("paddingBottom"),e.css("paddingLeft")];t<4;t++)n[t]=parseFloat(i[t])||0,n[t]+=parseFloat(o[t])||0;return{height:n[0]+n[2],width:n[1]+n[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var e,t=0,n=this.helper||this.element;t<this._proportionallyResizeElements.length;t++)e=this._proportionallyResizeElements[t],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(e)),e.css({height:n.height()-this.outerDimensions.height||0,width:n.width()-this.outerDimensions.width||0})},_renderProxy:function(){var t=this.element,n=this.options;this.elementOffset=t.offset(),this._helper?(this.helper=this.helper||e("<div style='overflow:hidden;'></div>"),this._addClass(this.helper,this._helper),this.helper.css({width:this.element.outerWidth(),height:this.element.outerHeight(),position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++n.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var n=this.originalSize;return{left:this.originalPosition.left+t,width:n.width-t}},n:function(e,t,n){var i=this.originalSize;return{top:this.originalPosition.top+n,height:i.height-n}},s:function(e,t,n){return{height:this.originalSize.height+n}},se:function(t,n,i){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,n,i]))},sw:function(t,n,i){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,n,i]))},ne:function(t,n,i){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,n,i]))},nw:function(t,n,i){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,n,i]))}},_propagate:function(t,n){e.ui.plugin.call(this,t,[n,this.ui()]),"resize"!==t&&this._trigger(t,n,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var n=e(this).resizable("instance"),i=n.options,o=n._proportionallyResizeElements,r=o.length&&/textarea/i.test(o[0].nodeName),s=r&&n._hasScroll(o[0],"left")?0:n.sizeDiff.height,l=r?0:n.sizeDiff.width,a={width:n.size.width-l,height:n.size.height-s},u=parseFloat(n.element.css("left"))+(n.position.left-n.originalPosition.left)||null,d=parseFloat(n.element.css("top"))+(n.position.top-n.originalPosition.top)||null;n.element.animate(e.extend(a,d&&u?{top:d,left:u}:{}),{duration:i.animateDuration,easing:i.animateEasing,step:function(){var i={width:parseFloat(n.element.css("width")),height:parseFloat(n.element.css("height")),top:parseFloat(n.element.css("top")),left:parseFloat(n.element.css("left"))};o&&o.length&&e(o[0]).css({width:i.width,height:i.height}),n._updateCache(i),n._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var t,n,i,o,r,s,l,a=e(this).resizable("instance"),u=a.options,d=a.element,c=u.containment,h=c instanceof e?c.get(0):/parent/.test(c)?d.parent().get(0):c;h&&(a.containerElement=e(h),/document/.test(c)||c===document?(a.containerOffset={left:0,top:0},a.containerPosition={left:0,top:0},a.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}):(t=e(h),n=[],e(["Top","Right","Left","Bottom"]).each(function(e,i){n[e]=a._num(t.css("padding"+i))}),a.containerOffset=t.offset(),a.containerPosition=t.position(),a.containerSize={height:t.innerHeight()-n[3],width:t.innerWidth()-n[1]},i=a.containerOffset,o=a.containerSize.height,r=a.containerSize.width,s=a._hasScroll(h,"left")?h.scrollWidth:r,l=a._hasScroll(h)?h.scrollHeight:o,a.parentData={element:h,left:i.left,top:i.top,width:s,height:l}))},resize:function(t){var n,i,o,r,s=e(this).resizable("instance"),l=s.options,a=s.containerOffset,u=s.position,d=s._aspectRatio||t.shiftKey,c={top:0,left:0},h=s.containerElement,p=!0;h[0]!==document&&/static/.test(h.css("position"))&&(c=a),u.left<(s._helper?a.left:0)&&(s.size.width=s.size.width+(s._helper?s.position.left-a.left:s.position.left-c.left),d&&(s.size.height=s.size.width/s.aspectRatio,p=!1),s.position.left=l.helper?a.left:0),u.top<(s._helper?a.top:0)&&(s.size.height=s.size.height+(s._helper?s.position.top-a.top:s.position.top),d&&(s.size.width=s.size.height*s.aspectRatio,p=!1),s.position.top=s._helper?a.top:0),o=s.containerElement.get(0)===s.element.parent().get(0),r=/relative|absolute/.test(s.containerElement.css("position")),o&&r?(s.offset.left=s.parentData.left+s.position.left,s.offset.top=s.parentData.top+s.position.top):(s.offset.left=s.element.offset().left,s.offset.top=s.element.offset().top),n=Math.abs(s.sizeDiff.width+(s._helper?s.offset.left-c.left:s.offset.left-a.left)),i=Math.abs(s.sizeDiff.height+(s._helper?s.offset.top-c.top:s.offset.top-a.top)),n+s.size.width>=s.parentData.width&&(s.size.width=s.parentData.width-n,d&&(s.size.height=s.size.width/s.aspectRatio,p=!1)),i+s.size.height>=s.parentData.height&&(s.size.height=s.parentData.height-i,d&&(s.size.width=s.size.height*s.aspectRatio,p=!1)),p||(s.position.left=s.prevPosition.left,s.position.top=s.prevPosition.top,s.size.width=s.prevSize.width,s.size.height=s.prevSize.height)},stop:function(){var t=e(this).resizable("instance"),n=t.options,i=t.containerOffset,o=t.containerPosition,r=t.containerElement,s=e(t.helper),l=s.offset(),a=s.outerWidth()-t.sizeDiff.width,u=s.outerHeight()-t.sizeDiff.height;t._helper&&!n.animate&&/relative/.test(r.css("position"))&&e(this).css({left:l.left-o.left-i.left,width:a,height:u}),t._helper&&!n.animate&&/static/.test(r.css("position"))&&e(this).css({left:l.left-o.left-i.left,width:a,height:u})}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).resizable("instance"),n=t.options;e(n.alsoResize).each(function(){var t=e(this);t.data("ui-resizable-alsoresize",{width:parseFloat(t.width()),height:parseFloat(t.height()),left:parseFloat(t.css("left")),top:parseFloat(t.css("top"))})})},resize:function(t,n){var i=e(this).resizable("instance"),o=i.options,r=i.originalSize,s=i.originalPosition,l={height:i.size.height-r.height||0,width:i.size.width-r.width||0,top:i.position.top-s.top||0,left:i.position.left-s.left||0};e(o.alsoResize).each(function(){var t=e(this),i=e(this).data("ui-resizable-alsoresize"),o={},r=t.parents(n.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(r,function(e,t){var n=(i[t]||0)+(l[t]||0);n&&n>=0&&(o[t]=n||null)}),t.css(o)})},stop:function(){e(this).removeData("ui-resizable-alsoresize")}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).resizable("instance"),n=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:n.height,width:n.width,margin:0,left:0,top:0}),t._addClass(t.ghost,"ui-resizable-ghost"),!1!==e.uiBackCompat&&"string"==typeof t.options.ghost&&t.ghost.addClass(this.options.ghost),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).resizable("instance");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).resizable("instance");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(){var t,n=e(this).resizable("instance"),i=n.options,o=n.size,r=n.originalSize,s=n.originalPosition,l=n.axis,a="number"==typeof i.grid?[i.grid,i.grid]:i.grid,u=a[0]||1,d=a[1]||1,c=Math.round((o.width-r.width)/u)*u,h=Math.round((o.height-r.height)/d)*d,p=r.width+c,f=r.height+h,g=i.maxWidth&&i.maxWidth<p,m=i.maxHeight&&i.maxHeight<f,v=i.minWidth&&i.minWidth>p,y=i.minHeight&&i.minHeight>f;i.grid=a,v&&(p+=u),y&&(f+=d),g&&(p-=u),m&&(f-=d),/^(se|s|e)$/.test(l)?(n.size.width=p,n.size.height=f):/^(ne)$/.test(l)?(n.size.width=p,n.size.height=f,n.position.top=s.top-h):/^(sw)$/.test(l)?(n.size.width=p,n.size.height=f,n.position.left=s.left-c):((f-d<=0||p-u<=0)&&(t=n._getPaddingPlusBorderDimensions(this)),f-d>0?(n.size.height=f,n.position.top=s.top-h):(f=d-t.height,n.size.height=f,n.position.top=s.top+r.height-f),p-u>0?(n.size.width=p,n.position.left=s.left-c):(p=u-t.width,n.size.width=p,n.position.left=s.left+r.width-p))}}),e.ui.resizable}),define("views/NodeTextView",["require","exports","module","underscore","utils/marked","backbone","utils/coggle-encodeji","utils/trackModifiers","utils/colours","controllers/checkbox","views/AttachmentView","utils/lightbox","l10n","utils/loadmathjax","plugins/jquery.checkable-md","jquery-ui/widgets/resizable","utils/queryString"],function(e,t,n){function i(e){return e.target.src&&($(e.target).addClass("missing"),e.target.src=v()),!0}function o(e,t){var n=this,i=new Image;i.src=n.attr("src");var o=i.width,r=i.height,s=/\.svg(\?[a-z0-9%_!$&'()*+,;=:@/?-]*)?(#[a-z0-9%?/:@._~!$&'()*+,;=-]*)?$/i.exec(i.src),l=s?5*o:o,a=s?5*r:r,u=!0;if(o&&r&&(u=o/r),l>4e3&&(a=a/l*4e3,l=4e3),a>4e3&&(l=l/a*4e3,a=4e3),!e.readOnly()){var d=n.attr("data-origsrc"),c=!1;n.one("mouseenter pointerenter",function(){c||(c=!0,n.resizable({handles:"se",autoHide:!0,aspectRatio:u,maxWidth:l,minWidth:20,maxHeight:a,minHeight:20,stop:function(e,n){var i=t.text(),o=i.indexOf(d)+d.length,r=i.indexOf(")",o),s=Math.round(n.size.width),l=Math.round(n.size.height),a=i.slice(0,o)+" "+s+"x"+l+i.slice(r);t.set("text",a);var u={text:t.text()},c=t.get("width");"number"==typeof c&&s>c&&(t.set("width",s),u.width=t.width()),t.deltarize(u)}}))})}}var r=e("underscore"),s=e("utils/marked"),l=e("backbone"),a=e("utils/coggle-encodeji"),u=(e("utils/trackModifiers"),e("utils/colours"),e("controllers/checkbox").check),d=e("views/AttachmentView").AttachmentView,c=e("utils/lightbox").addLightbox,h=e("l10n"),p=e("utils/loadmathjax");e("plugins/jquery.checkable-md"),e("jquery-ui/widgets/resizable");var f=e("utils/queryString"),g=f().print,m=r.template("<div class='node-container'><div class='node-content' dir='auto'></div><div class='comment-count'></div></div>"),v=function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAAtJREFUCB1jYAACAAAFAAGNu5vzAAAAAElFTkSuQmCC"},y=function(e){return-1!==e.indexOf("[")&&-1!==e.indexOf("]")},b=function(e,t){return function(n){t.allChildren().forEach(function(t){var i=t.text();if(y(i)){for(var o=e.getNodeForId(t.id),r=o.label.contentContainer.find(".tasklist-checkbox").length,s=0;s<r;s++)i=u(i,s,n);t.set("text",i),t.deltarize({text:i})}})}},w=l.View.extend({initialize:function(e){this.options=e,this._last_classes={},this._last_position={},this.setElement($(m())[0]),this.contentContainer=$(this.el.children[0]),this.commentCount=$(this.el.children[1]),r.bindAll(this,"updateHtmlPosition"),this.diagram=e.diagram,this.listenTo(this.model,"change",function(){var e=this.model.changedAttributes();(e.hasOwnProperty("text")||e.hasOwnProperty("attachments"))&&this.updateText(),(e.hasOwnProperty("scale")||e.hasOwnProperty("text_size"))&&this.updateScale(),e.hasOwnProperty("width")&&this.updateWidth(),e.hasOwnProperty("text_alignment")&&this.updateTextAlignment(),(e.hasOwnProperty("colour")||e.hasOwnProperty("shape"))&&this.updateColour(),(e.hasOwnProperty("pos")||e.hasOwnProperty("control_points"))&&this.updateHtmlPosition(),e.hasOwnProperty("highlight")&&this.updateHighlight()}.bind(this)),this.listenTo(this.model,"child_added child_removed",function(){this.updateColour(),this.updateHtmlPosition()}.bind(this)),this.listenTo(this.model,"ancestor_moved",this.updateHtmlPosition),this.updateAll()},updateAll:function(){this.updateText(),this.updateColour(),this.updateScale(),this.updateWidth(),this.updateTextAlignment(),this.updateHtmlPosition(),this.updateHighlight()},updateClasses:function(){var e=this.model.ltr(),t=this.model.ttb(),n=this.model.hasChildren(),i=this.model.isTitle(),o=this.model.isRoot(),s=this.model.shape(),l={ttb:t,ltr:e,children:n,isTitle:i,isRoot:o,hasShape:s};if(!r.isEqual(this._last_classes,l)){var a="",u="";o||s?(u+="lr-left lr-right tb-top tb-bottom ",a+="shape lr-center tb-middle "):1===e?n?1===t?(u+="lr-center lr-right tb-top tb-middle ",a+="lr-left tb-bottom "):(u+="lr-center lr-right tb-middle tb-bottom ",a+="lr-left tb-top "):(u+="lr-left lr-center tb-top tb-bottom ",a+="lr-right tb-middle "):n?1===t?(u+="lr-left lr-center tb-top tb-middle ",a+="lr-right tb-bottom "):(u+="lr-left lr-center tb-middle tb-bottom ",a+="lr-right tb-top "):(u+="lr-center lr-right tb-top tb-bottom ",a+="lr-left tb-middle "),n?a+="haschildren ":u+="haschildren ",o?(a+="root ",i?(u+="extraroot ",a+="titleroot "):(u+="titleroot ",a+="extraroot ")):o!==this._last_classes.isRoot&&(u+="root ",u+="extraroot ",u+="titleroot "),s!==this._last_classes.hasShape&&(s?a+="shape ":u+="shape ","label"===s?a+="label-shape ":u+="label-shape ","root"===s?a+="root-shape ":u+="root-shape "),this.$el.removeClass(u).addClass(a),this.contentContainer.attr("tabindex",this.model.level()+1),this._last_classes=l}},updateHighlight:function(){var e=this.model.get("highlight");e!==this._last_highlight&&("green"===e?this.$el.removeClass("hlpink").addClass("highlight hlgreen"):"pink"===e?this.$el.removeClass("hlgreen").addClass("highlight hlpink"):this.$el.removeClass("highlight hlpink hlgreen")),this._last_highlight=e},updateText:function(){var e=this.model.text(),t=this.model.attachmentIds();if(this._text!==e||!r.isEqual(t,this._attachment_ids)){if(this._text=e,this._attachment_ids=t,e||t.length){this.$el.removeClass("empty");var n="<div class='text-content'>"+s(e)+"</div>";this.contentContainer[0].innerHTML=n+d.renderAttachments(this.model,this.diagram.model,t),(-1!==e.indexOf("![")||t.length)&&this.setupImages(),this.emoji(),this.checkboxes(),this.compileLatex()}else this.$el.addClass("empty"),this.contentContainer[0].innerHTML="<div class='text-content'>"+w.emptyNodeContentFor(this.model)+"</div>";t.length&&!this.diagram.model.attachmentsLoaded()&&this.diagram.model.getAttachments(function(){this&&this.model&&(this._text=null,this.updateText())}.bind(this))}},updateWidth:function(){var e=this.model.width();e?(this.contentContainer.css({width:e,"white-space":""}),this.contentContainer.removeClass("unset-width")):(this.contentContainer.css({width:"auto","white-space":"nowrap"}),this.contentContainer.addClass("unset-width"))},updateTextAlignment:function(){var e=this.model.textAlignment();this.contentContainer.css({"text-align":e||""})},updateScale:function(){this.contentContainer.css("font-size",this.model.textSize())},updateColour:function(){var e=this.model.colour();this.commentCount.css({background:e}),this.$el.css("color",this.model.textColour())},updateHtmlPosition:function(){var e=Math.round(this.model.x()),t=Math.round(this.model.y()),n={top:t,left:e};r.isEqual(n,this._last_position)||this.$el.css(n),this._last_position=n,this.updateClasses()},emoji:function(){a.replaceAndRender(this.contentContainer[0])},compileLatex:function(){var e=this.model.text();-1==e.indexOf("$$")&&-1==e.indexOf("\\\\(")&&-1==e.indexOf("\\\\[")||p.ensureMathJax(function(){console.log("I solemnly swear that I am up to no math."),MathJax.Hub.Queue(["Typeset",MathJax.Hub,this.contentContainer[0]]),MathJax.Hub.Queue(function(){p.doneMathJax(),console.log("MathJax Managed")})}.bind(this))},setupImages:function(){var e=this.diagram,t=this.model,n=this.contentContainer.find("img");g&&n.each(function(){var t=$(this).attr("data-attachment-id");t&&e.model.waitForAttachment(t)}),e.model.getAttachments(function(t,i){if(t)return void console.log("failed to fetch attachments:",t);n.each(function(){var t=$(this).attr("data-attachment-id");if(t){n.addClass("loading");var o=i.getByLocalId(t);o?o.getUrl(function(e,t){e||(this.src=t)}.bind(this)):(console.warn("image referenced unknown attachment: "+t),g&&e.model.stopWaitingForAttachment(t),this.src=v(),$(this).removeClass("loading").addClass("missing").attr("title","Unknown attachment URL, unable to fetch image."))}})}),n.on("dragstart",function(e){e.preventDefault()}),n.on("error",i),n.on("load",function(n){var i=$(n.target);i.attr("src")!==v()&&(i.removeClass("missing"),g&&e.model.stopWaitingForAttachment(i.attr("data-attachment-id"))),i.removeClass("loading"),i.hasClass("file-attachment")||i.hasClass("missing")||(g||o.call(i,e,t),c(i,e.readOnly(),e.model))})},checkboxes:function(){var e=this.diagram,t=this.model,n=this.model.text();y(n)&&(this.diagram.readOnly()?this.contentContainer.find(".tasklist-checkbox").prop("disabled",!0):this.contentContainer.find(".tasklist-checkbox").each(function(i,o){$(o).checkable({text:n,checkIndex:i,setTextFn:function(e){t.set("text",e),t.deltarize({text:t.text()})},checkRecursively:b(e,t)})}))}});w.emptyNodeContentFor=function(e,t){var n=$("body").hasClass("touch");return w.rootEmptyNodeHTML||(n?(w.rootEmptyNodeHTML="<p><span>"+h.getSync("tap-to-edit-title","tap to edit title")+"</span></p>",w.emptyNodeHTML="<p><span>"+h.getSync("tap-to-edit","tap to edit")+"</span></p>"):(w.rootEmptyNodeHTML="<p><span>"+h.getSync("click-to-edit-title","click to edit title")+"</span></p>",w.emptyNodeHTML="<p><span>"+h.getSync("click-to-edit","click to edit")+"</span></p>"),w.rootEmptyNodeHTMLText=$(w.rootEmptyNodeHTML).text(),w.emptyNodeHTMLText=$(w.emptyNodeHTML).text()),t?e.isTitle()?w.rootEmptyNodeHTMLText:w.emptyNodeHTMLText:e.isTitle()?w.rootEmptyNodeHTML:w.emptyNodeHTML},w.nodeTemplate=m,n.exports=w}),define("models/NotificationSearch",["require","exports","module","underscore","backbone"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=function(e){var t={positive:[],negative:[]};if(!e)return t;var n=e.toLowerCase().match(/(?:[^\s"]+|"[^"]*")+/g);if(!n)return t;for(var i=0;i<n.length;i++){var o=n[i];o.length&&("-"===o[0]?t.negative.push(o.slice(1).replace(/"/g,"")):t.positive.push(o.replace(/"/g,"")))}return t},s=o.Model.extend({setQuery:function(e){this.set("query",e.trim())},getQuery:function(){return this.get("query")||""},setNodes:function(e){this.set("nodes",e)},pushNode:function(e){this.set("nodes",i.unique(i.compact(i.union(this.getNodes(),[e]))))},getNodes:function(){return this.get("nodes")||[]},activeTags:function(){return this.getNodes().map(function(e){return e.shortId()})},apply:function(e){var t=e;this.getNodes().length&&(t=e.withTags(this.activeTags()));var n=r(this.getQuery());return(n.positive.length||n.negative.length)&&(t=t.filter(function(e){var t;if("attachment"===e.get("type"))t="file attachment "+(e.get("attachment").get("name")||"").toLowerCase();else{var o=e.messageAndTags();t=o.message+o.searchText}var r=!n.positive.length||i.any(n.positive,function(e){return-1!==t.indexOf(e)}),s=n.negative.length&&i.any(n.negative,function(e){return-1!==t.indexOf(e)});return r&&!s})),t}});s.instance=function(){return s._instance||(s._instance=new s),s._instance},n.exports=s}),define("models/Message",["require","exports","module","backbone","env"],function(e,t,n){var i=e("backbone"),o=i.Model.extend({idAttribute:"_id",timeout:function(e){return setTimeout(function(){this.deactivate()}.bind(this),e),this},activate:function(){return this.set("active",!0),this},deactivate:function(){return this.set("active",!1),this}}),r=i.Collection.extend({model:o,url:e("env").api.url+"/api/1/messages",message:function(e){return this.add(e,{merge:!0})},error:function(e,t){return this.message({type:"error",message:e,_id:t,active:!0})},warning:function(e,t){return this.message({type:"warning",message:e,_id:t,active:!0})},info:function(e,t){return this.message({type:"info",message:e,_id:t,active:!0})}}),s=new r;s.add({_id:"whatspossible",
type:"warning",translation_id:"doclist-discover-whatspossible",message:"Want to get more from Coggle? Discover <a data-l10n-name='link' href='https://coggle.it/diagram/VfQqad5caWRBKzhf/ea5d69d1d095b194f1276a5f0afc68c3283cd9c3592fc4dd91c7831e4a77a1e4' id='whatspossiblelink' data-bypass target='_blank'>what's possible</a>.",active:!1}),s.add({_id:"update",type:"info",translation_id:"update-coggle",message:"A Coggle update is available! <a onclick='window.location.reload(true);'>Update now</a>",active:!1}),s.add({_id:"must-update",type:"error",translation_id:"must-update-coggle",message:"Your version of Coggle is too old to view this diagram. <a onclick='window.location.reload(true);'>Reload now</a> to update.",active:!1}),s.add({_id:"readonly",type:"warning",translation_id:"readonly-warning",message:"You cannot edit this diagram. <div data-l10n-name='suggestion' class='suggestion'>If you need to edit it, ask the author to give you permission.</div>",active:!1}),s.add({_id:"degraded",type:"warning",translation_id:"websocket-offline",message:"Changes may be slow due to network issues. <a data-l10n-name='helpfix' href='/websockets' target='_blank' data-bypass>Help me fix this!</a>",active:!1}),s.add({_id:"disconnected",type:"error",translation_id:"disconnect-warning",message:"<b>Connection lost</b>: Changes may not be saved",active:!1}),s.add({_id:"access-revoked",type:"error",translation_id:"access-revoked",message:"<b>Your editing access to this diagram was disabled by an author:</b> the latest change could not be saved.",active:!1}),s.add({_id:"unrecoverable",type:"error",translation_id:"unrecoverable-warning",message:"There was an unrecoverable error, please reload the page. If you have information about what might have gone wrong, please email <a data-l10-name='email' href='mailto:hello@coggle.it'>hello@coggle.it</a>",active:!1}),s.add({_id:"embedded",type:"notice",translation_id:"embedded-create-your-own",message:'Made with Coggle: <a href="https://coggle.it/?utm_source=createyourown&utm_medium=web&utm_campaign=embed" target="_blank">create your own mindmap</a>',active:!1}),s.add({_id:"deleted-recovery",type:"error",translation_id:"deleted-recovery",message:"<b>This diagram has been deleted, and may be erased at any time.</b> You still have access to it because you are logged in and were an author of the diagram.",active:!1}),s.add({_id:"deleted-for-you",type:"notice",translation_id:"deleted-for-you",message:"This diagram has been deleted from your documents list but it still exists in the documents list of someone you shared it with.",active:!1}),s.add({_id:"publicdiagram",type:"notice",translation_id:"publicdiagram-create-your-own",message:'Create your own diagrams like this <b>for free</b> with <a href="https://coggle.it/?utm_source=createyourown&utm_medium=web&utm_campaign=public" target="_blank">Coggle</a>',active:!1}),s.add({_id:"image-resize-plug",type:"warning",translation_id:"image-resize-plug",message:"Your image was resized - get <a data-l10n-name='awesome' href='/plans'>Awesome</a> to upload larger images!",active:!1}),s.add({_id:"private-overage",type:"warning",translation_id:"private-overage",message:"Uh oh! Looks like <b>you've used more private diagrams</b> than your plan provides! To edit this diagram make it public or upgrade to <a href='/plans'>Awesome</a>",active:!1}),s.add({_id:"shape-replaced-plug",type:"warning",translation_id:"shapes-replaced",message:"Some shapes were replaced: Upgrade to <a href='/plans'>Awesome</a> to use all the shapes.",active:!1}),s.add({_id:"local-storage-unavailable",type:"warning",translation_id:"local-storage-unavailable",message:"Local Storage is not available in your browser, or is full, so offline changes cannot be saved! Ensure that you are connected to the internet.",active:!1}),s.add({_id:"local-storage-full",type:"warning",translation_id:"local-storage-full",message:"Your browser's local storage is full, so further offline changes cannot be saved! Ensure that you are connected to the internet.",active:!1}),s.add({_id:"org-overdue",type:"error",translation_id:"org-overdue",message:"Your organisation subscription is overdue, and access will be suspended soon. Please contact your organisation administrator to update the payment details.",active:!1}),s.add({_id:"org-overdue-admin",type:"error",translation_id:"org-overdue-admin",message:"Your organisation subscription is overdue, and access will be suspended soon. Please check your payment details.",active:!1}),s.add({_id:"org-incomplete-admin",type:"error",translation_id:"org-incomplete-admin",message:"Your organisation's billing setup has not been completed. Please complete your billing information in the Organisation settings.",active:!1}),s.add({_id:"org-incomplete",type:"error",translation_id:"org-incomplete",message:"Your organisation's billing setup has not been completed. Please contact your Organisation administrator to add billing information.",active:!1}),s.add({_id:"title-not-removable",type:"info",translation_id:"title-not-removable",message:"This is the title of the diagram - it can't be removed.",active:!1}),$(window).on("notify-info",function(e,t,n,i){var o=s.info(t);i?o.timeout(i):(n||void 0===n)&&o.timeout(5e3)}),$(window).on("notify-warning",function(e,t,n,i){var o=s.warning(t);i?o.timeout(i):(n||void 0===n)&&o.timeout(5e3)}),$(window).on("notify-error",function(e,t,n){var i=s.error(t);(n||void 0===n)&&i.timeout(5e3)}),$(window).on("notify-elevate",function(){s.get("unrecoverable").set("active",!0)}),n.exports.MessageModel=o,n.exports.MessageCollection=r,n.exports.Messages=window.Messages=s}),define("views/working",["require","exports","module","jquery"],function(e,t,n){var i=e("jquery"),o=[],r=null;i(window).on("start-working",function(e,t){o.push(t),null===r&&(r=i("<div id='loading'><div class='loadspinner'></div></div><p></p></div>"),i(".coggle-workspace").append(r))}),i(window).on("done-working",function(e,t){var n=o.indexOf(t);-1!==n&&o.splice(n,1),0===o.length&&null!==r&&(r.fadeOut(250,function(){i(this).remove()}),r=null)})}),define("starc/starc.copypaste",["require","exports","module","underscore","BrowserDetect","views/PitchView","models/Node","views/shapes","models/Message","views/working"],function(e,t,n){function i(e){function t(e){if(e.text){var i,o=new RegExp("attached:/?/?([a-z0-9]*)","gi");do{(i=o.exec(e.text))&&n.push(i[1])}while(i)}p.each(e.children,t)}var n=[];return p.each(e,t),p.uniq(n)}function o(e,t,n,i){function o(t,n,i){var s=p.omit(t,["children","parent_id","hidden","root"]);s.shape&&"free"===e.model.myEditing()&&-1===m.free_shapes.indexOf(s.shape)&&(s.shape=m.default_free_shape,r||(v.get("shape-replaced-plug").activate().timeout(7e3),r=!0)),s.node_id&&(i.hasOwnProperty(s.node_id)||(i[s.node_id]=g.newNodeId()),s.node_id=i[s.node_id]),s.join&&(i.hasOwnProperty(s.join)||(i[s.join]=g.newNodeId()),s.join=i[s.join]);var l;t.root?l=e.createRoot(s):(l=n.addChild(s,void 0,!s.pos||void 0),l.getSize().w>350&&(l.model.set("width",350),l.model.deltarize())),p.each(t.children,function(e){o(e,l,i)})}var r=!1;if(n.length)p.each(n,function(n){n.root?n.pos=i?{x:i.x,y:i.y}:t?{x:t.model.x()+20+50*Math.random(),y:t.model.y()+20+50*Math.random()}:{x:0,y:0}:i&&(t||(t=e.closestNode(i.x,i.y)),n.pos={x:i.x-t.model.x(),y:i.y-t.model.y()}),o(n,t,{})});else if(n.attachments){var s=null;i&&(s=e.model.getNodes().closest(i.x,i.y,void 0,300)),e.model.getAttachments(function(t,o){if(!t){var r=[];for(var l in n.attachments)n.attachments.hasOwnProperty(l)&&o.getByLocalId(l)&&r.push(l);var a;if(s){for(a=0;a<r.length;a++)s.addAttachment(r[a],n.attachments[r[a]]);a&&s.deltarize()}else if(r.length){var u={pos:{x:i.x,y:i.y},attachments:{}};for(a=0;a<r.length;a++)u.attachments[r[a]]=n.attachments[r[a]];e.createRoot(u)}}})}}function r(e,t,n,i){if(n.length&&t){var o=p.pick(n[0],["shape","line_shape","line_style","text_size","colour","text_alignment","line_weight"]);o.shape&&"free"===e.model.myEditing()&&-1===m.free_shapes.indexOf(o.shape)&&(o.shape=m.default_free_shape,v.get("shape-replaced-plug").activate().timeout(7e3)),i?t.model.depthFirst(function(e){e.deltarize(o)}):t.model.deltarize(o)}}function s(e,t,n,s,l,a){var u=null;n.nodes&&(u=n.sourceDiagram,n=n.nodes);var d=i(n);if(!n.was_json&&n.length>y&&Date.now()-k>15e3)return k=Date.now(),void $(window).trigger("notify-info","Pasting that would create "+n.length+" branches! If you're sure you want to do that, paste again.<br>Or, select some text before pasting to insert into a single item.");if(!l&&d.length&&u&&u!==e.model.get("_id")){var c=e.model.urlRoot+"/"+u+"/attachments/clone?to_diagram="+e.model.get("_id");$(window).trigger("start-working","paste"),d.forEach(function(e){c+="&copy_ids[]="+e}),$.ajax({type:"POST",url:c,contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({}),timeout:1e4}).fail(function(e,t,n){$(window).trigger("notify-error","Failed to copy referenced attachments: "+t)}).always(function(){$(window).trigger("done-working","paste"),o(e,t,n,s)})}else l?r(e,t,n,a):o(e,t,n,s)}function l(e){for(var t=0,n=0;n<e.length;n++)if(" "==e[n])t++;else{if("\t"!=e[n])break;t+=4}return t}function a(e){e=String(e);for(var t=e.split(/\r?\n/),n={children:[],level:0},i=n,o=[],r=[],s=0;s<t.length;s++){var a=l(t[s]);if(!/^\s*$/.exec(t[s])){var u=p.sortedIndex(r,a);o.length&&(u<=o.length||s==t.length-1)&&(i=u?o[u-1]:n,o=o.slice(0,u),r=r.slice(0,u));var d={text:$.trim(t[s]),children:[]};i.children.push(d),o.push(d),r.push(a)}}return n.children}function u(e){try{return JSON.parse(e)}catch(e){return null}}function d(e){var t=u(e);return t&&"object"==typeof t&&(t.was_json=!0),t}function c(e,t){var n,i,o;if(e){if(window.clipboardData)i=window.clipboardData.getData("Text");else{var r=e.originalEvent&&e.originalEvent.clipboardData;if(r){try{n=r.getData("application/x-coggle-tree")}catch(e){}i=r.getData("text/plain")}}o=d(n||i),o&&"string"!=typeof o||(o=a(i))}if(t&&(!o||!(o.was_json||o.length>1)||F(o))&&C()){var s=u(C());s&&(s.was_json=!0,o=s)}return o}function h(e,t){var n=JSON.stringify(t);if(S(n),e)if(window.clipboardData)window.clipboardData.setData("Text",n);else{var i=e.originalEvent&&e.originalEvent.clipboardData;i&&(i.setData("text/plain",n),i.setData("application/x-coggle-tree",n))}}var p=e("underscore"),f=e("BrowserDetect"),g=(e("views/PitchView"),e("models/Node").NodeModel),m=e("views/shapes"),v=e("models/Message").Messages;e("views/working");var y=10,b=null,w=function(){if(null===b){var e="testforlocalstorage";try{var t=window.localStorage;t.setItem(e,e),t.removeItem(e),b=!0}catch(e){b=!1}}return b},_=function(){return"coggle-clip-"+window.getCoggleUser().id},x=function(){var e=window.localStorage.getItem(_());return e?JSON.parse(e)||[]:[]},E=function(e){window.localStorage.setItem(_(),JSON.stringify(e))},A=function(){w()&&p.filter(p.keys(window.localStorage),function(e){return 0===e.indexOf("coggle-clip-")}).forEach(function(e){window.localStorage.removeItem(e)})},S=function(e){if(w()){var t=x();e!=t[t.length-1]&&(t.push(e),t.length>20&&(t=t.slice(t.length-20)),E(t))}},C=function(){if(!w())return"";var e=x();return e[e.length-1]||""},F=function(e){if(!w())return!1;for(var t=x(),n=0;n<t.length-1;n++)if(t[n]==e)return!0;return!1},k=0,T=function(e){if(!e.is("input,textarea"))return!0;var t=e.getInputSelection();return t.start==t.end},O=function(e){var t=0,n=function(e,i){if(e&&e.length){if((t+=e.length)>=i)return!0;for(var o=0;o<e.length;o++)if(n(e[o].children,i-t))return!0}return!1};return n(e,3)};$.fn.coggleHandleCopyPaste=function(e){var t=$(this),n=e.node,i=e.diagram,o=function(e){if(T(t)){if("Firefox"==f.browser)try{h(e,{nodes:[n.model.serialise()],sourceDiagram:i.model.get("_id")})}catch(e){}e.preventDefault()}},r=function(e){T(t)&&(h(e,{nodes:[n.model.serialise()],sourceDiagram:i.model.get("_id")}),e.preventDefault())},l=function(e){T(t)&&(h(e,{nodes:[n.model.serialise()],sourceDiagram:i.model.get("_id")}),console.log("onCut got clip data",n.model.serialise()),i.pushUndoMarker(),n.getNavigationController().removeRecursive(),e.preventDefault())},a=function(e){T(t)&&e.preventDefault()},u=function(e){if(T(t)){var o=c(e);if(o.was_json||O(o))return s(i,n,o,void 0),e.preventDefault(),!1}};return t.on("beforecopy",o),t.on("copy",r),t.on("cut",l),t.on("beforepaste",a),t.on("paste",u),{remove:function(){t.off("beforecopy",o),t.off("copy",r),t.off("beforepaste",a),t.off("paste",u)}}},window.addEventListener("beforeunload",function(e){A()}),n.exports.copy=function(e){e.attachments?h(void 0,{attachments:e.attachments,sourceDiagram:e.diagram.model.get("_id")}):h(void 0,{nodes:[e.node.serialise()],sourceDiagram:e.diagram.model.get("_id")})},n.exports.paste=function(e){var t=e.coggle_tree?d(e.coggle_tree):c(void 0,!0);t&&(t.was_json||O(t))&&s(e.diagram,e.node,t,e.at,e.paste_style,e.paste_style_recursive)}}),define("controllers/MarkdownController",["require","exports","module"],function(e,t,n){function i(){}const o=Object.prototype.hasOwnProperty;i.LINK=/\[([^\]]*)\]\(([^)]*)\)/gi,i.BOLD=/\*\*([^*]+)\*\*/gi,i.ITALICS=/\*([^*]+)\*/gi,i.ITALICS_NOT_BOLD=/(?:^|[^*])(?:\*([^*]+)\*|\*\*\*([^*]+)\*\*\*)(?:[^*]|$)/gi,i.WORD=/([^*[\]()\s]+)/gi,i.smartRange=function(e,t){if(!t)return{start:0,end:e.length};if(t.end||(t.end=e.length),t.start||(t.start=0),t.start===t.end){var n=i.closestMarkupOfType(e,t,i.WORD);if(n)return{start:n.start,end:n.end}}return t};var r=function(e,t){for(var n,i=[],o=t.start;o<t.end;)n=/^(\n\s*){2,}/.exec(e.substr(o)),n?(i.push({start:t.start,end:o,breakBefore:t.breakBefore||""}),t.start=o+n[0].length,t.breakBefore=n[0],o+=n[0].length):o+=1;return t.start<t.end&&i.push({start:t.start,end:t.end,breakBefore:t.breakBefore||""}),0===i.length&&i.push(t),i},s=function(e){return function(t,n){var i=r(t,n),o=0,s=null,l=0;return i.forEach(function(n){var i;n.start+=o,n.end+=o,i=e(t,n),o+=i.markdown.length-t.length,t=i.markdown,null===s&&(s=i.selection.start),l=i.selection.end}),{markdown:t,selection:{start:s,end:l}}}},l=function(e,t,n){var i,o;for(i=t.start;i>0&&n.exec(e[i-1]);i--);for(o=t.end;o<e.length&&n.exec(e[o]);o++);return{start:i,end:o}},a=function(e,t){for(var n=t.start,i=t.end,o=!1,r=t.start;r<i;r++)if(!/\s/.exec(e[r])){o=!0;break}if(o&&i>n)for(;i>t.start&&/[ \n\r]/.exec(e[i-1]);i--);return{start:n,end:i}},u=function(e){return function(){var t=Array.prototype.slice.call(arguments),n=t[0],i=t[1],r=l(n,i,/[*]/);r=a(n,r);var s=r.start;t[0]=n.substr(r.start,r.end-r.start),r.start=0,r.end-=s,t[1]=r;var u=e.apply(this,t);return"boolean"==typeof u?u:(o.call(u,"start")&&(u.start+=s),o.call(u,"end")&&(u.end+=s),o.call(u,"selection")&&(u.selection.start+=s,u.selection.end+=s),o.call(u,"markdown")&&(u.markdown=n.substr(0,r.start+s)+u.markdown+n.substr(r.end+s)),u)}},d=u(function(e,t,n){return n.lastIndex=0,null!==n.exec(e)});i.splitByRange=function(e,t){return t=i.smartRange(e,t),{prefix:e.slice(0,t.start),selection:e.slice(t.start,t.end),postfix:e.slice(t.end,e.length)}},i.surroundWith=function(e,t,n,o,r){var s=i.splitByRange(e,t);return 0===s.selection.length&&(s.selection=r||""),{markdown:s.prefix+n+s.selection+o+s.postfix,selection:{start:s.prefix.length+n.length,end:s.prefix.length+s.selection.length+n.length}}},i.toggleItalics=s(function(e,t){return d(e,t,i.ITALICS_NOT_BOLD)?i.removeItalics(e,t):i.addItalics(e,t)}),i.addItalics=u(function(e,t){return i.surroundWith(e,t,"*","*","text")}),i.removeItalics=u(function(e,t){return i.replaceWithGroup(e,t,i.ITALICS,1)}),i.toggleBold=s(function(e,t){return d(e,t,i.BOLD)?i.removeBold(e,t):i.addBold(e,t)}),i.addBold=u(function(e,t){return i.surroundWith(e,t,"**","**","text")}),i.removeBold=u(function(e,t){return i.replaceWithGroup(e,t,i.BOLD,1)}),i.addLink=function(e,t,n){t=i.smartRange(e,t);var o=i.surroundWith(e,t,"[","]("+n+")","Link Title");return o.selection.start=o.selection.end+2,o.selection.end=o.selection.start+n.length,o},i.isLink=function(e,t){return!!i.closestMarkupOfType(e,t,i.LINK)},i.removeLink=function(e,t){var n=i.replaceWithGroup(e,t,i.LINK,1);return n.removedHref=n.match&&n.match[2],n},i.addIcon=function(e,t){var n=i.splitByRange(e,t),o=n.prefix+n.selection,r=":";return o.length&&!/\n| /.exec(o[o.length-1])&&(r=" :"),{markdown:o+r+n.postfix,selection:{start:o.length+r.length,end:o.length+r.length}}},i.closestMarkupOfType=function(e,t,n){var i;for(n.lastIndex=0;null!==(i=n.exec(e));){var o=i.index,r=i.index+i[0].length;if(t.start>=o&&t.end<=r||o>=t.start&&r<=t.end)return{start:o,end:r,match:i}}return null},i.replaceWithGroup=function(e,t,n,o){t=i.smartRange(e,t);var r=i.closestMarkupOfType(e,t,n);if(r){var s=e.slice(0,r.start),l=e.slice(r.end,e.length),a=o?r.match[o]:"";return{markdown:s+a+l,selection:{start:s.length,end:s.length+a.length},match:r.match}}return{markdown:e,selection:t,match:[]}},n.exports=i}),function(e){"function"==typeof define&&define.amd?define("plugins/jquery.inputSelection",["jquery"],e):e(jQuery)}(function(e){e.fn.setInputSelection=function(e){var t=this[0],n=e.start||0,i=e.end||0;t.focus(),t.setSelectionRange&&t.setSelectionRange(n,i)},e.fn.getInputSelection=function(){var e,t,n,i,o,r=this[0],s=0,l=0;return"number"==typeof r.selectionStart&&"number"==typeof r.selectionEnd?(s=r.selectionStart,l=r.selectionEnd):document.selection&&document.selection.createRange&&(t=document.selection.createRange())&&t.parentElement()==r&&(i=r.value.length,e=r.value.replace(/\r\n/g,"\n"),n=r.createTextRange(),n.moveToBookmark(t.getBookmark()),o=r.createTextRange(),o.collapse(!1),n.compareEndPoints("StartToEnd",o)>-1?s=l=i:(s=-n.moveStart("character",-i),s+=e.slice(0,s).split("\n").length-1,n.compareEndPoints("EndToEnd",o)>-1?l=i:(l=-n.moveEnd("character",-i),l+=e.slice(0,l).split("\n").length-1))),{start:s,end:l}}}),define("controllers/MarkdownTextareaController",["require","exports","module","./MarkdownController","plugins/jquery.inputSelection"],function(e,t,n){function i(e){var t=l.toggleBold(e.val(),e.getInputSelection());e.val(t.markdown),e.setInputSelection(t.selection),e.trigger("input")}function o(e){var t=l.toggleItalics(e.val(),e.getInputSelection());e.val(t.markdown),e.setInputSelection(t.selection),e.trigger("input")}function r(e){var t,n=e.val(),i=e.getInputSelection();if(l.isLink(n,i))t=l.removeLink(n,i),e.attr("removed-href",t.removedHref);else{var o=e.attr("removed-href")||"https://example.com";t=l.addLink(n,i,o)}e.val(t.markdown),e.setInputSelection(t.selection),e.trigger("input")}function s(e){var t=l.addIcon(e.val(),e.getInputSelection());e.val(t.markdown),e.setInputSelection(t.selection),setTimeout(function(){e.textcomplete&&e.textcomplete("trigger")},10)}var l=e("./MarkdownController");e("plugins/jquery.inputSelection"),n.exports={bold:i,italics:o,link:r,icon:s}}),function(e){"function"==typeof define&&define.amd?define("plugins/jquery.markdownShortcuts",["jquery","controllers/MarkdownTextareaController","utils/trackModifiers"],e):e(jQuery)}(function(e,t,n){e.fn.markdownShortcuts=function(i){var o=e(this);o.on("keydown",function(e){if((66==e.keyCode||73==e.keyCode||75==e.keyCode||71==e.keyCode)&&(n.control_key_pressed||n.meta_key_pressed)&&!n.shift_key_pressed&&!n.alt_key_pressed){if(66==e.keyCode)return t.bold(o),o.trigger("markdownshortcut"),!1;if(73==e.keyCode)return t.italics(o),o.trigger("markdownshortcut"),!1;if(75==e.keyCode)return t.link(o),o.trigger("markdownshortcut"),!1;if(71==e.keyCode)return t.icon(o),o.trigger("markdownshortcut"),setTimeout(function(){o.textcomplete&&o.textcomplete("trigger")},10),!1}})}}),function(e){"function"==typeof define&&define.amd?define("plugins/jquery.markdownButtons",["jquery","controllers/MarkdownTextareaController","plugins/jquery.inputSelection","views/PitchView"],e):e(jQuery)}(function(e,t,n,i){e.fn.markdownButtons=function(n){var o=e(this),r=e("<div class='editor-toolbar'><div data-l10n-id='button-formatting' class='editor-button formatting' title='Text formatting'></div><div data-l10n-id='button-back' class='editor-button back' title='Back'></div><div data-l10n-id='button-bold' class='editor-button bold formatting-button' title='Make text bold'></div><div data-l10n-id='button-italic' class='editor-button italics formatting-button' title='Make text italic'></div><div data-l10n-id='button-aligned-left' class='editor-button alignment align-left formatting-button' title='Aligned left'></div><div data-l10n-id='button-aligned-center' class='editor-button alignment align-center formatting-button' title='Aligned center'></div><div data-l10n-id='button-aligned-right' class='editor-button alignment align-right formatting-button' title='Aligned right'></div><div data-l10n-id='button-aligned-auto' class='editor-button alignment align-auto formatting-button' title='Aligned automatically'></div><div data-l10n-id='button-link' class='editor-button link' title='Link to a website'></div><div data-l10n-id='button-upload' class='editor-button upload' title='Add image or attach file.'></div><form class='editor-image-attach' style='display:none'><input class='force-attach' type='file'  accept='*' name='files[]'/></form><div data-l10n-id='button-attach' class='editor-button upload-button attach' title='Attach a file'></div><form class='editor-image-upload' style='display:none'><input class='force-image' type='file'  accept='image/*' name='files[]'/></form><div data-l10n-id='button-image' class='editor-button upload-button image' title='Upload an image'></div><div data-l10n-id='button-emoji' class='editor-button addemoji' title='Search for icons'></div></div>");o.before(r),"awesome"!==n.myEditing()&&r.find(".editor-button.attach").addClass("disabled").attr("title","Upgrade to Awesome to attach files"),r.find(".addemoji").addClass("zap");var s=o.parent();if(s.length){getCoggleUser().attachmentsSupported()||(s.find(".editor-button.upload").hide(),s.find(".editor-button.upload-button.image").css("display","inline-block")),s.find(".editor-button.formatting").on("click",function(){r.addClass("formatting-selected")}),s.find(".editor-button.upload").on("click",function(){r.addClass("upload-selected")}),s.find(".editor-button.back").on("click",function(){r.removeClass("upload-selected").removeClass("formatting-selected")}),s.find(".editor-button.italics").on("click",function(){t.italics(o)}),s.find(".editor-button.bold").click(function(){t.bold(o)}),s.find(".editor-button.link").click(function(){t.link(o)});var l=s.find("form.editor-image-upload");s.find(".editor-button.image").click(function(e){return void 0!==e.originalEvent&&l.find("input").trigger("click"),e.stopPropagation(),!1});var a=s.find("form.editor-image-attach");s.find(".editor-button.attach").click(function(e){return"awesome"===n.myEditing()?void 0!==e.originalEvent&&a.find("input").trigger("click"):i.attachments(),e.stopPropagation(),!1}),s.find(".editor-button.addemoji").click(function(){t.icon(o)})}}}),define("views/NodeEditView",["require","exports","module","underscore","backbone","../utils/marked","views/PitchView","models/NotificationSearch","utils/colours","utils/textsize","views/AttachmentView","utils/trackModifiers","views/shapes","starc/starc.copypaste","plugins/jquery.markdownShortcuts","plugins/jquery.markdownButtons","plugins/jquery.inputSelection","jquery.outsideEvents","models/Node","env"],function(e,t,n){function i(e,t){if(e.createTextRange){var n=e.createTextRange();n.move("character",t),n.select()}else void 0!==e.selectionStart&&e.setSelectionRange(t,t)}var o=e("underscore"),r=e("backbone"),s=(e("../utils/marked"),e("views/PitchView")),l=e("models/NotificationSearch"),a=e("utils/colours"),u=e("utils/textsize"),d=e("views/AttachmentView").AttachmentView,c=e("utils/trackModifiers"),h=e("views/shapes").shapesFor,p=e("starc/starc.copypaste").paste;e("plugins/jquery.markdownShortcuts"),e("plugins/jquery.markdownButtons"),e("plugins/jquery.inputSelection"),e("jquery.outsideEvents");var f=e("models/Node").NodeModel,g=u.Min_Text_Size,m=u.Max_Text_Size,v=null,y=function(){for(var e=[g,9,10,12,13,15.3,17],t=17;t<m;)t*=1.189207115,t>=m&&(t=m),e.push(t);return e}(),b=function(){for(var e=[],t=g;t<=m;t++)e.push(t);return e}(),w=function(e,t){for(var n=t?b:y,i=0;i<n.length;i++)if(n[i]>e)return n[i];return m},_=function(e,t,n){for(var i=n?b:y,o=i.length-1;o>=0;o--)if(i[o]<e)return i[o];return g},x=r.View.extend({tagName:"div",className:"node-editor",template:o.template("<textarea spellcheck='true' rows='1' dir='auto' maxlength='<%= maxlength %>' name='markdown'></textarea><div class='file-attachments'></div><div class='editor-hint'></div><div class='font-size' style='display:none' data-l10n-id='label-fontsize'>Font size <span data-l10n-name='fontsize'></span>px</div><div class='resize' data-l10n-id='button-resize' title='Drag to change the text size.'></div>"),events:{"click .editor-button":"autogrow","click .comments":"openComments","keydown textarea":"onKeypress","focus textarea":"autogrow","textComplete:select textarea":function(e,t,n){this.autogrow(),t&&n&&getCoggleUser().getActions().perform("autocomplete:node:"+n.name)},"textComplete:show textarea":function(e,t,n){getCoggleUser().getActions().unique("autocomplete:node:open")},"input textarea":function(e){e.originalEvent&&this.endOfLineSpaces(e.originalEvent),this.autogrow(),this.modified=!0,this.triggerTyping()},"paste textarea":o.debounce(function(){this.autogrow(),this.modified=!0},3),"mousedown .resize":"startResizeDrag","touchstart .resize":"startResizeDrag","pointerdown .resize":"startResizeDrag","click .iconsearch":"iconSearch","picked-user textarea":"userTagged","click .editor-button.alignment":"toggleAlignment","click .editor-button.formatting":"showAlignmentButton","import:image:done":"onImageUpload",click:function(e){this.diagram.$el.trigger("opencontentcallout",e.target)}},userTagged:function(e,t){var n=this.model.get("tagged");n||(n=[]),n.push(t),this.model.set("tagged",n)},initialize:function(e){this.options=e,o.bindAll(this,"render","focus","commit","cancel","close","caretToEnd","onImageUpload","openComments","autogrowHeight","autogrowWidth","startResize","startResizeDrag","updateResize","endResize","iconSearch","updateFontSizeLabel","updateColour","toggleAlignment","showAlignmentButton"),this.diagram=e.diagram,this.$el.on("contextmenu mousedown touchstart pointerdown MSPointerDown",function(e){e.stopPropagation()}),this.scratch={initialAttributes:o.pick(this.model.toJSON(),["text","text_size","scale","text_alignment","width","attachments"])},this.inheritPauseState=e.inheritPauseState,this.modified=!1,this.open_since=Date.now(),x._active_edit=this,this.listenTo(this.model,"change:scale change:text_size",this.updateFontSizeLabel),this.listenTo(this.model,"change:colour",this.updateColour),this.listenToOnce(this.model,"remove destroy",this.close)},openDuration:function(){return Date.now()-this.open_since},onKeypress:function(e){for(var t=["handlePause","handleTab","renderHint","handleCreateNewline","handleEscapeToCancel","handleBackspace"].concat(e.ctrlKey||e.shiftKey||e.altKey||e.metaKey?["handleKeyboardNavigation","handleCreateNewSibling","handleScaleShortcut","handleArrange","handleUndo","handleStyleShortcuts","pasteStyle"]:[]);t.length&&!e.isImmediatePropagationStopped();)this[t.shift()](e)},onImageUpload:function(e,t,n,i,o,r,s){var l=this.$el.find("textarea"),a=l.getInputSelection(),u=l.val(),d=u.slice(0,a.start)+" !["+r+"](attached://"+s+" "+o.width+"x"+o.height+") "+u.slice(a.end);return l.val(d),this.autogrow(),e.stopPropagation(),!1},setTextSize:function(e){this.scratch.text_size=e,this.$el.css({"font-size":e+"px"}),this.autogrowHeight()},setAlignment:function(e){this.$el.find("textarea").css({"text-align":e||""})},triggerTyping:function(e,t){var n,i,o=function(){n=null,e.call(i,!0),i=null},r=function(){n&&clearTimeout(n);var r=!n;n=setTimeout(o,t),i=this,r&&e.call(this,!1)};return r.cancel=function(){n&&clearTimeout(n),n=null},r}(function(e){this.diagram&&this.model&&this.diagram.trigger("node:editor:typing",this.model,!e)},3e3),hideFontSizeLabel:o.debounce(function(){this.$el.find(".font-size").fadeOut(200)},1100),updateFontSizeLabel:function(e,t){if(!(Date.now()-this.open_since<100)){var n=this.$el.find("textarea");this.$el.find(".font-size").fadeIn(50).find("span").text(parseInt(n.css("font-size"))),this.hideFontSizeLabel()}},updateColour:function(){this.$el.css({"border-color":this.model.colour(),color:a.darken(this.model.colour())}),this.$el.find(".resize").css({"background-color":this.model.colour()})},render:function(){this.$el.html(this.template({maxlength:f.MAX_TEXT_LENGTH})),this.model.attachmentIds().length&&this.$el.find(".file-attachments").replaceWith(d.renderAttachments(this.model,this.diagram.model,this.model.attachmentIds()));var e=this.$el.find("textarea");return e.val(this.model.text()||""),e.markdownShortcuts({}),e.markdownButtons(this.diagram.model),e.coggleHandleCopyPaste({node:this.diagram.getNodeForId(this.model.id),diagram:this.diagram}),e.on("markdownshortcut",this.autogrow.bind(this)),this.$el.css({"border-color":this.model.colour(),"font-size":this.model.textSize(),color:a.darken(this.model.colour())}),e.css("text-align",this.model.get("text_alignment")||""),this.$el.find(".resize").css({"background-color":this.model.colour()}),window.Coggle_App_Main||(this.inheritPauseState?this.openEditorButtons(!0):(this.$el.removeClass("has-paused"),this.handlePause())),this.renderHint(),this},openEditorButtons:function(e){window.Coggle_App_Main||(this.$el.addClass("has-paused"),e&&this.$el.addClass("previously-paused"))},selectRange:function(e){e&&this.$el.find("textarea").setInputSelection(e)},caretToEnd:function(){var e=this.$el.find("textarea");if(e.length){var t=e.val();e[0].setSelectionRange?e[0].setSelectionRange(t.length,t.length):e.val(t)}},focus:function(){this.$el.find("textarea").focus()},commit:function(e){if(this.commited)return this.close();if(!this.model.collection)return console.log("cannot commit edit (node was removed)"),void this.cancel();if(!this.$el.find("textarea").length)return console.log("will not commit nonexistent editor"),void this.close();this.comitted=!0,this.model.set("text",this.$el.find("textarea").val());var t=(this.scratch.initialAttributes.tagged||[]).slice();if(this.model.get("tagged")){var n=this.model.get("tagged").map(function(e){return-1!==this.model.text().indexOf("@"+e.displayName().replace(/\s/g,""))&&e}.bind(this));this.model.set("tagged",o.uniq(o.compact(n)));var i=o.difference(this.model.get("tagged"),t);this.diagram.model.getNotifications().usersTagged(i,this.model)}this.model.deltarize({text:this.model.text(),width:this.model.width(),scale:this.model.get("scale"),text_size:this.model.get("text_size"),text_alignment:this.model.get("text_alignment")}),this.model.text()&&this.diagram.trigger("node_edited",this.model),this.scratch.resizing_children&&this.scratch.resizing_children.forEach(function(e){e.deltarize({text_size:e.get("text_size")})}),e||this.close()},cancel:function(){if(x._active_edit==this&&(x._active_edit=!1),!this.comitted){this.scratch.initialAttributes&&this.model.set(this.scratch.initialAttributes);var e=this.scratch.original_child_text_sizes,t=this.scratch.resizing_children;if(t&&e&&e.length)for(var n,i=0;i<t.length&&i<e.length;i++)(n=t[i])&&n.set("text_size",e[i])}this.close()},close:function(){x._active_edit==this&&(x._active_edit=!1),this.triggerTyping.cancel(),this.scratch={},this.trigger("close"),this.remove(),this.off()},isLeftToRight:function(){return-1!==this.model.ltr()},enableMultiLine:function(){this.scratch.multiline=!0},isMultiLineEnabled:function(){return this.scratch.multiline||$("body").hasClass("touch")||-1!==this.$el.find("textarea").val().indexOf("\n")},hasSetWidth:function(){return!!this.model.width()},handleKeyboardNavigation:function(e){if(e.shiftKey&&e.altKey&&!e.metaKey&&!e.ctrlKey&&e.keyCode>=37&&e.keyCode<=40&&!getCoggleUser().getActions().get("shortcut:deprecated-movement")&&Date.parse(getCoggleUser().get("firstLogin"))<Date.parse("2020-04-10"))return getCoggleUser().getActions().unique("shortcut:deprecated-movement"),
void $(window).trigger("notify-info",["Use [ctrl] + [alt] + arrow keys to navigate between items",!0,1e4]);e.ctrlKey&&e.altKey&&!e.metaKey&&e.keyCode>=37&&e.keyCode<=40&&(e.preventDefault(),e.stopPropagation(),ga&&ga("send","event","Shortcut","AltShiftArrow"),getCoggleUser().getActions().unique("shortcut-navigate"),39==e.keyCode&&this.isLeftToRight()&&this.trigger("next"),37==e.keyCode&&this.isLeftToRight()&&this.trigger("previous"),39!=e.keyCode||this.isLeftToRight()||this.trigger("previous"),37!=e.keyCode||this.isLeftToRight()||this.trigger("next"),38==e.keyCode&&this.trigger("up"),40==e.keyCode&&this.trigger("down"))},handlePause:function(e,t){var n,i,r,s=function(){var l=t(),a=o.now()-r;a<l&&a>=0?i=setTimeout(s,l-a):(i=null,e.apply(n),n=null)},l=function(){n=this,r=o.now(),i||(i=setTimeout(s,t()))};return l.cancel=function(){clearTimeout(i),n=i=null},l}(function(){this.openEditorButtons()},function(){return parseInt(getCoggleUser().science("editor-pause",["0ms","500ms","1000ms"]))||0}),spawnChildWithSelection:function(){var e=this.$el.find("textarea").val(),t=this.$el.find("textarea").getInputSelection(),n=e.slice(t.start,t.end);this.commit(!0),this.diagram.pushUndoMarker(),this.$el.find("textarea").val(e.slice(0,t.start)+e.slice(t.end)),this.trigger("spawn",n)},handleTab:function(e){9!=e.keyCode&&45!=e.which||(e.preventDefault(),e.shiftKey?(ga&&ga("send","event","Shortcut","ShiftTab"),getCoggleUser().getActions().unique("shortcut-toparent"),this.trigger("previous")):(ga&&ga("send","event","Shortcut","Tab"),getCoggleUser().getActions().unique("shortcut-newchild"),this.spawnChildWithSelection()))},handleArrange:function(e){if(77===e.keyCode&&c.shift_key_pressed&&(c.meta_key_pressed||c.control_key_pressed)){this.diagram.getNodeForId(this.model.id).arrange(),e.preventDefault()}},handleUndo:function(e){this.modified||("z"===e.key&&e.ctrlKey!==e.metaKey&&(this.diagram.undoStep(),e.preventDefault()),("z"===e.key&&e.ctrlKey!==e.metaKey&&e.shiftKey||"y"===e.key&&(e.ctrlKey||e.metaKey))&&(this.diagram.redoStep(),e.preventDefault()))},handleStyleShortcuts:function(e){if((e.ctrlKey||e.metaKey)&&e.altKey){var t=this.diagram.getNodeForId(this.model.id);if("c"===e.key.toLowerCase()){var n=a.nextColour(this.model.colour(),"free"!==this.diagram.model.myEditing());t.setColour(n,e.shiftKey),e.preventDefault()}else if("s"===e.key.toLowerCase()){var i=h(this.model.isRoot(),"free"!==this.diagram.model.myEditing()),o=this.model.shape(),r=i[(i.indexOf(o)+1)%i.length];t.setShape(r,e.shiftKey),e.preventDefault()}else if("t"===e.key.toLowerCase()||"†"===e.key.toLowerCase()){var s=this.model.lineWeight()+2;s>10&&(s=2),t.setLineWeight(s,e.shiftKey),e.preventDefault()}"free"!==this.diagram.model.myEditing()&&("l"===e.key.toLowerCase()?("smooth"===this.model.lineShape()?t.setLineShape("straight",e.shiftKey):t.setLineShape("smooth",e.shiftKey),e.preventDefault()):"d"===e.key.toLowerCase()&&("solid"===this.model.lineStyle()?t.setLineStyle("dashed",e.shiftKey):t.setLineStyle("solid",e.shiftKey),e.preventDefault()))}},pasteStyle:function(e){(e.ctrlKey&&e.metaKey&&!e.altKey&&"v"===e.key.toLowerCase()||e.ctrlKey&&e.altKey&&!e.metaKey&&"v"===e.key.toLowerCase())&&(p({diagram:this.diagram,node:this.diagram.getNodeForId(this.model.id),paste_style:!0,paste_style_recursive:e.shiftKey}),this.render(),this.autogrow())},renderHint:function(e){var t=this.$el.find("textarea").val(),n=this.diagram.model.getNotifications().withTags([this.model.shortId()]),i=isNaN(n.length)?0:n.length;t&&t.length>=f.MAX_TEXT_LENGTH-5?this.showHint('<span data-l10n-id="hint-toolong">Item too long! Try moving some text to a new item: select the text then press [tab]<span>'):t&&t.length>800?this.showHint('<span data-l10n-id="hint-movetext">Try moving some text to a new item: select the text then press [tab]</span>'):1==n.length?this.showHint("<a data-l10n-id='commentcount' data-l10n-args='{\"count\":1}' class='comments'>1 comment</a>"):n.length>1?this.showHint("<a data-l10n-id='commentcount' data-l10n-args='{\"count\":"+i+"}' class='comments'>"+i+" comments</a>"):this.hideHint()},showHint:function(e){this.$el.addClass("hint-visible"),this.$el.find(".editor-hint").html(e)},hideHint:function(){this.$el.removeClass("hint-visible")},openComments:function(){l.instance().setNodes([this.model])},handleCreateNewline:function(e){if(13==e.keyCode&&!e.shiftKey){var t=this.$el.find("textarea"),n=t.getInputSelection();if(this.isMultiLineEnabled()||e.altKey||e.ctrlKey||e.metaKey||n&&n.end>n.start){ga&&ga("send","event","EditText","Newline"),getCoggleUser().getActions().unique("editing-newline"),this.enableMultiLine();var o=n.end,r=t[0].value;t[0].value=r.substring(0,o)+"\n"+r.substring(o,r.length),i(t[0],o+1),this.autogrowHeight(),e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()}else this.commit()}83!=e.keyCode||!e.metaKey&&!e.ctrlKey||e.altKey||e.shiftKey||(this.commit(),e.preventDefault(),e.stopImmediatePropagation())},spawnSiblingWithSelection:function(e){var t=this.$el.find("textarea").val(),n=this.$el.find("textarea").getInputSelection(),i=t.slice(n.start,n.end);this.commit(!0),this.diagram.pushUndoMarker(),this.$el.find("textarea").val(t.slice(0,n.start)+t.slice(n.end)),this.trigger("sibling",i,e)},handleCreateNewSibling:function(e){13==e.keyCode&&e.shiftKey&&(getCoggleUser().getActions().unique("shortcut-newsibling"),this.spawnSiblingWithSelection(e.ctrlKey||e.altKey),e.stopPropagation(),e.preventDefault())},handleEscapeToCancel:function(e){27!=e.keyCode||"function"!=typeof e.isDefaultPrevented||e.isDefaultPrevented()||(ga&&ga("send","event","EditText","Cancel"),this.cancel(),e.stopPropagation(),e.preventDefault())},handleScaleShortcut:function(e){var t=function(t){t=Math.max(g,Math.min(m,t)),this.setTextSize(t),this.model.set("text_size",t),this.autogrowWidth(),e.preventDefault(),e.stopPropagation()}.bind(this);e.ctrlKey^e.metaKey&&!e.altKey&&(this.scratch.text_size||(this.scratch.text_size=this.model.textSize()),"+"==String.fromCharCode(e.which)||"="==String.fromCharCode(e.which)||187==e.which||107==e.which||61==e.which||43==e.which||171==e.which?t(w(this.scratch.text_size,e.shiftKey)):"-"==String.fromCharCode(e.which)||31==e.which||189==e.which||173==e.which||109==e.which?t(_(this.scratch.text_size,e.shiftKey)):"0"==String.fromCharCode(e.which)&&t(13))},handleBackspace:function(e){if(46==e.which||8==e.which){if((e.ctrlKey||e.metaKey)&&e.shiftKey)return(this.model.children().length||this.$el.find("textarea").val().length)&&(this.commit(!0),this.diagram.pushUndoMarker()),this.trigger("remove"),e.stopPropagation(),e.preventDefault(),!1;if(v&&v>(new Date).getTime())return e.stopPropagation(),e.preventDefault(),!1;if(!(e.repeat||e.originalEvent&&e.originalEvent.repeat||this.$el.find("textarea").val().length)){var t=new Date;if(this.last_backspace&&t-this.last_backspace.getTime()<500){if(this.last_backspace=null,!this.model.children().length&&!this.model.isTitle())return this.trigger("remove"),v=(new Date).getTime()+500,e.stopPropagation(),e.preventDefault(),!1}else this.last_backspace=t}}else this.last_backspace=null},endOfLineSpaces:function(e){var t=e.target,n=t&&t.value;if(n&&(!e||!e.isComposing)){var i=n.replace(/\xa0/g," ");if(" "===i.substr(-1)&&(i=i.substr(0,i.length-1)+" "),i!==n){var o=t.selectionStart,r=t.selectionEnd;t.value=i,t.setSelectionRange&&t.setSelectionRange(o,r)}}},autogrow:function(){this.autogrowWidth(),this.autogrowHeight()},autogrowHeight:function(){if(this.$el){var e=this.$el.find("textarea")[0].scrollHeight,t=e+this.$el.find(".file-attachments")[0].scrollHeight;this.$el.height(t),this.$el.find("textarea").height(e)}},autogrowWidth:function(){var e=this.model.width(),t=this.$el.width(),n=this.$el.find("textarea"),i=n.val();if(e)return void(0===i.length?(this.model.set("width",null),this.$el.width("")):t!==e&&this.$el.width(e));if(350!=t){var r=this.diagram.getSizeOfHtml,s=r(o.escape(i).replace(/\n/g,"<br>"),{"font-size":n.css("font-size")},!0).w,l=e||Math.min(Math.ceil(s+20),350);t<l&&this.$el.width(l),l>=350&&(this.model.set("width",Math.max(40,Math.round(l))),this.enableMultiLine())}},startResizeDrag:function(e){this.startResize(e),this.diagram.suspendAutoGrow(!0,"editor-resize"),this.enableMultiLine()},startResize:function(e){(e.shiftKey||e.ctrlKey||e.altKey)&&(this.scratch.resizing_children=this.model.allChildren(),this.scratch.original_child_text_sizes=o.map(this.scratch.resizing_children,function(e){return e.get("text_size")})),this.scratch.drag_origin=this.diagram.diagramCoordsFromEvent(e),this.scratch.starting_height=this.$el.height(),this.scratch.starting_text_height=this.$el.find("textarea").height(),this.scratch.starting_width=this.$el.width(),this.scratch.starting_text_size=this.model.textSize(),this.scratch.drag_origin_position_lr="left",this.model.shape()||this.model.isRoot()?this.scratch.drag_origin_position_lr="center":(this.model.children().length&&1==this.model.ltr()||!this.model.children().length&&-1==this.model.ltr())&&(this.scratch.drag_origin_position_lr="right"),this.scratch.drag_origin_position_tb=this.model.children().length&&-1==this.model.ttb()&&!this.model.shape()?"bottom":"top",this.$el.on("mousemove touchmove pointermove",this.updateResize),this.$el.closest(".diagram-editor").on("mousemove touchmove pointermove",this.updateResize),window.addEventListener("mouseup",this.endResize,{capture:!0,passive:!0}),window.addEventListener("touchend",this.endResize,{capture:!0,passive:!0}),window.addEventListener("pointerup",this.endResize,{capture:!0,passive:!0}),this.resizing_since=Date.now(),this.$el.addClass("resizing")},isResizing:function(){return!!this.resizing_since},updateResize:function(e){if(this.isResizing()){var t=this.diagram.diagramCoordsFromEvent(e);this.handlePause();var n=this.scratch,i=t.x-n.drag_origin.x,o=t.y-n.drag_origin.y,r=i,s=o;"right"==n.drag_origin_position_lr?r=-r:"center"==n.drag_origin_position_lr&&(r*=2),"bottom"==n.drag_origin_position_tb&&(s=-s),Math.abs(r)<5&&(r=0);s>=0?s<4?s=0:s-=4:s>-2?s=0:s+=2,!this.model.shape()&&this.model.children().length||(s*=2);var l=(n.starting_height+s)/n.starting_height,a=Math.max(g,Math.min(m,n.starting_text_size*l));e.ctrlKey&&(a-=a%1),n.resizing_children&&n.resizing_children.forEach(function(e){e.set("text_size",a)});var u=Math.max(1,n.starting_height+s),d=Math.max(1,n.starting_text_height+s),c=Math.max(1,n.starting_width+r);return this.$el.height(u),this.$el.find("textarea").height(d),this.$el.width(c),this.model.set("width",Math.max(40,Math.round(c))),this.setTextSize(a),this.model.set("text_size",a),e.stopPropagation(),!1}},endResize:function(){this.isResizing()&&(this.$el.off("mousemove touchmove pointermove",this.updateResize),this.$el.closest(".diagram-editor").off("mousemove touchmove pointermove",this.updateResize),window.removeEventListener("mouseup",this.endResize,{capture:!0,passive:!0}),window.removeEventListener("touchend",this.endResize,{capture:!0,passive:!0}),window.removeEventListener("pointerup",this.endResize,{capture:!0,passive:!0}),this.resizing_since=!1,this.$el.removeClass("resizing"),getCoggleUser().getActions().unique("editing-resize"),this.focus(),this.diagram.suspendAutoGrow(!1,"editor-resize"))},iconSearch:function(){var e=this.$el.find("textarea"),t=e.getInputSelection(),n=t.end,o=e[0].value;e[0].value=o.substring(0,n)+":"+o.substring(n,o.length),i(e[0],n+1),setTimeout(function(){e.textcomplete&&e.textcomplete("trigger")},10)},showAlignmentButton:function(){var e=this.model.get("text_alignment")||"auto";this.$el.find(".alignment:not(.align-"+e+")").removeClass("active"),this.$el.find(".alignment.align-"+e).addClass("active")},toggleAlignment:function(t){if("free"===this.diagram.model.myEditing())return void s.show({id:"pitch:text-align",title:"Change Text Alignment",teaser:e("env").cdn.url+"/img/features/text-align.gif",message:"The Awesome plan includes control over text alignment. Upgrade now for precise control!"});var n={auto:"left",left:"center",center:"right",right:null}[this.model.get("text_alignment")||"auto"];this.model.set("text_alignment",n),this.setAlignment(n),this.showAlignmentButton()}});x.activeEdit=function(){return x._active_edit},n.exports=x}),define("controllers/NodeNavigationController",["require","exports","module","underscore","models/Message"],function(e,t,n){var i=e("underscore"),o=e("models/Message").Messages,r=function(e,t){return t.access_time-e.access_time},s=function(e,t){return t.model.y()-e.model.y()},l=function(e,t){for(var n=e.model.pathToRoot(),i=t.model.pathToRoot(),o=0;o<n.length&&o<i.length;o++)if(n[o]!==i[o]&&n[o].y()!=i[o].y())return n[o].y()<i[o].y()?1:-1;return 0},a=function(e){return 0===e.model.text().length&&!e.model.joinedNode()},u=function(e){return function(t){return t.model.pos().y>e}},d=function(e){if(e.model.isRoot())return[];var t=e.side();return i.without(e.parent().children(t),e)},c=function(e){this.node=e};c.prototype.activateEmptyChildOrCreateNew=function(e){var t,n=i.filter(this.node.children(),a).sort(r);if(n.length)n[0].model.set("text",e),t=n[0].editNode();else{t=this.node.addChild({text:e}).editNode()}t&&e&&t.autogrow()},c.prototype.activateEmptySiblingOrCreateNew=function(e,t){if(this.node.model.isRoot()){this.node.diagram.createRoot({pos:{x:this.node.model.x(),y:this.node.boundingBox().y2+40},text:e}).editNode()}else{var n,o=i.filter(d(this.node),a);if(t?(o=i.filter(o,u(this.node.model.pos().y)),o.sort(s).reverse()):o.sort(r),o.length)o[0].model.set("text",e),n=o[0].editNode();else{var l;this.node.model.parent().shape()&&(l=this.node.side());n=this.node.parent().addChild({text:e},l,t).editNode()}n&&e&&n.autogrow()}},c.prototype.activateMostRecentChildNode=function(){var e=this.node.children();this.node.model.isRoot()&&(e=this.node.children("right")),e.length&&e.sort(r)[0].editNode()},c.prototype.activateParentNode=function(){if(this.node.model.isRoot()){var e=this.node.children("left");e.length&&e.sort(r)[0].editNode()}else this.node.parent().editNode()},c.prototype.activateSiblingBelow=function(){var e;if(this.node.model.isRoot()){var t=this.node.children("bottom");if(t.length)return void t.sort(r)[0].editNode()}else{var n=this.node.parent().children();if(n.length>1)for(n.sort(s),e=0;e<n.length;e++)if(n[e]==this.node){if(e-1>=0)return void n[e-1].editNode();break}}var o=i.filter(this.node.diagram.allNodes(),function(e){return e.model.level()===this.node.model.level()}.bind(this));if(o.length>1)for(o.sort(l),e=0;e<o.length;e++)if(o[e]==this.node)return void(e-1>=0&&o[e-1].editNode());this.node.editNode()},c.prototype.activateSiblingAbove=function(){var e;if(this.node.model.isRoot()){var t=this.node.children("top");if(t.length)return void t.sort(r)[0].editNode()}else{var n=this.node.parent().children();if(n.length>1)for(n.sort(s),e=0;e<n.length;e++)if(n[e]==this.node){if(e+1<n.length)return void n[e+1].editNode();break}}var o=i.filter(this.node.diagram.allNodes(),function(e){return e.model.level()===this.node.model.level()}.bind(this));if(o.length>1)for(o.sort(l),e=0;e<o.length;e++)if(o[e]==this.node)return void(e+1<o.length&&o[e+1].editNode());this.node.editNode()};var h=function(e){return e.parent()||e.children()[0]||e.diagram.getNodeForId((e.model.closest()||{}).id)||e.diagram.titleNode()};c.prototype.remove=function(){if(this.node.model.isTitle())return void o.get("title-not-removable").activate().timeout(4e3);var e=h(this.node);this.node.squashNode(),e&&setTimeout(function(){e.model&&e.model.stillExists()&&e.editNode()},20)},c.prototype.removeRecursive=function(){if(this.node.model.isTitle())return void o.get("title-not-removable").activate().timeout(4e3);var e=h(this.node);this.node.deleteNode(),e&&setTimeout(function(){e.model&&e.model.stillExists()&&e.editNode()},20)},c.prototype.attach=function(e){e.once("previous",this.activateParentNode.bind(this)),e.once("next",this.activateMostRecentChildNode.bind(this)),e.once("up",this.activateSiblingAbove.bind(this)),e.once("down",this.activateSiblingBelow.bind(this)),e.once("spawn",this.activateEmptyChildOrCreateNew.bind(this)),e.once("sibling",this.activateEmptySiblingOrCreateNew.bind(this)),e.once("remove",this.remove.bind(this)),e.once("removeRecursive",this.removeRecursive.bind(this))},n.exports=c}),define("utils/rateLimit",["require","exports","module"],function(e,t,n){var i=function(e,t){var n=t.calls,i=t.every,o=t.onlimit||function(){},r=!1,s=0;return function(){if(r||(r=setTimeout(function(){s=0,r=!1},i)),++s<=n)return e.apply(this,arguments);o.apply(this,arguments)}};n.exports=i}),define("starc/starc.buttons",["require","exports","module","underscore","utils/trackModifiers","utils/colours","utils/rateLimit","env"],function(e,t,n){var i=Object.prototype.hasOwnProperty,o=e("underscore"),r=e("utils/trackModifiers"),s=e("utils/colours"),l=e("utils/rateLimit"),a=function(e,t,n){void 0===n&&(n=!0),e.children(t).map(function(e){e.model.set("hidden",!0),n&&a(e,void 0,n)})},u=function(e,t,n){void 0===n&&(n=!1),e.children(t).map(function(e){e.model.set("hidden",!1),n&&u(e,void 0,n)})},d=function(e,t){return o.filter(e.children(t),function(e){return e.model.hidden()})},c=function(e,t,n){o.bindAll(this,"perform","render","onNodeChange","onModifiersChanged"),this.options=n,this.node=e,this.diagram=t,this._x=this._y=0,this._hidden=!0;var i="starcbutton";n&&n.crosslink&&(i+=" crosslinkbutton"),this.$el=$("<div/>",{class:i}),this.toAddButton(),this.$el.on("tap",this.perform),$(window).on("modifierschanged",this.onModifiersChanged),this.diagram.on("mode",this.render,this),this.node.on("change",this.onNodeChange,this),this.render()};c.prototype.remove=function(){this.$el.off("tap",this.perform),$(window).off("modifierschanged",this.onModifiersChanged),this.diagram.off("mode",this.render),this.node.off(void 0,void 0,this),this.$el.remove()},c.prototype.disable=function(){this._disabled=!0},c.prototype.enable=function(){this._disabled=!1},c.prototype.perform=l(function(e){e.gesture||this._disabled||!this.action||(this.action(e),this.render())},{calls:15,every:2e3}),c.prototype.setColour=function(e){this.node&&this.node.isRoot&&this.node.isRoot()&&!this.node.isTitle()&&"root"===this.node.shape()&&!this.node.hasChildren()?this.$el.css("background-color",s.lighten(e)):this.$el.css("background-color",e)},c.prototype.suppress=function(){this._suppressed=!0,this.hide()},c.prototype.unsuppress=function(){this._suppressed=!1},c.prototype.suppressed=function(){return this._suppressed},c.prototype.show=function(){this._hidden&&!this._suppressed&&(this.$el[0].classList.add("active"),this.$el.show(),this._hidden=!1)},c.prototype.hide=function(){this._hidden||(this.$el[0].classList.remove("active"),this.$el.hide(),this._hidden=!0)},c.prototype.hover=function(){this._hovered||(this._hovered=!0,this.$el[0].classList.add("hovered"))},c.prototype.unhover=function(){this._hovered&&(this._hovered=!1,this.$el[0].classList.remove("hovered"))},c.prototype.setOffset=function(e,t){this._x=e,this._y=t,this.$el.css({top:t,left:e})},c.prototype.getOffset=function(){return{x:this._x,y:this._y}},c.prototype.setImage=function(t){this.$el.css({"background-image":"url("+e("env").cdn.url+"/img/"+t+")"})},c.prototype.toAddButton=function(){this.setImage("addbutton.svg"),this.$el[0].classList.remove("rotated"),this.$el[0].classList.add("dragtoadd"),this.action=function(e){var t=this.diagram.getNodeForId(this.node.id),n=t.addChild(void 0,this.options.side);n.animate(function(){n.editNode()}),e.stopPropagation()}.bind(this)},c.prototype.toRemoveButton=function(){this.setImage("addbutton.svg"),this.$el[0].classList.remove("dragtoadd"),this.$el[0].classList.add("rotated"),this.action=function(){if(this.options.crosslink)this.options.crosslink.destroy();else{this.diagram.getNodeForId(this.node.id).deleteNode()}}.bind(this)},c.prototype.toInsertButton=function(){this.setImage("insertbutton.svg"),this.$el[0].classList.remove("rotated"),this.$el[0].classList.remove("dragtoadd"),this.action=function(){this.diagram.getNodeForId(this.node.id).insertNode()}.bind(this)},c.prototype.toSquashButton=function(){this.setImage("squashbutton.svg"),this.$el[0].classList.remove("rotated"),this.$el[0].classList.remove("dragtoadd"),this.action=function(){this.diagram.getNodeForId(this.node.id).squashNode()}.bind(this)},c.prototype.toEditButton=function(){this.setImage("editbutton.svg"),this.$el[0].classList.remove("rotated"),this.$el[0].classList.remove("dragtoadd"),this.action=function(e){this.options.crosslink&&this.options.crosslink.edit(),e.stopPropagation()}.bind(this)},c.prototype.toCollapseButton=function(){this.setImage("collapsebutton.svg"),this.$el[0].classList.remove("rotated"),this.$el[0].classList.remove("dragtoadd"),this.action=function(){var e=this.diagram.getNodeForId(this.node.id);a(e,this.options.side),this.diagram.trigger("present:collapse")}.bind(this)},c.prototype.toExpandButton=function(){this.setImage("expandbutton.svg"),this.$el[0].classList.remove("rotated"),this.$el[0].classList.remove("dragtoadd"),this.action=function(){var e=this.diagram.getNodeForId(this.node.id);u(e,this.options.side,r.shift_key_pressed),this.diagram.trigger("present:expand")}.bind(this)},c.prototype.onModifiersChanged=function(e,t){this.render()},c.prototype.onNodeChange=function(e){var t=e.changedAttributes();(!i.call(t,"pos")||o.keys(t).length>1)&&this.render()},c.prototype.render=function(){var e=this.diagram.getNodeForId(this.node.id);if(!e)return this.hide(),this;this.setColour(this.node.colour());var t=r.alt_key_pressed,n=r.shift_key_pressed,i=r.meta_key_pressed,o=r.control_key_pressed;return this.options.crosslink?(t||o?this.toRemoveButton():this.toEditButton(),this.diagram.editingPrevented()?this.hide():this.show()):this.diagram.presentationMode()?(d(e,this.options.side).length?this.toExpandButton():this.toCollapseButton(),this.show()):this.diagram.editingPrevented()||this.diagram.historyMode()?this.hide():(this.node.isTitle()?this.toAddButton():this.node.isRoot()||this.node.shape()?!t&&!o||n||i?(t||o)&&n&&!i?this.toRemoveButton():this.node.isRoot()||t||!n||i||o?this.toAddButton():this.toInsertButton():this.toSquashButton():!t||n||i||o?t||!n||i||o?t||n||!i||o?!t&&n&&!i&&o?this.toSquashButton():t||n||i||!o?this.toAddButton():this.toRemoveButton():this.toSquashButton():this.toInsertButton():this.toRemoveButton(),this.show()),this},n.exports=c}),define("starc/starc.crosslink",["require","exports","module","underscore","starc/starc.buttons"],function(e,t,n){var i=e("underscore"),o=e("starc/starc.buttons"),r="http://www.w3.org/2000/svg",s=function(e,t,n,o){i.bindAll(this,"render","activate","deactivate","sourceLinkElement","getConnection","getButton","edit","hide","follow"),this.diagram=e,this.from=t,this.to=o,this.link=n||"",o&&($(this.getConnection()).hover(this.activate,this.deactivate),$(this.getConnection()).click(this.follow),this.getButton().$el.hover(this.activate,this.deactivate),this.from.on("change:hidden child_added child_removed",this.render,this),this.to.on("change:hidden child_added child_removed",this.render,this))};s.prototype.remove=function(){this.getConnection().remove(),this.getTextNode().remove(),this.getButton().remove(),this.from.off(void 0,void 0,this),this.to&&this.to.off(void 0,void 0,this)},s.prototype.render=function(){this.to&&!this.to.collection||(this.updateConnection(),this.updateTextNode(),this.updateButton(),this.to.hidden()||this.from.hidden()?this.hide():this.show())},s.prototype.sourceLinkElement=function(){if(!this.link)return null;var e=this.diagram.getNodeForId(this.from.id),t=e.getLabel().$el.find('a[href="'+this.link+'"]:not(.callout a)');return t.addClass("diagram-link-origin"),t};var l=function(e,t,n,i){var o,r,s=t.x-e.x,l=t.y-e.y,a=Math.abs(s)>1.5*Math.abs(l)?"wide":"tall";return o="wide"==a?r=n===i===-1?-1:n===i===1?1:e.y<0&&t.y<0?-1:e.y>0&&t.y>0?1:Math.abs(e.y)>Math.abs(t.y)?Math.sign(e.y):Math.sign(t.y):e.y<t.y?-(r=-1):-(r=1),{type:a,dest_ttb:r,source_ttb:o}};s.prototype.sourcePosForXLink=function(e,t){var n,i=this.sourceLinkElement(),o=this.diagram.getNodeForId(this.from.id),r=o.boundingBox(),s=l(this.from.absolutePosition(),e,this.from.ttb(),t),a=.8*this.from.lineWeight()*s.source_ttb,u=(s.source_ttb<0?r.y:r.y2)+a,d=r.x2-r.x;if(i&&i.length&&!i.parents(".active").length){var c=this.diagram.getScale(),h=o.getLabel().$el.offset(),p=i.offset();n=this.from.absolutePosition().x+(p.left-h.left+i.width()/2)/c}else n=r.x+d/2;return{x:n,y:u}},s.prototype.destPosForXLink=function(){var e=this.to,t=this.from,n=this.diagram.getNodeForId(e.id);if(!n)return{x:0,y:0};var i=l(t.absolutePosition(),e.absolutePosition(),t.ttb(),e.ttb()),o=.8*e.lineWeight()*i.dest_ttb,r=n.boundingBox();return{x:r.x+r.width/2,y:(i.dest_ttb<0?r.y:r.y2)+o}};var a=function(e,t,n,i,o,r){e.x>t.x&&(e=[t,t=e][0],o=[r,r=o][0],n=[i,i=n][0]);var s=l(e,t,n,i),a=o.x,u=o.y,d=r.x,c=r.y,h=null;return s.type,h=Math.max((Math.min(.6*Math.abs(a-d),2600)+Math.abs(u-c))/3,8),{x0:a,y0:u,xc0:a,yc0:u+h*s.source_ttb,xc1:d,yc1:c+h*s.dest_ttb,x1:d,y1:c}};s.prototype.pathForXLink=function(e,t,n){var i=this.from.absolutePosition(),o=this.sourcePosForXLink(e,n),r=this.from.ttb(),s=a(i,e,r,n,o,t);return["M",s.x0.toFixed(4),s.y0.toFixed(4),"C",s.xc0.toFixed(4),s.yc0.toFixed(4),s.xc1.toFixed(4),s.yc1.toFixed(4),s.x1.toFixed(4),s.y1.toFixed(4)].join(" ")},s.prototype.getConnection=function(){return this.connection||(this.connection=document.createElementNS(r,"path"),this.connection.setAttribute("id",this.link.slice(1)+"-"+this.from.id),this.diagram.getCrosslinkGroup().appendChild(this.connection)),this.connection},s.prototype.updateConnection=function(){var e=this.to.absolutePosition(),t=this.destPosForXLink();this.drawTo(e,t,this.to.ttb())},s.prototype.boundingBox=function(){var e=this.to.absolutePosition(),t=this.from.absolutePosition(),n=this.destPosForXLink(),i=this.to.ttb(),o=this.from.ttb(),r=this.sourcePosForXLink(e,i),s=a(t,e,o,i,r,n),l=[s.x0,s.xc0,s.xc1,s.x1],u=[s.y0,s.yc0,s.yc1,s.y1];return{x:Math.min.apply(null,l),y:Math.min.apply(null,u),x2:Math.max.apply(null,l),y2:Math.max.apply(null,u)}},s.prototype.drawTo=function(e,t,n){void 0===t&&(t=e),void 0===n&&(n=e.y>this.from.y()?1:-1);var i=this.getConnection();i.setAttribute("stroke",this.from.colour()),i.setAttribute("stroke-width",.7*this.from.lineWeight()),i.setAttribute("stroke-dasharray","19 13"),i.setAttribute("stroke-linecap","round"),i.setAttribute("fill","none"),i.setAttribute("cursor","pointer"),i.setAttribute("d",this.pathForXLink(e,t,n))},s.prototype.getTextNode=function(){return this.text||(this.text=document.createElementNS(r,"text"),this.text.text_path=document.createElementNS(r,"textPath"),$(this.text).append(this.text.text_path),this.diagram.getCrosslinkGroup().appendChild(this.text)),$(this.text)},s.prototype.updateTextNode=function(){var e=this.getTextNode()[0],t=this.getTextNode()[0].text_path,n=this.sourceLinkElement(),i=n&&n.text()||"";e.setAttributeNS(null,"text-anchor","middle"),e.setAttributeNS(null,"dy","-7px"),t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#"+this.getConnection().id),t.setAttributeNS(null,"startOffset","50%"),t.setAttributeNS(null,"pointer-events","visiblePainted"),t.textContent=i.replace(/^#$/,""),$(e).css({fill:this.from.colour(),cursor:"default"})},s.prototype.getButton=function(){return this.button||(this.button=new o(this.from,this.diagram,{crosslink:this}),this.diagram.nodesContainer().append(this.button.render().$el),this.button.$el.hover(this.activate,this.deactivate),this.button.$el.css({opacity:0})),this.button},s.prototype.updateButton=function(){var e=this.sourcePosForXLink(this.to.absolutePosition(),this.to.ttb());this.getButton().setOffset(e.x-2,e.y)},s.prototype.follow=function(e){var t=this.diagram.diagramCoordsFromEvent(e);(t.x-this.from.x())*(t.x-this.from.x())+(t.y-this.from.y())*(t.y-this.from.y())<(t.x-this.to.x())*(t.x-this.to.x())+(t.y-this.to.y())*(t.y-this.to.y())?this.diagram.scrollTo(this.to):this.diagram.scrollTo(this.from)},s.prototype.edit=function(){var e=this.from.text(),t=this.sourceLinkElement(),n=$(t).data("marked")||0,i={start:n,end:n+1},o=/^<[^>]*>|^\[[^\]]*\]\([^)]*\)|^\[[^\]]*\]/.exec(e.substring(n));o&&(i.end=n+o[0].length);var r=/^\[([^\]]*)\]/.exec(o);r&&(i.start+=1,i.end=i.start+r[1].length),this.diagram.getNodeForId(this.from.id).editNode(i)},s.prototype.hide=function(){this.hidden=!0,this.getConnection().setAttribute("stroke-opacity",0),this.getTextNode().css({opacity:0}),this.getButton().hide()},s.prototype.show=function(){this.to.hidden()||this.from.hidden()||(this.hidden=!1,this.getConnection().setAttribute("stroke-opacity",.4),this.getTextNode().css({opacity:.4}),this.diagram.editingPrevented()||this.getButton().show())},s.prototype.activate=function(){this.hidden||(this.getConnection().setAttribute("stroke-opacity",.8),this.getTextNode().css({opacity:.8}),this.getButton().$el.css({opacity:.8}))},s.prototype.deactivate=function(){this.hidden||(this.getConnection().setAttribute("stroke-opacity",.4),this.getTextNode().css({opacity:.4}),this.getButton().$el.css({opacity:0}))},s.prototype.destroy=function(){var e=this.from.text(),t=this.sourceLinkElement();if(t){var n=$(t).data("marked")||0,i=/^<[^>]*>|^\[[^\]]*\]\([^)]*\)|^\[[^\]]*\]/.exec(e.substring(n));if(!i)return void console.log("failed to find element to remove!",t,n,e);this.from.set("text",e.substr(0,n)+e.substr(n+i[0].length)),this.from.deltarize({text:this.from.text()})}},n.exports=s}),define("starc/starc.arrange",["require","exports","module","underscore","async"],function(e,t,n){function i(e){if(!e.model||!e.model.collection)throw new Error("no collection for "+(e.model&&e.model.id)+": node was removed during arrangement");var t;return t=e.model.shape()?3*c+h*e.boundingBox().width/2:e.children().length?h*e.boundingBox().width:3*c,e.model.parent().shape()?t+=c+e.parent().boundingBox().width/2:t+=e.subtreeSize(void 0,c,p).height*f,t}function o(e,t){var n=e.boundingBox(),i=t.boundingBox();return n.y+n.height/2-(i.y+i.height/2)}function r(e){return e.model.relY()<=0}function s(e){return e.model.relY()>0}function l(e,t,n){if(t&&0!==t.length){var l=n&&!e.model.isRoot(),a=!l,d=0;d=a?u.reduce(u.map(t,i),g,c):c;var h,f=Math.sign(t[0].model.relX()),m=function(e,t){t||(t=e.subtreeSize(void 0,c,p));var n=0;return n=f<0?Math.abs(t.x2-(e.boundingBox().x2-e.model.x())):Math.abs(t.x-(e.boundingBox().x-e.model.x())),(d+n)*f};if(1===t.length&&a)return void t[0].model.set("pos",{x:m(t[0]),y:0});var v=0;u.each(t,function(e){h=e.subtreeSize(void 0,c,p),v-=h.height+p}),v/=2,t.sort(o),u.each(t,function(e){var t=e.subtreeSize(void 0,c,p);e.model.set("pos",{x:m(e,t),y:v+(t.height+p)/2}),v+=t.height+p});var y=u.filter(t,s),b=u.filter(t,r),w=0,_=0;l?(w=e.boundingBox().y2-e.model.y()+p,_=e.boundingBox().y-e.model.y()-p):(y.length?(h=y[0].subtreeSize(void 0,c,p),_=h.y-p/2):(h=b[0].subtreeSize(void 0,c,p),_=h.y2+p/2),w=_+p+.01);var x=null,E=null;if(u.each(y,function(e){h=e.subtreeSize(void 0,c,p),e.model.set("pos",{x:e.model.pos().x,y:w+p/2-h.y}),(null===x||e.model.pos().y+h.y<x)&&(x=e.model.pos().y+h.y),(null===E||e.model.pos().y+h.y2>E)&&(E=e.model.pos().y+h.y2),w+=h.height+p}),u.each(b.reverse(),function(e){h=e.subtreeSize(void 0,c,p),e.model.set("pos",{x:e.model.pos().x,y:_+p/2-h.y2}),(null===x||e.model.pos().y+h.y<x)&&(x=e.model.pos().y+h.y),(null===E||e.model.pos().y+h.y2>E)&&(E=e.model.pos().y+h.y2),_-=h.height+p}),a){var A=0,S=(-x-E)/2;A=S>=0?b.length?Math.min(Math.max(0,-b[0].model.pos().y),S):S:y.length?Math.max(Math.min(0,-(y[0].model.pos().y-.01)),S):S,u.each(t,function(e){e.model.set("pos",{x:e.model.pos().x,y:e.model.pos().y+A})})}}}function a(e,t){var n=u.filter(e.children(),function(e){return!e.model.joinedNode()}),i=u.filter(n,function(t){return t.model.ltr()===e.model.ltr()}),o=u.difference(n,i);d.eachLimit(e.children(),10,function(e,t){a(e,t)},function(){setTimeout(function(){var n=null;try{l(e,i,!1),l(e,o,!0)}catch(e){console.error("aborting arrange: "+(e&&e.message),e),n=e}t(n)},5)})}var u=e("underscore"),d=e("async"),c=18,h=1.22,p=15,f=.02,g=function(e,t){
return Math.max(e,t)};n.exports=a}),define("starc/starc.layout",["require","exports","module","underscore"],function(e,t,n){function i(e,t,n,i,o){var r,s=t.model,a=t.children(n);t.model.shape()?(r=p(a)||A,r=Math.min(Math.max(r,x),E)):(r=p(a)||_,r=Math.min(Math.max(r,b),w));var d=u(e,t.children(n),r,o),c=0;if(d.length){d=d.map(function(e){return e-s.y()}),d.sort(function(e,t){return-(l(t)-l(e))}),c=d[0];for(var h=0;h<d.length;h++){if(!e.collides(s.x()+i(d[h]),s.y()+d[h],180*s.ltr(),l(r)-2)){c=d[h];break}}}return{x:i(),y:c}}function o(e,t,n,i,o){var r,s=t.model,a=t.children(n);r=f(a)||S,r=Math.min(Math.max(r,C),F);var u=d(e,a,r,o),c=0;if(u.length){u=u.map(function(e){return e-s.x()}),u.sort(function(e,t){return-(l(t)-l(e))}),c=u[0];for(var h=0;h<u.length;h++){if(!e.collides(s.x()+u[h]-40,s.y()+i(u[h])+12,80,24)){c=u[h];break}}}return{x:c,y:i()}}var r=e("underscore"),s=(function(e){Math.PI}(50),function(e,t){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))}),l=Math.abs,a=function(e){return function(t,n,i,o){var r=n.map(function(t){var n=t.boundingBox();return n?{max:n[e+"2"],min:n[e]}:console.warn("failed to get bbox for node",t.model.id)}),s=[];if(r.length){r.sort(function(e,t){return t.max-e.max});var l=(r[0].max+r[0].min)/2;if(s.push(l+i),s.push(l+2*i),s.push(l+3*i),!o){r.sort(function(e,t){return e.min-t.min});var a=(r[0].max+r[0].min)/2;s.push(a-i),s.push(a-2*i),s.push(a-3*i)}}return s}},u=a("y"),d=a("x"),c=function(e){return r.reduce(e,function(e,t){return e+t},0)},h=function(e){return r.filter(e,function(e){return void 0!==e})},p=function(e){function t(e){var t=r.map(e,function(e){return e.model.y()});return t.sort(function(e,t){return e-t}),t.length>1?(t[t.length-1]-t[0])/(t.length-1):void 0}var n=r.filter(e,function(e){return e.model.ltr()>0}),i=r.filter(e,function(e){return e.model.ltr()<0}),o=h([t(n),t(i)]);return o.length?c(o)/o.length:void 0},f=function(e){return function(e){var t=r.map(e,function(e){return e.model.x()});return t.sort(function(e,t){return e-t}),t.length>1?(t[t.length-1]-t[0])/(t.length-1):void 0}(e)},g=function(e){function t(e){var t=h(r.map(e.children(),function(e){var t=e.model.pos().x;return t>0?t:void 0}));return t.length>0?c(t)/t.length:void 0}var n=h(r.map(e,t));return n.length>0?c(n)/n.length:void 0},m=function(e){if(0!==e.length)return 1==e.length?e[0]:(e.sort(function(e,t){return e-t}),e[Math.floor(e.length/2)])},v=function(e){return m(e.map(function(e){return e.model.relX()}))},y=function(e){return m(e.map(function(e){return e.model.relY()}))},b=24,w=100,_=32,x=40,E=150,A=50,S=100,C=64,F=160,k=function(e){var t=e.diagram,n=e.node,o=e.node.model;return function(e,r){var s=n.children(e),l=v(s);if(!l){var a=g(n.parent().children(e))||110;a=Math.min(Math.max(a,90),360),l=a*o.ltr()}return i(t,n,e,function(){return l},r)}},T=function(e,t){var n=Math.atan2(t.y-e.y,t.x-e.x),i=n*(180/Math.PI);return i<0?i+360:i},O=function(e,t,n){for(;e<0&&"number"==typeof n;)e+=360;for(;n<e&&"number"==typeof n;)n+=360;for(;t<e&&"number"==typeof t;)t+=360;return t>=e&&t<=n},N=function(e,t){for(;"number"==typeof e&&"number"==typeof t&&t<e;)t+=360;var n=t-e;return n>=0?n%360:- -n%360},I=function(e,t){return Math.min(Math.abs(N(e,t)),Math.abs(N(t,e)))},L=function(e){var t=(e.diagram.collides.bind(e.diagram),e.node,e.node.model);return function(n,i){void 0===n&&(n="right");var o=t.children(),l=null,a=null,u=0;"top"===n?u=270:"bottom"===n?u=90:"left"===n&&(u=180);var d,c=(t.y(),[]),h=0,p=0,f=0;for(d=0;d<o.length;d++){var g=o[d];p=s({x:t.x(),y:t.y()},{x:g.x(),y:g.y()}),f=T({x:t.x(),y:t.y()},{x:g.x(),y:g.y()}),c.push({angle:f,radius:p,child:g}),h+=p}var m,v,y=e.node.getSize(),w=Math.sqrt(y.w*y.w/4+y.h*y.h/4+8100+b*b);if(c.length&&(l=h/c.length)<w&&(l=w),c.length&&i&&("left"===n||"right"===n)){var _=null;for(m=u-45,v=u+45,d=0;d<c.length;d++)O(m,c[d].angle,v)&&(null===_||c[d].child.y()>_.child.y())&&(_=c[d]);if(_){if((a=_.angle+("right"===n?10:-10))>v)return R(e)(n,i)}else a=u}else if(c.length){c.sort(function(e,t){return e.angle-t.angle});var x=[];for(x.push({mid:(c[c.length-1].angle-360+c[0].angle)/2,start:c[c.length-1].angle,end:c[0].angle}),d=1;d<c.length;d++)x.push({mid:(c[d-1].angle+c[d].angle)/2,start:c[d-1].angle,end:c[d].angle});m=u-45,v=u+45,x=r.filter(x,function(e){return!(!O(m,e.start,v)&&!O(m,e.end,v))});for(d=0;d<x.length;d++)O(m,x[d].start,v)&&!O(m,x[d].end,v)?(x[d].end=v-1e-4,O(m,x[d].mid,v)||(x[d].mid=v-1e-4)):O(m,x[d].end,v)&&!O(m,x[d].start,v)?(x[d].start=m+1e-4,O(m,x[d].mid,v)||(x[d].mid=m+1e-4)):O(m,x[d].start,v)&&O(m,x[d].end,v)&&!O(m,x[d].mid,v)&&(x.push({mid:m+1e-4,start:m+1e-4,end:x[d].end}),x[d].mid=v-1e-4,x[d].end=v-1e-4);x.sort(function(e,t){var n=Math.abs(N(t.start,t.end)),i=Math.abs(N(e.start,e.end));return n*(1+Math.min(I(t.mid,90),I(t.mid,270))/45)-i*(1+Math.min(I(e.mid,90),I(e.mid,270))/45)}),a=x.length?x[0].mid:u}else{var E=t.parent();l=E?Math.min(s({x:E.x(),y:E.y()},{x:t.x(),y:t.y()}),250):250,l<w&&(l=w),a=u}var A={x:l*Math.cos(a*(Math.PI/180)),y:l*Math.sin(a*(Math.PI/180))};return Math.abs(A.x)<.1&&(A.x=1),A}},R=function(e){var t=e.node,n=e.node.model,r=e.diagram;return function(e,l){var a=t.children(e);if(a.length){if("top"===e||"bottom"===e){var u=y(a);return o(r,t,e,function(){return u},l)}var d=v(a);return i(r,t,e,function(){return d},l)}var c=150*(1+1/(10+n.level())),h=n.children(),p=n.x(),f=n.y(),g=t.parent();if(h.length){c=m(h.map(function(e){return s({x:e.x(),y:e.y()},{x:p,y:f})}))}else g&&(c=Math.min(s({x:g.model.x(),y:g.model.y()},{x:p,y:f}),c));var b=t.getSize();return"top"===e||"bottom"===e?(c=Math.max(b.h/2+A,c),{x:0,y:"top"===e?-c:c}):(c=Math.max(b.w/2+S,c),{x:"left"===e?-c:c,y:0})}};n.exports.getMedianRelX=v,n.exports.getMedianRelY=y,n.exports.root=L,n.exports.node=k,n.exports.shape=R}),define("starc/starc.connection",["require","exports","module","underscore","utils/controlPoints"],function(e,t,n){function i(e){return 4.54688*e/6}var o=Object.prototype.hasOwnProperty,r=e("underscore"),s="http://www.w3.org/2000/svg",l=e("utils/controlPoints"),a=function(e){r.bindAll(this,"updateHideState","animate","updateLinePosition","updateLineColour","remove","getLineGroup","getContainerGroup","attachLineGroup"),this.diagram=e.diagram,this._dasharray=null,this._collapsed_dasharray=null;var t=this.from=e.model.parent(),n=this.to=e.model;if(t){t.on("change",function(){var e=this.from.changedAttributes();o.call(e,"parent_id")&&this.attachLineGroup(),(o.call(e,"parent_id")||o.call(e,"pos")||o.call(e,"control_points")||o.call(e,"shape"))&&this.updateLinePosition(),o.call(e,"hidden")&&this.updateHideState(),(o.call(e,"text")||o.call(e,"scale")||o.call(e,"text_size")||o.call(e,"width"))&&t.shape()&&this.updateLinePosition()},this);var i=function(){this.updateLinePosition()};t.on("path_changed",i,this),n.on("change",function(){var e=this.to.changedAttributes();(o.call(e,"pos")||o.call(e,"join")||o.call(e,"line_weight")||o.call(e,"line_style")||o.call(e,"line_shape")||o.call(e,"control_points")||o.call(e,"shape"))&&this.updateLinePosition(),o.call(e,"hidden")&&this.updateHideState(),(o.call(e,"text")||o.call(e,"scale")||o.call(e,"text_size")||o.call(e,"width"))&&n.shape()&&this.updateLinePosition(),o.call(e,"colour")&&this.updateLineColour()}.bind(this),this),n.on("joinedchange",i,this),t.on("attachment_moved",i,this),this.updateLinePosition(e),this.attachLineGroup(),this.updateLineColour()}};a.prototype.remove=function(){this.from&&this.from.off(void 0,void 0,this),this.to.off(void 0,void 0,this),this.removeArcTip(),this.removeArcRoot(),this.getLine().remove(),this.getLineGroup().remove()},a.prototype.setOpacity=function(e){this.opacity!=e&&this.getLineGroup().setAttribute("opacity",e),this.opacity=e},a.prototype.animate=function(e){var t=this.getLine(),n=this.getArcTip(),i=Math.abs(this.from.x()-this.to.x())+Math.abs(this.from.y()-this.to.y());$({x:0}).animate({x:1},{step:function(e){n&&n.setAttribute("opacity",0),t.setAttribute("stroke-dasharray",i*e+" "+5*i)}.bind(this),duration:100,easing:"swing",always:function(){this._dasharray?this.getLine().setAttribute("stroke-dasharray",this._dasharray):this.getLine().removeAttribute("stroke-dasharray"),n&&n.setAttribute("opacity",1),e&&e()}.bind(this)})},a.prototype.updateLinePosition=function(e){if(this.from&&this.to&&this.to.collection){var t=this.to.joinedNode();if(!t){var n=this.diagram.getNodeForId(this.to.id);n&&(t=n.ephemerallyJoinedNode())}var i=null,o=null;t&&(i=t.id,o=this.diagram.getNodeForId(i));var s=this.from.shape(),a=this.to.shape(),d=t&&t.shape(),c={to:this.to.pos(),d:this.to.ltr(),shape:a,text:a?this.to.text():"unused",width:a?this.to.width():"unused",text_size:a?this.to.textSize():"unused",weight:this.to.lineWeight(),style:this.to.lineStyle(),lineShape:this.to.lineShape(),cp:this.to.controlPoints(),join:t&&{view:!!o,node:t.id,d:t&&t.ltr(),shape:d,width:d?t.width():"unused",text_size:d?t.textSize():"unused",text:d?t.text():"unused"},from:{ltr:this.from.ltr(),shape:s,width:s?this.from.width():"unused",text_size:s?this.from.textSize():"unused",text:s?this.from.text():"unused",height:s?this.diagram.getNodeForId(this.from.id).getSize().h:"unused"}};if(!r.isEqual(c,this._relativeBounds)){var h=l.connectionParameters(this.diagram,this.from,this.to,e),p=this.getLine();if(h.short?p.setAttribute("d","M 0 0"):(p.setAttribute("stroke-width",this.to.lineWeight()),p.setAttribute("d",u(this.diagram,this.from,this.to,h))),"dashed"==this.to.lineStyle()){var f=p.getTotalLength(),g=f/32,m=Math.round(g),v=g-m,y=32*v,b=(y+13)/m;this._dasharray=[19+b,13].join(", "),this._collapsed_dasharray||this.line.setAttribute("stroke-dasharray",this._dasharray)}else this._dasharray=null,this._collapsed_dasharray||this.line.removeAttribute("stroke-dasharray");this.replaceArc(h),this._relativeBounds=c}this.updateLineTransform()}},a.prototype.updateLineTransform=function(){this.from.isRoot()?this.getLineGroup().setAttribute("transform","translate(0, 0)"):this.getLineGroup().setAttribute("transform","translate("+Math.round(this.from.relX())+","+Math.round(this.from.relY())+")")},a.prototype.updateLineColour=function(){this.getLine().setAttribute("stroke",this.to.colour());var e=this.getArcTip(),t=this.getArcRoot();e&&e.setAttribute("fill",this.to.colour()),t&&t.setAttribute("fill",this.to.colour())},a.prototype.updateHideState=function(){this.to.hidden()&&this.from.hidden()?this.hide():this.to.hidden()&&!this.from.hidden()?this.collapse():this.show()},a.prototype.getLine=function(){return this.line||(this.line=document.createElementNS(s,"path"),this.getLineGroup().appendChild(this.line),this.line.setAttribute("fill","none"),this.line.setAttribute("stroke-linejoin","round")),this.line},a.prototype.getContainerGroup=function(){return this.from.isRoot()?this.diagram.getNodeForId(this.from.id).getSVGGroup():this.diagram.getNodeForId(this.from.id).getConnection().getLineGroup()},a.prototype.attachLineGroup=function(){this.getContainerGroup().appendChild(this.getLineGroup())},a.prototype.getLineGroup=function(){return this.line_group||(this.line_group=document.createElementNS(s,"g"),this.line_group.setAttribute("data-nodeid",this.to.id),this.line_group.setAttribute("class","node-connection")),this.line_group};var u=function(e,t,n,i){var o,r,s="M ";if("straight"===n.lineShape())for(o=l.straightCPForConnection(e,t,n,i,void 0),r=0;r<o.length;r++)s+=o[r].x.toFixed(4)+" "+o[r].y.toFixed(4)+" ";else for(o=l.bezierCPForConnection(e,t,n,i,void 0),r=0;r<o.length;r++)s+=o[r].x.toFixed(4)+" "+o[r].y.toFixed(4)+" ",0===r&&(s+="C ");return s};a.prototype.boundingBox=function(){var e=this.from,t=l.bezierCPForConnection(this.diagram,e,this.to),n=r.pluck(t,"x"),i=r.pluck(t,"y"),o=e.x(),s=e.y();return{x:o+Math.min.apply(null,n),y:s+Math.min.apply(null,i),x2:o+Math.max.apply(null,n),y2:s+Math.max.apply(null,i)}};var d=function(e){var t=i(e),n=0+t,o=-e/2,r=e/2,l="M 0 "+o+" "+n+" 0 0 "+r+" "+n+" "+r+" "+n+" "+o+" z",a=document.createElementNS(s,"path");return a.setAttribute("d",l),a},c=function(e,t){var n=i(t)*e,o=-t/2,r=t/2,l=n,a="M "+o+" 0 0 "+n+" "+r+" 0 "+r+" "+l+" "+o+" "+l+" z",u=document.createElementNS(s,"path");return u.setAttribute("d",a),u},h=function(e,t){var n;n="down"===t?"M "+-e/2+" -0.2 "+-e/2+" 0.1 0 "+.75811*e+" "+e/2+" 0.1 "+e/2+" -0.2 z":"up"===t?"M "+-e/2+" 0.2 "+-e/2+" -0.1 0 "+-.75811*e+" "+e/2+" -0.1 "+e/2+" 0.2 z":"right"===t?"M -0.2 "+-e/2+" 0.1 "+-e/2+" "+.75811*e+" 0 0.1 "+e/2+" -0.2 "+e/2+" ":"M 0.2 "+-e/2+" -0.1 "+-e/2+" "+-.75811*e+" 0 -0.1 "+e/2+" 0.2 "+e/2+" ";var i=document.createElementNS(s,"path");return i.setAttribute("d",n),i},p=function(e,t,n){var o=1-i(t),r=-t/2,l=t/2;if("up"===e||"left"===e){if((n=-n)<o+1)return document.createElementNS(s,"path")}else if(n<o+1)return document.createElementNS(s,"path");var a;a="down"===e?"M "+r+" "+o+" 0 1 "+l+" "+o+" "+l+" "+(n+.1)+" 0 "+(n+.75811*t)+" "+r+" "+(n+.1)+" Z":"up"===e?"M "+r+" "+-o+" 0 "+-1+" "+l+" "+-o+" "+l+" "+-(n+.1)+" 0 "+-(n+.75811*t)+" "+r+" "+-(n+.1)+" Z":"right"===e?"M "+o+" "+r+" 1 0 "+o+" "+l+" "+(n+.1)+" "+l+" "+(n+.75811*t)+" 0 "+(n+.1)+" "+r+" Z":"M "+-o+" "+r+" "+-1+" 0 "+-o+" "+l+" "+-(n+.1)+" "+l+" "+-(n+.75811*t)+" 0 "+-(n+.1)+" "+r+" Z";var u=document.createElementNS(s,"path");return u.setAttribute("d",a),u};a.prototype.createArcRoot=function(e){var t=null,n=e||l.connectionParameters(this.diagram,this.from,this.to);t="up"===n.df||"down"===n.df?c("up"===n.df?-1:1,this.to.lineWeight()):d(this.to.lineWeight());var o=0,r=0,s=i(this.to.lineWeight());return"up"===n.df?r=s-1:"down"===n.df?r=1-s:"left"===n.df?o=s-1:"right"===n.df&&(o=1-s),"left"===n.df?t.setAttribute("transform","translate("+(n.xf+o)+","+(n.yf+r)+") scale(-1, 1)"):t.setAttribute("transform","translate("+(n.xf+o)+","+(n.yf+r)+")"),t.setAttribute("fill",this.to.colour()),t.setAttribute("stroke","none"),this.arc_root=t,this.diagram.presentationMode()&&this.from.get("hidden")&&this.to.get("hidden")&&$(t).hide(),t},a.prototype.createCombinedRoot=function(e){var t=null;return t="up"===e.df||"down"===e.df?p(e.dt,this.to.lineWeight(),e.yt-e.yf):p(e.dt,this.to.lineWeight(),e.xt-e.xf),t.setAttribute("transform","translate("+e.xf+","+e.yf+")"),t.setAttribute("fill",this.to.colour()),t.setAttribute("stroke","none"),this.arc_root=t,this.diagram.presentationMode()&&this.from.get("hidden")&&this.to.get("hidden")&&$(t).hide(),t},a.prototype.getArcRoot=function(){return this.arc_root||null},a.prototype.removeArcRoot=function(){this.arc_root&&this.arc_root.remove(),this.arc_root=void 0},a.prototype.createArcTip=function(e){var t=e||l.connectionParameters(this.diagram,this.from,this.to),n=!this.from.isRoot()&&this.to.ltr()!==this.from.ltr(),i=h(this.to.lineWeight()-.3,t.dt);return i.setAttribute("transform","translate("+(t.xt-.1*(n?-1:1))+","+(t.yt+.15)+")"),i.setAttribute("fill",this.to.colour()),i.setAttribute("stroke","none"),this.arc_tip=i,this.diagram.presentationMode()&&this.to.get("hidden")&&$(i).hide(),i},a.prototype.getArcTip=function(){return this.arc_tip||null},a.prototype.removeArcTip=function(){this.arc_tip&&this.arc_tip.remove(),this.arc_tip=void 0},a.prototype.addCPAt=function(e){var t=e.x-this.from.x(),n=e.y-this.from.y(),i=this.to.sortedControlPoints();i=[{n:l.Min_CP_ID,x:0,y:0}].concat(i,[{n:l.Max_CP_ID,x:this.to.relX(),y:this.to.relY()}]);var o=l.findClosestPointsAlongPath(this.getLine(),i,t,n),r=l.newIDBetween(o[0].n,o[1].n);return this.to.setCP(r,{x:t,y:n}),this.to.deltarize(),this.updateLinePosition(),r},a.prototype.replaceArc=function(e){this.removeArcTip(),this.removeArcRoot();var t=this.getLineGroup();e.short?t.insertBefore(this.createCombinedRoot(e),t.firstChild):(t.insertBefore(this.createArcTip(e),t.firstChild),t.insertBefore(this.createArcRoot(e),t.firstChild))},a.prototype.collapse=function(){$(this.getArcRoot()).show(),$(this.getArcTip()).hide(),$(this.getLine()).show(),this._collapsed_dasharray=[5,1,4,1,2,1,1,2,1,4,1,8,1,99999].join(", "),this.getLine().setAttribute("stroke-dasharray",this._collapsed_dasharray),this.setOpacity(.6)},a.prototype.show=function(){$(this.getArcRoot()).show(),$(this.getArcTip()).show(),$(this.getLine()).show(),this._collapsed_dasharray=null,this._dasharray?this.getLine().setAttribute("stroke-dasharray",this._dasharray):this.getLine().removeAttribute("stroke-dasharray"),this.setOpacity(1)},a.prototype.hide=function(){$(this.getArcRoot()).hide(),$(this.getArcTip()).hide(),$(this.getLine()).hide()},n.exports=a}),define("views/ControlPoint",["require","exports","module","underscore","utils/controlPoints","views/PitchView","BrowserDetect","env"],function(e,t,n){var i=e("underscore"),o=e("utils/controlPoints"),r=e("views/PitchView"),s=e("BrowserDetect"),l="Safari"===s.browser&&window.performance&&window.performance.now,a={},u=function(e,t,n){var i,o=setTimeout(function(){o=null;var t=performance.now();i=setInterval(function(){var o=performance.now()-t;o+50>n?(clearInterval(i),i=null,e.css("opacity",0)):e.css("opacity",1-o/n)},100)},t);return{cancel:function(){e.css("opacity",""),o&&clearTimeout(o),i&&clearInterval(i)}}},d=function(e,t){this.id=e,this.virtual=t,this.$el=$("<div/>",{class:"controlpoint"+(t?" virtual":"")}),this.$el[0].setAttribute("data-cpid",e)};d.prototype.setVirtual=function(e){e&&!this.virtual?(this.$el.addClass("virtual"),this.virtual=!0):this.virtual&&!e&&(this.$el.removeClass("virtual"),this.virtual=!1)},d.prototype.render=function(){return this.$el},d.prototype.remove=function(){this.$el.remove(),this.$el=null};var c=function(e,t){return(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)},h=function(e,t){var n=e.parent();if(!n)return[];var r,s,l=e.sortedControlPoints(),a=[],u=[o.Min_CP_ID].concat(i.pluck(l,"n"),[o.Max_CP_ID]);if("straight"===e.lineShape()){var d=o.straightCPForConnection(t,n,e,void 0,l);for(r=0,s=1;s<d.length-2;s++)c(d[s],d[s+1])>6400&&a.push({x:(d[s].x+d[s+1].x)/2,y:(d[s].y+d[s+1].y)/2,n:o.newIDBetween(u[r],u[r+1]),virtual:!0}),r+=1}else{var h=o.bezierCPForConnection(t,n,e,void 0,l);for(r=0,s=3;s<h.length;s+=3)c(h[s-3],h[s])>6400&&a.push({x:(h[s-3].x+3*h[s-2].x+3*h[s-1].x+h[s].x)/8,y:(h[s-3].y+3*h[s-2].y+3*h[s-1].y+h[s].y)/8,n:o.newIDBetween(u[r],u[r+1]),virtual:!0}),r+=1}return a},p=function(e,t){this.node=e,this.diagram=t,this.$el=$("<div/>",{class:"controlpoint-set"}),this.$el[0].setAttribute("data-nodeid",e.id),this.node.on("ancestor_moved joinedchange",this.update,this),this.node.on("change",function(){var e=this.node.changedAttributes();e.hasOwnProperty("shape")||e.hasOwnProperty("control_points")||e.hasOwnProperty("line_shape")||e.hasOwnProperty("colour")?this.update():(e.hasOwnProperty("text")||e.hasOwnProperty("width")||e.hasOwnProperty("text_size")||e.hasOwnProperty("scale"))&&this.node.shape()&&this.update()}.bind(this),this),this.listening_to_parent=null;var n=function(){this.listening_to_parent&&(this.listening_to_parent.off(null,null,this),this.listening_to_parent=null);var e=this.node.parent();e&&(e.on("change",function(){var t=e.changedAttributes();t.hasOwnProperty("shape")||t.hasOwnProperty("control_points")||t.hasOwnProperty("pos")?this.update():(t.hasOwnProperty("text")||t.hasOwnProperty("width")||t.hasOwnProperty("text_size")||t.hasOwnProperty("scale"))&&e.shape()&&this.update()}.bind(this),this),this.listening_to_parent=e),this.update()}.bind(this);this.node.on("path_changed",n,this),n(),this.control_points={},this.update()};p.prototype.update=function(){if(this.$el){this.clearFade();var e=this.node.controlPoints();e.length<7&&(e=e.concat(h(this.node,this.diagram)));var t=i.pluck(e,"n"),n={};if(i.each(this.control_points,function(e,i){-1===t.indexOf(i)?e.remove():n[i]=e}),this.control_points=n,e.length){var o=this.node.parent();if(!o)return i.each(this.control_points,function(e,t){e.remove()}),void(this.control_points={});this.$el.css({left:o.x(),top:o.y(),color:this.node.colour()});var r=[];e.forEach(function(e){this.control_points[e.n]||(this.control_points[e.n]=new d(e.n,e.virtual),r.push(this.control_points[e.n].render())),this.control_points[e.n].$el.css({left:e.x,top:e.y}),this.control_points[e.n].setVirtual(e.virtual)}.bind(this)),this.$el.append(r)}}},p.prototype.render=function(){this.$el.empty();var e=[];return i.each(this.control_points,function(t){e.push(t.render())}.bind(this)),this.$el.append(e),this.$el},p.prototype.clearFade=function(){this._fade&&(clearTimeout(this._fade),this._fade=null,this._js_fade&&(this._js_fade.cancel(),this._js_fade=null),this.$el&&this.$el.removeClass("fadeout"))},p.prototype.fadeOut=function(){this.$el&&(this.clearFade(),l?this._js_fade=u(this.$el,2e3,1e3):this.$el.addClass("fadeout"),this._fade=setTimeout(function(){this.remove()}.bind(this),3e3))},p.prototype.remove=function(){this.node&&this.$el&&(this.node.id&&delete a[this.node.id],this.$el.remove(),this.$el=null,this.clearFade(),this.node.off(null,null,this),this.node=null,this.listening_to_parent&&this.listening_to_parent.off(null,null,this))};var f=function(e){i.each(a,function(t){e&&t.node===e||t.fadeOut()})};p.showFor=function(e,t){if(t&&t.stillExists())if(f(t),a[t.id]&&a[t.id].node)a[t.id].clearFade(),a[t.id].update();else{var n=new p(t,e);n.render().appendTo(e.nodesContainer()),a[t.id]=n}},p.remove=function(e){var t={};i.each(a,function(n){!n.node||e&&n.node!==e?n.node&&(t[n.node.id]=n):n.remove()}),a=t},p.pitch=function(){r.show({id:"pitch:controlpoints",title:"Control Line Paths",teaser:e("env").cdn.url+"/img/features/control-paths.gif",message:"The Awesome plan includes more control points to adjust the path of connections. Upgrade now for precise control!"})},p.fadeOut=f,p.virtualControlPoints=h,p.Max_Control_Points=7,p.enabled=!0,n.exports=p}),define("utils/snapping",["require","exports","module","underscore","utils/trackModifiers","starc/starc.layout"],function(e,t,n){var i=e("underscore"),o=e("utils/trackModifiers"),r=e("starc/starc.layout"),s=function(e){var t=e.side(),n=i.without(e.parent().children(t),e);return r.getMedianRelX(n)},l=function(e){this.view=e,this.model=e.model,this.snaps=0,this.sibling_median_x=null,this.sibling_median_y=null;var t=[],n=[],i=e.boundingBox(),o={top:i.y2-300,right:i.x2+300,bottom:i.y+300,left:i.x-300};e.diagram.model.getNodes().forEach(function(i){i.isInRegion(o)&&i!==e.model&&(t.push(i.x()),n.push(i.y()))}),this.neighbours_x=t,this.neighbours_y=n,this.snap_modifier_was_pressed=!1,this.origin=null,this.max_1d_dist=0};l.prototype.snapDistance=function(){return Math.min(this.max_1d_dist/2,40/(40+this.snaps)*6)};var a=function(e,t){for(var n=null,i=1/0,o=0;o<t.length;o++)Math.abs(t[o]-e)<i&&(i=Math.abs(t[o]-e),n=t[o]);return n};l.prototype.snap=function(e){null===this.origin&&(this.origin={x:e.x,y:e.y}),this.max_1d_dist=Math.max(this.max_1d_dist,Math.abs(e.x-this.origin.x),Math.abs(e.y-this.origin.y));var t={x:e.x,y:e.y},n=this.model.parent(),l=this.snapDistance();if(o.control_key_pressed||o.meta_key_pressed)this.snap_modifier_was_pressed=!0,t.x=20*Math.round(e.x/20),t.y=20*Math.round(e.y/20);else if(!this.snap_modifier_was_pressed){var u=[],d=[];if(this.model.shape()){if(n){u.push(n.x()),d.push(n.y());var c=i.without(this.view.parent().children(this.view.side()),this.view);if(c.length){var h=this.view.side();"top"===h||"bottom"===h?(null===this.sibling_median_y&&(this.sibling_median_y=n.y()+r.getMedianRelY(c)),d.push(this.sibilng_median_y)):(null===this.sibling_median_x&&(this.sibling_median_x=n.x()+r.getMedianRelX(c)),u.push(this.sibilng_median_x))}}}else n&&(null===this.sibling_median_x&&(this.sibling_median_x=n.x()+s(this.view)),u.push(this.sibilng_median_x));var p=a(e.x,u.concat(this.neighbours_x)),f=a(e.y,d.concat(this.neighbours_y));null!==p&&Math.abs(p-e.x)<l&&(t.x=p,this.snaps++),null!==f&&Math.abs(f-e.y)<l&&(t.y=f,this.snaps++)}return t};var u=function(e,t){this.view=e,this.model=e.model,this.snaps=0,this.snapto=[{x:0,y:0},{x:this.model.relX(),y:this.model.relY()}],this.model.sortedControlPoints().forEach(function(e){e.n!==t&&this.snapto.push(e)}.bind(this))};u.prototype.snapDistance=function(){return 50/(50+this.snaps)*6},u.prototype.snap=function(e){var t={x:e.x,y:e.y};if("straight"!==this.model.get("line_shape"))return t;var n=this.snapDistance();return this.snapto.forEach(function(i){Math.abs(e.x-i.x)<n&&(t.x=i.x,this.snaps++),Math.abs(e.y-i.y)<n&&(t.y=i.y,this.snaps++)}),t},n.exports={NodeSnapping:l,CPSnapping:u}}),define("starc/starc.node",["require","exports","module","underscore","views/NodeTextView","views/NodeEditView","controllers/NodeNavigationController","starc/starc.crosslink","starc/starc.arrange","utils/trackModifiers","views/PitchView","starc/starc.layout","utils/colours","starc/starc.connection","views/ControlPoint","views/shapes","utils/snapping","utils/controlPoints","utils/queryString"],function(e,t,n){function i(e){var t=e.clone();return t.find(".callout").remove(),t.find("img").replaceWith(function(){return $(this).attr("alt")||$(this).attr("title")}),t.text()}var o=e("underscore"),r=e("views/NodeTextView"),s=e("views/NodeEditView"),l=e("controllers/NodeNavigationController"),a=e("starc/starc.crosslink"),u=e("starc/starc.arrange"),d=e("utils/trackModifiers"),c=(e("views/PitchView"),e("starc/starc.layout")),h=e("utils/colours"),p=e("starc/starc.connection"),f=e("views/ControlPoint"),g=e("views/shapes"),m=e("utils/snapping"),v=e("utils/controlPoints"),y=e("utils/queryString"),b="http://www.w3.org/2000/svg",w=y().dbg_bboxes,_=function(e,t,n){var i=e.x-t.x,o=e.y-t.y;return i*i+o*o>n*n},x=function(e){if(!e.length)return!1;var t=[];o.each(e,function(e){var n=/^\s*[*-]?\s*([0-9]+)(?:\.|\s|$)/.exec(e.text());n&&t.push(n[1])}),t.sort();for(var n=0,i=0;i<t.length-1;i++)parseInt(t[i])+1===parseInt(t[i+1])&&(n+=1);return t.length>=.5*e.length&&n>=.7*(t.length-2)},E=function(e,t){o.bindAll(this,"getLabel","crosslinkFor","updateCrosslinks","destroyCrosslink","invalidateSize","editNode","updateFontSize","getSize","getSVGGroup","onImgLoad"),this.model=t,this.diagram=e,this.crosslinks=null,this.connection=null,this._move_join_to=null,t.on("change",this.onChange,this),t.on("joinedchange",this.joinedChange,this),t.on("child_added child_removed",this.onChildAddRm,this),t.on("path_changed",this.updateFontSize,this),t.on("destroy",this.remove,this),this.getLabel().$el[0].addEventListener("load",this.onImgLoad,!0),this.updateFontSize(),this.getConnection(),this.diagram.presentationMode()&&this.updateHideState(),this.model.isRoot()&&this.updateRootPosition(),w&&(this.showDebugBoundingBox(),this.model.on("change child_added child_removed parent_moved",this.showDebugBoundingBox.bind(this))),this.model.shape()&&this.render(),this.model.joinedNode()&&this.getLabel().$el.hide()};o.extend(E.prototype,Backbone.Events),E.prototype.onImgLoad=function(){this.model&&this.model.stillExists()&&(this.invalidateSize(),this.render(),this.model.trigger("attachment_moved"))},E.prototype.onChange=function(){var e=this.model.changedAttributes();if((e.hasOwnProperty("text")||e.hasOwnProperty("scale")||e.hasOwnProperty("text_size")||e.hasOwnProperty("width")||e.hasOwnProperty("shape")||e.hasOwnProperty("attachments"))&&this.invalidateSize(),e.hasOwnProperty("parent_id")||e.hasOwnProperty("shape")){var t="root parent"===(e.parent_id||this.model.get("parent_id")),n="root parent"===this.model.previous("parent_id"),i=t||!!e.shape,o=n||null===e.shape;i?this.getLabel().updateHtmlPosition():o&&(this.node&&(this.node.remove(),this.node=null),this.bg_svg&&(this.bg_svg.remove(),this.bg_svg=null),this.getLabel().updateHtmlPosition()),t?this.removeConnection():n&&(this.group&&(this.group.remove(),this.group=null),this.removeConnection(),this.getConnection())}this.model.isRoot()?((e.hasOwnProperty("pos")||e.hasOwnProperty("parent_id"))&&this.updateRootPosition(),this.render()):(e.hasOwnProperty("parent_id")&&(this.removeConnection(),this.getConnection(),this.getLabel().updateHtmlPosition()),e.hasOwnProperty("hidden")&&this.updateHideState(),this.model.shape()&&(e.hasOwnProperty("text")||e.hasOwnProperty("scale")||e.hasOwnProperty("text_size")||e.hasOwnProperty("width")||e.hasOwnProperty("colour")||e.hasOwnProperty("parent_id")||e.hasOwnProperty("attachments"))?this.render():e.hasOwnProperty("shape")&&this.render())},E.prototype.joinedChange=function(){this.model.joinedNode()||this._move_join_to?(this.node&&(this.node.remove(),this.node=null),this.bg_svg&&(this.bg_svg.remove(),this.bg_svg=null),this.getLabel().$el.hide()):this.getLabel().$el.show(),this.render()},E.prototype.onChildAddRm=function(){this.invalidateSize(),this.model.isRoot()&&this.render()},E.prototype.side=function(){var e=this.model.parent();if(!e)return"right";if(!e.shape())return this.model.ltr()>0?"right":"left";switch(v.connectionParameters(this.diagram,e,this.model).df){case"down":return"bottom";case"up":return"top";case"left":return"left";default:case"right":return"right"}},E.prototype.positionForChild=function(){return this.model.isRoot()?c.root({diagram:this.diagram,node:this}).apply(this,arguments):this.model.shape()?c.shape({diagram:this.diagram,node:this}).apply(this,arguments):c.node({diagram:this.diagram,node:this}).apply(this,arguments)},E.prototype.render=function(){if(this.model.joinedNode()||this._move_join_to)return void this.getLabel().$el.hide();var e=this.model.shape(),t=this.model.isRoot();if(t||null!==e){var n=this.getNode(),i=this.getSVG(),o=this.getSize(),r=o.w,s=o.h;i.setAttribute("width",r),i.setAttribute("height",s),i.setAttribute("viewBox",[-r/2,-s/2,r,s].join(" ")),i.style.margin=-s/2+"px 0 0 "+-r/2+"px";var l=this.model.isTitle(),a=this.model.hasChildren();if(e){var u=g.path(e,r,s);u?(n.setAttribute("d",u),n.setAttribute("fill",this.model.colour())):(n.removeAttribute("d"),n.removeAttribute("fill")),n.removeAttribute("stroke"),n.removeAttribute("stroke-width")}t&&(l||a||e&&"root"!==e?1===this.opacity?n.removeAttribute("opacity"):this.getNode().setAttribute("opacity",this.opacity):e&&"root"!==e||(n.setAttribute("fill","#fcfcfc"),n.setAttribute("stroke-width","2px"),n.setAttribute("stroke",h.lighten(this.model.colour()))))}return this},E.prototype.animate=function(e){this.getLabel().$el.hide(),this.getConnection().animate(function(){this.getLabel().$el.fadeIn(200),e&&e()}.bind(this))},E.prototype.getSize=function(){var e=this.boundingBox(),t={w:e.width+10,h:e.height};return t.w=Math.round(Math.max(80,t.w)),t.h=Math.round(Math.max(15,t.h)),t.w%2&&(t.w+=1),t.h%2&&(t.h+=1),t},E.prototype.connectionPoints=function(){var e=this.model.shape();return e?g.connectionsForSize(e,this.getSize()):[{x:0,y:0,direction:this.model.ltr()>0?"right":"left"}]},E.prototype.getSVGGroup=function(){return this.group||(this.group=document.createElementNS(b,"g"),this.diagram.getPaper().appendChild(this.group),this.opacity=1),this.group},E.prototype.updateRootPosition=function(){this.getSVGGroup().setAttribute("transform","translate("+Math.round(this.model.pos().x)+","+Math.round(this.model.pos().y)+")")},E.prototype.getSVG=function(){if(this.bg_svg)return this.bg_svg;var e=$('<svg class="shapebackground" height="0" width="0" version="1.1" xmlns="'+b+'" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 0 0"></svg>');return this.bg_svg=e[0],this.getLabel().$el.append(e),this.bg_svg},E.prototype.getNode=function(){if(this.node)return this.node;var e=this.getSVG();return this.node=document.createElementNS(b,"path"),e.appendChild(this.node),this.node},E.prototype.getConnection=function(){return this.connection||(this.connection=new p(this)),this.connection},E.prototype.removeConnection=function(){this.connection&&this.connection.remove(),this.connection=null},E.prototype.updateHideState=function(){this.model.hidden()?(this.getConnection().hide(),this.getLabel().$el.hide()):(this.getConnection().show(),this.model.joinedNode()||this.getLabel().$el.show())},E.prototype.remove=function(){this.node&&this.node.remove(),f.remove(this.model),this.removeConnection(),this.diagram.model.getNodes().off(void 0,void 0,this),this.model.off(void 0,void 0,this),this.removeAllCrosslinks(),this.bg_svg&&(this.bg_svg.remove(),this.bg_svg=null),this.label&&(this.label.remove(),this.label=null),this.group&&(this.group.remove(),
this.group=null),this.wasRemoved=!0},E.prototype.isInViewport=function(e){return this.model.isInRegion(this.diagram.viewportBounds(e))},E.prototype.getLabel=function(){return this.label||(this.label=new r({model:this.model,diagram:this.diagram}),this.label.$el.attr({"data-nodeid":this.model.id}),this.diagram.nodesContainer().append(this.label.render().$el)),this.label},E.prototype.displayedText=function(){return this.model.text()?i(this.label.$el.find(".node-content")).replace(/\s*$/,""):""},E.prototype.updateFontSize=function(){this.invalidateSize(),this.getLabel().$el.css({"font-size":this.model.textSize()})},E.prototype.newEphemeralCrosslink=function(){return new a(this.diagram,this.model)},E.prototype.targetForCrosslink=function(e,t){var n=this,i=function(i){return i.id!==n.model.id&&Math.abs(i.x()-e)<100&&Math.abs(i.y()-t)<40};return this.diagram.model.getNodes().closest(e,t,i)},E.prototype.createCrosslinkTo=function(e,t){var n=this.targetForCrosslink(e,t);n&&(this.model.set("text",this.model.text()+" [#](#"+n.shortId()+")"),this.model.deltarize({text:this.model.text()}))},E.prototype.crosslinkFor=function(e,t){return this.crosslinks||(this.crosslinks={}),this.crosslinks[t]?this.crosslinks[t]:(this.crosslinks[t]=new a(this.diagram,this.model,t,e),this.crosslinks[t])},E.prototype.deadCrosslinks=function(e){return this.crosslinks?o.mapObject(this.crosslinks,function(t,n){if(-1===e.indexOf(n))return t}):[]},E.prototype.destroyCrosslink=function(e,t){e&&(e.remove(),delete this.crosslinks[t])},E.prototype.updateCrosslinks=function(){var e=this.model.linksTo(),t=o.mapObject(e,this.crosslinkFor);o.values(t).map(function(e){e.render()}),o.mapObject(this.deadCrosslinks(o.keys(e)),this.destroyCrosslink)},E.prototype.removeAllCrosslinks=function(){this.crosslinks&&o.values(this.crosslinks).map(function(e){e.remove()})},E.prototype.colourForNewChild=function(e){if(this.model.isRoot()&&h.saturation(this.model.colour())<.05&&!e){var t=this.diagram.model.get("_cid")||this.diagram.model.get("_id"),n=this.model.children().length+parseInt(t.substr(-8),16),i=h.defaults("free"!==this.diagram.model.myEditing());return i[Math.abs(n+5*this.model.rootIdx())%i.length]}var o=[];this.diagram.model.getNodes().each(function(e){e&&e.joinedNode&&e.joinedNode()===this.model&&o.push(e.colour())}.bind(this));var r="#000000";return o.length?(o.push(this.model.colour()),r=this.diagram.averageColours(o)):r=this.diagram.randomWalkColour(this.model.colour()),r};var A=function(e){var t=e.children();if(!t.length)return null;for(var n=t[0],i=1;i<t.length;i++)t[i].model.local_timestamp<n.model.local_timestamp&&(n=t[i]);return n};E.prototype.addChild=function(e,t,n){e||(e={});var i=this;this.model.shape()&&(i=A(this)||this),t||this.model.shape()&&this.parent()&&(t=this.side()),e.colour||(e.colour=this.colourForNewChild()),e.pos||(e.pos=this.positionForChild(t,n||x(this.model.children()))),void 0===e.shape&&"root"!==this.model.shape()&&(e.shape=i.model.shape()),["text_alignment","line_weight","line_shape","line_style"].forEach(function(t){e[t]||(e[t]=i.model.get(t))}),e.text_size||(this.model.hasChildren()||this.model.shape()&&"root"!==this.model.shape()?e.text_size=(A(this)||this).model.textSize():e.text_size=this.model.textSizeForChild());var o=this.model.addChild(e),r=this.diagram.getNodeForId(o.id);return this.diagram.growSizeToContent({do_not_defer:!!window.Coggle_App_Main}),this.diagram.trigger("node_added",r),this.model.trigger("node_added",o),r},E.prototype.insertNode=function(){if(this.model.parent()){var e=this.parent().addChild({pos:this.model.pos(),colour:this.model.colour()});return this.model.reparentTo(e.model),this.model.deltarize({parent_id:this.model.get("parent_id"),pos:this.model.pos()}),setTimeout(function(){e.editNode&&e.editNode()}),this.diagram.trigger("node_inserted",e),e}},E.prototype.reverseLine=function(){var e=this,t=this.diagram,n=e.model.parent(),i=e.model.joinedNode();if(n&&e){var o=e.model.colour(),r=e.model.get("line_weight"),s=e.model.get("line_style"),l=e.model.get("line_shape");e.removeLine();var a=null;if(i&&t.getNodeForId(i.id)?a=i:e.wasRemoved||(a=e.model),!a)return void console.error("no new parent for line reversal");var u=n.absolutePosition();if(!n.isRoot()||n.isTitle()||a.isDescendedFrom(n)){var d=a.addChild({join:n.id,colour:o,line_weight:r,line_style:s,line_shape:l}),c=t.getNodeForId(d.id);t.trigger("node_added",c),a.trigger("node_added",d)}else n.reparentTo(a),n.positionAbsolutely(u.x,u.y),n.deltarize({parent_id:n.get("parent_id"),pos:n.pos()})}},E.prototype.removeLine=function(){var e=this.model.joinedNode();if(e)this.model.children().map(function(t){t.reparentTo(e),t.deltarize({parent_id:e.id})}),this.deleteNode();else{var t=this.diagram.model.getNodes().find(function(e){return e.get("join")===this.model.id&&!e.isDescendedFrom(this.model)}.bind(this)),n=t&&t.parent();if(n){var i=this.model.parent().absolutePosition();this.model.reparentTo(n),this.model.positionAbsolutely(this.model.pos().x+i.x,this.model.pos().y+i.y),this.model.deltarize({line_weight:t.get("line_weight"),line_style:t.get("line_style"),colour:t.colour(),parent_id:n.id,pos:this.model.pos()}),this.diagram.getNodeForId(t.id).deleteNode()}else{var o=this.model.x(),r=this.model.y();this.model.ltr();this.model.reparentTo(null),this.model.positionAbsolutely(o,r),this.model.deltarize({parent_id:this.model.get("parent_id"),pos:this.model.pos()})}}},E.prototype.squashNode=function(){if(this.model.children().length){var e={x:this.model.pos().x,y:this.model.pos().y};this.model.children().map(function(t){t.reparentTo(this.model.parent()),t.deltarize({parent_id:this.model.get("parent_id"),pos:{x:t.pos().x+e.x,y:t.pos().y+e.y}})}.bind(this))}this.diagram.trigger("node_squashed",this),this.deleteNode()},E.prototype.editNode=function(e){if(!this.diagram.editingPrevented()){if(this.model.joinedNode()){var t=this.diagram.getNodeForId(this.model.joinedNode().id);if(t)return t.editNode(e)}var n;e&&e.start&&e.end&&(n={start:e.start,end:e.end}),this.access_time=new Date;var i,o=s.activeEdit();if(!o||(i=o.$el.hasClass("has-paused"),o.model!==this.model)){var r=new s({model:this.model,inheritPauseState:i,diagram:this.diagram});return r.$el.innerWidth(this.getLabel().$el.find(".node-content .text-content").width()),r.$el.innerHeight(this.getLabel().$el.find(".node-content .text-content").height()),this.getLabel().$el.addClass("active"),this.getLabel().$el.prepend(r.render().$el),r.focus(),n?r.selectRange(n):r.caretToEnd(),this.getNavigationController().attach(r),r.once("close",function(){this.getLabel().$el.removeClass("active"),this.diagram.trigger("node:editor:closed",this.model),e&&e.deleteEmpty&&0===this.model.text().length&&!this.model.hasChildren()&&!this.model.attachmentIds().length?this.deleteNode():this.updateCrosslinks()}.bind(this)),o&&o.commit(),this.diagram.trigger("node:editor:opened",this.model),r}}},E.prototype.children=function(e){var t=this.model.children(),n=this.diagram;return o.filter(o.map(t,function(e){return n.getNodeForId(e.id)}),function(t){return void 0===e||t.side()===e})},E.prototype.parent=function(){return this.model.isRoot()?null:this.diagram.getNodeForId(this.model.get("parent_id"))},E.prototype.getNavigationController=function(){return this.navigation||(this.navigation=new l(this)),this.navigation},E.prototype.invalidateSize=function(){this._cachedSize=void 0},E.prototype.boundingBox=function(e){if(!this._cachedSize){if(e)return null;this._cachedSize=this.diagram.getSizeOfNode(this.model)}var t=this._cachedSize.w,n=this._cachedSize.h,i=this.model.ttb(),o=this.model.ltr(),r=this.model.children().length,s=this.model.level(),l={x:this.model.x(),y:this.model.y(),x2:null,y2:null,width:null,height:null},a=0,u=0;return 0===s||this.model.shape()?(a=-.5*t,u=-.5*n):1===o&&0===r?(a=0,u=-.5*n):1===o&&1===i&&r>0?(a=-t,u=0):1===o&&1!==i&&r>0?(a=-t,u=-n):1!==o&&0===r?(a=-t,u=-.5*n):1!==o&&1===i&&r>0?(a=0,u=0):1!==o&&1!==i&&r>0&&(a=0,u=-n),l.x+=a,l.y+=u,l.width=t,l.height=n,l.x2=l.x+l.width,l.y2=l.y+l.height,l},E.prototype.subtreeSize=function(e,t,n){e||(e=this.children());var i=this.childrenSize(e,t,n),o=this.boundingBox(),r=this.model.x(),s=this.model.y(),l={x:Math.min(o.x-r,i.x),y:Math.min(o.y-s,i.y),x2:Math.max(o.x2-r,i.x2),y2:Math.max(o.y2-s,i.y2)};return l.width=l.x2-l.x,l.height=l.y2-l.y,l},E.prototype.childrenSize=function(e,t,n,i){t||(t=32),n||(n=15),e||(e=this.children());var r=this,s=e.map(function(e){if(e.model.joinedNode()&&!i)return null;var o=e.subtreeSize(void 0,t,n),s=e.model.x()-r.model.x(),l=e.model.y()-r.model.y();return o.x+=s,o.y+=l,o.x2+=s,o.y2+=l,o}),l=o.reduce(s,function(e,t){return e?t?{x:Math.min(e.x,t.x),x2:Math.max(e.x2,t.x2),y:Math.min(e.y,t.y),y2:Math.max(e.y2,t.y2)}:e:o.clone(t)},null);return l||(l={x:0,x2:0,y:0,y2:0}),l.width=l.x2-l.x,l.height=l.y2-l.y,l},E.prototype.setColour=function(e,t){this.model.setColour(e),this.model.deltarize({colour:this.model.get("colour")}),t&&this.children().map(function(e){e.setColour(this.colourForNewChild(!0),t)}.bind(this))},E.prototype.setLineWeight=function(e,t){this.model.setLineWeight(e),this.model.deltarize({line_weight:this.model.get("line_weight")}),t&&this.children().map(function(n){n.setLineWeight(e,t)}.bind(this))},E.prototype.setLineStyle=function(e,t){this.model.setLineStyle(e),this.model.deltarize({line_style:this.model.get("line_style")}),t&&this.children().map(function(n){n.setLineStyle(e,t)}.bind(this))},E.prototype.setLineShape=function(e,t){this.model.setLineShape(e),this.model.deltarize({line_shape:this.model.get("line_shape")}),t&&this.children().map(function(n){n.setLineShape(e,t)}.bind(this))},E.prototype.setShape=function(e,t){getCoggleUser().getActions().unique("shape:set"),this.model.set("shape",e),t&&this.children().map(function(n){n.setShape(e,t)}.bind(this)),this.model.deltarize({shape:this.model.get("shape")})},E.prototype.setOpacity=function(e){this.opacity!==e&&(1===e?(this.getSVGGroup().removeAttribute("opacity"),this.getNode().removeAttribute("opacity")):(this.getSVGGroup().setAttribute("opacity",e),this.getNode().setAttribute("opacity",e)),this.opacity=e)},E.prototype.deleteNode=function(){if(this.model.isRoot()&&1===this.model.collection.getRoots().length)return!1;s.activeEdit()&&s.activeEdit().model===this.model&&s.activeEdit().cancel(),this.children().map(function(e){e.deleteNode()}),this.diagram.trigger("node_deleted",this.model),this.model.trigger("node_deleted",this.model),this.model.destroy()},E.prototype.arrange=function(){var e=this;if(!this.model.hasChildren()){var t=this.model.parent();if(!t)return;e=this.diagram.getNodeForId(t.id)}u(e,function(){e.model.depthFirst(function(e){e.deltarize({pos:e.pos()})})})},E.prototype.highlight=function(){setTimeout(function(){this.getLabel().$el.find(".node-content").focus()}.bind(this),0)},E.prototype.setEphemerallyJoinedNode=function(e){this._move_join_to=e,this.joinedChange()},E.prototype.ephemerallyJoinedNode=function(){return this._move_join_to},E.prototype.startMoveSession=function(){if(!this.diagram.editingPrevented()){var e={x:this.model.x(),y:this.model.y()};this._move_orig_state={abs_pos:{x:e.x,y:e.y},parent_id:this.model.get("parent_id"),child_flips:this.model._child_flips},this.diagram.trigger("node:move:start",this.model),f.showFor(this.diagram,this.model);var t=e,n=this.model.isRoot()&&!this.model.isTitle(),i=d.shift_key_pressed||n,o=d.shift_key_pressed,r=n&&!o;this.movingSelfOnly=d.control_key_pressed||d.alt_key_pressed;var s=new m.NodeSnapping(this),l=e.x,a=e.y;return function(u,c){if(this.model.stillExists()&&!this.diagram.editingPrevented()&&e){void 0===u&&(u=l),void 0===c&&(c=a),l=u,a=c;var h=s.snap({x:u,y:c});o=o||d.shift_key_pressed,r=n&&!o,i=!this.model.isTitle()&&!this.model.joinedNode()&&(d.shift_key_pressed||r),this.moveBranchTo(h.x,h.y,i,t,r,this.movingSelfOnly)}}.bind(this)}},E.prototype.endMoveSession=function(e){if(this.model.stillExists()&&!this.diagram.editingPrevented()){var t;if(!this.model.isRoot()){var n=this.ephemerallyJoinedNode();if(n)if(!n.isRoot()||n.isTitle()||this.model.isDescendedFrom(n))this.model.setJoinedNode(n);else{var i=this.model.parent();if(i){var o=n.x(),r=n.y();n.set("text_size",n.textSize()),n.reparentTo(i),"root"===n.shape()&&(n.hasChildren()?n.set("shape","root"):n.set("shape",this.model.get("shape")||"label")),n.positionAbsolutely(o,r,!0),n.deltarize({shape:n.get("shape"),parent_id:n.get("parent_id"),pos:n.pos(),colour:this.model.colour(),line_style:this.model.get("line_style"),line_weight:this.model.get("line_weight")}),this.deleteNode(),t=this.diagram.getNodeForId(n.id)}}}return this.wasRemoved||(this.model.deltarize({parent_id:this.model.get("parent_id"),pos:this.model.pos(),join:this.model.get("join"),text_size:this.model.textSize()}),this.getConnection().setOpacity(1),this.setOpacity(1),this.model.isRoot()||this.getConnection().setOpacity(1),this.setEphemerallyJoinedNode(null),this._move_orig_state&&_(this._move_orig_state.abs_pos,{x:this.model.x(),y:this.model.y()},10)&&this.diagram.trigger("node_moved",this),this.movingSelfOnly&&this.model.children().forEach(function(e){e.deltarize()})),this.diagram.trigger("node:move:end",this.model),t||this}},E.prototype.cancelMove=function(e){this.model.stillExists()&&(this.diagram.editingPrevented()||(this.setOpacity(1),this.model.isRoot()||this.getConnection().setOpacity(1),this.setEphemerallyJoinedNode(null),this._move_orig_state&&(this.model.set("parent_id",this._move_orig_state.parent_id),this.model.positionAbsolutely(this._move_orig_state.abs_pos.x,this._move_orig_state.abs_pos.y,this.movingSelfOnly),this._move_orig_state.child_flips%2!=this.model._child_flips%2&&this.model.flipChildrenUntilShape())))},E.prototype.startCPMove=function(e,t){var n=new m.CPSnapping(this,e);this._cp_move_orig_state=this.model.get("control_points");var i=function(t,i){this.model.get("control_points")[e]||getCoggleUser().getActions().unique("controlpoint:create");var o=n.snap({x:t,y:i});this.model.setCP(e,{x:o.x,y:o.y})};return this.diagram.trigger("cp:drag:start",t),i.bind(this)},E.prototype.cancelCPMove=function(e){this.model.set("control_points",this._cp_move_orig_state)},E.prototype.endCPMove=function(e,t){this.model.controlPoints().length>1&&"free"===this.diagram.model.myEditing()&&(f.pitch(),this.cancelCPMove()),this.diagram.trigger("cp:drag:end",t),this.model.deltarize()},E.prototype.startDragAdd=function(e){var t=this.addChild({pos:{x:e.x-this.model.x(),y:e.y-this.model.y()}});return this._dragadd_child=t,this._dragadd_initial_pos={x:t.model.relX(),y:t.model.relY()},t.startMoveSession()},E.prototype.cancelDragAdd=function(){this._dragadd_child&&(this._dragadd_child.cancelMove(),this._dragadd_child.endMoveSession(),this._dragadd_child.deleteNode(),this._dragadd_child=null)};var S=function(e,t,n,i){return(e-n)*(e-n)+(t-i)*(t-i)};E.prototype.endDragAdd=function(){var e=this._dragadd_child;return e&&(S(e.model.relX(),e.model.relY(),this._dragadd_initial_pos.x,this._dragadd_initial_pos.y)>400?e=e.endMoveSession():(this.cancelDragAdd(),e=null)),this._dragadd_child=null,e},E.prototype.moveBranchTo=function(e,t,n,i,o,r){if(!this.diagram.editingPrevented()){var s={x:this.model.x(),y:this.model.y()};if(!(this.model.isRoot()||(this.setEphemerallyJoinedNode(null),n||this.model.joinedNode()||0!==this.model.text().length||this.model.hasChildren()))){var l=function(e){return e!=this.model.parent()&&(!e.joinedNode()&&(!(e.parent()==this.model.parent()&&!e.hasCP()&&!this.model.hasCP())&&e!==this.model))}.bind(this),a=this.diagram.closestByConnection({x:e,y:t},l);if(a){var u=a.distance,d=a.node;u<15&&(!a.contained_distance||a.contained_distance<100)&&(e=d.model.x(),t=d.model.y(),this.setEphemerallyJoinedNode(d.model))}}if(n){var c=o?50:200,h=this.diagram.model.getNodes().closest(e,t,function(e){return!e.isDescendedFrom(this.model)&&(!e.joinedNode()&&(e.isRoot()&&!e.isTitle()&&e.hasChildren(),!0))}.bind(this));_({x:e,y:t},i,60)&&(_({x:e,y:t},h.absolutePosition(),c)?(this.model.reparentTo(null,!1),i.x=e,i.y=t):h!==this.model.parent()&&(this.model.reparentTo(h,!1),i.x=e,i.y=t))}if(this.model.isRoot()?!n||o&&this.model.get("parent_id")===this._move_orig_state.parent_id?this.setOpacity(1):this.setOpacity(.2):(this.setOpacity(1),n?this.getConnection().setOpacity(.2):this.getConnection().setOpacity(1)),this.model.positionAbsolutely(e,t,r),r){var p=this.model.x()-s.x,f=this.model.y()-s.y;this.children().forEach(function(e){e.model.positionAbsolutely(e.model.x()-p,e.model.y()-f,!0)})}}},E.prototype.showDebugBoundingBox=function(){this._bb_debug||(this._bb_debug=$("<div>"),this.diagram.nodesContainer().append(this._bb_debug)),this._bb_debug.css({position:"absolute",left:this.boundingBox().x,top:this.boundingBox().y,width:this.boundingBox().width,height:this.boundingBox().height,border:"1px solid rgba(255, 0, 255, 0.5)","z-index":9999999})},n.exports=E}),function(e){"function"==typeof define&&define.amd?define("jquery.mousewheel",["jquery"],e):"object"==typeof exports?module.exports=e:e(jQuery)}(function(e){function t(t){var s=t||window.event,l=a.call(arguments,1),u=0,c=0,h=0,p=0,f=0,g=0;if(t=e.event.fix(s),t.type="mousewheel","detail"in s&&(h=-1*s.detail),"wheelDelta"in s&&(h=s.wheelDelta),"wheelDeltaY"in s&&(h=s.wheelDeltaY),"wheelDeltaX"in s&&(c=-1*s.wheelDeltaX),"axis"in s&&s.axis===s.HORIZONTAL_AXIS&&(c=-1*h,h=0),u=0===h?c:h,"deltaY"in s&&(h=-1*s.deltaY,u=h),"deltaX"in s&&(c=s.deltaX,0===h&&(u=-1*c)),0!==h||0!==c){if(1===s.deltaMode){var m=e.data(this,"mousewheel-line-height");u*=m,h*=m,c*=m}else if(2===s.deltaMode){var v=e.data(this,"mousewheel-page-height");u*=v,h*=v,c*=v}if(p=Math.max(Math.abs(h),Math.abs(c)),(!r||r>p)&&(r=p,i(s,p)&&(r/=40)),i(s,p)&&(u/=40,c/=40,h/=40),u=Math[u>=1?"floor":"ceil"](u/r),c=Math[c>=1?"floor":"ceil"](c/r),h=Math[h>=1?"floor":"ceil"](h/r),d.settings.normalizeOffset&&this.getBoundingClientRect){var y=this.getBoundingClientRect();f=t.clientX-y.left,g=t.clientY-y.top}return t.deltaX=c,t.deltaY=h,t.deltaFactor=r,t.offsetX=f,t.offsetY=g,t.deltaMode=0,l.unshift(t,u,c,h),o&&clearTimeout(o),o=setTimeout(n,200),(e.event.dispatch||e.event.handle).apply(this,l)}}function n(){r=null}function i(e,t){return d.settings.adjustOldDeltas&&"mousewheel"===e.type&&t%120==0}var o,r,s=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],l="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],a=Array.prototype.slice;if(e.event.fixHooks)for(var u=s.length;u;)e.event.fixHooks[s[--u]]=e.event.mouseHooks;var d=e.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var n=l.length;n;)this.addEventListener(l[--n],t,!1);else this.onmousewheel=t;e.data(this,"mousewheel-line-height",d.getLineHeight(this)),e.data(this,"mousewheel-page-height",d.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var n=l.length;n;)this.removeEventListener(l[--n],t,!1);else this.onmousewheel=null;e.removeData(this,"mousewheel-line-height"),e.removeData(this,"mousewheel-page-height")},getLineHeight:function(t){var n=e(t),i=n["offsetParent"in e.fn?"offsetParent":"parent"]();return i.length||(i=e("body")),parseInt(i.css("fontSize"),10)||parseInt(n.css("fontSize"),10)||16},getPageHeight:function(t){return e(t).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})}),define("utils/mousePosition",["require","exports","module"],function(e,t,n){function i(e){e.pageX?(o.x=e.pageX,o.y=e.pageY):e.originalEvent&&(o.x=e.originalEvent.clientX||e.originalEvent.pageX,o.y=e.originalEvent.clientY||e.originalEvent.pageY)}var o={x:0,y:0};document.body.addEventListener("mousemove",i,{capture:!0,passive:!0}),document.body.addEventListener("dragover",i,{capture:!0,passive:!0}),n.exports=o}),define("starc/starc.zoomController",["require","exports","module","jquery.mousewheel","underscore","utils/mousePosition","utils/queryString"],function(e,t,n){e("jquery.mousewheel");var i=e("underscore"),o=e("utils/mousePosition"),r=e("utils/queryString"),s=window.localStorage,l=function(e){return"prefs.1."+e.model.id},a=function(e){if(s&&s.getItem){var t=s.getItem(l(e));if(t)try{return t=JSON.parse(t),t.z}catch(e){return null}return null}},u=function(e,t){return"number"==typeof t?parseFloat(t.toFixed(2)):t},d=function(e,t){if(s&&s.setItem){var n=l(e),o=s.getItem(n);if(o)try{o=JSON.parse(o)}catch(e){o={}}else o={};1===t?delete o.z:o.z=t,0===i.keys(o).length?s.removeItem(n):s.setItem(n,JSON.stringify(o,u))}};n.exports=function(e){var t=BrowserDetect,n=parseFloat(r().zoom);n&&n<e.min_zoom&&(e.min_zoom=Math.max(n,.025)),e.setScale(n||a(e)||1),e.on("scale",i.debounce(function(){var n=e.getScale();d(e,n);var i=t&&"Safari"==t.browser?1:.4;e.$el.toggleClass("lod-1",n>=i)},500)),$(window).keydown(function(t){if(t.ctrlKey^t.metaKey&&!t.shiftKey&&!t.altKey){if("+"==String.fromCharCode(t.which)||"="==String.fromCharCode(t.which)||187==t.which||107==t.which||61==t.which||43==t.which||171==t.which)return e.setScale(1.25992105*e.getScale()),t.preventDefault(),!1;if("-"==String.fromCharCode(t.which)||31==t.which||189==t.which||173==t.which||109==t.which)return e.setScale(e.getScale()/1.25992105),t.preventDefault(),!1;if("0"==String.fromCharCode(t.which))return e.setScale(1),t.preventDefault(),!1}});var s=0,l=0,u=0,c=null;if(e.scrollContainer().on("mousewheel",function(t){var n=Date.now();if(t.ctrlKey^t.metaKey&&!t.shiftKey&&!t.altKey){var i=0;void 0!==t.deltaY&&(i=t.deltaY),l++,s+=Math.abs(i);var r=s/l;Math.abs(i)>u&&(u=Math.abs(i));var a=4/(r||1),d=20/(u||1),h=(a+d)/2;h>1&&l<20&&(h=(20-l+h*l)/20);var p=e.diagramCoordsFromEvent({pageX:o.x,pageY:o.y});return 0!==o.x&&0!==o.y||(p=void 0),(!c||n-c>500)&&e.startScalingAround(p),e.updateScaling(e.getScale()*(100+i*h)/100),c=n,t.preventDefault(),!1}c=n}),e.scrollContainer().on("mousemove",function(e){c=null}),t&&"Mac"===t.OS&&"GestureEvent"in window){var h=1,p=null,f=function(t){t&&"gesturestart"===t.type&&(p=e.diagramCoordsFromEvent(t),h=e.getScale(),e.startScalingAround(p)),t&&"gesturechange"===t.type&&t.scale&&e.updateScaling(h*t.scale),t&&"gestureend"===t.type&&e.endScaling(),t.preventDefault()};document.addEventListener("gesturestart",f),document.addEventListener("gesturechange",f),document.addEventListener("gestureend",f),e.on("remove",function(){document.removeEventListener("gesturestart",f),document.removeEventListener("gesturechange",f),document.removeEventListener("gestureend",f)})}}}),define("starc/starc.keyboardShortcuts",["require","exports","module","views/PitchView","utils/trackModifiers"],function(e,t,n){var i=(e("views/PitchView"),e("utils/trackModifiers"));n.exports=function(e){var t=function(t){if(90!=t.keyCode||!i.meta_key_pressed&&!i.control_key_pressed||i.alt_key_pressed||i.shift_key_pressed||e.textPopupActive()||e.editingPrevented()){if(89!=t.keyCode||!i.meta_key_pressed&&!i.control_key_pressed||i.alt_key_pressed||i.shift_key_pressed||e.textPopupActive()||e.editingPrevented())if(90!=t.keyCode||!i.meta_key_pressed&&!i.control_key_pressed||!i.shift_key_pressed||i.alt_key_pressed||e.textPopupActive()||e.editingPrevented())if(83!=t.keyCode||!i.meta_key_pressed&&!i.control_key_pressed||i.alt_key_pressed||i.shift_key_pressed)80!=t.keyCode||!i.meta_key_pressed&&!i.control_key_pressed||i.alt_key_pressed||i.shift_key_pressed?(82==t.keyCode&&(i.meta_key_pressed||i.control_key_pressed)&&i.alt_key_pressed&&i.shift_key_pressed||119==t.keyCode&&!(i.control_key_pressed||i.meta_key_pressed||i.alt_key_pressed))&&e.rootNodes().forEach(function(e){e.arrange()}):($(window).trigger("print-diagram"),t.preventDefault&&t.preventDefault());else{var n=new Date;n.getTime()-(this.autosave_warning_displayed||0)>2e4&&(this.autosave_warning_displayed=n.getTime(),window.Messages.info("<b>Coggles are saved automatically, no need to wear out the S key!</b>").timeout(5e3)),t.preventDefault&&t.preventDefault()}else e.warnIfHistoryMode()||(e.redoStep(),t.preventDefault&&t.preventDefault());else if(!e.warnIfHistoryMode())return e.redoStep(),t.preventDefault&&t.preventDefault(),!1}else if(!e.warnIfHistoryMode())return e.undoStep(),t.preventDefaul&&t.preventDefault(),!1;if(8==t.keyCode||32==t.keyCode){var o=t.srcElement||t.target;"INPUT"===o.tagName.toUpperCase()&&("TEXT"===o.type.toUpperCase()||"PASSWORD"===o.type.toUpperCase()||"FILE"===o.type.toUpperCase())||"TEXTAREA"===o.tagName.toUpperCase()?(o.readOnly||o.disabled)&&t.preventDefault():t.preventDefault()}if(t.shiftKey&&t.altKey&&!t.metaKey&&!t.ctrlKey&&t.keyCode>=37&&t.keyCode<=40&&!getCoggleUser().getActions().get("shortcut:deprecated-movement")&&Date.parse(getCoggleUser().get("firstLogin"))<Date.parse("2020-04-10"))return getCoggleUser().getActions().unique("shortcut:deprecated-movement"),void $(window).trigger("notify-info",["Use [ctrl] + [alt] + arrow keys to navigate between items",!0,1e4]);t.ctrlKey&&t.altKey&&!t.metaKey&&t.keyCode>=37&&t.keyCode<=40&&(e.textPopupActive()||e.editingPrevented()||e.titleNode().editNode()),27!=t.keyCode||"Firefox"!=BrowserDetect.browser||e.presentationMode()||t.preventDefault()};$(window).on("keydown",t),e.once("remove",function(){$(window).off("keydown",t)})}}),define("utils/gestures",["require","exports","module","js-cookie","utils/queryString","backbone","underscore"],function(e,t,n){function i(e,t){this.el=e,t=a.extend({candidates:[],touchAction:"none"},t),this.options=t,this.down=[],this.last_event=null,this.candidates=t.candidates.map(f);var n=this;this.onEvt=function(e){n[e.type](e)},this.timerEvalStates=function(){n.el&&n.evalStates()},this.el.addEventListener("pointerdown",this.onEvt,{catpure:!0}),this.el.addEventListener("pointermove",this.onEvt,{catpure:!0}),this.el.addEventListener("pointerup",this.onEvt,{catpure:!0}),this.el.addEventListener("pointercancel",this.onEvt,{catpure:!0}),t.touchAction&&(this.el.style.touchAction=t.touchAction),this.evalStates()}var o=e("js-cookie"),r=e("utils/queryString");(o.get("debug_gestures")||r().debug_gestures)&&(window._debug_gestures=1);var s=function(){window._debug_gestures&&console.log.apply(console,arguments)},l=e("backbone"),a=e("underscore"),u=function(e){return function(t){return t.pointerId==e}},d=function(e){return function(t){return t.at<e}},c=function(e,t,n,i){return(n-e)*(n-e)+(i-t)*(i-t)},h=function(e){return void 0!==e},p={events:{}},f=function(e){if(e=a.clone(e),!e.id)throw new Error("gesture id required");if(!Array.isArray(e.states))throw new Error("gesture "+e.id+" states required");return e.states.forEach(function(t){if(t.events||(t.events={}),"object"!=typeof t.events)throw new Error("gesture "+e.id+" events invalid");a.keys(t.events).forEach(function(t){if(-1===["enter","update","cancel"].indexOf(t))throw new Error("gesture "+e.id+" unknown event "+t)})}),e.states=[p].concat(e.states),e._state=0,e._state_entered=null,e};a.extend(i.prototype,l.Events);var g=function(e,t){return a.any(a.pluck(t,"target"),function(t){return t&&t.closest(e)?(s("target matches "+e,t),!0):(s("target fails "+e,t),!1)})},m=function(e,t,n,i){return!!e&&(!(h(e.pointersDown)&&!(e.pointersDown===t.length||e.pointersDown.indexOf&&e.pointersDown.indexOf(t.length)>=0))&&(!(h(e.buttons)&&!a.findWhere(t,{buttons:e.buttons}))&&(!(h(e.durationMax)&&h(n)&&n>e.durationMax)&&!(h(e.distanceMax)&&h(i)&&i>e.distanceMax*e.distanceMax))))},v=function(e,t,n,i){return!!e&&(!(h(e.pointersDown)&&!(e.pointersDown===t.length||e.pointersDown.indexOf&&e.pointersDown.indexOf(t.length)>=0))&&(!(h(e.buttons)&&!a.findWhere(t,{buttons:e.buttons}))&&(!(h(e.durationMin)&&h(n)&&n<e.durationMin)&&(!(h(e.distanceMin)&&h(i)&&i<e.distanceMin*e.distanceMin)&&!!(!h(e.target)||t.length&&g(e.target,t))))))};i.prototype.evalStates=function(){for(var e,t,n,i,o,r,l=Date.now(),a=this.pointersDistanceSquared(),u=0;u<this.candidates.length;u++)for(e=this.candidates[u],o=!0,r=!0;o;)t=(e._state+1)%e.states.length,n=e.states[t],i=e.states[e._state],r||(i&&i.durationMax&&setTimeout(this.timerEvalStates,i.durationMax),n&&n.durationMin&&setTimeout(this.timerEvalStates,n.durationMin)),v(n,this.down,l-e._state_entered,a)?(e._state=t,e._state_entered=l,s("gesture: candidate "+e.id+" moves to state "+e._state),this.emitEvent(n.events.enter,e)):r?m(i,this.down,l-e._state_entered,a)?(this.emitEvent(i.events.update,e),o=!1):(e._state=0,e._state_entered=l,s("gesture: candidate "+e.id+" cancelled"),this.emitEvent(i.events.cancel,e)):o=!1,r=!1},i.prototype.pointersDistanceSquared=function(){for(var e=0,t=0;t<this.down.length;t++)e+=c(this.down[t].clientX,this.down[t].clientY,this.down[t].origX,this.down[t].origY);return e},i.prototype.cancelGestures=function(){var e=Date.now();this.candidates.forEach(function(t){var n=t.states[t._state];n&&this.emitEvent(n.events.cancel,t),t._state=0,t._state_entered=e}.bind(this)),this.evalStates()},i.prototype.emitEvent=function(e,t){e&&this.trigger(e,this.last_event,this.down)},i.prototype.updatePointer=function(e,t){var n=a.findWhere(this.down,{pointerId:e.pointerId}),i=void 0!==t?t:e.buttons;return n?(n.clientX=e.clientX,n.clientY=e.clientY,"pointermove"!==e.type||0!==i||i===n.buttons||n._ignored_update?(n._ignored_update=0,n.buttons=i):n._ignored_update=1,n):null},i.prototype.pointerdown=function(e){var t=Date.now(),n=a.partition(this.down,d(t-6e4));n[0].length&&(console.error("expired "+n[0].length+" pointers at "+t+": "+JSON.stringify(n[0])),this.down=n[1],this.evalStates());var i;"pointerdown"===e.type&&0===e.buttons&&(s("safari pointerdown buttons workaround"),i=1),this.last_event=e,e.target&&e.target.setPointerCapture&&e.target.setPointerCapture(e.pointerId),this.updatePointer(e,i)?s("gesture pointers: pointerdown (duplicate) "+e.pointerId+" now "+this.down.length+" down"):(this.down.push(a.extend(a.pick(e,["pointerId","pointerType","clientX","clientY","target"]),{origX:e.clientX,origY:e.clientY,buttons:void 0!==i?i:e.buttons,at:t})),s("gesture pointers: pointerdown "+e.pointerId+" now "+this.down.length+" down")),this.evalStates()},i.prototype.pointermove=function(e){this.last_event=e,this.updatePointer(e),this.evalStates()},i.prototype.pointerup=function(e){this.last_event=e,this.updatePointer(e),this.down=a.reject(this.down,u(e.pointerId)),s("gesture pointers: pointerup "+e.pointerId+" now "+this.down.length+" down"),this.evalStates()},i.prototype.pointercancel=function(e){this.last_event=e,this.updatePointer(e),this.down=a.reject(this.down,u(e.pointerId)),s("gesture pointers: pointercancel "+e.pointerId+" now "+this.down.length+" down"),this.evalStates()},i.prototype.destroy=function(){this.el.removeEventListener("pointerdown",this.onEvt,{catpure:!0}),this.el.removeEventListener("pointermove",this.onEvt,{catpure:!0}),this.el.removeEventListener("pointerup",this.onEvt,{catpure:!0}),this.el.removeEventListener("pointercancel",this.onEvt,{catpure:!0}),this.stopListening(),this.el=null,this.options=null,this.down=null,this.candidates=null,this.last_event=null,this.onEvt=null,this.timerEvalStates=null},n.exports=i}),define("starc/starc.pointergestures",["require","exports","module","js-cookie","utils/queryString","underscore","utils/gestures","models/Message"],function(e,t,n){var i=e("js-cookie"),o=e("utils/queryString");(i.get("debug_gestures")||o().debug_gestures)&&(window._debug_gestures=1);var r=function(){window._debug_gestures&&console.log.apply(console,arguments)},s=(e("underscore"),e("utils/gestures")),l=e("models/Message").Messages,a=function(e,t,n,i){return(n-e)*(n-e)+(i-t)*(i-t)},u=function(e){if(!e.length)return null;for(var t={x:0,y:0},n=0;n<e.length;n++)t.x+=e[n].clientX,t.y+=e[n].clientY;return t.x/=e.length,t.y/=e.length,t},d=function(e,t){if(!e.length)return null;t=t||u(e);for(var n=0,i=0;i<e.length;i++)n+=a(t.x,t.y,e[i].clientX,e[i].clientY);return Math.sqrt(n/e.length)},c=[{id:"tap",states:[{pointersDown:0},{pointersDown:1,buttons:1,durationMax:400,distanceMax:5},{pointersDown:0,events:{enter:"tap"}}]},{id:"press",states:[{
pointersDown:0},{pointersDown:1,buttons:1,distanceMax:4},{durationMin:500,pointersDown:1,events:{enter:"press"}}]},{id:"drag",states:[{pointersDown:0},{pointersDown:1,target:".node-container, .controlpoint",buttons:1,events:{enter:"dragpossible"}},{pointersDown:1,distanceMin:2,buttons:1,events:{enter:"dragstart",update:"dragmove",cancel:"dragcancel"}},{pointersDown:0,events:{enter:"dragend"}}]},{id:"pan",states:[{pointersDown:[0,2]},{pointersDown:1,target:".pannable",buttons:1,events:{enter:"panstart",update:"panmove",cancel:"pancancel"}},{pointersDown:0,events:{enter:"panend"}}]},{id:"pinch",states:[{pointersDown:2,buttons:1,events:{enter:"pinchstart",update:"pinchmove",cancel:"pinchcancel"}},{pointersDown:[1,0],events:{enter:"pinchend"}}]},{id:"erase",states:[{pointersDown:0},{pointersDown:1,buttons:32,events:{enter:"erasestart",update:"erasemove",cancel:"eraseend"}},{pointersDown:0,events:{enter:"eraseend"}}]}],h=function(e,t){var n=t.scrollContainer(),i=t.getPaper();i.classList?i.classList.add("pannable"):$(i).addClass("pannable");var o=null,r=null,s=null,l=null,c=null,h=null,p=null;e.on("panstart",function(e,i){n[0].classList.add("panning"),t.suspendAutoGrow(!0,"pan"),r={x:i[0].clientX,y:i[0].clientY},l=Date.now(),s={left:n.scrollLeft(),top:n.scrollTop()},o="touch"===e.pointerType,p=null}),e.on("panmove",function(e,t){if(1===t.length){var i=t[0],o=Date.now();if(c&&(p={x:1e3*(i.clientX-c.x)/(o-h),y:1e3*(i.clientY-c.y)/(o-h)}),h=o,c={x:i.clientX,y:i.clientY},o-l>400||a(r.x,r.y,i.clientX,i.clientY)>25){var u=i.clientX-r.x,d=i.clientY-r.y;n.scrollLeft(Math.round(s.left-u)),n.scrollTop(Math.round(s.top-d))}}}),e.on("panend pancancel",function(){n[0].classList.remove("panning"),t.suspendAutoGrow(!1,"pan")});var f=null,g=null,m=null,v=null,y=function(){if(g){var e=Date.now(),t=.001*(e-m);g-=2500*t,g<0&&(g=0),n.scrollLeft(Math.round(v.left-f.x*t*g)),n.scrollTop(Math.round(v.top-f.y*t*g)),m=e,v={left:n.scrollLeft(),top:n.scrollTop()},g>1&&requestAnimationFrame(y)}},b=function(){g=null};e.on("panend",function(e,t){if(p){var i=Date.now(),r=a(0,0,p.x,p.y);i-h<50&&r>1e4&&0===t.length&&o&&(g=Math.sqrt(r),f={x:p.x/g,y:p.y/g},g=Math.min(3e3,g),v={left:n.scrollLeft(),top:n.scrollTop()},m=h,y(i))}}),n[0].addEventListener("pointerdown",b,{capture:!0});var w=null,_=null,x=null,E=null;e.on("pinchstart",function(e,n){var i=u(n);w=Math.max(d(n,i),50),_=t.getScale(),E=t.diagramCoordsFromEvent({pageX:i.x,pageY:i.y}),x=i,t.startScalingAround(E)}),e.on("pinchmove",function(e,n){var i=u(n),o=d(n,i),r=x.x-i.x,s=x.y-i.y;t.updateScaling(_*o/w,{x:r,y:s})}),e.on("pinchend pinchcancel",function(){t.endScaling()})},p=function(e,t){var n=window.Coggle_App_Main,i=null,o=null,s=null,l=null,u=null,d=null,c=null;e.on("dragpossible",function(e,n){if(!t.editingPrevented()){o=null,i=null,s=null,c=Date.now();var l=n[0].target;if(l.classList.contains("ui-resizable-handle"))return void r("ignoring drag on resize handle");if(l.classList.contains("controlpoint"))i=l.getAttribute("data-cpid"),o=t.getNodeForId(l.parentNode.getAttribute("data-nodeid")),r("drag start on controlPoint "+i,o);else{s=l.classList.contains("dragtoadd");var a=l.closest(".node-container");if(!a)return void r("ignoring drag on unknown element");o=t.getNodeForId(a.getAttribute("data-nodeid"))}o&&(u={x:o.model.x(),y:o.model.y()})}});var h=function(e){o&&l&&d&&d()},p=function(e){27==e.keyCode&&g(e)};e.on("dragstart",function(e,r){!t.editingPrevented()&&o&&(n&&t.suspendAutoGrow(!0,"drag"),document.body.classList.add("dragging"),i?(d=o.startCPMove(i,t.diagramCoordsFromEvent(e)),l={x:o.parent().model.x(),y:o.parent().model.y()}):o&&(s&&o.startDragAdd?(d=o.startDragAdd(t.diagramCoordsFromEvent(e)),l={x:0,y:0}):o.startMoveSession&&(d=o.startMoveSession(),l={x:t.diagramCoordsFromEvent(e).x-o.model.x(),y:t.diagramCoordsFromEvent(e).y-o.model.y()})),$(window).on("modifierschanged",h),$(window).on("keydown",p))});e.on("dragmove",function(e,n){if(o&&l&&d){var i=t.diagramCoordsFromEvent(e);(Date.now()-c>400||a(u.x,u.y,i.x,i.y)>16)&&d(i.x-l.x,i.y-l.y)}});var f=function(e,r){if(o){if(i)o.endCPMove&&o.endCPMove(i,t.diagramCoordsFromEvent(e));else if(s){if(o.endDragAdd){var a=o.endDragAdd(t.diagramCoordsFromEvent(e));a&&a.editNode()}}else o.endMoveSession&&o.endMoveSession();o=null,i=null,d=null,l=null,u=null,n&&t.suspendAutoGrow(!1,"drag"),document.body.classList.remove("dragging")}$(window).off("modifierschanged",h),$(window).on("keydown",p)},g=function(e){o&&(i?o.cancelCPMove():s?o.cancelDragAdd():o.cancelMove(),f(e))};e.on("dragend",f),e.on("dragcancel",g)},f=function(e){var t=null;e.on("tap",function(e,n){var i=new CustomEvent("tap",{bubbles:!0,cancelable:!0});if(i.clientX=e.clientX,i.clientY=e.clientY,i.pageX=e.pageX,i.pageY=e.pageY,i.ctrlKey=e.ctrlKey,i.altKey=e.altKey,i.metaKey=e.metaKey,i.shiftKey=e.shiftKey,e.target.dispatchEvent(i),i.defaultPrevented)t=null;else{var o=Date.now();t&&o-t.t<400&&a(e.clientX,e.clientY,t.x,t.y)<144?(t=null,i=new CustomEvent("doubletap",{bubbles:!0,cancelable:!0}),i.clientX=e.clientX,i.clientY=e.clientY,i.pageX=e.pageX,i.pageY=e.pageY,e.target.dispatchEvent(i)):t={t:o,x:e.clientX,y:e.clientY}}})},g=function(e){e.on("press",function(t,n){r("gestures triggered press, canceling other gestures..."),e.cancelGestures();var i=new CustomEvent("press",{bubbles:!0,cancelable:!0});i.clientX=t.clientX,i.clientY=t.clientY,i.pageX=t.pageX,i.pageY=t.pageY,t.target.dispatchEvent(i)})},m=function(e,t){e.on("erasestart erasemove",function(e,n){if(!t.editingPrevented()){var i,o=document.elementFromPoint(e.pageX,e.pageY);if(o)if("PATH"===o.nodeName.toUpperCase()){r("erase path with elementFromPoint",o);var s=o.closest("g");if(s){var a=s.getAttribute("data-nodeid");a&&(i=t.getNodeForId(a))&&i.removeLine()}}else{var u=o.closest(".node-container");u&&(r("erase node with elementFromPoint",o),i=t.getNodeForId(u.getAttribute("data-nodeid")),i&&!i.model.isTitle()?i.squashNode():l.get("title-not-removable").activate().timeout(4e3))}}})};n.exports=function(e){var t=e.$el[0],n=e.scrollContainer()[0]===window,i=new s(t,{candidates:c,touchAction:n?"manipulation":"none"}),o=function(e){0!==e.button&&2!==e.button||e.preventDefault()};t.addEventListener("mousedown",o),n||h(i,e),p(i,e),m(i,e),f(i),g(i),e.once("remove",function(){i.destroy(),t.removeEventListener("mousedown",o)})}}),define("utils/getDroppedFiles",["require","exports","module"],function(e,t,n){var i=function(e,t){var n=new $.Deferred,i=function(t){t&&!t.entry&&(t.entry=e),n.resolve([t])};return t=t||"",e.isFile?e._file?(e._file.relativePath=t,n.resolve(e._file)):e.file(function(e){e.relativePath=t,n.resolve(e)},i):e.isDirectory?n.resolve(e):n.resolve([]),n.promise()},o=function(e,t){return $.when.apply($,$.map(e,function(e){return i(e,t)})).then(function(){return Array.prototype.concat.apply([],arguments)})},r=function(e){e=e||{};var t=e.items;return t&&t.length&&(t[0].webkitGetAsEntry||t[0].getAsEntry)?o($.map(t,function(e){var t;return e.webkitGetAsEntry?(t=e.webkitGetAsEntry(),t&&(t._file=e.getAsFile()),t):e.getAsEntry()})):(new $.Deferred).resolve($.makeArray(e.files)).promise()};t.getDroppedFiles=r,t.handleFileTreeEntries=o,t.handleFileTreeEntry=i}),define("starc/starc.import.attach",["require","exports","module","underscore","views/NodeEditView","models/Attachment","views/PitchView","utils/rateLimit"],function(e,t,n){function i(e,t,n){var i=new FormData;i.append("files[]",t,n);var o=$.ajax({type:"POST",url:e.model.attachmentsURL(),data:i,processData:!1,contentType:!1});return o.done(function(t){t&&t.local_id?e.model.getAttachments().add(new l(t)):console.error("response was not an attachment")}),o}function o(e,t,n,o,s,l){if("awesome"!==e.model.myEditing())return a.attachments(),l();var u=null,d=$(s).parents(".node-container");d.length&&(u=d.attr("data-nodeid")),i(e,t,t.name).done(function(t){try{return r(e,t,o,n,u,l)}catch(e){return console.error(e),l(new Error("Internal error: Failed to add attachment."))}}).fail(function(){l(new Error("Upload failed: are you online?"))})}function r(e,t,n,i,o,r){if(t&&t.error)return r(new Error(t&&t.message||t&&t.msg||"Attachment upload failed."));var l=t.local_id;if(!l)return r(new Error("Invalid upload response."));n||(n="attached file");var a,u;if(o?(a=e.model.getNodes().get(o),u=0):(a=e.model.getNodes().closest(i.x,i.y),o=a.id,u=a.distanceTo(i.x,i.y)),u<120&&0===a.text().replace(/\s/g,"").length||u<60){if(a.addAttachment(l,{title:n}),s.activeEdit()&&s.activeEdit().commit(),!a.get("width")){var d=e.getNodeForId(o);d&&a.set("width",Math.max(40,d.boundingBox().width))}a.deltarize()}else{var c={attachments:{}};if(c.attachments[l]={title:n},u<240){c.pos={x:(i.x-a.x())*a.ltr(),y:i.y-a.y()};var h=e.getNodeForId(a.id);c.width=Math.min(300,e.getSizeOfContent(n,.8*h.model.textSize(),null).w);h.addChild(c)}else c.pos={x:i.x,y:i.y},c.width=Math.min(300,e.getSizeOfContent(n,12,null).w),e.createRoot(c)}return r()}var s=(e("underscore"),e("views/NodeEditView")),l=e("models/Attachment").AttachmentModel,a=e("views/PitchView"),u=e("utils/rateLimit");n.exports.import_type="^.*$",n.exports.import_raw_file=!0,n.exports.import=u(o,{calls:1,every:500,onlimit:function(e,t,n,i,o,r){return r(new Error("Whoa, slow down! Add files one at a time."))}})}),define("utils/resizeImage",["require","exports","module"],function(e,t,n){function i(e){return.75*e.src.length}function o(e,t){var n=e.height,i=e.width,o=1,r=t.maxWidth,s=t.maxHeight;return i>r&&(o=r/i,n=Math.floor(n*o),i=Math.floor(i*o)),n>s&&(o=s/n,n=Math.floor(n*o),i=Math.floor(i*o)),e.height=n,e.width=i,e}function r(e,t,n){var i=document.createElement("canvas"),o=i.getContext("2d"),r=e.orientation,s=e.width,l=e.height,a=!!/^data:image\/png;/.exec(e.src),u=!!/^data:image\/svg[;+]/.exec(e.src);switch(r&&r>4?(i.width=l,i.height=s,e.width=l,e.height=s,e.orientation=1):(i.width=s,i.height=l),r){case 2:o.transform(-1,0,0,1,s,0);break;case 3:o.transform(-1,0,0,-1,s,l);break;case 4:o.transform(1,0,0,-1,0,l);break;case 5:o.transform(0,1,1,0,0,0);break;case 6:o.transform(0,1,-1,0,l,0);break;case 7:o.transform(0,-1,-1,0,l,s);break;case 8:o.transform(0,-1,1,0,0,s)}o.drawImage(e,0,0,s,l),i.toBlob(function(e){i.toBlob(function(i){e.size<i.size||(a||u)&&e.size<t?n(e,".png"):n(i,".jpg")},"image/jpeg",.95)},"image/png")}function s(e,t,n){var s=e.width,l=e.height;e=o(e,t),r(e,t.maxSize,function(o,r){var a=s!==e.width||l!==e.height||i(e)>=t.maxSize;n(o,a,r)})}HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(e,t,n){for(var i=atob(this.toDataURL(t,n).split(",")[1]),o=i.length,r=new Uint8Array(o),s=0;s<o;s++)r[s]=i.charCodeAt(s);e(new Blob([r],{type:t||"image/png"}))}}),n.exports.resizeImage=s,n.exports.applyMaxSize=o}),define("utils/imageFromFile",["require","exports","module"],function(e,t,n){n.exports=function(e,t){var n=new FileReader,i=new FileReader,o=null,r=null,s=null,l=function(){null!==o&&null!==s&&(s.orientation=o,s.detected_mimetype=r,t(null,s))},a=function(e,t){o=e,l()},u=function(e){s=e,l()},d=function(e){return e.byteLength<8?null:65496===e.getUint16(0,!1)?"image/jpeg":2303741511===e.getUint32(0,!1)&&218765834===e.getUint32(4,!1)?"image/png":1195984440!==e.getUint32(0,!1)||14177!==e.getUint16(4,!1)&&14689!==e.getUint16(4,!1)?null:"image/gif"};i.onload=function(e){var t=new DataView(e.target.result);if(r=d(t),65496!=t.getUint16(0,!1))return a(-2);for(var n=t.byteLength,i=2;i<n;){var o=t.getUint16(i,!1);if(i+=2,65505==o){if(1165519206!=t.getUint32(i+=2,!1))return a(-1);var s=18761==t.getUint16(i+=6,!1);i+=t.getUint32(i+4,s);var l=t.getUint16(i,s);i+=2;for(var u=0;u<l;u++)if(274==t.getUint16(i+12*u,s))return a(t.getUint16(i+12*u+8,s))}else{if(65280!=(65280&o))break;i+=t.getUint16(i,!1)}}return a(-1)},n.onload=function(e){var n=new Image;n.src=e.target.result,n.onload=function(){u(n)},n.onerror=function(){return t(new Error("Failed to read image."))}},n.readAsDataURL(e),i.readAsArrayBuffer(e)}}),define("starc/starc.import.image",["require","exports","module","underscore","utils/resizeImage","utils/resizeImage","utils/imageFromFile","views/NodeEditView","models/Message","models/Attachment","models/User","utils/rateLimit"],function(e,t,n){function i(e,t,n){var i=new FormData;i.append("files[]",t,n);var o=$.ajax({type:"POST",url:e.model.attachmentsURL(),dataType:"json",data:i,processData:!1,contentType:!1});return o.done(function(t){t&&t.local_id?e.model.getAttachments().add(new d(t)):console.error("response was not an attachment")}),o}function o(e,t,n,o,d,h){if(!e.warnIfHistoryMode()&&!e.editingPrevented()){var p="awesome"===e.model.myEditing(),f={maxWidth:p?1600:150,maxHeight:p?1600:150,maxSize:p?2e6:2e5};a.activeEdit()&&(d=a.activeEdit().$el);var g=null,m=$(d).parents(".node-container");m.length&&(g=m.attr("data-nodeid")),l(t,function(o,l){if(o)return h(new Error(o));r(l,f,function(o,r,a){if(o.size>f.maxSize)return h(new Error("Sorry, this file exceeded the maximum size of 2MB after applying the maximum resolution, try resizing it first."));var p=t,m=/^(.*)([.][^.]{3,4})$/.exec(t.name),v=m&&m[2]||"",y=m&&m[1]||"unknown";r?("awesome"!==e.model.myEditing()&&(u.get("image-resize-plug").activate().timeout(7e3),c.me().getActions().perform("pitch:bigimages")),p=o,y+="-resized",v=a):["image/jpeg","image/png","image/gif"].indexOf(l.detected_mimetype)<0&&(p=o,v=a);var b=i(e,p,y+v);c.me().getActions().perform("upload-image");var w="";t.name&&(w=t.name.replace(/[[\]\\]/g,"").replace(/\.[^.]{3,20}$/,"")),b.done(function(t){try{t.error?$(d).trigger("import:image:error",[t.message||t.msg||"Image upload failed."]):$(d).trigger("import:image:done",[e,g,n,s(l,{maxWidth:300,maxHeight:300}),w,t.local_id])}catch(e){return console.error(e),h(new Error("Failed to process file please try again."))}h(null)}).fail(function(){$(d).trigger("import:image:error",["Image upload failed."]),h(new Error("Upload failed: are you online?"))})})})}}var r=(e("underscore"),e("utils/resizeImage").resizeImage),s=e("utils/resizeImage").applyMaxSize,l=e("utils/imageFromFile"),a=e("views/NodeEditView"),u=e("models/Message").Messages,d=e("models/Attachment").AttachmentModel,c=e("models/User"),h=e("utils/rateLimit");$(document).on("import:image:error",function(e,t){$(window).trigger("notify-error",t)}),$(document).on("import:image:done",function(e,t,n,i,o,r,s){if(n&&a.activeEdit()&&a.activeEdit().model.id===n)return void a.activeEdit().$el.trigger("import:image:done",[t,n,i,o,r,s]);var l,u;n?(l=t.model.getNodes().get(n),u=0):(l=t.model.getNodes().closest(i.x,i.y),u=l.distanceTo(i.x,i.y));var d="!["+r+"](attached://"+s+" "+o.width+"x"+o.height+")";if(u<120&&0===l.text().replace(/\s/g,"").length||u<60)a.activeEdit()&&a.activeEdit().commit(!0),l.set("text",l.text()+" "+d),l.deltarize({text:l.text()}),a.activeEdit()&&a.activeEdit().close();else{var c={text:d};if(u<240){c.pos={x:(i.x-l.x())*l.ltr(),y:i.y-l.y()};var h=t.getNodeForId(l.id);h.addChild(c)}else c.pos={x:i.x,y:i.y},t.createRoot(c)}}),n.exports.import_type="^image/",n.exports.import_raw_file=!0,n.exports.import=h(o,{calls:2,every:2e3,onlimit:function(e,t,n,i,o,r){return r(new Error("Whoa, slow down! Add files one at a time."))}})}),define("starc/starc.import.links",["require","exports","module"],function(e,t,n){function i(e,t,n,i){for(var o in e)if(e.hasOwnProperty(o)&&new RegExp(o).test(n))return e[o](t,n,i),!0;return!1}var o=function(e,t,n){var i="[link to "+t.replace(/^[^.\/]*?:?\/\//g,"").replace(/\/.*/,"")+"]("+t+")",o=e.closestNode(n.x,n.y);o.addChild({text:i,pos:{x:n.x-o.model.x(),y:n.y-o.model.y()}})},r={},s={};r[".*\\.dropbox\\.com/.*\\.(jpg|gif|png|jpeg|tiff|mng|svg|JPG|GIF|PNG|JPEG|TIFF|MNG|SVG)(\\?.*)?$"]=function(e,t,n){var o=t.replace("www.dropbox.com","dl.dropboxusercontent.com");return i(s,o,n)},s["(jpg|gif|png|jpeg|tiff|mng|svg|JPG|GIF|PNG|JPEG|TIFF|MNG|SVG)(\\?.*)?$"]=function(e,t,n){var i="![dropped image link]("+t+")",o=e.closestNode(n.x,n.y);o.addChild({text:i,pos:{x:n.x-o.model.x(),y:n.y-o.model.y()}})},s["^file:"]=function(e,t,n){console.log("ignoring dropped file URL")};var l=function(e,t,n,l,a,u){console.log("handle uri list:",t),i(r,e,t,n)?u(null):i(s,e,t,n)?u(null):(o(e,t,n),u(null))};n.exports.import_type="text/uri-list",n.exports.import=l}),define("starc/starc.import.mm",["require","exports","module","underscore","../utils/colours","async","../models/Node","utils/textsize"],function(e,t,n){function i(e,t){return e.substring(0,t||4e3)}function o(e){console.log('WARNING: item "'+e.substring(0,80)+'..." is too long and has been truncated at 4000 characters. The text cut off was: "'+e.substring(4e3)+'"'),$(window).trigger("notify-warning",'Item "'+s.escape(e.substring(0,30))+'..." is too long and has been truncated.')}function r(e){if(!f(e))return null;var t,n,i=parseFloat(e.getAttribute("X_COGGLE_POSY")),r=parseFloat(e.getAttribute("X_COGGLE_POSX")),s=e.getAttribute("TEXT"),a=l.mediate(e.getAttribute("COLOR"));return(isNaN(r)||isNaN(i))&&(r=400*(Math.random()-.5),i=400*(Math.random()-.5)),e.getAttribute("starc-wrapped")&&(t=parseFloat(e.getAttribute("starc-width"))),e.getAttribute("starc-textsize")&&(n=parseFloat(e.getAttribute("starc-textsize"))),s.length>u.MAX_TEXT_LENGTH&&(o(s),s=s.substring(0,u.MAX_TEXT_LENGTH)),{text:s,pos:{x:r,y:i},colour:a,width:t,text_size:n}}var s=e("underscore"),l=e("../utils/colours"),a=e("async"),u=e("../models/Node").NodeModel,d=e("utils/textsize"),c="---newline"+function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;i<e;i++)t+=n.charAt(Math.floor(Math.random()*n.length));return t}(8)+"---",h=function(e){return e=e.replace(/((?:width)|(?:height))=(\d+)/g,'$1="$2"')},p=function(e,t){for(var n="",i=!1,o=!1,r=0,s=0;s<e.length;s++){if(!o&&/^<richcontent/i.exec(e.substr(s,s+50))){var l=/[^\\]<[\/]richcontent\s*>/i.exec(e.substr(s));if(l){var a=e.substr(s,l.index+l[0].length);n+=e.substr(r,s-r),s+=l.index+l[0].length,n+=h(a),r=s+1;continue}}"\\"==e[s]?o=!o:("'"!==e[s]&&'"'!==e[s]||o||i?e[s]!==i||o?i&&"\n"==e[s]&&(n+=e.substr(r,s-r),n+=t,r=s+1):i=!1:i=e[s],o=!1)}return n+=e.substr(r)},f=function(e){return"NODE"===e.tagName.toUpperCase()||"X-COGGLE-ROOTNODE"===e.tagName.toUpperCase()},g=function(e){for(var t,n=[],i=0;i<e.children.length;i++)t=e.children[i],f(t)&&n.push(t);return n},m=function(e){for(var t=0;t<e.length;t++){var n=$(e[t]),i=n.attr("POSITION");void 0!==i&&!1!==i||n.attr("POSITION",["left","right"][t%2])}},v=function(e,t){function n(e){function t(){var e=$(this),t=e.attr("src"),n=e.text();e.replaceWith("!["+n+"]("+t+")")}for(var o,r,s,l,a=0;a<e.length;a++){o=e[a],r="",l=[];for(var d=0;d<o.children.length;d++)"RICHCONTENT"===o.children[d].tagName.toUpperCase()?r+=o.children[d].innerHTML:f(o.children[d])&&l.push(o.children[d]);r.length&&(s=$(r),s.find("img").each(t),o.setAttribute("TEXT",i($.trim(s.text()),u.MAX_TEXT_LENGTH+1e3))),n(l)}}n(e)},y=function(e,t){function n(e,t){for(var i,s,l,a,u,c=0;c<e.length;c++)i=e[c],s=d.clamp(i.getAttribute("SIZE")||d.textSizeForLevel(t)),u=i.getAttribute("TEXT"),l=r.getSizeOfContent(u,s,null),a=!1,l.w>o&&(l=r.getSizeOfContent(u,s,o),a=!0),i.setAttribute("starc-width",l.w),i.setAttribute("starc-height",l.h),i.setAttribute("starc-textsize",s),i.setAttribute("starc-wrapped",a),n(g(i),t+1)}var i=t&&t.initial_level||0,o=t&&t.wrap||300,r=t.diagram;n(e,i)},b=function(e,t,n,i,o,r){var s,l,a,u=0,d=0,c=[];if(null!==e)for(l=0;l<i.length;l++)((s=i[l].getAttribute("POSITION"))==e||""===e&&!s)&&c.push(i[l]);else c=i;for(l=0;l<c.length;l++)a=c[l],d=Math.max(d,parseFloat(a.getAttribute("starc-treewidth"))),u+=parseFloat(a.getAttribute("starc-treeheight"));return u+=c.length?(c.length-1)*r:0,{w:o+d+t,h:Math.max(n,u)}},w=function(e,t){function n(e,t){for(var r=g(e),l=0;l<r.length;l++)n(r[l],!1);var a=t?["left","right",""]:[""];s.each(a,function(n){var s=b(t?n:null,parseFloat(e.getAttribute("starc-width")),parseFloat(e.getAttribute("starc-height")),r,i,o);e.setAttribute("starc-"+n+"treewidth",s.w),e.setAttribute("starc-"+n+"treeheight",s.h)})}for(var i=t&&t.x_space||40,o=t&&t.y_space||14,r=0;r<e.length;r++)n(e[r],!0)},_=function(e){function t(){for(var e,o,r=[],s=0;s<this.children.length;s++)if(e=this.children[s],f(e))r.push(e);else if("EDGE"===e.tagName.toUpperCase())for(var l=0;l<n.length;l++){var a=n[l];o=e.getAttribute(a),void 0!==o&&!1!==o&&null!==o&&this.setAttribute(a,o)}var d=this.getAttribute("TEXT");d?(d=d.replace(new RegExp(c,"g"),"\n"),this.setAttribute("TEXT",i(d,u.MAX_TEXT_LENGTH+1e3))):this.setAttribute("TEXT",""),r.map(Function.prototype.call,t)}var n=["COLOR","SIZE"];e.each(t)},x=function(){return this.id_map={},this.added_nodes=[],this},E=0;x.prototype.addRecursive=function(e,t,n,i,r){if(!e.length)return r(null);i||(i="");var d=$(e[0]).parent(),c=1;("left"==i||""===i&&n.model.ltr()<1)&&(c=-1);var h=t.x+c*(40+s.reduce(e.map(function(){var e=$(this);return e.children("node").length?parseFloat(e.attr("starc-width")):40}).get(),function(e,t){return Math.max(e,t)},0)),p=t.y,m="starc-"+i+"treeheight";void 0!==d.attr(m)&&(p-=parseFloat(d.attr(m))/2),a.eachSeries(e,function(e,t){if(!f(e))return t(null);var i,r,s=parseFloat(e.getAttribute("starc-treeheight")),a=e.getAttribute("TEXT"),d=e.getAttribute("LINK"),c=l.mediate(e.getAttribute("COLOR")),m=e.getAttribute("X_COGGLE_JOINEDTO");if(p+=s/2,e.getAttribute("starc-wrapped")&&(i=parseFloat(e.getAttribute("starc-width"))),e.getAttribute("starc-textsize")&&(r=parseFloat(e.getAttribute("starc-textsize"))),d){var v=/^[^\[\n]*(?=(?: |\n|$))/i.exec(a);a=v?"["+v[0]+"]("+d+")"+a.substring(v[0].length):d+" "+a}a.length>u.MAX_TEXT_LENGTH&&(o(a),a=a.substring(0,u.MAX_TEXT_LENGTH));var y=n.addChild({text:a,pos:{x:h,y:p},colour:c,width:i,text_size:r,join:m});this.added_nodes.push(y),e.getAttribute("ID")&&(this.id_map[e.getAttribute("ID")]=y.model.id),p+=s/2+14,E+=1,E%20==0?setTimeout(function(){this.addRecursive($(g(e)),{x:0,y:0},y,void 0,t)}.bind(this)):this.addRecursive($(g(e)),{x:0,y:0},y,void 0,t)}.bind(this),r)},x.prototype.lookupId=function(e){for(var t in this.id_map)if(this.id_map.hasOwnProperty(t)&&t.startsWith(e))return this.id_map[t].slice(0,e.length)},x.prototype.fixupIds=function(){this.added_nodes.forEach(function(e){var t=e.model.text(),n=/(#)([a-f0-9]{6,32})(\)|\s|>)/g,i=!1,o=t.replace(n,function(e,t,n,o,r,s){var l=this.lookupId(n);return l?(i=!0,t+l+o):e}.bind(this)),r={};i&&(e.model.set("text",o),r.text=o);var s=e.model.get("join");this.id_map[s]&&(s=this.id_map[s],e.model.set("join",s),r.join=s),"undefined"===r.text&&"undefined"===r.join||e.model.deltarize(r)}.bind(this))};var A=function(e,t,n,i,o,s){console.log("parse document...");var u;try{u=$($.parseXML(p(t,c))).find("map")}catch(e){return window._debug_import&&console.log(e),s(new Error("Could not parse file. Is this a valid .mm file?"))}var d=e.closestNode(n.x,n.y),h=d.model.isRoot(),g=u.children("node, x-coggle-rootnode"),b=new x;if(console.log("run fixups..."),_(g),console.log("tag positions..."),h&&m(1==g.length?g.children("node, x-coggle-rootnode"):g),console.log("parse rich content..."),v(g),console.log("tag sizes..."),y(g,{diagram:e}),console.log("tag subtrees..."),w(g),console.log("build..."),h){var E=!0;a.eachSeries(g,function(t,n){var i=$(t);if(!f(t))return n();i.attr("starc-treeheight",0),E?(E=!1,d.model.set("text",i.attr("TEXT")),d.model.setColour(l.mediate(i.attr("COLOR"))),d.model.deltarize()):(d=e.createRoot(r(t)),b.added_nodes.push(d)),i.attr("ID")&&(b.id_map[i.attr("ID")]=d.model.id);var o=(d.model.x(),{x:-Math.abs(i.attr("starc-width")/2+40),y:0}),s={x:Math.abs(i.attr("starc-width")/2+40),y:0};a.series([function(e){b.addRecursive(i.children("node[POSITION=left]"),o,d,"left",e)},function(e){b.addRecursive(i.children("node[POSITION=right]"),s,d,"right",e)},function(e){b.addRecursive(i.children("node:not([POSITION])"),s,d,"",e)}],n)},function(){b.fixupIds(),s()})}else b.addRecursive(g,{x:n.x,y:n.y},d,void 0,function(){b.fixupIds(),s()})};n.exports.import_type="^[.]mm$",n.exports.import=A}),define("starc/starc.import.text",["require","exports","module","underscore"],function(e,t,n){var i=e("underscore"),o=function(e){for(var t=0,n=0;n<e.length;n++)if(" "==e[n])t++;else{if("\t"!=e[n])break;t+=8}return t},r=350,s=150,l=function(e,t,n,l,a,u){function d(t,n){var o=null,l=n.model.textSizeForChild();(t.text.length>s||e.getSizeOfContent(t.text,l,null)>r)&&(o=r);var a=n.addChild({text:t.text,width:o,text_size:l},void 0,!0);i.each(t.children,function(e){d(e,a)})}if(e.editingPrevented())return u();for(var c=t.split(/[\r\n]+/),h={children:[]},p=h,f=[],g=[],m=0;m<c.length;m++){var v=o(c[m]);if(!/^\s*$/.exec(c[m])){var y=i.sortedIndex(g,v);f.length&&(y<=f.length||m==c.length-1)&&(p=y?f[y-1]:h,f=f.slice(0,y),g=g.slice(0,y));var b={text:$.trim(c[m]),children:[]};p.children.push(b),f.push(b),g.push(v)}}var w=e.closestNode(n.x,n.y);if(1===h.children.length&&w.model.isRoot()&&0===w.model.children().length){var _=h.children[0];w.model.set("text",_.text),w.model.deltarize({text:w.model.text()}),h.children=_.children}i.each(h.children,function(e){d(e,w)}),w.arrange(),u()};n.exports.import_type="text/plain",n.exports.import=l}),define("utils/loaddeferred",["require","exports","module","env"],function(e,t,n){n.exports=function(t){var n=e("env").cdn.url+"/assets/deferred-abc473fb5e.js";e([n],function(){e(["deferred"],function(e){t(null,e)},function(e){console.error(e),$(window).trigger("notify-error","Sorry, something went wrong, please try again or reload the page.")})},function(e){console.log(e),$(window).trigger("notify-error","Failed to load necessary resource, are you online?")})}}),define("starc/starc.import.mmap",["require","exports","module","utils/loaddeferred"],function(e,t,n){var i=e("utils/loaddeferred"),o=null,r=function(e){for(var t=e.childNodes,n=0;n<t.length;n++)if("ap:text"===t[n].nodeName.toLowerCase())return t[n].getAttribute("PlainText");return null},s=function(e,t){t=t.toLowerCase();for(var n=e.childNodes,i=[],o=0;o<n.length;o++)n[o].nodeName.toLowerCase()===t&&i.push(n[o]);return i},l=function(e){var t=[];return s(e,"ap:SubTopics").forEach(function(e){t=t.concat(s(e,"ap:Topic"))}),t},a=function(e,t,n,i,o){if(e.editingPrevented())return o();var a=function(t,i){if(t&&t.length>0){var o=!1;if(!i&&(o=!0,i=e.closestNode(n.x,n.y),i.model.isRoot()&&0===i.model.children().length&&1===t.length))return i.model.set("text",r(t[0])),i.model.deltarize({text:i.model.text()}),a(l(t[0]),i),void i.arrange();t.forEach(function(t){var n=r(t),o=i.model.textSizeForChild(),s=null;(n.length>150||e.getSizeOfContent(n,o,null)>350)&&(s=350);var u=i.addChild({text:n,width:s,text_size:o},void 0,!0);a(l(t),u)}),o&&i.arrange()}},u=t.getElementsByTagName("ap:OneTopic");return u&&u.length?(a(s(u[0],"ap:Topic")),o()):o(new Error("OneTopic missing from mmap file"))},u=function(e,t,n,r,s,l){$(window).trigger("notify-info",".mmap import is experimental, we appreciate any issue reports to hello@coggle.it!"),i(function(i,r){if(i)return l(i);o=r.jszip,o.loadAsync(t).then(function(t){t.file("Document.xml").async("string").then(function(t){if(!t)return l(new Error("Document.xml missing from file"));var i;try{i=$.parseXML(t)}catch(e){return console.error("parseXML error:",e),l(new Error("Could not parse file. Is this a valid .mmap file?"))}return a(e,i,n,0,l)},function(e){return console.error(e),l(new Error("Failed to read .mmap file"))})},function(e){l(new Error("Failed to decompress file."))})})};n.exports.import_type="^[.]mmap$",n.exports.import_raw_file=!0,n.exports.import=u}),define("starc/starc.import",["require","exports","module","views/working","utils/mousePosition","utils/getDroppedFiles","underscore","starc/starc.copypaste","utils/rateLimit","starc/starc.import.attach","starc/starc.import.image","starc/starc.import.links","starc/starc.import.mm","starc/starc.import.text","starc/starc.import.mmap"],function(e,t,n){function i(e,t){var n=t.diagramCoordsFromEvent(e);if(n.failed){var i=a;n=t.diagramCoordsFromEvent({pageX:i.x,pageY:i.y})}return n}function o(e){if(e)for(var t in g){var n=g[t],i=n.import_type;if(new RegExp(i,"i").test(e))return n}}function r(e){var t=/\.[^.]*$/i.exec(e.name);return o(e.type)||o(t&&t[0])}function s(e,t,n,i,o){var r=!1,s=function(e){e&&m(e.message),r=!0,$(window).trigger("done-working","import")};if(function(){setTimeout(function(){r||$(window).trigger("start-working","import")},200)}(),e.import_raw_file)e.import(t,n,i,n.name,o,s);else{var l=new FileReader;l.onloadend=function(r){e.import(t,l.result,i,n.name,o,s)},l.readAsText(n)}}function l(e,t,n,o){if(!t.editingPrevented()){var l;if("attach"===o)l=p;else if("image"===o){if((l=r(n))!==f)return!1}else l=r(n);return!!l&&(s(l,t,n,i(e,t),e.currentTarget||e.target),!0)}}e("views/working");var a=e("utils/mousePosition"),u=e("utils/getDroppedFiles").getDroppedFiles,d=e("underscore"),c=e("starc/starc.copypaste").paste,h=e("utils/rateLimit"),p=e("starc/starc.import.attach"),f=e("starc/starc.import.image"),g=[f,e("starc/starc.import.links"),e("starc/starc.import.mm"),e("starc/starc.import.text"),e("starc/starc.import.mmap")];getCoggleUser().attachmentsSupported()&&g.push(p);var m=h(function(e){$(window).trigger("notify-warning",[e])},{calls:1,every:2e3});n.exports=function(e){function t(t){if(!(t.target.classList&&t.target.classList.contains&&t.target.classList.contains("emails"))){var n=!1,o=t.clipboardData||t.originalEvent.clipboardData;if(o&&o.getData&&o.getData("text/rtf"))return void console.log("detected MS word paste, ignoring rich paste types: "+o.types);if(o&&o.getData&&o.getData("application/x-coggle-tree")&&(n=!0,c({coggle_tree:o.getData("application/x-coggle-tree"),diagram:e,at:i(t,e)})),o&&o.files&&o.files.length)for(var r=o.files,s=0;s<r.length;s++)l(t,e,r[s])&&(n=!0);n?t.preventDefault():console.log("no supported rich paste types in: "+o.types)}}var n=function(t,n){var r=n.getData("URL"),s=!1;if(r){s=!0;var l=i(t,e);o("text/uri-list").import(e,r,l,null,t.currentTarget||t.target,function(e){e&&($(window).trigger("notify-info",["Error processing dropped link."]),console.error(e))})}s||$(window).trigger("notify-info",["Sorry! That sort of file isn't supported. You can add .png, .jpg or .gif images, and import .mm or .txt files."])},r=function(t){t.preventDefault();var i=t.dataTransfer=t.originalEvent.dataTransfer;if(!(i&&i.files&&i.files.length))return n(t,i);u(i).always(function(o){if(!d.find(o,function(n){return console.log("drop file:",n.type,n.name),l(t,e,n)}))return n(t,i)})};e.$el.bind("drop",r),$(document).on("paste",t),e.$el.bind("dragenter dragover",function(t){if(!e.editingPrevented()){return(t.dataTransfer=t.originalEvent.dataTransfer).dropEffect="copy",!1}});var s=function(t){var n,i=t.currentTarget.files[0];if(-1!==t.currentTarget.className.indexOf("force-attach")?n="attach":-1!==t.currentTarget.className.indexOf("force-image")&&(n="image"),!l(t,e,i,n)){var o;"image"===n?(o="That file didn't look like a supported image type.",getCoggleUser().attachmentsSupported()&&(o+=" Maybe try adding it as an attachment instead?")):o="Sorry we couldn't process that file, please check that it is a supported type.",$(window).trigger("notify-warning",[o])}};$("body").on("change.coggleImport",".node-editor input[type=file]",s),$("body").on("change.coggleImport",".notification-panel input[type=file]",s),e.once("remove",function(){$("body").off(".coggleImport"),$(document).off("paste",t)})}}),define("utils/glass",["require","exports","module"],function(e,t,n){var i="http://www.w3.org/2000/svg",o="http://www.w3.org/1999/xlink",r=0,s=function(){return""+(r+=1)},l=!1,a=!1,u=function(e){e&&(a=!0),l||(l=!0,document.getElementsByTagName("body")[0].classList.add("glass-disabled"))},d=function(){a||(l=!1,document.getElementsByTagName("body")[0].classList.remove("glass-disabled"))},c=function(){if("function"!=typeof window.requestAnimationFrame)return void u(!0);var e=(new Date).getTime(),t=[],n=function(i,o){window.requestAnimationFrame(function(){t.push((new Date).getTime()-e),0===i?o(t):n(i-1,o)})};n(5,function(e){var t=0;e.forEach(function(e){e>200&&(t+=1)}),t>1&&u(!0)})},h=function(){
window.visualViewport&&window.visualViewport.width&&(window.visualViewport.width!==window.outerWidth?u(!1):d())},p=function(e,t,n){return'<svg width="'+t+'" height="'+n+'" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="'+e(100,100)+'" fill="#000"/></svg>'},f=function(e,t){var n=document.createElementNS(i,"svg");n.setAttribute("xmlns",i),n.setAttribute("version","1.1"),n.setAttribute("class","glassclip-svg");var o=document.createElementNS(i,"clipPath");o.id="glassmenu-clip-"+t,o.setAttribute("clipPathUnits","objectBoundingBox");var r=document.createElementNS(i,"path");return r.setAttribute("d",e(1,1)),o.appendChild(r),n.appendChild(o),n},g=function(e,t,n,r,s,l,a,u){var d=document.createElementNS(i,"svg");d.setAttribute("xmlns",i),d.setAttributeNS(i,"xlink",o),d.setAttribute("version","1.1"),d.setAttribute("class","glassbgfilter-svg");var c=document.createElementNS(i,"defs"),h=document.createElementNS(i,"filter");h.id="glassmenu-backdrop-filter-"+u,h.setAttribute("x","0%"),h.setAttribute("y","0%"),h.setAttribute("width","100%"),h.setAttribute("height","100%");var f=document.createElementNS(i,"feGaussianBlur");f.setAttribute("class","glassbgfilter-blur"),f.setAttribute("stdDeviation","5"),f.setAttribute("result","glassbg-blurred");var g=document.createElementNS(i,"feImage");g.setAttributeNS(o,"href","data:image/svg+xml;charset=utf-8;base64,"+btoa(p(e,l,a))),g.setAttribute("class","glassbgfilter-mask-image"),g.setAttribute("x",t+"px"),g.setAttribute("y",n+"px"),g.setAttribute("width",r+"px"),g.setAttribute("height",s+"px"),g.setAttribute("result","glassbg-filter-mask"),g.setAttribute("preserveAspectRatio","none");var m=document.createElementNS(i,"feComposite");m.setAttribute("class","glassbgfilter-composite"),m.setAttribute("in2","glassbg-filter-mask"),m.setAttribute("in","glassbg-blurred"),m.setAttribute("operator","in"),m.setAttribute("result","glassbg-masked");var v=document.createElementNS(i,"feMerge");v.setAttribute("class","glassbgfilter-merge");var y=document.createElementNS(i,"feMergeNode");y.setAttribute("in","SourceGraphic");var b=document.createElementNS(i,"feMergeNode");return b.setAttribute("in","glassbg-masked"),v.appendChild(y),v.appendChild(b),h.appendChild(f),h.appendChild(g),h.appendChild(m),h.appendChild(v),c.appendChild(h),d.appendChild(c),d},m=function(e,t,n){var i=t.getBoundingClientRect(),o=e.getBoundingClientRect(),r=o.left-i.left,s=o.top-i.top,l=o.width,a=o.height,u=n.querySelectorAll(".glassbgfilter-mask-image")[0];u.setAttribute("x",r+"px"),u.setAttribute("y",s+"px"),u.setAttribute("width",l+"px"),u.setAttribute("height",a+"px");var d=function(e){e.setAttribute("width",l+20+"px"),e.setAttribute("height",a+20+"px"),e.setAttribute("x",r-10+"px"),e.setAttribute("y",s-10+"px")};d(n.querySelectorAll(".glassbgfilter-blur")[0]),d(n.querySelectorAll(".glassbgfilter-composite")[0])},v=function(e){var t=document.createElement("style");t.id="glass-style-"+e,t.appendChild(document.createTextNode("@supports (((-webkit-clip-path: url(#glassmenu-clip-"+e+")) or (clip-path: url(#glassmenu-clip-"+e+"))) and ((-webkit-backdrop-filter: blur(5px)) or (backdrop-filter: blur(5px)))) { .glassmenu-"+e+" { -webkit-backdrop-filter: blur(5px); backdrop-filter: blur(5px); -webkit-clip-path: url(#glassmenu-clip-"+e+"); clip-path: url(#glassmenu-clip-"+e+"); } } @supports not (((-webkit-clip-path: url(#glassmenu-clip-"+e+")) or (clip-path: url(#glassmenu-clip-"+e+"))) and ((-webkit-backdrop-filter: blur(5px)) or (backdrop-filter: blur(5px)))) { body:not(.glass-disabled) .glassmenu-background-"+e+" { -webkit-filter: url(#glassmenu-backdrop-filter-"+e+"); filter: url(#glassmenu-backdrop-filter-"+e+"); } }")),document.head.appendChild(t)},y=function(e){var t=document.getElementById("glass-style-"+e);t&&t.remove()},b={remove:function(){},updatePosition:function(){}},w=function(e,t,n,i,o){var r=s();if(!(t&&e&&t.classList&&e.classList))return console.error("Could not set up glass: invalid elements"),b;e.classList.add("glassmenu"),e.classList.add("glassmenu-"+r),t.classList.add("glassmenu-background"),t.classList.add("glassmenu-background-"+r),v(r);var a=f(n,r);document.body.appendChild(a),h();var u=null;return l||(u=g(n,0,0,10,10,i||200,o||200,r),m(e,t,u),document.body.appendChild(u)),c(),{remove:function(){e.classList.remove("glassmenu-"+r),/glassmenu-/.exec(e.className)||e.classList.remove("glassmenu"),t.classList.remove("glassmenu-background-"+r),/glassmenu-background-/.exec(t.className)||t.classList.remove("glassmenu-background"),y(r),u&&(u.remove(),u=null),a&&(a.remove(),a=null)},updatePosition:function(){u&&m(e,t,u)}}};n.exports.glass=w}),define("views/sage",["require","exports","module","utils/colours","utils/glass","jquery"],function(e,t,n){var i=e("utils/colours"),o=e("utils/glass"),r=e("jquery"),s="http://www.w3.org/2000/svg",l="http://www.w3.org/1999/xlink",a=function(e){return"function"==typeof e?e():e},u=function(e){return e.toPrecision(5).replace(/\.0+$/,"").replace(/\.(.+?)0+$/,".$1")},d=function(e,t,n,i,o){void 0===o&&(o=.05);var r=o,s=r*i/n,l=e+s/2,a=t-s/2,d=e+r/2,c=t-r/2,h={x:Math.cos(l)*n,y:Math.sin(l)*n},p={x:Math.cos(a)*n,y:Math.sin(a)*n},f={x:Math.cos(d)*i,y:Math.sin(d)*i},g={x:Math.cos(c)*i,y:Math.sin(c)*i};return"M"+u(f.x)+","+u(f.y)+" A"+i+","+i+",0,0,1,"+u(g.x)+","+u(g.y)+" L"+u(p.x)+","+u(p.y)+" A"+n+","+n+",0,0,0,"+u(h.x)+","+u(h.y)+" Z"},c=0,h=function(){return""+(c+=1)},p=function(e){return{x:e.pageX||e.changedTouches&&e.changedTouches[0]&&e.changedTouches[0].pageX,y:e.pageY||e.changedTouches&&e.changedTouches[0]&&e.changedTouches[0].pageY}},f=function(e){var t=null,n=!1,i={x:null,y:null},o=function(t){var o=p(t);(n||Math.abs(o.x-i.x)>6||Math.abs(o.y-i.y)>6)&&(n=!0,r(e).trigger(new r.Event("buttondrag",{pageX:o.x,pageY:o.y,target:t.target,originalEvent:t}))),t.preventDefault()},s=function(n){if(r(window).off("touchmove pointermove mousemove",o),r(window).off("touchend pointerup pointercancel mouseup",s),r(e).off("touchmove pointermove mousemove",o),r(e).off("touchend pointerup pointercancel mouseup",s),null!==t){t=null;var i=p(n);/.*cancel$/.exec(n.type)?r(e).trigger(new r.Event("buttoncancel",{pageX:i.x,pageY:i.y,target:n.target,originalEvent:n})):r(e).trigger(new r.Event("buttonrelease",{pageX:i.x,pageY:i.y,target:n.target,originalEvent:n}))}n.preventDefault()},l=function(n){if(null===t){r(n.target).closest(".sage2-segment").length&&(t=n.type,i=p(n),"touchstart"===t?(r(window).on("touchmove",o),r(window).on("touchend",s),r(e).on("touchmove",o),r(e).on("touchend",s)):"pointerdown"===t?(r(window).on("pointermove",o),r(window).on("pointerup pointercancel",s),r(e).on("pointermove",o),r(e).on("pointerup pointercancel",s)):"mousedown"===t&&(r(window).on("mousemove",o),r(window).on("mouseup",s),r(e).on("mousemove",o),r(e).on("mouseup",s)),r(e).trigger(new r.Event("buttonpress",{pageX:n.pageX,pageY:n.pageY,target:n.target,originalEvent:n})),n.preventDefault())}};r(e).on("touchstart mousedown",l)},g=function(e,t){void 0===t&&(t=3);var n=e.clientX||e.changedTouches&&e.changedTouches[0]&&e.changedTouches[0].clientX,i=e.clientY||e.changedTouches&&e.changedTouches[0]&&e.changedTouches[0].clientY;return"number"!=typeof n?e.originalEvent&&t>0?g(e.originalEvent,t-1):null:{x:n,y:i}},m=function(e){this.options=e,this.render(),f(this.el),this.setupEvents()};m.prototype.setupEl=function(){this.el=document.createElement("div"),this.el.setAttribute("role","region"),this.el.setAttribute("aria-label","context menu"),this.el.className="sage2",this.el.style.width=this.options.size+"px",this.el.style.height=this.options.size+"px",this.options.appendTo.appendChild(this.el),this.menu_el=document.createElement("div"),this.menu_el.className="sage2-glass",this.el.appendChild(this.menu_el);var e=document.createElementNS(s,"svg");this.actions=e,e.setAttribute("xmlns",s),e.setAttributeNS(s,"xlink",l),e.setAttribute("version","1.1"),e.setAttribute("viewBox","-50 -50 100 100"),e.setAttribute("class","sage2-actions");var t=document.createElementNS(s,"defs");this.action_defs=t,e.appendChild(t);var n=document.createElementNS(s,"g"),o=document.createElementNS(s,"path"),r=document.createElementNS(s,"path");n.setAttribute("class","sage2-bg"),o.setAttribute("d",d(0,Math.PI,30,50,0)),r.setAttribute("d",d(Math.PI,0,30,50,0)),o.setAttribute("fill",i.glass(this.options.colour,.3)),r.setAttribute("fill",i.glass(this.options.colour,.3)),n.appendChild(o),n.appendChild(r),e.appendChild(n);for(var c in this.options.actions)if(this.options.actions.hasOwnProperty(c)){var p=this.options.actions[c],f=p.slot,g=f*(Math.PI/4),m=g+Math.PI/4,v=d(g,m,30,50,.05),y=document.createElementNS(s,"g");y.setAttribute("class","sage2-segment"+(p.update?" draggable":"")+(p.disabled?" disabled":"")),y.setAttribute("id","sage2-segment-"+c);var b="sage2-clip-"+h(),w=document.createElementNS(s,"clipPath");w.id=b,t.appendChild(w);var _=document.createElementNS(s,"path");_.setAttribute("d",v),w.appendChild(_);var x=document.createElementNS(s,"g");y.appendChild(x);var E=document.createElementNS(s,"path");E.setAttribute("class","sage2-segment-bg"),E.setAttribute("d",v),E.setAttribute("fill",i.glass(this.options.colour,.5)),x.appendChild(E);var A=document.createElementNS(s,"image"),S=20,C=20;p.bigIcon&&(S=40,C=40),A.setAttribute("width",S),A.setAttribute("height",C),A.setAttribute("x",u(40*Math.cos((g+m)/2)-S/2)),A.setAttribute("y",u(40*Math.sin((g+m)/2)-C/2)),A.setAttribute("y",u(40*Math.sin((g+m)/2)-C/2)),A.setAttribute("aria-label",a(p.tip)),A.setAttribute("clip-path","url(#"+b+")"),x.appendChild(A),p._icon=A,p._button=y,p._clip=w,p._name=c,e.appendChild(y)}this.menu_el.appendChild(e);var F=document.createElement("div");if(F.className="sage2-tip",F.style.color=i.glass(this.options.colour,.8),this.tip=F,this.el.appendChild(F),this.options.title){var k=document.createElement("div");k.className="sage2-title",k.style.color=i.glass(this.options.colour,.8),this.title=k,this.el.appendChild(k),this.title=k,this.title_content=document.createElement("span"),this.title_content.className="sage2-tip-content",this.title_content.textContent=a(this.options.title)||"",this.title.appendChild(this.title_content)}},m.prototype.setupGlass=function(){this.glass=o.glass(this.menu_el,this.options.background,function(e,t){var n=e/2*.6,i=e/2,o=e/2,r=t/2;return"M"+o+","+(r+i)+" A"+i+","+i+",0,0,0,"+o+","+(r-i)+" A"+i+","+i+",0,0,0,"+o+","+(r+i)+" M"+o+","+(r+n)+" A"+n+","+n+",0,0,1,"+o+","+(r-n)+" A"+n+","+n+",0,0,1,"+o+","+(r+n)+" Z"},150,150)},m.prototype.render=function(){this.el||this.setupEl(),this.el.style.top=this.options.y-this.options.size/2+"px",this.el.style.left=this.options.x-this.options.size/2+"px",this.hidden||this.glass||this.setupGlass(),this.updateTip();for(var e in this.options.actions)if(this.options.actions.hasOwnProperty(e)){var t=this.options.actions[e],n=a(t.iconUrl);n!==t._icon.getAttributeNS(l,"href")&&(t._icon.setAttributeNS(l,"href",n),t._icon.setAttribute("aria-label",a(t.tip)))}},m.prototype.updateTip=function(){this.tip_action?(this.tip_content||(this.tip_content=document.createElement("span"),this.tip_content.className="sage2-tip-content",this.tip.appendChild(this.tip_content)),this.tip_content.textContent=a(this.tip_action.tip)||""):this.tip_content&&(this.tip_content.remove(),this.tip_content=null)},m.prototype.setTip=function(e){this.tip_action=e,this.updateTip()},m.prototype.hideRing=function(){this.hidden=!0,document.getElementsByClassName("sage2-bg")[0].remove(),this.setTip(null),this.glass&&(this.glass.remove(),this.glass=null)},m.prototype.hideOthers=function(e){for(var t in this.options.actions)this.options.actions.hasOwnProperty(t)&&(this.options.actions[t]===e||this.options.actions[t].hidden||(this.options.actions[t].hidden=!0,r(this.options.actions[t]._button).addClass("hidden")))},m.prototype.call=function(e,t,n){if("function"==typeof e[t])try{e[t](n,this)}catch(n){console.error((e&&e._name)+":"+t+" call failed: "+(n&&n.message)+" stack: "+(n&&n.stack))}},m.prototype.actionFor=function(e){if(this.finished)return null;var t;if(/^touch.*/.exec(e.type)||e.originalEvent&&/^touch.*/.exec(e.originalEvent.type)){var n=g(e);t=n?r(document.elementFromPoint(n.x,n.y)):r()}else t=r(e.target);var i=t.closest(".sage2-segment");return i.length?this.options.actions[i[0].id.replace(/^sage2-segment-/,"")]:null},m.prototype.buttonPress=function(e){var t=this.actionFor(e);if(t&&!t.disabled){this.pressed=t,this.setTip(t);var n=!1;a(t.hideOthers)&&this.hideOthers(t),r(t._button).addClass("pressed");var i=document.createElementNS(s,"svg");i.setAttribute("xmlns",s),i.setAttributeNS(s,"xlink",l),i.setAttribute("version","1.1"),i.setAttribute("viewBox","-50 -50 100 100"),i.setAttribute("class","sage2-actions");var o=document.createElementNS(s,"defs");i.appendChild(o),t._button.remove(),t._clip.remove(),this.menu_el.appendChild(i),o.appendChild(t._clip),i.appendChild(t._button),t.button=r(i),this.call(t,"commit",e);var u=function(e){if(!a(t.draggable)){var i=this.actionFor(e);r(t._button).toggleClass("pressed",i===t)}a(t.hideRing)&&!n&&(this.hideRing(),n=!0),this.call(t,"update",e)}.bind(this),d=function(e){r(this.el).off("buttondrag",u),r(this.el).off("buttonrelease",d),r(this.el).off("buttoncancel",d);var n=this.actionFor(e);this.finished=!0,this.setTip(null),!a(t.draggable)&&n!==t||"buttoncancel"===e.type?this.call(t,"cancel",e):this.call(t,"finish",e),t.stayOpen?(this.finished=!1,this.pressed=null,r(t._button).removeClass("pressed"),t._button.remove(),t._clip.remove(),i.remove(),this.actions.appendChild(t._button),this.action_defs.appendChild(t._clip),o.remove()):this.close()}.bind(this);r(this.el).on("buttondrag",u),r(this.el).on("buttonrelease",d),r(this.el).on("buttoncancel",d)}},m.prototype.closeOnOutsideEvent=function(e){this.el.contains(e.target)||this.close()},m.prototype.setupEvents=function(){this.closeHandler||(this.closeHandler=this.closeOnOutsideEvent.bind(this),window.addEventListener("mousedown",this.closeHandler,!0),window.addEventListener("touchstart",this.closeHandler,!0),window.addEventListener("pointerdown",this.closeHandler,!0)),this.modsChangedHandler||(this.modsChangedHandler=this.render.bind(this),r(window).on("modifierschanged",this.modsChangedHandler)),r(this.el).on("buttonpress",this.buttonPress.bind(this)),r(this.el).on("mouseenter",".sage2-segment",function(e){if(!(this.pressed||this.finished||this.hidden)){var t=this.actionFor(e);t&&this.setTip(t)}}.bind(this)),r(this.el).on("mouseleave",".sage2-segment",function(e){this.pressed||this.finished||this.hidden||this.setTip(null)}.bind(this)),r(this.el).on("contextmenu",function(e){return e.preventDefault(),!1})},m.prototype.close=function(){this.options&&this.options.onclose&&this.options.onclose(),this.remove()},m.prototype.remove=function(){this.glass&&(this.glass.remove(),this.glass=null),this.el&&(this.el.remove(),this.el=null),this.closeHandler&&(window.removeEventListener("mousedown",this.closeHandler,!0),window.removeEventListener("touchstart",this.closeHandler,!0),window.removeEventListener("pointerdown",this.closeHandler,!0),this.closeHandler=null),this.modsChangedHandler&&(r(window).off("modifierschanged",this.modsChangedHandler),this.modsChangedHandler=null),this.options=null},t.generateSegment=d,t.Sage=m}),define("starc/starc.new-menu.background",["require","exports","module","views/sage","l10n","utils/queryString","starc/starc.copypaste","BrowserDetect","env"],function(e,t,n){function i(e){ga&&ga("send","event",e[0],e[1],e[2],e[3])}function o(e){return e&&!f&&-1===navigator.userAgent.indexOf("Googlebot")&&setTimeout(function(){(new Image).src=e},3500),e}function r(t){return e("env").cdn.url+"/img/sage/"+t}function s(e,t,n,i,o,r){var s=90*(t-2)/-1.875,l=90-s,d=s,c=-l,h=i.diagramCoordsFromEvent({pageX:o,pageY:r});return{slot:7,iconUrl:v,tip:u.getSync("drag-zoom-page","drag to zoom page"),commitOnClickhold:!0,hideOthers:!0,draggable:!0,commit:function(e){var t=-d/180*Math.PI-Math.PI/4,n=-c/180*Math.PI,o=document.createElementNS(p,"path");o.setAttribute("d",a.generateSegment(t,n,30,50)),o.setAttribute("fill","rgba(255,255,255,0.3)"),this.button[0].insertBefore(o,this.button.find(".sage2-segment")[0]),i.startScalingAround(h)},update:function(e,t){var n=e.pageX-o,s=e.pageY-r,l=Math.atan2(n,s),a=180*l/Math.PI-112.5;a>180&&(a-=360),a<-180&&(a+=360);var u=Math.max(Math.min(d,a),c),h=.125+1.875*(u-c)/90;this.button.find(".sage2-segment")[0].setAttribute("transform","rotate("+-u+")"),i.updateScaling(h),this.tip=Math.round(100*i.getScale())+"%",t.updateTip()},finish:function(){i.endScaling()},cancel:function(){i.updateScaling(t),i.endScaling()}}}function l(e,t){var n=t.initial_zoom,o=t.size,r=(t.colour,t.diagram),l=!!t.hasOwnProperty("readonly")&&t.readonly,d={};return window.Coggle_App_Main||(d.zoom=s(o,n,e,r,t.x,t.y)),l||(d.add={slot:3,iconUrl:b,tip:u.getSync("add-label","add label"),finish:function(){var e=r.diagramCoordsFromEvent({pageX:t.x,pageY:t.y});r.createRoot({pos:e}).editNode()}},d.undo={slot:2,active:r.hasUndoStep.bind(r),iconUrl:g,tip:u.getSync("undo","undo"),finish:r.undoStep.bind(r),stayOpen:!0},d.redo={slot:1,active:r.hasRedoStep.bind(r),iconUrl:m,tip:u.getSync("redo","redo"),finish:r.redoStep.bind(r),stayOpen:!0},d.paste={slot:6,iconUrl:y,tip:u.getSync("paste-branch","paste branch"),finish:function(){var e=r.diagramCoordsFromEvent({pageX:t.x,pageY:t.y}),n=r.closestNode(e.x,e.y);c({diagram:r,at:e,node:n})}}),i(["Sage","Open","Background"]),t.onclose=function(){getCoggleUser().getActions().unique("background-contextmenu-opened"),r.trigger("menu:close",{type:"bg"})},r.trigger("menu:open",{type:"bg",x:t.x,y:t.y}),t.appendTo=e[0],new a.Sage($.extend(t,{actions:d}))}var a=e("views/sage"),u=e("l10n"),d=e("utils/queryString"),c=e("starc/starc.copypaste").paste,h=e("BrowserDetect"),p="http://www.w3.org/2000/svg",f=d().print,g=(o(r("zoomscale-w.png")),o(r("undo-w.png"))),m=o(r("redo-w.png")),v=o(r("zoom-w.png")),y=o(r("paste-w.png")),b=o(r("plus-w.png"));n.exports=function(e){e.$el.on("contextmenu press",function(t){if(!f&&($(t.target).is(".diagram-editor>svg")||$(t.target).is(".diagram-editor"))){if(t.preventDefault(),t.stopPropagation(),!t.originalEvent)return!1;var n=$("body").hasClass("touch")?200:150;if("Android"!==h.OS){n*=window.innerHeight/$(window).height()}var i=e.documentCoordsFromEvent(t);l($("body"),{size:n,x:i.x,y:i.y,initial_zoom:e.getScale(),colour:"#ffffff",readonly:e.editingPrevented(),diagram:e,background:$(".coggle-workspace").length?$(".coggle-workspace")[0]:$(".diagram-editor")[0]});return!1}})}}),define("views/ColourMenu",["require","exports","module","underscore","backbone","utils/glass","views/PitchView","jquery.outsideEvents","env","env","env"],function(e,t,n){function i(e,t){var n=2*Math.PI/16,i=e/250,o=70*i,r=180*i,s=244*i,l=3*i,a=o,u=r,d=s,c=u/2+l,h=a/2-l,p=d/2-1*i,f={x:Math.cos(-.12)*c,y:Math.sin(-.12)*c},g={x:Math.cos(-.12)*p,y:Math.sin(-.12)*p},m=6*n-.12+.06,v={x:Math.cos(m)*c,y:Math.sin(m)*c},y={x:Math.cos(m)*p,y:Math.sin(m)*p},b={x:Math.cos(2.47)*c,y:Math.sin(2.47)*c},w={x:Math.cos(2.47)*p,y:Math.sin(2.47)*p},_={x:Math.cos(3.29)*c,y:Math.sin(3.29)*c},x={x:Math.cos(3.29)*p,y:Math.sin(3.29)*p},E={x:Math.cos(3.47)*c,y:Math.sin(3.47)*c},A={x:Math.cos(3.47)*p,y:Math.sin(3.47)*p},S={x:Math.cos(4.29)*c,y:Math.sin(4.29)*c},C={x:Math.cos(4.29)*p,y:Math.sin(4.29)*p},F=e/2,k=t/2;return"M"+F+","+(k-c)+" A"+c+","+c+",0,0,1,"+(f.x+F)+","+(f.y+k)+" L"+(g.x+F)+","+(g.y+k)+" A"+p+","+p+",0,0,1,"+(y.x+F)+","+(y.y+k)+" L"+(v.x+F)+","+(v.y+k)+" A"+c+","+c+",0,0,1,"+(b.x+F)+","+(b.y+k)+" L"+(w.x+F)+","+(w.y+k)+" A"+p+","+p+",0,0,1,"+(x.x+F)+","+(x.y+k)+" L"+(_.x+F)+","+(_.y+k)+" A"+c+","+c+",0,0,1,"+(E.x+F)+","+(E.y+k)+" L"+(A.x+F)+","+(A.y+k)+" A"+p+","+p+",0,0,1,"+(C.x+F)+","+(C.y+k)+" L"+(S.x+F)+","+(S.y+k)+" A"+c+","+c+",0,0,1,"+F+","+(k-c)+" M"+(h+F)+","+k+" A"+h+","+h+",0,0,0,"+(F-h)+","+k+" A"+h+","+h+",0,0,0,"+(h+F)+","+k}var o=e("underscore"),r=e("backbone"),s=e("utils/glass"),l=e("views/PitchView");e("jquery.outsideEvents");var a=function(){o.bindAll(this,"show","hide","_selected"),this.$el=$('<div class="colourmenu" role="region" aria-label="contextmenu"><svg viewBox="-125 -125 250 250" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M0,-93 A93,93,0,0,1,92.33120313440956,-11.1332352778695 L120.12984493831782,-14.485177081959243 A121,121,0,0,1,-80.2754432347867,90.53647449209925 L-61.69930761020797,69.58588535343165 A93,93,0,0,1,-72.80334406734008,57.867720644695325 L-94.72263045320591,75.29026019363586 A121,121,0,0,1,-119.66994706487438,-17.89144403032254 L-91.97772790936625,-13.751275163801623 A93,93,0,0,1,-88.02982255397542,-29.995838729990545 L-114.53342504334437,-39.026843939019955 A121,121,0,0,1,-49.60281731443898,-110.36557667348272 L-38.12447942349442,-84.82643496391647 A93,93,0,0,1,0-93 M32,0 A32,32,0,0,0,-32,0 A32,32,0,0,0,32,0" fill="rgba(215,215,215,0.6)"/><g id="line_weight"><g id="10"><path d="M115.79,-6.9558 A116,116,0,0,1,111.71,31.242 L92.453,25.856 A96,96,0,0,0,95.827,-5.7565 Z" fill="rgba(0,0,0,0)"/><path d="M110.8,-6.656 A111,111,0,0,1,106.9,29.896 L97.268,27.203 A101,101,0,0,0,100.82,-6.0564 Z" fill="#979797"/></g><g id="8"><path d="M109.64,37.885 A116,116,0,0,1,91.254,71.615 L75.52,59.268 A96,96,0,0,0,90.736,31.353 Z" fill="rgba(0,0,0,0)"/><path d="M103.97,35.925 A110,110,0,0,1,86.534,67.911 L80.24,62.972 A102,102,0,0,0,96.407,33.313 Z" fill="#979797"/></g><g id="6"><path d="M86.795,76.958 A116,116,0,0,1,56.902,101.09 L47.091,83.657 A96,96,0,0,0,71.831,63.69 Z" fill="rgba(0,0,0,0)"/><path d="M81.558,72.314 A109,109,0,0,1,53.468,94.985 L50.525,89.757 A103,103,0,0,0,77.068,68.334 Z" fill="#979797"/></g><g id="4"><path d="M50.738,104.32 A116,116,0,0,1,13.887,115.17 L11.492,95.31 A96,96,0,0,0,41.99,86.33 Z" fill="rgba(0,0,0,0)"/><path d="M47.239,97.121 A108,108,0,0,1,12.929,107.22 L12.45,103.25 A104,104,0,0,0,45.489,93.524 Z" fill="#979797"/></g><g id="2"><path d="M6.9558,115.79 A116,116,0,0,1,-31.242,111.71 L-25.856,92.453 A96,96,0,0,0,5.7565,95.827 Z" fill="rgba(0,0,0,0)"/><path d="M6.4161,106.81 A107,107,0,0,1,-28.818,103.05 L-28.28,101.12 A105,105,0,0,0,6.2962,104.81 Z" fill="#979797"/></g><g id="auto"><path d="M-37.885,109.64 A116,116,0,0,1,-71.615,91.254 L-59.268,75.52 A96,96,0,0,0,-31.353,90.736 Z" fill="rgba(0,0,0,0)"/><path d="M-36.252,104.91 A107,107,0,0,1,-66.059,84.174 L-64.824,82.6 A105,105,0,0,0,-32.986,95.462 Z" fill="#979797"/></g></g><g id="line_style"><g id="dashed"><path d="M-94.973,66.604 A116,116,0,0,1,-111.43,32.235 L-92.219,26.677 A96,96,0,0,0,-78.599,55.121 Z" fill="rgba(0,0,0,0)"/><path d="M-84.32966372557033,59.13973128052095,-88.25954159700157,53.09664129761081,-93.40087411721525,56.18964952853959,-89.24207132123462,62.584764170648384 ZM-90.31224271061099,49.52472934383077,-93.55496863501513,43.08674788959287,-99.00477263317134,45.596655533646825,-95.57315005297667,52.40966503376266 ZM-95.20314499914375,39.31108218139016,-97.71952154084002,32.55603031435654,-103.41192085389866,34.45249809965887,-100.74895927093853,41.601048133704154 Z" fill="#979797"/></g><g id="solid"><path d="M-113.16,25.495 A116,116,0,0,1,-115.64,-9.0859 L-95.705,-7.5194 A96,96,0,0,0,-93.653,21.099 Z" fill="rgba(0,0,0,0)"/><path d="M-100.48151070085152,22.637712059187045 A109,109,0,0,1,-102.68355500105935,-8.06768444749908 L-108.66512131180068,-8.53764664832427 A103,103,0,0,0,-106.334802586338,23.956413732537747 Z" fill="#979797"/></g></g><g id="line_shape"><g id="straight"><path d="M-106.46,-46.069 A116,116,0,0,1,-86.563,-77.219 L-71.639,-63.905 A96,96,0,0,0,-88.104,-38.126 Z" fill="rgba(0,0,0,0)"/><polyline transform="translate(-107 -54) scale(1.9) rotate(300.000000)" points="-2.31217783 7.53108891 4.75 9.29903811 6.25 6.70096189 13.3121778 8.46891109" stroke="#979797" stroke-width="3" fill="none"></polyline></g><g id="smooth"><path d="M-85.787,-78.081 A116,116,0,0,1,-56.87,-101.1 L-47.065,-83.671 A96,96,0,0,0,-70.996,-64.619 Z" fill="rgba(0,0,0,0)"/><path transform="scale(1.9) translate(-24 -42) rotate(125.000000)" d="M-2.8434354,6.51657658 C-1.77770015,9.27894918 0.503379707,10.1076905 3.99980417,9.00280057 C7.49622862,7.89791062 9.77743904,8.72478491 10.8434354,11.4834234" stroke="#979797" stroke-width="3" fill="none"></path></g></g><g id="colours"><g id="colour-pastel"><path d="M57.515,23.152 A62,62,0,0,1,23.726,57.281 L13.394,32.336 A35,35,0,0,0,32.468,13.07 Z" data-fill="#67d7c4" fill="#67d7c4"/><path d="M24.298,57.04 A62,62,0,0,1,-23.726,57.281 L-13.394,32.336 A35,35,0,0,0,13.717,32.2 Z" data-fill="#9ed56b" fill="#9ed56b"/><path d="M-23.152,57.515 A62,62,0,0,1,-57.281,23.726 L-32.336,13.394 A35,35,0,0,0,-13.07,32.468 Z" data-fill="#ebd95f" fill="#ebd95f"/><path d="M-57.04,24.298 A62,62,0,0,1,-57.281,-23.726 L-32.336,-13.394 A35,35,0,0,0,-32.2,13.717 Z" data-fill="#efa670" fill="#efa670"/><path d="M-57.515,-23.152 A62,62,0,0,1,-23.726,-57.281 L-13.394,-32.336 A35,35,0,0,0,-32.468,-13.07 Z" data-fill="#e68782" fill="#e68782"/><path d="M-24.298,-57.04 A62,62,0,0,1,23.726,-57.281 L13.394,-32.336 A35,35,0,0,0,-13.717,-32.2 Z" data-fill="#e096e9" fill="#e096e9"/><path d="M23.152,-57.515 A62,62,0,0,1,57.281,-23.726 L32.336,-13.394 A35,35,0,0,0,13.07,-32.468 Z" data-fill="#988ee3" fill="#988ee3"/><path d="M57.04,-24.298 A62,62,0,0,1,57.281,23.726 L32.336,13.394 A35,35,0,0,0,32.2,-13.717 Z" data-fill="#7aa3e5" fill="#7aa3e5"/></g><g id="colour-vivid"><path d="M89.996,-0.89999 A90,90,0,0,1,77.942,45 L56.292,32.5 A65,65,0,0,0,64.997,-0.64999 Z" data-fill="#e8e525" fill="#e8e525"/><path d="M78.388,44.218 A90,90,0,0,1,45,77.942 L32.5,56.292 A65,65,0,0,0,56.614,31.935 Z" data-fill="#69b500" fill="#69b500"/><path d="M45.777,77.488 A90,90,0,0,1,5.5109e-15,90 L3.9801e-15,65 A65,65,0,0,0,33.061,55.964 Z" data-fill="#0a660d" fill="#0a660d"/><path d="M0.89999,89.996 A90,90,0,0,1,-45,77.942 L-32.5,56.292 A65,65,0,0,0,0.64999,64.997 Z" data-fill="#3e8975" fill="#3e8975"/><path d="M-44.218,78.388 A90,90,0,0,1,-77.942,45 L-56.292,32.5 A65,65,0,0,0,-31.935,56.614 Z" data-fill="#0da7d3" fill="#0da7d3"/><path d="M-77.488,45.777 A90,90,0,0,1,-90,5.0990e-14 L-65,3.6826e-14 A65,65,0,0,0,-55.964,33.061 Z" data-fill="#075978" fill="#075978"/><path d="M-89.996,0.89999 A90,90,0,0,1,-77.942,-45 L-56.292,-32.5 A65,65,0,0,0,-64.997,0.64999 Z" data-fill="#272727" fill="#272727"/><path d="M-78.388,-44.218 A90,90,0,0,1,-45,-77.942 L-32.5,-56.292 A65,65,0,0,0,-56.614,-31.935 Z" data-fill="#5f5f5f" fill="#5f5f5f"/><path class="enabled" d="M-45.777,-77.488 A90,90,0,0,1,-1.6533e-14,-90 L-1.1940e-14,-65 A65,65,0,0,0,-33.061,-55.964 Z" data-fill="#b4b4b4" fill="#b4b4b4"/><path d="M-0.89999,-89.996 A90,90,0,0,1,45,-77.942 L32.5,-56.292 A65,65,0,0,0,-0.64999,-64.997 Z" data-fill="#e23e2b" fill="#e23e2b"/><path d="M44.218,-78.388 A90,90,0,0,1,77.942,-45 L56.292,-32.5 A65,65,0,0,0,31.935,-56.614 Z" data-fill="#a65427" fill="#a65427"/><path d="M77.488,-45.777 A90,90,0,0,1,90,0 L65,0 A65,65,0,0,0,55.964,-33.061 Z" data-fill="#ffaa38" fill="#ffaa38"/></g></g></svg></div>'),this.$el.find("#colour-pastel path").addClass("enabled"),getCoggleUser().paysForColours()||this.$el.find("#colour-vivid path").addClass("enabled"),$.addOutsideEvent("pointerdown")};o.extend(a.prototype,r.Events),a.instance=function(){return a._instance||(a._instance=new a),a._instance},a.prototype._selected=function(t){if(!(Date.now()-this.shown_at<200)){if(!this.callback)return this.hide();var n=$(t.target);if(!(n.is("#background")||n.is("#colour-vivid")||n.is("#colour-pastel"))){if(!n.hasClass("enabled"))return n.closest("#colours").length?l.show({id:"pitch:extendedcolours",title:"More Colours!",teaser:e("env").cdn.url+"/img/features/change-colours.gif",message:"The outer ring of colours is included in our Awesome plan along with loads of other great features. Upgrade now to use all the colours."}):n.closest("#line_weight").length||n.closest("#line_style").length?l.show({id:"pitch:linestyles",title:"Line Styling",teaser:e("env").cdn.url+"/img/features/adjust-thickness.gif",message:"The Awesome plan comes with loads of great features, including control of line thickness and pattern! Upgrade now to customise your diagram."}):n.closest("#line_shape").length&&l.show({id:"pitch:straightlines",title:"Straight Connections",teaser:e("env").cdn.url+"/img/features/straight-connections.gif",message:"The Awesome plan includes advanced control over connections. Upgrade now to use straight lines for more formal diagrams."}),t.preventDefault(),t.stopPropagation(),this.callback(!0);n.closest("#colours").length?(this.callback(!1,{colour:n.attr("data-fill")||n.attr("fill")}),this.hide()):n.closest("#line_weight").length?(this.callback(!1,{weight:parseFloat(n.closest("g").attr("id"))||null}),this.hide()):n.closest("#line_style").length?(this.callback(!1,{style:n.closest("g").attr("id")||null}),this.hide()):n.closest("#line_shape").length&&(this.callback(!1,{shape:n.closest("g").attr("id")||null}),this.hide()),t.preventDefault()}}},a.prototype.show=function(e,t,n,i){return $(e).append(this.$el),this.$el.find("svg g").on("click",this._selected),this.$el.on("pointerdownoutside",this.hide),this.$el.css({left:t,top:n}),this.$el.addClass("active"),setTimeout(function(){this.glass&&this.glass.updatePosition()}.bind(this),10),this.setupGlass(),this.callback=i,this.shown_at=Date.now(),this},a.prototype.extended=function(e){e&&(this.$el.find("#colour-vivid g, #colour-vivid path").addClass("enabled"),this.$el.find("#colour-pastel g, #colour-pastel path").addClass("enabled"),this.$el.find("#line_weight g, #line_weight path").addClass("enabled"),this.$el.find("#line_style g, #line_style path").addClass("enabled"),this.$el.find("#line_shape g, #line_shape polyline, #line_shape path").addClass("enabled"))},a.prototype.setupGlass=function(){this.glass||(this.glass=s.glass(this.$el[0],$(".coggle-workspace").length?$(".coggle-workspace")[0]:$(".diagram-editor")[0],i,240,240))},a.prototype.removeGlass=function(){this.glass&&(this.glass.remove(),this.glass=null)},a.prototype.hide=function(e){this.removeGlass(),this.$el.removeClass("active"),this.$el.find("svg g").off("click"),this.$el.remove(),this.trigger("hidden")},n.exports=a}),function(e){"function"==typeof define&&define.amd?define("plugins/jquery.callout",["jquery","jquery.outsideEvents","underscore","jquery-ui/position"],e):e(jQuery)}(function(e,t,n,i){var o=["left","center","right","top","middle","bottom"];e.fn.callout=function(t,i){var r=e(this),s="closed",l=e('<div class="callout"><div class="arrow"></div><div class="contents"></div><div class="arrow mask"></div></div>'),a={appendTo:r,at:"center bottom",my:"center top",of:void 0,callout:void 0,filter:function(){return!0},closeOn:"mousedownoutside focusoutside",openOn:void 0,closeDelay:0,openDelay:0};i=e.extend({},a,i);var u=n.once(function(){l.find(".contents").html(t),e(i.appendTo).append(l),l.reposition(),l.bind("mousedown touchdown click tap touchstart",function(e){e.stopPropagation()})}),d=function(){"closed"==s&&(i.onClose&&i.onClose(l),l.removeClass("is-open"),l.hide())},c=function(){"open"==s&&i.filter()&&(u(),l.show(),l.addClass("is-open"),i.closeOn&&l.bind(i.closeOn,l.close),i.openOn&&l.bind(i.openOn,l.open),i.onOpen&&i.onOpen(l))};return i.openDelay&&i.openDelay>0&&(c=n.debounce(c,i.openDelay||0)),i.closeDelay&&i.closeDelay>0&&(d=n.debounce(d,i.closeDelay||0)),l.reposition=function(e){return void 0===e&&(e={}),l.position({of:e.of||i.of||r,at:e.at||i.at,my:e.my||i.my,collision:"none",using:function(e,t){if(i.callout)for(var n=i.callout.split(" "),r=0;r<2;r++)n.length>r&&-1!=o.indexOf(n[r])&&l.addClass(n[r]);else l.removeClass("top bottom left right").addClass(t.vertical).addClass(t.horizontal);l.css(e)}}),l},l.close=function(){return s="closed",d(),l},l.open=function(){return s="open",c(),l},l.isOpen=function(){return"open"==s},i.closeOn&&r.bind(i.closeOn,l.close),i.openOn&&r.bind(i.openOn,l.open),l}}),
define("views/ShapeMenu",["require","exports","module","underscore","plugins/jquery.callout","utils/glass","views/shapes","utils/colours","views/PitchView","backbone","env"],function(e,t,n){var i=e("underscore");e("plugins/jquery.callout");var o=e("utils/glass"),r=e("views/shapes"),s=e("utils/colours"),l=e("views/PitchView"),a=e("backbone"),u=function(e){return"M 0 "+-e/2+" "+.75811*e+" 0 0 "+e/2+" z"},d=function(e){var t=4.54688*e/6,n=0-t,i=-e/2,o=e/2;return"M "+n+" "+i+" 0 0 "+n+" "+o+" 0 "+o+" 0 "+i+" z"},c=function(e,t,n,i){var o=22,r=14,s=(n-8)/o;s<1&&(o*=s,r*=s);var l=o*(e/n),a=r*(t/i),u=e/n*4,d=t/i*4;return"M "+u+","+a+","+(e/2-l/2)+","+a+","+e/2+",0,"+(e/2+l/2)+","+a+","+(e-u)+","+a+" A "+u+","+d+",0,0,1,"+e+","+(a+d)+" L "+e+","+(t-d)+" A "+u+","+d+",0,0,1,"+(e-u)+","+t+" L "+u+","+t+" A "+u+","+d+",0,0,1,0,"+(t-d)+" L 0,"+(a+d)+" A "+u+","+d+",0,0,1,"+u+","+a+" Z"},h="<div class='shapemenu'><svg class='shapemenu-bg' viewBox='0 0 220 149' preserveAspectRatio='xMidYMid meet' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><path class='bgpath' d='"+c(220,149,220,149)+"'></path></svg><div class='col-xs-4 shapebutton' data-shapeid='root'><div class='shapemenu-svg-scaling-container' style='padding-bottom:60%;'><svg class='shapemenu-shape' viewBox='-40 -25 80 50' preserveAspectRatio='xMidYMid meet' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><path class='shapepath' d='"+r.rootPath(0)(80,46)+"'></path></svg></div></div><div class='col-xs-4 shapebutton' data-shapeid='rounded'><div class='shapemenu-svg-scaling-container' style='padding-bottom:60%;'><svg class='shapemenu-shape' viewBox='-40 -25 80 50' preserveAspectRatio='xMidYMid meet' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><path class='shapepath' d='"+r.roundedPath()(70,40)+"'></path></svg></div></div><div class='col-xs-4 shapebutton' data-shapeid='rect'><div class='shapemenu-svg-scaling-container' style='padding-bottom:60%;'><svg class='shapemenu-shape' viewBox='-40 -25 80 50' preserveAspectRatio='xMidYMid meet' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><path class='shapepath' d='"+r.trapPath(0,0,0,0)(70,40)+"'></path></svg></div></div><div class='col-xs-4 shapebutton disabled' data-shapeid='rpara'><div class='shapemenu-svg-scaling-container' style='padding-bottom:60%;'><svg class='shapemenu-shape' viewBox='-40 -25 80 50' preserveAspectRatio='xMidYMid meet' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><path class='shapepath' d='"+r.trapPath(.1,.1,-.1,-.1)(70,40)+"'></path></svg></div></div><div class='col-xs-4 shapebutton disabled' data-shapeid='diamond'><div class='shapemenu-svg-scaling-container' style='padding-bottom:60%;'><svg class='shapemenu-shape' viewBox='-40 -25 80 50' preserveAspectRatio='xMidYMid meet' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><path class='shapepath' d='"+r.diamondPath()(80,40)+"'></path></svg></div></div><div class='col-xs-4 shapebutton disabled' data-shapeid='ttrap'><div class='shapemenu-svg-scaling-container' style='padding-bottom:60%;'><svg class='shapemenu-shape' viewBox='-40 -25 80 50' preserveAspectRatio='xMidYMid meet' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><path class='shapepath' d='"+r.trapPath(-.1,.1,.1,-.1)(70,40)+"'></path></svg></div></div><div class='col-xs-6 shapebutton inbranch' data-shapeid='label'><div class='shapemenu-svg-scaling-container' style='padding-bottom:42%;'><svg class='shapemenu-shape' viewBox='-60 -25 120 50' preserveAspectRatio='xMidYMid meet' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><path class='arc' d='M -65 10 C -55 10 -55 0 -35 0 ' stroke-width='9'> </path><path class='arcend' d='"+u(9)+"' transform='translate(-35, 0)'> </path><path class='arcend' d='"+d(9)+"' transform='translate(30, 0)' > </path><path class='arc' d='M 30 0 C 45 0 45 -6 65 -10 ' stroke-width='9'> </path><rect x='-22' y='-5' width='3' height='9'></rect><rect x='-17' y='-5' width='8' height='9'></rect><rect x='-7'  y='-7' width='2' height='11'></rect><rect x='-3'  y='-7' width='2' height='11'></rect><rect x='1'   y='-5' width='6' height='9'></rect><rect x='9'   y='-5' width='3' height='9'></rect><rect x='14'  y='-5' width='2' height='11'></rect></svg></div></div><div class='col-xs-6 shapebutton onbranch' data-shapeid='branch'><div class='shapemenu-svg-scaling-container' style='padding-bottom:42%;'><svg class='shapemenu-shape' viewBox='-60 -25 120 50' preserveAspectRatio='xMidYMid meet' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><path class='arc' d='M -65 20 C -55 20 -45 0 0 0 ' stroke-width='9'> </path><path class='arcend' d='"+u(9)+"' transform='translate(0, 0)'> </path><path class='arcend' d='"+d(9)+"' transform='translate(10, 0)' > </path><path class='arc' d='M 10 0 C 30 0 45 -6 65 -10 ' stroke-width='9'> </path><rect x='-50' y='-17' width='8' height='9'></rect><rect x='-40' y='-17' width='3' height='9'></rect><rect x='-35' y='-19' width='2' height='11'></rect><rect x='-31' y='-19' width='2' height='11'></rect><rect x='-27' y='-17' width='6' height='9'></rect><rect x='-19' y='-17' width='2' height='11'></rect><rect x='-14' y='-17' width='3' height='9'></rect><rect x='-9'  y='-17' width='7' height='9'></rect></svg></div></div><div style='clear:both'/></div>",p=function(){i.bindAll(this,"_selected"),this.$el=$(h),this.callback=null,this.callout=$("body").callout(this.$el,{my:"center top+20",at:"center bottom",callout:"center top",onClose:function(){this.removeGlass(),this.trigger("hidden")}.bind(this)}),this.callout.addClass("shapemenu-callout")};i.extend(p.prototype,a.Events),p.prototype._selected=function(t){if(!this.callback)return this.hide();var n=$(t.target);if(!n.is(".shapemenu")){var i=n.closest(".shapebutton");if(i.hasClass("disabled"))return void l.show({id:"pitch:shapes",title:"Use Advanced Shapes",teaser:e("env").cdn.url+"/img/features/choose-shape.gif",message:"The Awesome plan includes advanced flow-chart shapes. Upgrade now to use all the shapes!"});var o=i.data("shapeid");"branch"===o&&(o=null),this.callback(!1,{shape:o})}},p.prototype.show=function(e,t,n,i,r,l){return this.callout.open(),this.callout.reposition({of:{pageX:e,pageY:t,preventDefault:function(){}}}),this.$el.find(".shapebutton").off("click"),this.$el.find(".shapebutton").on("click",this._selected),this.$el.toggleClass("root",n),r&&this.$el.find(".shapebutton").removeClass("disabled"),$(this.callout).find(".bgpath")[0].setAttribute("fill",s.glass(i,.5)),this.glass||(this.glass=o.glass($(this.callout)[0],$(".coggle-workspace").length?$(".coggle-workspace")[0]:$(".diagram-editor")[0],function(e,t){var n=$(this.callout).outerWidth(),i=$(this.callout).outerHeight();return c(e,t,n,i)}.bind(this))),this.callback=l,this},p.prototype.removeGlass=function(){this.glass&&(this.glass.remove(),this.glass=null)},p.prototype.hide=function(){this.removeGlass()},p.instance=function(){return p._instance||(p._instance=new p),p._instance},n.exports=p}),define("starc/starc.new-menu.node",["require","exports","module","underscore","l10n","utils/queryString","BrowserDetect","starc/starc.copypaste","models/NotificationSearch","views/ColourMenu","views/ShapeMenu","views/PitchView","utils/trackModifiers","views/sage","env"],function(e,t,n){function i(e){ga&&ga("send","event",e[0],e[1],e[2],e[3])}function o(e){return e&&!x&&-1===navigator.userAgent.indexOf("Googlebot")&&setTimeout(function(){(new Image).src=e},3500),e}function r(t){return e("env").cdn.url+"/img/sage/"+t}function s(e,t){var n=e.diagram,i=e.node;e.actions.paint={slot:7,iconUrl:S,bigIcon:!0,tip:p.getSync("choose-style","choose style"),finish:function(){var o=n.documentCoordsFromEvent({pageX:e.x,pageY:e.y}),r=y.instance();r.show($("body"),o.x,o.y,function(e,o){if(!e&&o){var r=n.getNodeForId(i.id),s=!t&&!(i.isRoot()||i.get("shape")&&"branch"!==i.get("shape")),l=!t;w&&w.shift_key_pressed&&(s=!s,l=!l);i.isRoot()||(!i.get("shape")||i.get("shape"));void 0!==o.colour&&r.setColour(o.colour,s),void 0!==o.weight&&r.setLineWeight(o.weight,l),void 0!==o.style&&r.setLineStyle(o.style,l),void 0!==o.shape&&r.setLineShape(o.shape,l)}}).extended("free"!==n.model.myEditing());n.trigger("menu:open",{x:e.x,y:e.y,type:"colour"}),r.once("hidden",function(){n.trigger("menu:close",{type:"colour"})})}}}function l(e){function t(e){return e.get("shape")&&"branch"!==e.get("shape")?!(w&&(w.control_key_pressed||w.alt_key_pressed||w.shift_key_pressed)):w&&(w.control_key_pressed||w.alt_key_pressed)&&!w.shift_key_pressed}var n=e.node,i=e.diagram,o=e.size,r={};if(e.actions=r,n.joinedNode()||(r.add=G(3,"left",e),e.actions["copy-or-cogglify"]={slot:1,iconUrl:function(){return w.shift_key_pressed?k:w.alt_key_pressed||w.control_key_pressed?k:L},tip:function(){return w.shift_key_pressed?p.getSync("copy-branch-to-diagram","copy branch to new diagram"):w.alt_key_pressed||w.control_key_pressed?p.getSync("move-branch-to-diagram","move branch to new diagram"):p.getSync("copy-branch","copy branch")},finish:function(){w.shift_key_pressed?i.cogglify(i.getNodeForId(n.id),!1):(w.alt_key_pressed||w.control_key_pressed)&&i.cogglify(i.getNodeForId(n.id),!0),m({node:n,diagram:i})}},r.comment={disabled:i.model.accessViaToken(),slot:4,iconUrl:function(){return w.shift_key_pressed?I:N},tip:function(){return i.model.accessViaToken()?"comments unavailable":w.shift_key_pressed?p.getSync("add-to-discussion","add to discussion"):p.getSync("comment-on-this","comment on this")},finish:function(){$(".notification-creation").trigger("expand");var e=v&&v.instance();w.shift_key_pressed?e.pushNode(n):e.setNodes([n]),setTimeout(function(){$(".notification-panel .editor textarea").focus()},200)}},r.rearrange={slot:6,iconUrl:R,tip:p.getSync("auto-arrange","auto-arrange"),finish:function(){i.getNodeForId(n.id).arrange()}},s(e)),n.isTitle()?(e.title="Diagram Title",r["add-right"]=G(0,"right",e)):r.remove={slot:0,iconUrl:function(){return t(n)?F:C},tip:function(){return t(n)?p.getSync("remove-item","remove item"):p.getSync("delete-branch","delete branch")},finish:function(){var e=i.getNodeForId(n.id);e&&(t(n)?e.squashNode():e.deleteNode())}},!n.joinedNode()){var l,a=!1,u=null,d=null;r.shapes_or_crosslink={slot:5,tip:function(){return a||w.shift_key_pressed?p.getSync("drag-to-create-link","drag to create link"):p.getSync("choose-shape","choose shape")},iconUrl:function(){return a||w.shift_key_pressed?T:B},hideOthers:function(){return a||w.shift_key_pressed},hideRing:function(){return a||w.shift_key_pressed},draggable:function(){return a||w.shift_key_pressed},commit:function(){if(w.shift_key_pressed&&(a=!0),a){d=this.button;var e=i.getNodeForId(n.id);e||(console.error("view not found for node",n.id),this.cancel()),l=e.newEphemeralCrosslink()}},cancel:function(){a&&(u=null,d&&d.remove(),l&&l.remove(),l=null,d=null)},finish:function(){if(a){if(u){i.getNodeForId(n.id).createCrosslinkTo(u.x,u.y)}this.cancel()}else{var t=i.documentCoordsFromEvent({pageX:e.x,pageY:e.y}),o=b.instance();o.show(t.x,t.y,n.isRoot(),e.colour,"free"!==i.model.myEditing(),function(e,t){if(!e&&t){var o=i.getNodeForId(n.id);void 0!==t.shape&&o.setShape(t.shape,w.shift_key_pressed)}});i.trigger("menu:open",{x:e.x,y:e.y,type:"shape"}),o.once("hidden",function(){i.trigger("menu:close",{type:"shape"})})}},update:function(e){if(a){if(!l)return console.error("ephemeral link missing"),void this.cancel();u=i.diagramCoordsFromEvent(e),l.drawTo(u);i.getNodeForId(n.id).targetForCrosslink(u.x,u.y)?d.css({opacity:1}):d.css({opacity:.3});var t=i.documentCoordsFromEvent(e);d.appendTo($("body")),d.css({width:o/2+"px",height:o/2+"px"}),d.css({position:"absolute",top:t.y-d.height()/2,left:t.x-d.width()/2})}}}}var c={},h=null,f=null;return n.isTitle()||n.joinedNode()||(e.actions.transplant={slot:2,iconUrl:O,bigIcon:!0,tip:p.getSync("drag-to-transplant-branch","drag to transplant branch"),hideOthers:!0,hideRing:!0,draggable:!0,commit:function(){f=this.button,console.log("transplant link:",f,this);f.offset();c={x:n.x(),y:n.y(),parent:n.parent()},h=null},_cleanup:function(){var e=i.getNodeForId(n.id);e&&(e.getConnection().setOpacity(1),n.isRoot()&&e.setOpacity(1)),c=null,f&&(f.remove(),f=null)},cancel:function(){n.reparentTo(c.parent,!1),n.positionAbsolutely(c.x,c.y),this._cleanup()},finish:function(){n.deltarize({parent_id:n.get("parent_id"),pos:n.pos(),text_size:n.textSize()}),this._cleanup()},update:function(e){if(f){var t=i.documentCoordsFromEvent(e);f.appendTo($("body")),f.css({width:o/2+"px",height:o/2+"px"}),f.css({position:"absolute",top:t.y-f.height()/2,left:t.x-f.width()/2});var r=i.diagramCoordsFromEvent(e),s=i.getNodeForId(n.id);null===h&&(h={x:r.x,y:r.y}),s?s.moveBranchTo(r.x,r.y,!0,h):this._cleanup()}}}),e.onclose=function(){getCoggleUser().getActions().unique("node-contextmenu-opened"),i.trigger("menu:close",{type:"node"})},i.trigger("menu:open",{type:"node",x:e.x,y:e.y}),new _.Sage(e)}function a(e){var t=e.node,n=e.diagram;e.actions={},s(e,!0),e.actions.breakLine={slot:0,iconUrl:M,tip:p.getSync("delete-connection","delete connection"),finish:function(){var e=n.getNodeForId(t.id);e&&e.removeLine()}},e.actions.insertLabel={slot:3,iconUrl:E,tip:p.getSync("label-connection","label this connection"),finish:function(){var i=n.getNodeForId(t.id),o=i.parent();if(o){var r=n.diagramCoordsFromEvent({pageX:e.x,pageY:e.y}),s=o.addChild({pos:{x:r.x-o.model.x(),y:r.y-o.model.y()},colour:t.colour(),line_style:t.get("line_style"),line_weight:t.get("line_weight"),line_shape:t.get("line_shape"),shape:"label"});t.reparentTo(s.model),t.set("pos",{x:t.relX()-s.model.relX(),y:t.relY()-s.model.relY()}),t.set("control_points",{}),t.deltarize(),setTimeout(function(){s.editNode&&s.editNode()})}}};var i=!(t.shape()||t.joinedNode()&&t.joinedNode().shape());return e.actions.reverseConnection={slot:4,disabled:i,iconUrl:j,tip:i?p.getSync("reverse-connection-shapes","reversing is not possible for continuous branches: choose a shape first"):p.getSync("reverse-connection","reverse connection"),finish:function(){var e=n.getNodeForId(t.id);e&&e.reverseLine()}},e.onclose=function(){n.trigger("menu:close",{type:"line"})},n.trigger("menu:open",{type:"line",x:e.x,y:e.y}),new _.Sage(e)}function u(e){return e.actions={copy:{slot:1,iconUrl:L,tip:p.getSync("copy-branch","copy branch"),finish:function(){m({node:e.node,diagram:e.diagram})}}},new _.Sage(e)}function d(e){return e.actions={expand:{slot:5,iconUrl:P,tip:p.getSync("show-children","show children"),finish:function(){e.node.expandAllChildren(),e.diagram.trigger("present:expand")}},collapse:{slot:0,iconUrl:D,tip:p.getSync("hide-children","hide children"),finish:function(){e.node.collapseAllChildren(),e.diagram.trigger("present:collapse")}}},new _.Sage(e)}function c(e){var t=e.node,n=e.diagram;return e.actions={copy:{slot:1,iconUrl:L,tip:p.getSync("copy-attachment","copy attachment"),finish:function(){var i={attachments:{},diagram:n};i.attachments[e.attachment_id]=t.getAttachment(e.attachment_id),m(i)}},remove:{slot:0,iconUrl:C,tip:p.getSync("remove-attachment","remove attachment"),finish:function(){t&&t.collection&&(t.removeAttachment(e.attachment_id),t.deltarize())}},download:{slot:3,iconUrl:A,tip:p.getSync("download-attachment","download attachment"),finish:function(){var t=n.model.getAttachments();if(t){var i=t.getByLocalId(e.attachment_id);if(i&&i.getUrl()){var o=window.open(i.getUrl(),"_blank");return o.opener=null,o}}$(window).trigger("notify-warning",["attachment not available: are you online?"])}}},new _.Sage(e)}function h(e,t,n,o){var r=n.getNodeForId(t);if(r){var s=$("body").hasClass("touch")?200:150;if("Android"!==g.OS){s*=window.innerHeight/$(window).height()}var h,p={size:s,x:e.x,y:e.y,node:r.model,diagram:n,colour:r.model.colour(),appendTo:document.body,background:$(".coggle-workspace").length?$(".coggle-workspace")[0]:$(".diagram-editor")[0]};return n.historyMode()?(h=u(p),i(["Sage","Open","NodeHM"])):n.presentationMode()?(h=d(p),i(["Sage","Open","NodePM"])):n.editingPrevented()||(o.is(".node-connection path")||o.is(".controlpoint")?(h=a(p),i(["Sage","Open","Line"])):o.is(".file-attachment")?(p.attachment_id=o.attr("data-attachment-id"),h=c(p),i(["Sage","Open","Attachment"])):(h=l(p),i(["Sage","Open","Node"]))),h&&r.model.once("destroy",function(){h&&h.close&&h.close()}),h}}var p=(e("underscore"),e("l10n")),f=e("utils/queryString"),g=e("BrowserDetect"),m=e("starc/starc.copypaste").copy,v=e("models/NotificationSearch"),y=e("views/ColourMenu"),b=e("views/ShapeMenu"),w=(e("views/PitchView"),e("utils/trackModifiers")),_=e("views/sage"),x=f().print,E=(o(r("undo-w.png")),o(r("plus-w.png"))),A=o(r("download-w.png")),S=o(r("paint2.png")),C=o(r("cross-w.png")),F=o(r("minus-w.png")),k=(o(r("dup-w.png")),o(r("cogglify-w.png"))),T=o(r("vdash-w.png")),O=o(r("transplant2-w.png")),N=o(r("comment-w.png")),I=o(r("comment-plus-w.png")),L=o(r("copy-w.png")),R=o(r("rearrange-w.png")),P=o(r("expand-w.png")),D=o(r("collapse-w.png")),M=o(r("remove-line-w.png")),B=o(r("shape-w.png")),j=o(r("reverse-line-w.png")),H=function(e,t){return(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)},G=function(e,t,n){var i,o,r,s,l=n.node,a=n.diagram,u=n.size;return window._no_menu_dragadd?{slot:e,iconUrl:E,tip:p.getSync("add-branch","add branch"),finish:function(){a.getNodeForId(l.id).addChild(void 0,l.isRoot()?"left":void 0,w.shift_key_pressed).editNode()}}:{slot:e,tip:p.getSync("add-branch","add branch"),iconUrl:E,hideOthers:!0,hideRing:!0,draggable:!0,commit:function(e){r=this.button,o=a.getNodeForId(l.id),s=a.diagramCoordsFromEvent(e)},cancel:function(){r&&r.remove(),i&&o&&o.cancelDragAdd&&o.cancelDragAdd(),o=null,i=null,r=null,s=null},finish:function(e){if(o&&o.addChild){if(i){var n=o.endDragAdd();n&&n.editNode(),i=null}else o.addChild(void 0,l.isRoot()?t:void 0,w.shift_key_pressed).editNode();this.cancel()}},update:function(e){var t=a.diagramCoordsFromEvent(e);if(!o)return void this.cancel();s&&!i&&H(t,s)>400?i=o.startDragAdd(t):i&&i(t.x,t.y);var n=a.documentCoordsFromEvent(e);r.appendTo($("body")),r.css({width:u/2+"px",height:u/2+"px"}),r.css({position:"absolute",top:n.y-r.height()/2,left:n.x-r.width()/2})}}};n.exports=function(e){e.$el.on("press contextmenu",".node-container .node-content, .starcbutton, path, .controlpoint, .file-attachment",function(t){var n=$(t.currentTarget);if(!n.is("textarea,input")&&!x){var i=n.closest("[data-nodeid]").attr("data-nodeid");return h(e.documentCoordsFromEvent(t),i,e,n)&&"contextmenu"===t.type?(t.preventDefault(),t.stopPropagation(),!1):void 0}})}}),define("starc/starc.menu.colour",["require","exports","module","views/ColourMenu","utils/trackModifiers"],function(e,t,n){var i=e("views/ColourMenu"),o=e("utils/trackModifiers");n.exports=function(e){function t(t){if(!e.editingPrevented()){var n=$(t.currentTarget).closest("[data-nodeid]").attr("data-nodeid"),r=e.getNodeForId(n);if(r&&!r.model.isRoot()&&!o.control_key_pressed){var s=e.documentCoordsFromEvent(t),l=i.instance();l.show($("body"),s.x,s.y,function(e,t){!e&&t&&(void 0!==t.colour&&r.setColour(t.colour,o.shift_key_pressed),void 0!==t.weight&&r.setLineWeight(t.weight,o.shift_key_pressed),void 0!==t.style&&r.setLineStyle(t.style,o.shift_key_pressed),void 0!==t.shape&&r.setLineShape(t.shape,o.shift_key_pressed))}.bind(this)).extended("free"!==e.model.myEditing());e.trigger("menu:open",{x:s.y,y:s.y,type:"colour"}),l.once("hidden",function(){e.trigger("menu:close",{type:"colour"})}),t.preventDefault()}}}e.$el.on("tap",".node-connection path",t)}}),define("views/LinkEditView",["require","exports","module","underscore"],function(e,t,n){var i=e("underscore"),o=Backbone.View.extend({className:"item-hyperlink",events:{"click .editlink":"edit"},template:i.template("<a class='callout-link' href='<%-url%>' target='<%-target%>' rel='nofollow noopener noreferrer ugc'><%-url%></a><span class='button green editlink'>EDIT</span>"),initialize:function(e){i.bindAll(this,"render","edit"),this.options=e},render:function(){return this.$el.html(this.template({url:this.options.url||"about:blank",target:this.options.target||""})),this},edit:function(){var e=this.options.$link,t=this.options.diagram,n=e.attr("href"),i=e.closest("[data-nodeid]").attr("data-nodeid"),o=t.getNodeForId(i);if(o){var r=o.model.text(),s=r.indexOf(n);o.editNode({start:s,end:s+n.length})}this.trigger("edit")}});n.exports={LinkEditView:o}}),define("starc/starc.contentcallouts",["require","exports","module","utils/trackModifiers","plugins/jquery.callout","views/LinkEditView","views/AttachmentView","jquery"],function(e,t,n){var i=e("utils/trackModifiers");e("plugins/jquery.callout");var o=e("views/LinkEditView").LinkEditView,r=e("views/AttachmentView"),s=e("jquery");n.exports=function(e){function t(){return!(e.editingPrevented()||e.textPopupActive())}function n(e){e.preventDefault(),e.stopPropagation()}function l(e,t){var n=t[0],i={at:"center top",my:"center bottom",collision:"ignore",of:t};return e.removeClass("center top bottom"),n&&(n.getBoundingClientRect().top<window.innerHeight-110?(i.at="center bottom",i.my="center top",e.addClass("center top")):e.addClass("center bottom")),e.position(i),e}function a(e,t){var n=s(".contentcallout");if(n.length)n.find(".contents").html(e);else{n=s('<div class="callout contentcallout"><div class="arrow"/><div class="contents"/><div class="arrow mask"/></div>'),n.find(".contents").html(e);var i=s(".coggle-workspace");i.length?n.appendTo(i):n.appendTo("body")}return setTimeout(function(){n.addClass("is-open")},10),m=n,v=t,n}function u(){var e=s(".contentcallout");e.fadeOut(200,function(){e.remove()})}function d(t){var n=t.attr("href"),i=/^#/.exec(n),r=new o({url:n,target:i?"":"_blank",$link:t,diagram:e}),s=a(r.render().$el);return s.find(".contents").html(),l(s,t),r.on("edit",function(){r.remove(),s.remove()}),r.$el.find("a").on("click",f),s}function c(t){var n=t.closest("[data-nodeid]").attr("data-nodeid"),i=t.data("attachment-id"),o=e.getNodeForId(n),s=new r.AttachmentDetailView({nodeView:o,attachment_id:i,diagram:e}),u=a(s.render().$el,n+i);return l(u,t),s.on("removed",function(){u.remove()}),u}function h(t){var n=s(t.target).attr("href");/^#/.exec(n)||e.trigger("url:open",n,t)}function p(t){return e.editingPrevented()?h(t):i.control_key_pressed||i.meta_key_pressed?void h(t):(t.preventDefault(),t.stopPropagation(),!1)}function f(e){h(e)}function g(e){var i,o=s(e.target),r=m&&m.parent().length&&v;o.is(".node-content a:not(.at-tagged):not(.diagram-link-origin)")&&t()?i=d(o):o.is(".file-attachment>*")&&(i=c(o.closest(".file-attachment"))),!i||r&&v===r?u():n(e)}var m,v;e.$el[0].addEventListener("tap",g,!0),e.scrollContainer().on("scroll",u),e.$el.on("click",".node-content a:not(.at-tagged)",p),e.$el.on("panstart",u),e.$el.on("dragstart","a, img",n),e.$el.on("pointerdown",u),e.$el.on("opencontentcallout",function(e,t){e.target=t,g(e)})}}),define("starc/starc.node.buttons",["require","exports","module","underscore","starc/starc.buttons","views/shapes","utils/controlPoints","utils/trackModifiers"],function(e,t,n){var i=e("underscore"),o=e("starc/starc.buttons"),r=e("views/shapes"),s=e("utils/controlPoints"),l=e("utils/trackModifiers"),a=function(e){switch(e){case"up":return"top";case"down":return"bottom";case"left":return"left";default:case"right":return"right"}},u=function(e){return e&&!e.get("hidden")},d=function(e,t,n,i){return(e-n)*(e-n)+(t-i)*(t-i)},c=function(e,t,n){for(var i=r.connectionsForSize(e.shape(),t.getSize()),o=n.x-e.x(),s=n.y-e.y(),l=0;l<i.length;l++)if(d(o,s,i[l].x,i[l].y<196))return!0;return!1},h=function(){this.buttons=[],this.setUpFor=this.shownFor=this.nodeView=this.hidden=this.nearestButton=null};h.prototype.setupFor=function(e){this.shownFor!==e&&(this.remove(),this.shownFor=e),this.nodeView=e,this.render()},h.prototype.hide=function(){this.hidden=!0,this.render()},h.prototype.show=function(){this.hidden=!1,this.render()},h.prototype.showNearestTo=function(e){if(!this.hidden){var t=document.body.className.split(" ");if(!(t.indexOf("dragging")>=0||t.indexOf("touch")>=0||!this.nodeView||this.nodeView.wasRemoved)&&this.nodeView.model){var n=e.x-this.nodeView.model.x(),i=e.y-this.nodeView.model.y(),o=null,r=null,s=1/0,l=1/0;this.buttons.forEach(function(e){var t=e.getOffset(),a=d(t.x,t.y,n,i);a<s&&a<1e4&&(s=a,o=e),a<l&&!e.suppressed()&&(l=a,r=e)}),o&&o.suppressed()&&(o=r),this.nearestButton&&this.nearestButton!==o&&this.nearestButton.unhover(),o&&(o.hover(),this.nearestButton=o)}}},h.prototype.render=function(){if(this.hidden||$("body").hasClass("dragging")||$("body").hasClass("touch")||!this.nodeView||!this.nodeView.model||!this.nodeView.model.collection)return void this.remove();var e=this.nodeView,t=e.model,n=e.diagram,i=e.getLabel().$el,u=t.shape(),c=n.presentationMode();if(n.readOnly()&&!c)return void this.remove();if(u)this.setUpFor!==u&&(this.removeButtons(),this.setUpFor=u,r.connectionsForSize(u,e.getSize()).forEach(function(e){var r=a(e.direction),s=new o(t,n,{side:r});this.buttons.push(s),s.setOffset(e.x,e.y),i.append(s.$el)}.bind(this)));else if("branch"!==this.setUpFor){this.removeButtons(),this.setUpFor="branch";var h=new o(t,n,{});this.buttons.push(h),i.append(h.$el)}if(this.buttons.length>1&&!c){var p=t.parent();if(p){var f=s.connectionParameters(n,p,t,e),g=f.xt-t.relX(),m=f.yt-t.relY(),v=l.alt_key_pressed,y=l.control_key_pressed,b=l.shift_key_pressed,w=l.meta_key_pressed,_=!(!(v||y||w)||c),x=!(!b||(v||y||w||c));this.buttons.forEach(function(e){(_||x)!==d(e._x,e._y,g,m)<36?e.suppress():e.unsuppress()})}else this.buttons.forEach(function(e){e.unsuppress(),e.show()})}c&&this.buttons.forEach(function(t){0===e.children(t.options.side).length&&t.suppress()})},h.prototype.removeButtons=function(){this.buttons.forEach(function(e){e&&e.remove()}),this.buttons=[],this.nearestButton=null},h.prototype.remove=function(){this.removeButtons(),this.setUpFor=this.shownFor=this.nodeView=this.hidden=null},n.exports=function(e){function t(t){if(s())return void(o&&o.remove());r=!0;var n=$(t.currentTarget),i=n.closest("[data-nodeid]").attr("data-nodeid");o.setupFor(e.getNodeForId(i))}function n(e){r=!1,l(e)}var o=new h,r=!1,s=function(){return(e.readOnly()||e.historyMode())&&!e.presentationMode()},l=i.throttle(function(t){if(s())return void(o&&o.remove());var n=e.diagramCoordsFromEvent(t);if(!r){var i=e.model.getNodes().closest(n.x,n.y,u);i&&i.shape()&&c(i,e.getNodeForId(i.id),n)?o.setupFor(e.getNodeForId(i.id)):i&&d(i.x(),i.y(),n.x,n.y)<196?o.setupFor(e.getNodeForId(i.id)):o.remove()}$(t.target).parents(".sage2, .shapemenu, .colourmenu").length||t.target.classList.contains("tasklist-checkwidget")?o.nearestButton&&o.nearestButton.unhover():o.showNearestTo(n)},50),a=function(){o&&o.render()};e.$el.on("mouseenter",".node-container",t),e.$el.on("mouseleave",".node-container",n),document.body.addEventListener("mousemove",l,{capture:!0,passive:!0}),$(window).on("modifierschanged",a),e.model.getNodes().on("change:parent_id",a),e.model.getNodes().on("change:text",function(e){o.nodeView&&o.nodeView.model===e&&e.shape()&&o.remove()}),e.once("remove",function(){e.model.getNodes().off(void 0,t),$(window).off("modifierschanged",a),document.body.removeEventListener("mousemove",l,{capture:!0,passive:!0})})}}),define("starc/starc.node.blame",["require","exports","module","underscore","env","utils/coggle-timeago"],function(e,t,n){var i=e("underscore"),o=e("env").cdn.url,r=e("utils/coggle-timeago"),s=i.template("<div class='content' style='background: <%- user.avatar.colour %>'><div class='icon' style='background-image: url(<%-user.avatar.url%>);'/><div class='text'><div class='name'><%- user.name %></div><% if (ts) { %> <time datetime='<%-ts%>'/> <% } %></div></div>"),l=function(e){this.$el=$('<div class="blamecallout"/>'),this.setData(e||{})};l.prototype.setData=function(e){return this.user=e.user||null,this.ts=e.ts||null,this},l.prototype.render=function(){var e=this.user&&this.user.toJSON();e||(e={name:"Unknown User",avatar:{url:o+"/img/anon-member-2x.png",colour:"#aaa"}});var t={user:e,ts:this.ts};return this.$el.html(s(t)),this.ts&&r.loadLanguages(function(){r.timeago(this.$el.find("time"))}.bind(this)),this},l.prototype.remove=function(){return this.$el.remove(),this},n.exports=function(e){function t(t){if(e.historyMode()){var n=$(t.currentTarget),i=n.closest("[data-nodeid]").attr("data-nodeid"),r=e.getNodeForId(i);o.setData({user:e.model.getAccess().get(r.model.get("owner_id")),ts:r.model.get("action_ts")}),e.nodesContainer().append(o.render().$el),o.$el.css({top:r.boundingBox().y,left:r.boundingBox().x+r.boundingBox().width/2})}}function n(e){o.remove()}function i(){o.remove()}var o=new l(e);e.$el.on("mouseenter",".node-container",t),e.$el.on("mouseleave",".node-container",n),e.on("mode",i),e.once("remove",function(){e.off(void 0,i)})}}),define("starc/starc.node.editevents",["require","exports","module","models/NotificationSearch","views/NodeEditView","utils/trackModifiers","models/User"],function(e,t,n){var i=(e("models/NotificationSearch"),e("views/NodeEditView")),o=(e("utils/trackModifiers"),e("models/User"),function(e){e.get("highlight")?"pink"===e.get("highlight")?e.set("highlight","green"):e.set("highlight",null):e.set("highlight","pink")}),r=function(e){e.children().filter(function(e){return e.get("hidden")}).length?e.expandAllChildren(!1):e.collapseAllChildren(!0)};n.exports=function(e){function t(t){var n=$(t.target);if(!n.is(".shapebackground")&&!n.closest(".starcbutton").length){if(n.closest(".node-editor").length)return void t.stopPropagation();if(!t.ctrlKey){var i=n.closest("[data-nodeid]").attr("data-nodeid");if(e.editingPrevented())return void(e.presentationMode()&&(t.altKey?o(e.model.getNodes().get(i)):r(e.model.getNodes().get(i))));var s=e.getNodeForId(i);return s&&s.editNode(),t.stopPropagation(),t.preventDefault(),!1}}}function n(){i.activeEdit()&&i.activeEdit().commit()}e.once("loaded",function(){e.$el.on("tap",".node-container",t),e.$el.on("tap",n)})}}),define("starc/starc.node.tabfocus",["require","exports","module"],function(e,t,n){n.exports=function(e){function t(t){if(13==t.keyCode){var n=$(t.currentTarget),i=n.closest("[data-nodeid]").attr("data-nodeid"),o=e.getNodeForId(i);o&&o.editNode()}}function n(e){var t=$(e.target).closest(".node-container");t.addClass("disable-focus"),setTimeout(function(){t.find(".node-content").blur()},0),setTimeout(function(){t.removeClass("disable-focus")},100)}e.$el[0].addEventListener("mousedown",n,{capture:!0}),e.$el.on("keyup",".node-container:not(.active) .node-content",t)}}),define("starc/starc.node.crosslinks",["require","exports","module","underscore"],function(e,t,n){var i=e("underscore");n.exports=function(e){var t,n=i.throttle(function(){t&&t.length||(t=e.$el.find("#xlink-elements")),t.stop().hide(),o()},30),o=i.debounce(function(){t.stop().fadeIn(100)},200),r=i.debounce(function(){e.model.getNodes().each(function(t){var n=e.getNodeForId(t.id);n&&n.updateCrosslinks()})},200);e.once("loaded",function(){e.model.getNodes().on("change remove",n),e.model.getNodes().on("add change remove",r),e.model.getNodes().each(r),e.once("remove",function(){e.model.getNodes().off(void 0,n),e.model.getNodes().off(void 0,r)})})}}),function(e){"function"==typeof define&&define.amd?define("plugins/jquery.restrictscroll",["jquery","underscore"],e):e(jQuery,_)}(function(e,t){var n={left_min:0,left_max:800,top_min:0,top_max:600},i=function(e){var n=function(){if("function"!=typeof this.options.beforeLimit||!1!==this.options.beforeLimit()){var t=e.scrollLeft(),n=e.scrollTop(),i=this.options.left_min,o=this.options.left_max,r=this.options.top_min,s=this.options.top_max;t<i?e.scrollLeft(Math.round(1*i+0*t+.5)):t>o&&e.scrollLeft(Math.round(1*o+0*t-.5)),n<r?e.scrollTop(Math.round(1*r+0*n+.5)):n>s&&e.scrollTop(Math.round(1*s+0*n-.5))}}
;e[0].addEventListener("scroll",t.debounce(n,200).bind(this),{capture:!0,passive:!0})};i.prototype.setOptions=function(t){this.options=e.extend(this.options,t)},e.fn.restrictScroll=function(t){var o=e(this),r=e.data(this,"plugin_restrictScroll");r||(t=e.extend(n,t),r=new i(o),e.data(this,"plugin_restrictScroll",r)),r.setOptions(t)}}),define("starc/starc.bounds.scroll",["require","exports","module","plugins/jquery.restrictscroll","underscore"],function(e,t,n){e("plugins/jquery.restrictscroll");var i=e("underscore");n.exports=function(e){function t(){r(!0)}var n=null,o=function(){return!e.textPopupActive()},r=function(t){var i=window.innerHeight/$(window).height(),r=100*i;n&&t||(n=e.getFastBoundingRect(r));var s=n,l=e.scrollContainer().width()*i,a=e.scrollContainer().height()*i,u={left_min:(-e._size.x1+s.xmin)*e.getScale()*i-.75*l,left_max:(-e._size.x1+s.xmax)*e.getScale()*i-.25*l,top_min:(-e._size.y1+s.ymin)*e.getScale()*i-.75*a,top_max:(-e._size.y1+s.ymax)*e.getScale()*i-.25*a,beforeLimit:o};e.scrollContainer().restrictScroll(u)},s=i.debounce(function(){r()},200);e.on("loaded",function(){s(),e.model.getNodes().on("change add remove",s),e.on("scale",t),e.on("resize",t),$(window).on("resize",t),e.once("remove",function(){e.model.getNodes().off(void 0,s),e.off(void 0,t),$(window).off("resize",t)})})}}),function(e){"function"==typeof define&&define.amd?define("plugins/jquery.dragScrolling",["jquery"],e):e(jQuery)}(function(e){var t;e.fn.dragScrolling=function(n){function i(n){function i(e){var t=(o-e)/o;return Math.min(t*t,1.2)}var o=15,r=t.scrollLeft(),s=t.scrollTop(),l=n.clientX||n.changedTouches&&n.changedTouches[0]&&n.changedTouches[0].clientX||0,a=n.clientY||n&&n.changedTouches&&n.changedTouches[0]&&n.changedTouches[0].clientY||0,u=e(window).width()-1,d=e(window).height(),c=l,h=u-l,p=a,f=d-a;c<o&&(r-=2*i(c)),h<o&&(r+=2*i(h)),p<o&&(s-=2*i(p)),f<o&&(s+=2*i(f)),t.scrollLeft(r),t.scrollTop(s)}function o(e){l=e}function r(e){a||n.filter&&!n.filter(e)||(window.addEventListener("mousemove",o,{capture:!0,passive:!0}),window.addEventListener("touchmove",o,{capture:!0,passive:!0}),window.addEventListener("pointermove",o,{capture:!0,passive:!0}),a=setInterval(function(){l&&i(l)},2))}function s(){window.removeEventListener("mousemove",o,{capture:!0,passive:!0}),window.removeEventListener("touchmove",o,{capture:!0,passive:!0}),window.removeEventListener("pointermove",o,{capture:!0,passive:!0}),clearInterval(a),a=null,l=null}t=e(this);var l=null,a=null;e("body").data("scroll-bounds.configured")||(e("body").data("scroll-bounds.configured",!0),window.addEventListener("mousedown",r,{capture:!0,passive:!0}),window.addEventListener("touchstart",r,{capture:!0,passive:!0}),window.addEventListener("pointerdown",r,{capture:!0,passive:!0}),window.addEventListener("mouseup",s,{capture:!0,passive:!0}),window.addEventListener("touchend",s,{capture:!0,passive:!0}),window.addEventListener("pointerup",s,{capture:!0,passive:!0}))}}),define("starc/starc.bounds.drag",["require","exports","module","plugins/jquery.dragScrolling"],function(e,t,n){e("plugins/jquery.dragScrolling"),n.exports=function(e){e.scrollContainer().dragScrolling({filter:function(e){return!$(e.target).is("svg")&&(!$(e.target).closest(".diagram-toolbar").length&&!$(e.target).closest("#diagram-header").length)}.bind(this)})}}),function(e){if("function"==typeof define&&define.amd)define("jquery.textcomplete",["jquery"],e);else if("object"==typeof module&&module.exports){var t=require("jquery");module.exports=e(t)}else e(jQuery)}(function(e){if(void 0===e)throw new Error("jQuery.textcomplete requires jQuery");return function(e){"use strict";var t=function(e){console.warn&&console.warn(e)},n=1;e.fn.textcomplete=function(i,o){var r=Array.prototype.slice.call(arguments);return this.each(function(){var s=this,l=e(this),a=l.data("textComplete");if(a||(o||(o={}),o._oid=n++,a=new e.fn.textcomplete.Completer(this,o),l.data("textComplete",a)),"string"==typeof i){if(!a)return;r.shift(),a[i].apply(a,r),"destroy"===i&&l.removeData("textComplete")}else e.each(i,function(n){e.each(["header","footer","placement","maxCount"],function(e){n[e]&&(a.option[e]=n[e],t(e+"as a strategy param is deprecated. Use option."),delete n[e])})}),a.register(e.fn.textcomplete.Strategy.parse(i,{el:s,$el:l}))})}}(e),function(e){"use strict";function t(n,r){if(this.$el=e(n),this.id="textcomplete"+i++,this.strategies=[],this.views=[],this.option=e.extend({},t.defaults,r),!(this.$el.is("input[type=text]")||this.$el.is("input[type=search]")||this.$el.is("textarea")||n.isContentEditable||"true"==n.contentEditable))throw new Error("textcomplete must be called on a Textarea or a ContentEditable.");if(n===n.ownerDocument.activeElement)this.initialize();else{var s=this;this.$el.one("focus."+this.id,function(){s.initialize()}),this.option.adapter&&"CKEditor"!=this.option.adapter||"undefined"==typeof CKEDITOR||!this.$el.is("textarea")||CKEDITOR.on("instanceReady",function(t){-1==e.inArray(t.editor.id,o)&&(o.push(t.editor.id),t.editor.on("focus",function(n){s.$el=e(t.editor.editable().$),s.option.adapter||(s.option.adapter=e.fn.textcomplete.CKEditor),s.option.ckeditor_instance=t.editor,s.initialize()}))})}}var n=function(e){return"[object String]"===Object.prototype.toString.call(e)},i=0,o=[];t.defaults={appendTo:"body",className:"",dropdownClassName:"dropdown-menu textcomplete-dropdown",maxCount:10,zIndex:"100",rightEdgeOffset:30},e.extend(t.prototype,{id:null,option:null,strategies:null,adapter:null,dropdown:null,$el:null,$iframe:null,initialize:function(){var t=this.$el.get(0);if(this.$el.prop("ownerDocument")!==document&&window.frames.length)for(var n=0;n<window.frames.length;n++)if(this.$el.prop("ownerDocument")===window.frames[n].document){this.$iframe=e(window.frames[n].frameElement);break}this.dropdown=new e.fn.textcomplete.Dropdown(t,this,this.option);var i,o;this.option.adapter?i=this.option.adapter:(o=this.$el.is("textarea")||this.$el.is("input[type=text]")||this.$el.is("input[type=search]")?"number"==typeof t.selectionEnd?"Textarea":"IETextarea":"ContentEditable",i=e.fn.textcomplete[o]),this.adapter=new i(t,this,this.option)},destroy:function(){this.$el.off("."+this.id),this.adapter&&this.adapter.destroy(),this.dropdown&&this.dropdown.destroy(),this.$el=this.adapter=this.dropdown=null},deactivate:function(){this.dropdown&&this.dropdown.deactivate()},trigger:function(e,t){this.dropdown||this.initialize(),null!=e||(e=this.adapter.getTextFromHeadToCaret());var n=this._extractSearchQuery(e);if(n.length){var i=n[1];if(t&&this._term===i&&""!==i)return;this._term=i,this._search.apply(this,n)}else this._term=null,this.dropdown.deactivate()},fire:function(e){var t=Array.prototype.slice.call(arguments,1);return this.$el.trigger(e,t),this},register:function(e){Array.prototype.push.apply(this.strategies,e)},select:function(e,t,n){this._term=null,this.adapter.select(e,t,n),this.fire("change").fire("textComplete:select",e,t),this.adapter.focus()},_clearAtNext:!0,_term:null,_extractSearchQuery:function(t){for(var i=0;i<this.strategies.length;i++){var o=this.strategies[i],r=o.context(t);if(r||""===r){var s=e.isFunction(o.match)?o.match(t):o.match;n(r)&&(t=r);var l=t.match(s);if(l)return[o,l[o.index],l]}}return[]},_search:function(e){var t,n;return function(){var i=Array.prototype.slice.call(arguments);if(t)return void(n=i);t=!0;var o=this;i.unshift(function i(){if(n){var r=n;n=void 0,r.unshift(i),e.apply(o,r)}else t=!1}),e.apply(this,i)}}(function(e,t,n,i){var o=this;t.search(n,function(i,r){o.dropdown.shown||o.dropdown.activate(),o._clearAtNext&&(o.dropdown.clear(),o._clearAtNext=!1),o.dropdown.setPosition(o.adapter.getCaretPosition()),o.dropdown.render(o._zip(i,t,n)),r||(e(),o._clearAtNext=!0)},i)}),_zip:function(t,n,i){return e.map(t,function(e){return{value:e,strategy:n,term:i}})}}),e.fn.textcomplete.Completer=t}(e),function(e){"use strict";function t(n,i,r){this.$el=t.createElement(r),this.completer=i,this.id=i.id+"dropdown",this._data=[],this.$inputEl=e(n),this.option=r,r.listPosition&&(this.setPosition=r.listPosition),r.height&&this.$el.height(r.height);var s=this;e.each(["maxCount","placement","footer","header","noResultsMessage","className"],function(e,t){null!=r[t]&&(s[t]=r[t])}),this._bindEvents(n),o[this.id]=this}var n=e(window),i=function(e,t){var n,i,o=t.strategy.idProperty;for(n=0;n<e.length;n++)if(i=e[n],i.strategy===t.strategy)if(o){if(i.value[o]===t.value[o])return!0}else if(i.value===t.value)return!0;return!1},o={};e(document).on("click",function(t){var n=t.originalEvent&&t.originalEvent.keepTextCompleteDropdown;e.each(o,function(e,t){e!==n&&t.deactivate()})});var r={SKIP_DEFAULT:0,KEY_UP:1,KEY_DOWN:2,KEY_ENTER:3,KEY_PAGEUP:4,KEY_PAGEDOWN:5,KEY_ESCAPE:6};e.extend(t,{createElement:function(t){var n=t.appendTo;return n instanceof e||(n=e(n)),e("<ul></ul>").addClass(t.dropdownClassName).attr("id","textcomplete-dropdown-"+t._oid).css({display:"none",left:0,position:"absolute",zIndex:t.zIndex}).appendTo(n)}}),e.extend(t.prototype,{$el:null,$inputEl:null,completer:null,footer:null,header:null,id:null,maxCount:null,placement:"",shown:!1,data:[],className:"",destroy:function(){this.deactivate(),this.$el.off("."+this.id),this.$inputEl.off("."+this.id),this.clear(),this.$el.remove(),this.$el=this.$inputEl=this.completer=null,delete o[this.id]},render:function(t){var n=this._buildContents(t),i=e.map(t,function(e){return e.value});if(t.length){var o=t[0].strategy;o.id?this.$el.attr("data-strategy",o.id):this.$el.removeAttr("data-strategy"),this._renderHeader(i),this._renderFooter(i),n&&(this._renderContents(n),this._fitToBottom(),this._fitToRight(),this._activateIndexedItem()),this._setScroll()}else this.noResultsMessage?this._renderNoResultsMessage(i):this.shown&&this.deactivate()},setPosition:function(t){var i="absolute";return this.$inputEl.add(this.$inputEl.parents()).each(function(){return"absolute"!==e(this).css("position")&&("fixed"===e(this).css("position")?(t.top-=n.scrollTop(),t.left-=n.scrollLeft(),i="fixed",!1):void 0)}),this.$el.css(this._applyPlacement(t)),this.$el.css({position:i}),this},clear:function(){this.$el.html(""),this.data=[],this._index=0,this._$header=this._$footer=this._$noResultsMessage=null},activate:function(){return this.shown||(this.clear(),this.$el.show(),this.className&&this.$el.addClass(this.className),this.completer.fire("textComplete:show"),this.shown=!0),this},deactivate:function(){return this.shown&&(this.$el.hide(),this.className&&this.$el.removeClass(this.className),this.completer.fire("textComplete:hide"),this.shown=!1),this},isUp:function(e){return 38===e.keyCode||e.ctrlKey&&80===e.keyCode},isDown:function(e){return 40===e.keyCode||e.ctrlKey&&78===e.keyCode},isEnter:function(e){return!(e.ctrlKey||e.altKey||e.metaKey||e.shiftKey)&&(13===e.keyCode||9===e.keyCode||!0===this.option.completeOnSpace&&32===e.keyCode)},isPageup:function(e){return 33===e.keyCode},isPagedown:function(e){return 34===e.keyCode},isEscape:function(e){return 27===e.keyCode},_data:null,_index:null,_$header:null,_$noResultsMessage:null,_$footer:null,_bindEvents:function(){this.$el.on("mousedown."+this.id,".textcomplete-item",e.proxy(this._onClick,this)),this.$el.on("touchstart."+this.id,".textcomplete-item",e.proxy(this._onClick,this)),this.$el.on("mouseover."+this.id,".textcomplete-item",e.proxy(this._onMouseover,this)),this.$inputEl.on("keydown."+this.id,e.proxy(this._onKeydown,this))},_onClick:function(t){var n=e(t.target);t.preventDefault(),t.originalEvent.keepTextCompleteDropdown=this.id,n.hasClass("textcomplete-item")||(n=n.closest(".textcomplete-item"));var i=this.data[parseInt(n.data("index"),10)];this.completer.select(i.value,i.strategy,t);var o=this;setTimeout(function(){o.deactivate(),"touchstart"===t.type&&o.$inputEl.focus()},0)},_onMouseover:function(t){var n=e(t.target);t.preventDefault(),n.hasClass("textcomplete-item")||(n=n.closest(".textcomplete-item")),this._index=parseInt(n.data("index"),10),this._activateIndexedItem()},_onKeydown:function(t){if(this.shown){var n;switch(e.isFunction(this.option.onKeydown)&&(n=this.option.onKeydown(t,r)),null==n&&(n=this._defaultKeydown(t)),n){case r.KEY_UP:t.preventDefault(),this._up();break;case r.KEY_DOWN:t.preventDefault(),this._down();break;case r.KEY_ENTER:t.preventDefault(),this._enter(t);break;case r.KEY_PAGEUP:t.preventDefault(),this._pageup();break;case r.KEY_PAGEDOWN:t.preventDefault(),this._pagedown();break;case r.KEY_ESCAPE:t.preventDefault(),this.deactivate()}}},_defaultKeydown:function(e){return this.isUp(e)?r.KEY_UP:this.isDown(e)?r.KEY_DOWN:this.isEnter(e)?r.KEY_ENTER:this.isPageup(e)?r.KEY_PAGEUP:this.isPagedown(e)?r.KEY_PAGEDOWN:this.isEscape(e)?r.KEY_ESCAPE:void 0},_up:function(){0===this._index?this._index=this.data.length-1:this._index-=1,this._activateIndexedItem(),this._setScroll()},_down:function(){this._index===this.data.length-1?this._index=0:this._index+=1,this._activateIndexedItem(),this._setScroll()},_enter:function(e){var t=this.data[parseInt(this._getActiveElement().data("index"),10)];this.completer.select(t.value,t.strategy,e),this.deactivate()},_pageup:function(){var t=0,n=this._getActiveElement().position().top-this.$el.innerHeight();this.$el.children().each(function(i){return e(this).position().top+e(this).outerHeight()>n?(t=i,!1):void 0}),this._index=t,this._activateIndexedItem(),this._setScroll()},_pagedown:function(){var t=this.data.length-1,n=this._getActiveElement().position().top+this.$el.innerHeight();this.$el.children().each(function(i){return e(this).position().top>n?(t=i,!1):void 0}),this._index=t,this._activateIndexedItem(),this._setScroll()},_activateIndexedItem:function(){this.$el.find(".textcomplete-item.active").removeClass("active"),this._getActiveElement().addClass("active")},_getActiveElement:function(){return this.$el.children(".textcomplete-item:nth("+this._index+")")},_setScroll:function(){var e=this._getActiveElement(),t=e.position().top,n=e.outerHeight(),i=this.$el.innerHeight(),o=this.$el.scrollTop();0===this._index||this._index==this.data.length-1||0>t?this.$el.scrollTop(t+o):t+n>i&&this.$el.scrollTop(t+n+o-i)},_buildContents:function(e){var t,n,o,r="";for(n=0;n<e.length&&this.data.length!==this.maxCount;n++)t=e[n],i(this.data,t)||(o=this.data.length,this.data.push(t),r+='<li class="textcomplete-item" data-index="'+o+'"><a>',r+=t.strategy.template(t.value,t.term),r+="</a></li>");return r},_renderHeader:function(t){if(this.header){this._$header||(this._$header=e('<li class="textcomplete-header"></li>').prependTo(this.$el));var n=e.isFunction(this.header)?this.header(t):this.header;this._$header.html(n)}},_renderFooter:function(t){if(this.footer){this._$footer||(this._$footer=e('<li class="textcomplete-footer"></li>').appendTo(this.$el));var n=e.isFunction(this.footer)?this.footer(t):this.footer;this._$footer.html(n)}},_renderNoResultsMessage:function(t){if(this.noResultsMessage){this._$noResultsMessage||(this._$noResultsMessage=e('<li class="textcomplete-no-results-message"></li>').appendTo(this.$el));var n=e.isFunction(this.noResultsMessage)?this.noResultsMessage(t):this.noResultsMessage;this._$noResultsMessage.html(n)}},_renderContents:function(e){this._$footer?this._$footer.before(e):this.$el.append(e)},_fitToBottom:function(){var e=n.scrollTop()+n.height(),t=this.$el.height();this.$el.position().top+t>e&&(this.completer.$iframe||this.$el.offset({top:e-t}))},_fitToRight:function(){for(var e,t=this.option.rightEdgeOffset,i=this.$el.offset().left,o=this.$el.width(),r=n.width()-t;i+o>r&&(this.$el.offset({left:i-t}),!((e=this.$el.offset().left)>=i));)i=e},_applyPlacement:function(e){return-1!==this.placement.indexOf("top")?e={top:"auto",bottom:this.$el.parent().height()-e.top+e.lineHeight,left:e.left}:(e.bottom="auto",delete e.lineHeight),-1!==this.placement.indexOf("absleft")?e.left=0:-1!==this.placement.indexOf("absright")&&(e.right=0,e.left="auto"),e}}),e.fn.textcomplete.Dropdown=t,e.extend(e.fn.textcomplete,r)}(e),function(e){"use strict";function t(t){e.extend(this,t),this.cache&&(this.search=n(this.search))}var n=function(e){var t={};return function(n,i){t[n]?i(t[n]):e.call(this,n,function(e){t[n]=(t[n]||[]).concat(e),i.apply(null,arguments)})}};t.parse=function(n,i){return e.map(n,function(e){var n=new t(e);return n.el=i.el,n.$el=i.$el,n})},e.extend(t.prototype,{match:null,replace:null,search:null,id:null,cache:!1,context:function(){return!0},index:2,template:function(e){return e},idProperty:null}),e.fn.textcomplete.Strategy=t}(e),function(e){"use strict";function t(){}var n=Date.now||function(){return(new Date).getTime()},i=function(e,t){var i,o,r,s,l,a=function(){var u=n()-s;t>u?i=setTimeout(a,t-u):(i=null,l=e.apply(r,o),r=o=null)};return function(){return r=this,o=arguments,s=n(),i||(i=setTimeout(a,t)),l}};e.extend(t.prototype,{id:null,completer:null,el:null,$el:null,option:null,initialize:function(t,n,o){this.el=t,this.$el=e(t),this.id=n.id+this.constructor.name,this.completer=n,this.option=o,this.option.debounce&&(this._onKeyup=i(this._onKeyup,this.option.debounce)),this._bindEvents()},destroy:function(){this.$el.off("."+this.id),this.$el=this.el=this.completer=null},select:function(){throw new Error("Not implemented")},getCaretPosition:function(){var t=this._getCaretRelativePosition(),n=this.$el.offset(),i=this.option.appendTo;if(i){i instanceof e||(i=e(i));var o=i.offsetParent().offset();n.top-=o.top,n.left-=o.left}return t.top+=n.top,t.left+=n.left,t},focus:function(){this.$el.focus()},_bindEvents:function(){this.$el.on("keyup."+this.id,e.proxy(this._onKeyup,this))},_onKeyup:function(e){this._skipSearch(e)||this.completer.trigger(this.getTextFromHeadToCaret(),!0)},_skipSearch:function(e){switch(e.keyCode){case 9:case 13:case 16:case 17:case 18:case 33:case 34:case 40:case 38:case 27:return!0}if(e.ctrlKey)switch(e.keyCode){case 78:case 80:return!0}}}),e.fn.textcomplete.Adapter=t}(e),function(e){"use strict";function t(e,t,n){this.initialize(e,t,n)}e.extend(t.prototype,e.fn.textcomplete.Adapter.prototype,{select:function(t,n,i){var o,r=this.getTextFromHeadToCaret(),s=this.el.value.substring(this.el.selectionEnd),l=n.replace(t,i);void 0!==l&&(e.isArray(l)&&(s=l[1]+s,l=l[0]),o=e.isFunction(n.match)?n.match(r):n.match,r=r.replace(o,l),this.$el.val(r+s),this.el.selectionStart=this.el.selectionEnd=r.length)},getTextFromHeadToCaret:function(){return this.el.value.substring(0,this.el.selectionEnd)},_getCaretRelativePosition:function(){var t=e.fn.textcomplete.getCaretCoordinates(this.el,this.el.selectionStart);return{top:t.top+this._calculateLineHeight()-this.$el.scrollTop(),left:t.left-this.$el.scrollLeft(),lineHeight:this._calculateLineHeight()}},_calculateLineHeight:function(){var e=parseInt(this.$el.css("line-height"),10);if(isNaN(e)){var t=this.el.parentNode,n=document.createElement(this.el.nodeName),i=this.el.style;n.setAttribute("style","margin:0px;padding:0px;font-family:"+i.fontFamily+";font-size:"+i.fontSize),n.innerHTML="test",t.appendChild(n),e=n.clientHeight,t.removeChild(n)}return e}}),e.fn.textcomplete.Textarea=t}(e),function(e){"use strict";function t(t,i,o){this.initialize(t,i,o),e("<span>"+n+"</span>").css({position:"absolute",top:-9999,left:-9999}).insertBefore(t)}var n="吶";e.extend(t.prototype,e.fn.textcomplete.Textarea.prototype,{select:function(t,n,i){var o,r=this.getTextFromHeadToCaret(),s=this.el.value.substring(r.length),l=n.replace(t,i);if(void 0!==l){e.isArray(l)&&(s=l[1]+s,l=l[0]),o=e.isFunction(n.match)?n.match(r):n.match,r=r.replace(o,l),this.$el.val(r+s),this.el.focus();var a=this.el.createTextRange();a.collapse(!0),a.moveEnd("character",r.length),a.moveStart("character",r.length),a.select()}},getTextFromHeadToCaret:function(){this.el.focus();var e=document.selection.createRange();e.moveStart("character",-this.el.value.length);var t=e.text.split(n);return 1===t.length?t[0]:t[1]}}),e.fn.textcomplete.IETextarea=t}(e),function(e){"use strict";function t(e,t,n){this.initialize(e,t,n)}e.extend(t.prototype,e.fn.textcomplete.Adapter.prototype,{select:function(t,n,i){var o=this.getTextFromHeadToCaret(),r=this.el.ownerDocument.getSelection(),s=r.getRangeAt(0),l=s.cloneRange();l.selectNodeContents(s.startContainer);var a,u=l.toString(),d=u.substring(s.startOffset),c=n.replace(t,i);if(void 0!==c){e.isArray(c)&&(d=c[1]+d,c=c[0]),a=e.isFunction(n.match)?n.match(o):n.match,o=o.replace(a,c).replace(/ $/,"&nbsp"),s.selectNodeContents(s.startContainer),s.deleteContents();var h=this.el.ownerDocument.createElement("div");h.innerHTML=o;var p=this.el.ownerDocument.createElement("div");p.innerHTML=d;for(var f,g,m=this.el.ownerDocument.createDocumentFragment();f=h.firstChild;)g=m.appendChild(f);for(;f=p.firstChild;)m.appendChild(f);s.insertNode(m),s.setStartAfter(g),s.collapse(!0),r.removeAllRanges(),r.addRange(s)}},_getCaretRelativePosition:function(){var t=this.el.ownerDocument.getSelection().getRangeAt(0).cloneRange(),n=t.endContainer.parentNode,i=this.el.ownerDocument.createElement("span");t.insertNode(i),t.selectNodeContents(i),t.deleteContents(),setTimeout(function(){n.normalize()},0);var o=e(i),r=o.offset();if(r.left-=this.$el.offset().left,r.top+=o.height()-this.$el.offset().top,r.lineHeight=o.height(),this.completer.$iframe){var s=this.completer.$iframe.offset();r.top+=s.top,r.left+=s.left,r.top-=e(this.completer.$iframe[0].contentWindow.document).scrollTop()}return o.remove(),r},getTextFromHeadToCaret:function(){var e=this.el.ownerDocument.getSelection().getRangeAt(0),t=e.cloneRange();return t.selectNodeContents(e.startContainer),t.toString().substring(0,e.startOffset)}}),e.fn.textcomplete.ContentEditable=t}(e),function(e){"use strict";function t(e,t,n){this.initialize(e,t,n)}e.extend(t.prototype,e.fn.textcomplete.ContentEditable.prototype,{_bindEvents:function(){var t=this;this.option.ckeditor_instance.on("key",function(e){var n=e.data;return t._onKeyup(n),(!t.completer.dropdown.shown||!t._skipSearch(n))&&void 0},null,null,1),this.$el.on("keyup."+this.id,e.proxy(this._onKeyup,this))}}),e.fn.textcomplete.CKEditor=t}(e),function(e){function t(e,t,r){if(!i)throw new Error("textarea-caret-position#getCaretCoordinates should only be called in a browser");var s=r&&r.debug||!1;if(s){var l=document.querySelector("#input-textarea-caret-position-mirror-div");l&&l.parentNode.removeChild(l)}var a=document.createElement("div");a.id="input-textarea-caret-position-mirror-div",document.body.appendChild(a);var u=a.style,d=window.getComputedStyle?getComputedStyle(e):e.currentStyle;u.whiteSpace="pre-wrap","INPUT"!==e.nodeName&&(u.wordWrap="break-word"),u.position="absolute",s||(u.visibility="hidden"),n.forEach(function(e){u[e]=d[e]}),o?e.scrollHeight>parseInt(d.height)&&(u.overflowY="scroll"):u.overflow="hidden",a.textContent=e.value.substring(0,t),"INPUT"===e.nodeName&&(a.textContent=a.textContent.replace(/\s/g," "));var c=document.createElement("span");c.textContent=e.value.substring(t)||".",a.appendChild(c);var h={top:c.offsetTop+parseInt(d.borderTopWidth),left:c.offsetLeft+parseInt(d.borderLeftWidth)};return s?c.style.backgroundColor="#aaa":document.body.removeChild(a),h}var n=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],i="undefined"!=typeof window,o=i&&null!=window.mozInnerScreenX;e.fn.textcomplete.getCaretCoordinates=t}(e),e}),define("starc/starc.textareas.completion",["require","exports","module","underscore","utils/coggle-encodeji","twemoji","views/NodeEditView","jquery.textcomplete","env"],function(e,t,n){var i=e("underscore"),o=e("utils/coggle-encodeji"),r=e("twemoji"),s=e("views/NodeEditView");e("jquery.textcomplete"),n.exports=function(t){function n(e,n){n(t.model.getAccess().search(e).concat(t.model.getInvites().search(e)))}function l(e){var t=e.toJSON();return t.name=e.displayName(),t.picture||(t.picture=""),f(t)}function a(e){return $(this.el).trigger("picked-user",e),"$1@"+e.displayName().replace(/\s/g,"")+" "}function u(e,t){t(i.uniq(i.map(o.possibleShortNames(e).slice(0,200),o.primaryShortName.bind(o))))}function d(t){var n=o.primaryShortName(t),i=o.replaceColons(":"+n+":"),s=$(r.parse(i,{base:e("env").cdn.url+"/img/",ext:".svg",folder:"twe"})).attr("src");return g({value:t,encoded:i,primary_name:n,icon:s})}function c(e){return"$1:"+o.primaryShortName(e)+":"}var h=/((?:^|\s)(?::[^:]{0,80}:)*):([^:]{0,80})$/,p={maxCount:30,height:"auto"};p.onKeydown=function(e,t){if(13===e.keyCode||9===e.keyCode)return e.stopPropagation(),e.preventDefault(),t.KEY_ENTER},p.listPosition=function(e){var t="absolute";return this.$inputEl.add(this.$inputEl.parents()).each(function(){return"absolute"!==$(this).css("position")&&("fixed"===$(this).css("position")?(e.top-=$(window).scrollTop(),e.left-=$(window).scrollLeft(),t="fixed",!1):void 0)}),this.$el.css(this._applyPlacement(e)),this.$el.css({position:t}),this.$el.css("height","auto"),this};var f=i.template("<div>            <span class='icon' style='background-image: url(<%-picture%>); background-color:<%-colour%>'/>            <span class='name'><%-name%></span>            <span class='email'><%-email%></span>        </div>"),g=i.template("<div>        <img class='twemoji' draggable='false' alt='<%-encoded%>' src='<%-icon%>'/>        <span class='emojiname'>:<%-value%>:</span>        </div>"),m={match:/(^|\s)@(\w{1,})$/,search:n,replace:a,template:l,name:"people"},v={match:h,search:u,replace:c,template:d,name:"emoji"},y=function(e){var t=s.activeEdit(),n=t.$el.find("textarea");p.appendTo=t.$el,n.textcomplete([m,v],p)},b=function(e){var t=$(e.currentTarget),n=t.find("textarea");p.appendTo=t,n.textcomplete([m,v],p)};t.on("node:editor:opened",y),$("body").on("focus",".notification-creation",b),t.once("remove",function(){t.off(void 0,y),$("body").off("focus",b)})}}),define("starc/starc.usercolours",["require","exports","module","underscore"],function(e,t,n){function i(e,t){e.each(function(){var e,n,i=$(this),o=i.text().trim();for(e=0;e<t.length;e++)if(o.toLowerCase()===t[e].get("email"))return void i.attr("data-uid",t[e].get("_id"));for(e=0;e<t.length;e++)if((n=t[e].get("name"))&&o===n)return void i.attr("data-uid",t[e].get("_id"));for(e=0;e<t.length;e++)if((n=t[e].get("name"))&&o.toLowerCase().replace(/\s/g,"")===n.toLowerCase().replace(/\s/g,""))return void i.attr("data-uid",t[e].get("_id"))})}function o(e,t,n){var i=n.property||"color";e.each(function(){for(var e=$(this).attr("data-uid"),n=0;n<t.length;n++)if(t[n].get("_id")==e)return void $(this).css(i,t[n].get("colour"))})}var r=e("underscore");n.exports=function(e){var t=r.debounce(function(){var t=e.model.getAccess().toArray().concat(e.model.getInvites().toArray()),n=$("a.at-tagged"),r=$(".node-container.titleroot a.at-tagged");i(n,t),o(n.not(r),t,{property:"background-color"}),o(r,t,{property:"color"})},300);e.once("loaded",function(){t(),e.model.getNodes().on("add change:text",t),e.model.getInvites().on("sync",t),e.model.getAccess().on("sync",t),e.model.getNotifications().on("sync",t),e.once("remove",function(){e.model.getNodes().off(void 0,t),e.model.getInvites().off(void 0,t),e.model.getAccess().off(void 0,t),e.model.getNotifications().off(void 0,t)})})}}),define("starc/starc.controlpoints",["require","exports","module","underscore","utils/trackModifiers","views/ControlPoint"],function(e,t,n){var i=e("underscore"),o=e("utils/trackModifiers"),r=e("views/ControlPoint"),s=Math.max(241,500),l=function(e,t){var n=function(e){return(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)},i=null,o=null;e.model.getNodes().each(function(t){if(n({x:t.x(),y:t.y()})<1e6){var s=n({x:t.x(),y:t.y()});(null===o||s<o)&&(i=t,o=s);var l=t.parent();if(l){var a=l.x(),u=l.y();l.ltr();t.controlPoints().concat(r.virtualControlPoints(t,e)).forEach(function(e){var r=n({x:a+e.x,y:u+e.y});r<o&&(i=t,o=r)})}}}),null!==i&&o<16e4&&r.showFor(e,i)};n.exports=function(e){if(r.enabled){var t={};e.on("node:editor:opened",function(t){e.editingPrevented()||r.showFor(e,t)},t),e.on("mode",function(){e.editingPrevented()&&r.remove()},t),e.$el.on("touchend","svg",function(t){if(!e.editingPrevented()&&$(t.target).is("svg")){var n=e.diagramCoordsFromEvent(t);n.failed||l(e,n)}});var n=i.debounce(function(){r.fadeOut()},s),a=null,u=i.debounce(function(){e.editingPrevented()||(a&&l(e,a),n())},120);e.$el.on("mousemove",function(t){if(!e.editingPrevented()){if($(t.target).is("svg")){var n=e.diagramCoordsFromEvent(t);n.failed||(a=n)}u()}}),e.$el.on("tap","path",function(t){if(!e.editingPrevented()){var n=e.getNodeForId($(t.currentTarget).closest("[data-nodeid]").attr("data-nodeid"));if(n){r.showFor(e,n.model);var i=n.model.controlPoints().length;if(o.alt_key_pressed&&i<r.Max_Control_Points){if(i>0&&!getCoggleUser().isAwesome()&&"free"===e.model.myEditing)return r.pitch();t.stopImmediatePropagation();var s=n.connection.addCPAt(e.diagramCoordsFromEvent(t));return getCoggleUser().getActions().unique("controlpoint:create"),e.trigger("cp:create",n.model,s),!1}}}}),e.$el.on("tap",".controlpoint",function(t){if(!e.editingPrevented()){var n=$(t.target),i=e.getNodeForId(n.parent().attr("data-nodeid"));if(!o.shift_key_pressed&&!o.control_key_pressed){var s=n.attr("data-cpid");i&&(e.trigger("cp:remove",i.model,s),i.model.removeCP(s),i.model.deltarize(),r.showFor(e,i.model),getCoggleUser().getActions().unique("controlpoint:delete"))}}}),e.on("remove",function(){e.off(null,null,t)},t)}}}),define("starc/starc.doubletap",["require","exports","module","utils/trackModifiers"],function(e,t,n){var i=e("utils/trackModifiers");n.exports=function(e){function t(e){var t=e.timeStamp,n=o||t,i=t-n,r=e.originalEvent.touches.length;o=t,!i||i>500||r>1||e.preventDefault()}function n(t){if(!e.editingPrevented()){var n=getCoggleUser();if(i.shift_key_pressed)var o=e.createNodeAt(e.diagramCoordsFromEvent(t),function(){o&&o.editNode()});else e.createRoot({pos:e.diagramCoordsFromEvent(t)}).editNode({deleteEmpty:!0});n.getActions().perform("background:add-node",{type:i.shift_key_pressed?"child":"label"})}}var o;e.scrollContainer().bind("touchstart",t),e.$el.on("doubletap","svg",n)}}),define("starc/starc.cogglify",["require","exports","module","underscore","utils/textsize","env"],function(e,t,n){function i(e,t){var n=/^\[([^\]]+)\]\(([^)]+)\)$/.exec(e);return n&&(e=n[1]),"["+e+"]("+t+")"}function o(e,t,n){$(window).trigger("notify-error","Failed to create linked Coggle: "+t)}function r(e){var t,n=new RegExp("attached:/?/?([a-z0-9]*)","gi"),i={};do{(t=n.exec(e))&&(i[t[1]]=1)}while(t);return i}function s(e,t,n,i,o){var a=[];e.model.get("node_id");return l.each(e.children(),function(e){var i=new $.Deferred,d=e.model.attachments(),c=e.model.text();l.extend(o.copy_attachments,d,r(c)),$.ajax({type:"POST",url:u+"diagrams/"+n+"/nodes",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({text:c,width:e.model.width(),text_size:e.model.textSize(),offset:{x:e.model.pos().x,y:e.model.pos().y},parent:t,colour:e.model.colour(),line_weight:e.model.get("line_weight")||null,line_style:e.model.get("line_style")||null,line_shape:e.model.get("line_shape")||null,shape:e.model.get("shape")||null,control_points:e.model.get("control_points")||{},attachments:d})}).then(function(t){s(e,t._id,n,!1,o).then(i.resolve,i.reject)},function(e,t,n){i.reject(JSON.parse(e.responseText))}),a.push(i)}),$.when.apply($,a)}var l=e("underscore"),a=e("utils/textsize"),u=e("env").api.url+"/api/1/";n.exports=function(e){e.prototype.cogglify=function(e,t){var n=window.location,r=n.origin||n.protocol+"//"+n.hostname+(n.port?":"+n.port:""),d=r+"/diagram/",c=this,h=/diagram\/[^\/]+\/t\/[^\/]*\/([^/#]+)/.exec(n.pathname);h&&(h=h[1]);var p=e.displayedText(),f=e.model.text(),g=t;$.ajax({type:"POST",url:u+"diagrams/"+c.model.get("_id")+"?clone[]=folder&clone[]=acl"}).fail(o).done(function(t,m,v){
var y=d+t.short_id,b={copy_attachments:{}};$.ajax({type:"GET",url:u+"diagrams/"+t._id+"/nodes",contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(d){var m=i(p||"Unnamed Coggle",r+n.pathname+"#"+e.model.get("node_id").slice(0,6)),v={text:m,colour:e.model.colour()};e.model.width()&&(v.width=e.model.width()*(a.textSizeForLevel(0)/e.model.textSize())),e.model.shape()&&(v.shape=e.model.shape()),$.ajax({type:"PUT",url:u+"diagrams/"+t._id+"/nodes/"+d[0]._id,contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify(v)}).fail(o),$.ajax({type:"PUT",url:u+"diagrams/"+t._id,contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({title:m})}).fail(o),s(e,d[0]._id,t._id,!0,b).done(function(){function n(){e.model.set("text",i(f,y)),e.model.deltarize({text:e.model.text()}),g&&l.each(e.children(),function(e){e.deleteNode()})}h?$.ajax({type:"POST",url:u+"diagrams/"+t._id+"/links",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({type:"cogglify"})}).fail(function(e,t,i){o(e,t,i),n()}).done(function(e){y+="/"+e.key,n()}):n();var r=0,s=u+"diagrams/"+c.model.get("_id")+"/attachments/clone?to_diagram="+t._id;for(var a in b.copy_attachments)b.copy_attachments.hasOwnProperty(a)&&(s+="&copy_ids[]="+a,r+=1);r>0&&(console.log("copying "+r+" attachments"),$.ajax({type:"POST",url:s,contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({})}).fail(function(e,t,n){o(e,t,n)}))}).fail(function(e){console.error("copy failed :(",e),$(window).trigger("notify-error","Failed to create linked Coggle: "+e)})}).fail(o)})}}}),define("starc/starc.undo",["require","exports","module","underscore"],function(e,t,n){var i=e("underscore");n.exports=function(e){e.prototype.disableUndo=function(){this._undo_disabled=!0},e.prototype.enableUndo=function(){this._undo_disabled=!1},e.prototype.undoDisabled=function(){return this._undo_disabled},e.prototype.pushUndo=function(e,t){t||(this.redo_stack=[]),e._undo_ts=new Date,this.undo_stack.push(e)},e.prototype.pushUndoMarker=function(e){this.undo_stack.push({_undo_ts:new Date,marker:!0})},e.prototype.pushRedo=function(e){e._undo_ts=new Date,this.redo_stack.push(e)},e.prototype.hasUndoStep=function(){return 0!==this.undo_stack.length},e.prototype.undoStep=function(){if(0!==this.undo_stack.length){this.trigger("undo");var e=this.undo_stack;for(this.disableUndo();;){var t=e.pop();if(this.undo(t),this.pushRedo(i.clone(t)),0===e.length)break;var n=e[e.length-1];if(t._undo_ts.getTime()-n._undo_ts.getTime()>125||t.marker)break}this.enableUndo()}},e.prototype.hasRedoStep=function(){return 0!==this.redo_stack.length},e.prototype.redoStep=function(){if(0!==this.redo_stack.length){this.trigger("redo");var e=this.redo_stack;for(this.disableUndo();;){var t=e.pop();if(this.redo(t),this.pushUndo(i.clone(t),!0),0===e.length)break;var n=e[e.length-1];if(t._undo_ts.getTime()-n._undo_ts.getTime()>125||t.marker)break}this.enableUndo()}},e.prototype.undo=function(e){if(!e.marker)if(null===e.new_state)if("root parent"===e.old_state.parent_id)this.model.getNodes().addRoot(e.old_state);else{var t=this.getNodeForId(e.old_state.parent_id);if(!t)return console.warn("parent view missing during undo operation",e.old_state.parent_id);t.addChild(e.old_state)}else if(null===e.old_state){var n=this.getNodeForId(e.node_id);if(!n)return console.warn("node view missing during undo operation",e.node_id);n.deleteNode()}else{var i=this.model.getNodes().get(e.node_id);if(!i)return console.error("cannot undo change to now-deleted node",e.node_id);i.deltarize(e.old_state)}},e.prototype.redo=function(e){if(!e.marker)if(null===e.new_state){var t=this.getNodeForId(e.node_id);if(!t)return console.warn("node view missing during undo operation",e.node_id);t.deleteNode()}else if(null===e.old_state)if("root parent"===e.new_state.parent_id)this.model.getNodes().addRoot(e.new_state);else{var n=this.getNodeForId(e.new_state.parent_id);if(!n)return console.warn("parent view missing during undo operation",e.new_state.parent_id);n.addChild(e.new_state)}else{var i=this.model.getNodes().get(e.node_id);if(!i)return console.error("cannot redo change to now-deleted node",e.node_id);i.deltarize(e.new_state)}},e.prototype.enableUndoRedo=function(){this.undo_stack=[],this.redo_stack=[];var e=this.model.getNodes(),t=function(e,t,n){this.undoDisabled()||this.editingPrevented()||this.pushUndo({node_id:e.id,old_state:n,new_state:t})}.bind(this),n=function(e){this.undoDisabled()||this.editingPrevented()||this.pushUndo({node_id:e.id,old_state:null,new_state:i.clone(e.attributes)})}.bind(this),o=function(e){this.undoDisabled()||this.editingPrevented()||this.pushUndo({node_id:e.id,old_state:i.clone(e.attributes),new_state:null})}.bind(this);e.on("delta",t,this),e.on("node_added",n,this),e.on("node_deleted",o,this),this.on("remove",function(){e.off("delta",t),e.off("node_added",n),e.off("node_deleted",o),e.off(void 0,void 0,this)}.bind(this))}}}),define("starc/starc",["require","exports","module","underscore","tinytinycolor","utils/coggle-encodeji","utils/marked","utils/coordsFromEvent","views/PitchView","jquery","twemoji","utils/queryString","jquery.scrollTo","plugins/jquery.fullscreen","starc/starc.node","views/NodeTextView","views/NodeEditView","utils/trackModifiers","views/shapes","models/Node","./starc.zoomController","./starc.keyboardShortcuts","./starc.pointergestures","starc/starc.import","./starc.new-menu.background","./starc.new-menu.node","./starc.menu.colour","./starc.contentcallouts","./starc.node.buttons","./starc.node.blame","./starc.node.editevents","./starc.node.tabfocus","./starc.node.crosslinks","./starc.bounds.scroll","./starc.bounds.drag","./starc.textareas.completion","./starc.usercolours","./starc.controlpoints","./starc.doubletap","./starc.cogglify","./starc.undo"],function(e,t,n){function i(e){o.bindAll(this,"getSizeOfHtml","getSizeOfNode","getSizeOfContent","scrollToFragment"),this.$el=u(y),this.scroll_target=e.scroll_target,this.model=e.model,this._writable=void 0,this.setReadOnly(!!e.readOnly),this._historyMode=!1,this._presentationMode=!1,this._growingPreventedBy=[],this.nodes={},this.scale=1,this.min_zoom=v,this._size={x1:0,y1:0,x2:0,y2:0},this.enableControlPoints(),this.enableImports(),this.enableBackgroundMenu(),this.enableNodeMenus(),this.enableColourMenus(),this.enableUndoRedo(),this.enableGestures(),this.enableLinkCallouts(),e.readOnly||this.enableDoubleTapCreate(),this.enableBlame(),this.enableCrosslinkUpdates(),this.enableNodeEditing(),this.enableTextCompletion(),this.enableUserColourTagging(),this.model.getNodes().once("loaded",function(){this.loadNodes();var e=o.throttle(this.growSizeToContent.bind(this),50);this.model.getNodes().on("add change",e),this.growSizeToContent(),this.setInitialScroll(),window.addEventListener("hashchange",this.scrollToFragment),window.Coggle_App_Main&&this.listenToVVChanges(),this.trigger("scale",1),this.trigger("loaded")}.bind(this)),window._diagram=this}var o=e("underscore"),r=e("tinytinycolor"),s=e("utils/coggle-encodeji"),l=e("utils/marked"),a=e("utils/coordsFromEvent")("pageX","pageY"),u=(e("views/PitchView"),e("jquery")),d=e("twemoji"),c=e("utils/queryString");e("jquery.scrollTo"),e("plugins/jquery.fullscreen");var h=e("starc/starc.node"),p=e("views/NodeTextView"),f=e("views/NodeEditView"),g=(e("utils/trackModifiers"),e("views/shapes")),m=(e("models/Node").textSizeFromLevel,"http://www.w3.org/2000/svg"),v=.125,y="<div class='diagram-editor' role='main'>    <div class='nodes'></div></div>";o.extend(i.prototype,Backbone.Events),i.prototype.nodesContainer=function(){return this._nodesContainer||(this._nodesContainer=this.$el.find(".nodes")),this._nodesContainer},i.prototype.nodesContainerPos=function(){return{left:-this._size.x1,top:-this._size.y1}},i.prototype.scrollContainer=function(){return this.scroll_target||u(window)},i.prototype.getPaper=function(){if(!this.paper){var e=u('<svg version="1.1"  xmlns="'+m+'" xmlns:xlink="http://www.w3.org/1999/xlink"preserveAspectRatio="xMinYMin" style="overflow: hidden; position: relative;">');this.$el.append(e),this.paper=e[0]}return this.paper},i.prototype.setDiagramSize=function(e,t,n,i){var o=n-e,r=i-t,s=this._size;if(e!=s.x1||t!=s.y1||n!=s.x2||i!=s.y2){var l,a;e!=s.x1&&(l=this.scrollContainer().scrollLeft()),t!=s.y1&&(a=this.scrollContainer().scrollTop()),this.$el.css({width:o,height:r}),this.nodesContainer().css({left:-e,top:-t});var u=[e,t,n-e,i-t].join(" "),d=this.getPaper();if(d.setAttribute("viewBox",u),d.setAttribute("width",o),d.setAttribute("height",r),!this.likelyInAutoScroll()){if(e!=s.x1){var c=l+Math.round((s.x1-e)*this.getScale());this.scrollContainer().scrollLeft(c)}if(t!=s.y1){var h=a+Math.round((s.y1-t)*this.getScale());this.scrollContainer().scrollTop(h)}}this._size.x1=e,this._size.y1=t,this._size.x2=n,this._size.y2=i,this.trigger("resize")}};var b=function(e,t){var n;e<0?(e=-e,n=-1):n=1;var i=e%t;return i<.5*t?n*(e-i):n*(e+t-i)};i.prototype.growSizeToContent=function(e){if(this._growingPreventedBy.length&&(!e||!e.do_not_defer))return void(this._growDeferred=!0);this._growDeferred=!1;var t=Math.max(200,.5*window.innerWidth/v),n=Math.max(200,.5*window.innerHeight/v),i=this.getFastBoundingRect(0);i.xmin=Math.round(b(i.xmin-t,8)),i.ymin=Math.round(b(i.ymin-n,8)),i.xmax=Math.round(b(i.xmax+t,8)),i.ymax=Math.round(b(i.ymax+n,8)),this.setDiagramSize(i.xmin,i.ymin,i.xmax,i.ymax)},i.prototype.suspendAutoGrow=function(e,t){t||(t="unknown"),window._debug_autogrow&&console.log("suspend autogrow "+e+" "+t);var n=this._growingPreventedBy.length,i=this._growingPreventedBy.indexOf(t);e&&-1===i?this._growingPreventedBy.push(t):e||-1===i||this._growingPreventedBy.splice(i,1),this._growDeferred&&n&&!this._growingPreventedBy.length&&(window._debug_autogrow&&console.log("auto-grow suspension ended"),this.growSizeToContent())},i.prototype.listenToVVChanges=function(){if(!this._vvChangeHandler&&window.visualViewport&&window.visualViewport.addEventListener){var e=0,t=function(){(e-=1)<=0&&this.suspendAutoGrow(!1,"vv-changes")}.bind(this);this._vvChangeHandler=function(n){e+=1,1===e&&this.suspendAutoGrow(!0,"vv-changes"),setTimeout(t,window._debug_vv_delays_autogrow_by||1500)}.bind(this),window.visualViewport.addEventListener("scroll",this._vvChangeHandler,{passive:!0}),window.visualViewport.addEventListener("resize",this._vvChangeHandler,{passive:!0})}},i.prototype.stopListeningToVVChanges=function(){this._vvChangeHandler&&window.visualViewport&&window.visualViewport.removeEventListener&&(window.visualViewport.removeEventListener("scroll",this._vvChangeHandler),window.visualViewport.removeEventListener("resize",this._vvChangeHandler))},i.prototype.remove=function(){this.trigger("remove"),u(window).off(".starcDiagram"),window.removeEventListener("hashchange",this.scrollToFragment),f.activeEdit()&&f.activeEdit().cancel(),this.stopListeningToVVChanges(),this.model.getNodes().off(void 0,void 0,this),this.model.off(void 0,void 0,this),o.values(this.nodes).map(function(e){e.remove()}),this.nodes={},this.off(),window._diagram===this&&(window._diagram=void 0)},i.prototype.enableZoomShortcuts=function(){e("./starc.zoomController")(this)},i.prototype.enableKeyboardShortcuts=function(){e("./starc.keyboardShortcuts")(this)},i.prototype.enableGestures=function(){e("./starc.pointergestures")(this)},i.prototype.enableImports=function(){e("starc/starc.import")(this)},i.prototype.enableBackgroundMenu=function(){e("./starc.new-menu.background")(this)},i.prototype.enableNodeMenus=function(){e("./starc.new-menu.node")(this)},i.prototype.enableColourMenus=function(){e("./starc.menu.colour")(this)},i.prototype.enableLinkCallouts=function(){e("./starc.contentcallouts")(this)},i.prototype.enableNodeButtons=function(){e("./starc.node.buttons")(this)},i.prototype.enableBlame=function(){e("./starc.node.blame")(this)},i.prototype.enableNodeEditing=function(){e("./starc.node.editevents")(this)},i.prototype.enableTabFocus=function(){e("./starc.node.tabfocus")(this)},i.prototype.enableCrosslinkUpdates=function(){e("./starc.node.crosslinks")(this)},i.prototype.enableScrollBounding=function(){e("./starc.bounds.scroll")(this)},i.prototype.enableBoundaryDragScrolling=function(){e("./starc.bounds.drag")(this)},i.prototype.enableTextCompletion=function(){e("./starc.textareas.completion")(this)},i.prototype.enableUserColourTagging=function(){e("./starc.usercolours")(this)},i.prototype.enableControlPoints=function(){e("./starc.controlpoints")(this)},i.prototype.enableDoubleTapCreate=function(){e("./starc.doubletap")(this)},i.prototype.getScale=function(){return this.scale},i.prototype.setScale=function(e,t){e<1.02&&e>.98&&(e=1),e>2&&(e=2),e<this.min_zoom&&(e=this.min_zoom);var n=this.getScale(),i=this.scrollContainer(),o=i.scrollLeft(),r=i.scrollTop();t||(t=this.diagramCoordsFromEvent({pageX:window.innerWidth/2,pageY:window.innerHeight/2})),this._setScale(e);var s=this._size.x1,l=this._size.y1,a=Math.round(o+(t.x-s)*(e-n)),u=Math.round(r+(t.y-l)*(e-n));i.scrollLeft(a),i.scrollTop(u),this.trigger("scale",e)},i.prototype._setScale=function(e){var t=this.getScale();this.scale!==e&&(this.scale=e,this.$el[0].style.transformOrigin="0 0",this.$el[0].style.transform="scale("+e+")",t<.8!=e<.8&&this.$el.css({"-webkit-font-smoothing":e<.8?"antialiased":"subpixel-antialiased"}))},i.prototype.startScalingAround=function(e){e||(e=this.diagramCoordsFromEvent({pageX:window.innerWidth/2,pageY:window.innerHeight/2}));var t=this.scrollContainer();this._scale_session={original_scale:this.getScale(),original_scroll:{l:t.scrollLeft(),t:t.scrollTop()},around:e,tx:0,ty:0}},i.prototype.updateScaling=function(e,t){if(this._scale_session&&(e<1.02&&e>.98&&(e=1),e>2&&(e=2),e<this.min_zoom&&(e=this.min_zoom),e!==this.scale||t&&(t.x!==this._scale_session.tx||t.y!==this._scale_session.ty))){var n=this._scale_session.original_scale,i=this._scale_session.original_scroll.l,o=this._scale_session.original_scroll.t,r=this._scale_session.around;this._setScale(e);var s=this._size.x1,l=this._size.y1,a=t&&t.x||0,u=t&&t.y||0,d=Math.round(i+(r.x-s)*(e-n)+a),c=Math.round(o+(r.y-l)*(e-n)+u);this.scrollContainer().scrollLeft(d),this.scrollContainer().scrollTop(c),this._scale_session.tx=a,this._scale_session.ty=u,this.trigger("scale",e)}},i.prototype.endScaling=function(){this._scale_session=null},i.prototype.getSizeOfHtml=function(e,t,n){if(!this.sizingContainer){var i=u(p.nodeTemplate());i.addClass("sizing-container"),i.css({left:-1e4,top:-1e4,visibility:"hidden"}),this.nodesContainer().append(i);var o=i.find(".node-content");this.sizingContainer=o[0]}var r=this.sizingContainer;return r.innerHTML=e,n&&s.parse(r),null!==t.width&&void 0!==t.width?(r.style.width=t.width+"px",r.style.whiteSpace=""):(r.style.width="auto",r.style.whiteSpace="nowrap"),r.style.fontSize=t["font-size"],{w:r.offsetWidth,h:r.offsetHeight}},i.prototype.getSizeOfNode=function(e){var t=e.text(),n=e.attachmentIds();t||(t=n.length?"":p.emptyNodeContentFor(e,!0));var i=this.getSizeOfContent(t,e.textSize(),e.width());n.length&&(i.h+=e.attachmentIds().length*(2+.8*e.textSize())),i.w=Math.max(i.w,e.get("width"));var o=e.shape();if(o){var r=g.padding(o,i);i.w+=r.w,i.h+=r.h}return i};var w=new l.NoImages;i.prototype.getSizeOfContent=function(e,t,n){var i=s.replaceColons(e||""),o=i!==e||!!d.test(i);return this.getSizeOfHtml(l(i,{renderer:w}),{"font-size":t+"px",width:n},o)},i.prototype.viewportBounds=function(e){e||(e=0);var t=this.diagramCoordsFromEvent({pageX:-e,pageY:-e}),n=this.diagramCoordsFromEvent({pageX:window.innerWidth+e,pageY:window.innerHeight+e});return{top:t.y,left:t.x,right:n.x,bottom:n.y}},i.prototype.documentCoordsFromEvent=function(e){var t=a(e);return t||(console.warn("failed to get page coords from",e,t),{x:0,y:0,failed:!0})},i.prototype.diagramCoordsFromEvent=function(e){var t=this.documentCoordsFromEvent(e),n=this.scrollContainer();if(n[0]!==window){t.x=n.scrollLeft()+t.x,t.y=n.scrollTop()+t.y;var i=n.offset();i&&(t.x-=i.left,t.y-=i.top)}return t.x=t.x/this.getScale()+this._size.x1,t.y=t.y/this.getScale()+this._size.y1,t},i.prototype.createNodeAt=function(e,t){if(!this.editingPrevented()){var n=this.model.getNodes().closest(e.x,e.y);if(n){var i=this.getNodeForId(n.id);if(i){var o=i.addChild();return o.model.positionAbsolutely(e.x,e.y),o.model.deltarize(),t&&"function"==typeof t&&o.animate(t),o}}}};var _=function(e){if(0!==e.length)return 1==e.length?e[0]:(e.sort(function(e,t){return e-t}),e[Math.floor(e.length/2)])};i.prototype.createRoot=function(e){if(!this.editingPrevented()){var t={root:.1},n={null:.1},i=[];e.shape&&e.text_alignment&&e.text_size||this.rootNodes().forEach(function(e){var o=e.model.shape();t[o]?t[o]+=1:t[o]=1;var r=e.model.textAlignment()||"null";n[r]?n[r]+=1:n[r]=1,i.push(e.model.textSize())}),e.shape||(e.shape=o.max(o.keys(t),function(e){return t[e]})),e.text_alignment||(e.text_alignment=o.max(o.keys(n),function(e){return n[e]}),"null"===e.text_alignment&&(e.text_alignment=null)),e.text_size||(e.text_size=_(i));var r=this.model.getNodes().addRoot(e),s=this.nodes[r.id];return this.trigger("node_added",s),s}},i.prototype.setViewBoxToContent=function(e){this.suspendAutoGrow(!0,"print-viewbox"),void 0===e&&(e=120);var t=this.getSVGContentsBoundingRect(e),n=t.xmax-t.xmin,i=t.ymax-t.ymin;this.getPaper().setAttribute("height",i),this.getPaper().setAttribute("width",n),this.getPaper().setAttribute("viewBox",[t.xmin,t.ymin,n,i].join(" ")),u(this.getPaper()).css({width:n,height:i,margin:0}),this.$el.css({width:n,height:i}),this.nodesContainer().css({left:-t.xmin,top:-t.ymin}),this.scrollContainer().scrollTop(0),this.scrollContainer().scrollLeft(0)},i.prototype.visitDepthFirst=function(e,t){function n(t){e(t);var i=t.children();i.sort(function(e,t){return e.y()-t.y()}),o.each(i,n)}var i=new u.Deferred;return void 0===t?o.sortBy(this.rootNodes(),function(e){return e.model.isTitle()?-1/0:e.model.y()}).forEach(function(e){n(e.model)}.bind(this)):n(t),i.resolve(),i.promise()},i.prototype.loadNodes=function(){if(!this._watching_nodes){this._watching_nodes=!0;var e=function(e){e.isRoot()?this.onRootNodeAdded(e):this.onNodeAdded(e)}.bind(this),t=function(e){var t=this.getNodeForId(e.id);t&&t.remove(),delete this.nodes[e.id]}.bind(this);this.model.getNodes().each(e),this.model.getNodes().on("add",e,this),this.model.getNodes().on("remove",t,this)}},i.toTitleText=function(e){return function(e){var t=e.clone();return t.find(".callout").remove(),t.find("img").replaceWith(function(){return u(this).attr("alt")||u(this).attr("title")}),t.find("br").replaceWith("\n"),s.replaceColons(t.text())}(u("<div>",{html:l(e||"")})).replace(/\n/g," ").replace(/^ *| *$/g,"")},i.prototype.scrollTo=function(e){var t=this.getNodeForId(e.id);t&&(t.highlight(),this.scrollContainer().scrollTo(t.getLabel().$el,{duration:500,queue:!1,hash:!1,axis:"xy",offset:{top:-this.scrollContainer().height()/2,left:-this.scrollContainer().width()/2}}))},i.prototype.scrollToFragment=function(){var e=this.model.getNodes(),t=window.location.hash&&e.matchingLink(window.location.hash.slice(1))||c().search&&e.matchingSearch(c().search);t&&this.scrollTo(t)},i.prototype.setInitialScroll=function(){this.centreInScrolledView(this.titleNode()),this.scrollToFragment()},i.prototype.setReadOnly=function(e){var t=!e;t!==this._writable&&(e?this.$el.addClass("readonly"):this.$el.removeClass("readonly"),this._writable=t,this.trigger("mode",this.mode()))},i.prototype.closestNode=function(e,t){var n=this.model.getNodes().closest(e,t);return this.getNodeForId(n.id)},i.prototype.startHistoryMode=function(){this.historyMode()||(this.$el.addClass("historymode"),this._historyMode=!0,this.trigger("mode",this.mode()))},i.prototype.stopHistoryMode=function(){this.historyMode()&&(this.$el.removeClass("historymode"),this._historyMode=!1,this.trigger("mode",this.mode()))};var x=function(e,t){return e.filter(function(e){return e.matchesLink(t)})};i.prototype.startPresentationMode=function(e){if(!this.presentationMode()){this.$el.addClass("presentationmode"),this._presentationMode=!0,e||(e={}),e.fullscreen&&u.fullscreen(!0),this._previous_present_hidden&&!e.hide&&(e.hide=this._previous_present_hidden);var t,n=this.model.getNodes();if(e&&e.hide&&e.hide.length>0)for(t=0;t<e.hide.length;t++)x(n,e.hide[t]).forEach(function(e){e.collapseAllChildren(!0),e.set("hidden",!0)});else e&&void 0!==e.expandLevel&&n.forEach(function(t){t.level()===parseInt(e.expandLevel)&&t.collapseAllChildren(!0)});this.trigger("mode",this.mode())}},i.prototype.stopPresentationMode=function(){if(this.presentationMode()){this.$el.removeClass("presentationmode"),this._presentationMode=!1;var e=this.model.getNodes();this._previous_present_hidden=e.filter(function(e){return e.get("hidden")}).map(function(e){return e.id}),e.getRoots().forEach(function(e){e.expandAllChildren(!0)}),u.fullscreen(!1),this.trigger("mode",this.mode())}},i.prototype.mode=function(){return this.presentationMode()?["presentationmode"]:this.historyMode()?["historymode"]:this.readOnly()?["readonly"]:["normal"]},i.prototype.presentationMode=function(){return this._presentationMode},i.prototype.historyMode=function(){return this._historyMode},i.prototype.readOnly=function(){return!this.model.canWrite()||!this._writable},i.prototype.editingPrevented=function(){return this.presentationMode()||this.historyMode()||this.readOnly()},i.prototype.displayHistoryModeWarning=function(){window.Messages.warning("Unable to do that at the moment! Try closing the history viewer first.","history-warning").timeout(3e3)},i.prototype.warnIfHistoryMode=function(){return!!this.historyMode()&&(this.displayHistoryModeWarning(),!0)},i.prototype.textPopupActive=function(){return!!f.activeEdit()},i.prototype.collides=function(e,t,n,i){var r=e,s=e+n,l=t-i/2,a=t+i/2;if(s<r){var u=s;s=r,r=u}for(var d=o.values(this.nodes),c=0;c<d.length;c++){var h=d[c];if(!(Math.abs(h.model.x()-e)>1600||Math.abs(h.model.y()-t)>800)){var p=h.boundingBox();if(!(s<p.x&&r<p.x||s>p.x2&&r>p.x2||a<p.y&&l<p.y||a>p.y2&&l>p.y2))return h}}return!1},i.prototype.getSVGContentsBoundingRect=function(e){e||(e=0);var t,n,i,r,s,l,a,u={xmin:null,ymin:null,xmax:null,ymax:null},d=1200;return o.map(this.nodes,function(e){e.model.x()-d>u.xmin&&e.model.x()+d<u.xmax&&e.model.y()-d>u.ymin&&e.model.y()+d<u.ymax||(t=e.boundingBox(),u.xmin=null===u.xmin||t.x<u.xmin?t.x:u.xmin,u.ymin=null===u.ymin||t.y<u.ymin?t.y:u.ymin,u.xmax=null===u.xmax||t.x2>u.xmax?t.x2:u.xmax,u.ymax=null===u.ymax||t.y2>u.ymax?t.y2:u.ymax,e.crosslinks&&o.values(e.crosslinks).map(function(e){t=e.boundingBox(),u.xmin=t.x<u.xmin?t.x:u.xmin,u.ymin=t.y<u.ymin?t.y:u.ymin,u.xmax=t.x2>u.xmax?t.x2:u.xmax,u.ymax=t.y2>u.ymax?t.y2:u.ymax}),n=e.parent(),n&&!n.model.isRoot()&&n.model.ltr()!==e.model.ltr()&&(i=e.getConnection(),t=i.boundingBox(),u.xmin=t.x<u.xmin?t.x:u.xmin,u.ymin=t.y<u.ymin?t.y:u.ymin,u.xmax=t.x2>u.xmax?t.x2:u.xmax,u.ymax=t.y2>u.ymax?t.y2:u.ymax),r=e.model.controlPoints(),r.length&&n&&(s=n.model.x(),l=n.model.y(),a=n.model.ltr(),r.forEach(function(e){u.xmin=s+e.x*a<u.xmin?s+e.x*a:u.xmin,u.ymin=l+e.y<u.ymin?l+e.y:u.ymin,u.xmax=s+e.x*a>u.xmax?s+e.x*a:u.xmax,u.ymax=l+e.y>u.ymax?l+e.y:u.ymax})))}),u.xmin=Math.round(u.xmin-e),u.ymin=Math.round(u.ymin-e),u.xmax=Math.round(u.xmax+e),u.ymax=Math.round(u.ymax+e),u},i.prototype.getFastBoundingRect=function(e){e||(e=0);var t,n,i={xmin:null,ymin:null,xmax:null,ymax:null};return this.model.getNodes().each(function(e){t=e.x(),n=e.y(),i.xmin=null===i.xmin||t<i.xmin?t:i.xmin,i.ymin=null===i.ymin||n<i.ymin?n:i.ymin,i.xmax=null===i.xmax||t>i.xmax?t:i.xmax,i.ymax=null===i.ymax||n>i.ymax?n:i.ymax}),i.xmin=Math.round(i.xmin-e),i.ymin=Math.round(i.ymin-e),i.xmax=Math.round(i.xmax+e),i.ymax=Math.round(i.ymax+e),i},i.prototype.getNodeForId=function(e){return this.nodes[e]},i.prototype.centreInScrolledView=function(e){if(e){var t=this.scrollContainer();t.scrollTo(this.titleNode().getLabel().$el,{offset:{top:-t.height()/2,left:-t.width()/2}})}},i.prototype.onRootNodeAdded=function(e){this.nodes[e.id]&&console.error("duplicate root ID: "+JSON.stringify(e.toJSON())),this.onNodeAdded(e).render(),e.get("title")&&this.model.set("title",i.toTitleText(e.text()))},i.prototype.onNodeAdded=function(e){var t=new h(this,e);return this.nodes[e.id]=t,this.model.getNodes().joinedFrom(e).map(function(e){var t=this.nodes[e.id];t&&t.connection&&t.connection.from&&t.connection.updateLinePosition()}.bind(this)),t},i.prototype.likelyInAutoScroll=function(){if(!window.Coggle_App_Main)return!1;var e=f.activeEdit();return!!e&&(!!e.isResizing()||!(e.openDuration()>1100))},i.prototype.rootNodes=function(){return this.model.getNodes().getRoots().map(function(e){return this.nodes[e.id]}.bind(this))},i.prototype.titleNode=function(){var e=this.rootNodes();return o.find(e,function(e){return e.model.isTitle()})||e[0]},i.prototype.allNodes=function(){return this.nodes},i.prototype.getCrosslinkGroup=function(){return this.crosslink_group||(this.crosslink_group=document.createElementNS(m,"g"),this.crosslink_group.setAttribute("id","xlink-elements"),u(this.getPaper()).prepend(this.crosslink_group)),this.crosslink_group};var E=function(e,t,n,i){return(n-e)*(n-e)+(i-t)*(i-t)};i.prototype.closestByConnection=function(e,t){for(var n,i=null,r=null,s=o.values(this.nodes),l=0;l<s.length;l++){var a=s[l];if("function"!=typeof t||t(a.model)){var u,d=a.model.x(),c=a.model.y(),h=a.boundingBox();if(e.x>h.x&&e.x<h.x2&&e.y>h.y&&e.y<h.y2)u=E(d,c,e.x,e.y),(null===r||u<r)&&(n=a,i=0,r=u);else if(0!==i)for(var p=a.connectionPoints(),f=0;f<p.length;f++)u=E(d+p[f].x,c+p[f].y,e.x,e.y),(null===i||u<i)&&(n=a,i=u,r=null)}}return n?{node:n,distance:Math.sqrt(i),contained_distance:null!==r?Math.sqrt(r):null}:null},i.prototype.randomWalkColour=function(e){var t=r(e).toHsl();return t.h+=(Math.floor(19*Math.random())-9)/256,t.s+=(Math.floor(13*Math.random())-6)/256,t.l+=(Math.floor(13*Math.random())-6)/256,t.h<0&&(t.h=1-t.h),t.h>1&&(t.h=t.h-1),t.s<0&&(t.s=0),t.s>1&&(t.s=1),t.l<0&&(t.l=0),t.l>1&&(t.l=1),r(t).toHexString()},i.prototype.averageColours=function(e){if(!e.length)return"#bbbbbb";for(var t=0,n=0,i=0,o=0;o<e.length;o++){var s=r(e[o]).toRgb();t+=s.r,n+=s.g,i+=s.b}return r({r:t/e.length,g:n/e.length,b:i/e.length}).toHexString()},e("./starc.cogglify")(i),e("./starc.undo")(i),n.exports=i}),define("views/DiagramViews",["require","exports","module","underscore","async","backbone","utils/coggle-timeago","starc/starc","utils/coggle-encodeji","env"],function(e,t,n){function i(e,t){var n=document.createElement("div");n.className="content";var i=document.createElement("a"),o=document.createElement("a");if(i.className="lazy preview open",o.className="open title",t.searchQuery?(i.setAttribute("href","/diagram/"+t.short_id+"/t/"+t.url_title+"?search="+t.searchQuery),o.setAttribute("href","/diagram/"+t.short_id+"/t/"+t.url_title+"?search="+t.searchQuery)):(i.setAttribute("href","/diagram/"+t.short_id+"/t/"+t.url_title),o.setAttribute("href","/diagram/"+t.short_id+"/t/"+t.url_title)),i.setAttribute("data-src",u+"/diagram/"+t.short_id+"/thumbnail?mtime="+t.last_modified),t.public){var r=document.createElement("span");r.className="public-label",r.setAttribute("data-l10n-id","public-label"),r.setAttribute("title","This is a public diagram"),r.textContent="Public",o.appendChild(r)}else{var s=document.createElement("img");s.className="private-icon",s.src=u+"/img/padlock.png",s.setAttribute("data-l10n-id","tooltip-private-icon"),s.setAttribute("title","Diagram is private"),o.appendChild(s)}if(t.title&&t.title.length)o.appendChild(document.createTextNode(t.title));else{var l=document.createElement("span");l.setAttribute("data-l10n-id","unnamed-diagram"),l.textContent="Unnamed Diagram",o.appendChild(l)}n.appendChild(i),n.appendChild(o);var a=document.createElement("time");a.className="last-modified",a.setAttribute("datetime",t.last_modified),n.appendChild(a);var d=document.createElement("span");d.className="unread-notifications",t.unread_notifications&&(d.textContent=t.unread_notifications),n.appendChild(d);var c=document.createElement("div");c.className="diagram-icons";var h=document.createElement("img"),p=document.createElement("img"),f=document.createElement("img"),g=document.createElement("img"),m=document.createElement("img"),v=document.createElement("img");h.src=u+"/img/dots.png",h.setAttribute("data-l10n-id","tooltip-more"),h.setAttribute("title","Diagram options"),h.className="icon more",p.src=u+"/img/bin.png",p.setAttribute("data-l10n-id","tooltip-remove"),p.setAttribute("title","Remove diagram"),p.className="icon delete",f.src=u+"/img/undo.png",f.setAttribute("data-l10n-id","tooltip-restore"),f.setAttribute("title","Restore diagram"),f.className="icon undo",g.src=u+"/img/clone.png",g.setAttribute("data-l10n-id","tooltip-duplicate"),g.setAttribute("title","Create a copy"),g.className="icon clone",m.src=u+"/img/subscribed.png",m.setAttribute("data-l10n-id","tooltip-unsubscribe"),m.setAttribute("title","Unsubscribe from notifications"),m.className="icon unsubscribe",v.src=u+"/img/unsubscribed.png",v.setAttribute("data-l10n-id","tooltip-subscribe"),v.setAttribute("title","Subscribe to notifications"),v.className="icon subscribe",c.appendChild(h),c.appendChild(p),c.appendChild(f),c.appendChild(g),c.appendChild(m),c.appendChild(v),e.children.length&&(e.innerHTML=""),e.appendChild(n),e.appendChild(c)}var o=e("underscore"),r=e("async"),s=e("backbone"),l=e("utils/coggle-timeago"),a=(e("starc/starc"),e("utils/coggle-encodeji")),u=e("env").cdn.url,d=s.View.extend({tagName:"li",className:"diagram col-sm-6 col-md-4",events:{"click .delete":"removeDiagram","click .undo":"unremoveDiagram","click .clone":"makeClone","click .subscribe":"toggleNotifications","click .unsubscribe":"toggleNotifications","click .more":"more",mouseleave:"less","click a.open":"updateLastView"},initialize:function(e){this.options=e,o.bindAll(this,"renderWithThumb"),this.$el.attr("data-id",this.model.id),this.listenTo(this.model,"change",this.renderWithThumb),this.el.view=this,this.el.model=this.model},renderWithThumb:function(){this.render(),this.loadThumb()},render:function(){var e=this.model.toJSON();return e.title=this.model.cleanTitle(),e.searchQuery=this.options.searchQuery,i(this.el,e),this.model.canWrite()&&this.$el.find(".content").addClass("handle"),this.model.get("deleted")&&this.$el.addClass("deleted"),this.model.get("public")||this.$el.addClass("private"),(!this.model.canClone()||this.options.organisation&&this.options.organisation.id&&!this.options.organisation.canWrite())&&this.$el.find(".icon.clone").remove(),!this.options.folder||this.options.folder.isVirtual()||this.options.folder.isAdmin()||(this.$el.find(".icon.delete").remove(),this.$el.find(".icon.undo").remove()),this.model.get("subscribed")?this.$el.addClass("subscribed"):this.$el.removeClass("subscribed"),this.model.isModified()?this.$el.addClass("modified"):this.$el.removeClass("modified"),l.timeago(this.$el.find("time.last-modified")),a.replaceAndRender(this.$el.find(".title")[0]),this},updateLastView:function(){this.model.set({last_viewed:new Date})},toggleNotifications:function(e){return e.stopPropagation(),this.model.get("subscribed")?this.model.unsubscribe():this.model.subscribe(),!1},removeDiagram:function(e){return this.less(e),this.model.getAccess(function(e,t){if(e)return console.warn("failed to determine permission");this.previous_folder||(this.previous_folder=this.model.get("folder"));var n=t.getMe(),i=function(e){n.grant(["read","write","clone"],e)},o=function(e){n.revoke(["list"],function(t){return t||this.model.set("deleted",!0),e(t)}.bind(this))}.bind(this),s=function(e){if(!this.previous_folder)return e(null);this.model.save({folder:null},{wait:!0,success:function(){e()},error:function(){e(new Error("remove folder failed"))}})}.bind(this);r.series([i,o,s],function(e){if(e)return console.error("delete failed:",e);$(this.el).addClass("deleted")}.bind(this))}.bind(this)),!1},loadThumb:function(){var e,t=this.el.getElementsByClassName("preview")[0]
;if(t&&(e=new Image,e.src=t.getAttribute("data-src")),e){var n=this.$el;e.addEventListener("load",function(){t.style.backgroundImage="url('"+e.src+"')",t.classList.add("thumb-loaded"),e.complete&&e.width<n.width()&&e.height<n.height()&&t.classList.add("small-thumb")})}},unremoveDiagram:function(e){return e.stopPropagation(),this.model.getAccess(function(e,t){if(e)return console.warn("failed to determine permission");var n=function(e){if(!this.previous_folder)return e(null);this.model.save({folder:this.previous_folder},{wait:!0,success:function(){return this.previous_folder=void 0,e()}.bind(this),error:function(){e(new Error("restore folder failed"))}})}.bind(this),i=function(e){t.getMe().grant("list",function(t){return t||this.model.set("deleted",!1),e(t)}.bind(this))}.bind(this);r.series([n,i],function(e){if(e)return console.error("restore failed:",e);$(this.el).removeClass("deleted")}.bind(this))}.bind(this)),!1},makeClone:function(e){e.stopPropagation();var t="/clone/"+this.model.id;return e.ctrlKey||e.metaKey?window.open(t,"_blank"):window.location=t,!1},more:function(e){return e.stopPropagation(),this.$el.addClass("expanded"),!1},less:function(e){return e.stopPropagation(),this.$el.removeClass("expanded"),!1}}),c=o.template("<div class='diagram-list-notice diagram-list-welcome' data-l10n-id='doclist-create'><b>Welcome to Coggle!</b> – your diagrams will be listed here.</div><div class='diagram-list-notice diagram-list-readonly' data-l10n-id='doclist-readonly'><b>Welcome to Coggle!</b> – Ask the owner to grant you access to create a diagram here.</div><div class='diagram-list-notice diagram-list-folder-empty' data-l10n-id='doclist-folder-empty'><b>This is an empty folder!</b> – Create a new diagram here, or drag & drop diagrams into folders.</div><div class='diagram-list-notice diagram-list-shared' data-l10n-id='doclist-shared'><b>Shared with you</b> – diagrams created by other people then shared with you are in this folder.</div><div class='diagram-list-notice diagram-list-folder-recent' data-l10n-id='doclist-folder-recent'><b>Recently Updated Diagrams</b> – Diagrams from any of your folders that were modified within the last month will appear here.</div><ul class='row diagram-list'></ul></div>"),h=o.template("<div class='loadspinner'/>"),p=s.View.extend({tagName:"div",className:"diagrams",initialize:function(e){this.options=e,o.bindAll(this,"removeOne","addOne","sortByOrder","intersectionChanged"),this.listenTo(this.collection,"remove",this.removeOne),this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"sort",this.sortByOrder),this.loaded=this.collection.loaded||this.collection.length,this.listenToOnce(this.collection,"sync",function(){this.loaded||(this.loaded=!0,this.render())}.bind(this)),window.IntersectionObserver&&(this._io=new IntersectionObserver(this.intersectionChanged,{root:document}))},render:function(){return this.loaded?(this.$el.html(c(this.model&&this.model.toJSON())),this.options.folder?(this.options.folder.isShared()?(this.$el.find(".diagram-list-welcome").remove(),this.$el.find(".diagram-list-readonly").remove(),this.$el.find(".diagram-list-folder-empty").remove(),this.$el.find(".diagram-list-folder-recent").remove()):this.options.folder.isRoot()?(this.$el.find(".diagram-list-shared").remove(),this.$el.find(".diagram-list-folder-recent").remove(),this.$el.find(".diagram-list-folder-empty").remove(),this.options.folder.canWrite()?this.$el.find(".diagram-list-readonly").remove():this.$el.find(".diagram-list-welcome").remove()):"recent"===this.options.folder.id?(this.$el.find(".diagram-list-shared").remove(),this.$el.find(".diagram-list-folder-empty").remove(),this.$el.find(".diagram-list-welcome").remove(),this.$el.find(".diagram-list-readonly").remove()):(this.$el.find(".diagram-list-shared").remove(),this.$el.find(".diagram-list-folder-recent").remove(),this.$el.find(".diagram-list-welcome").remove(),this.$el.find(".diagram-list-readonly").remove()),this.options.folder.canWrite()&&this.addDragging({connect:this.options.folder.isAdmin()})):(this.$el.find(".diagram-list-shared").remove(),this.$el.find(".diagram-list-folder-recent").remove()),this.collection.length&&(this.$el.find(".diagram-list-welcome").remove(),this.$el.find(".diagram-list-folder-empty").remove()),!1===this.options.emptyContent&&this.$el.find(".diagram-list-notice").remove(),this.addAll(),this.$el.fadeOut(0).fadeIn(150),this):(this.$el.html(h()),this)},intersectionChanged:function(e){for(var t=0;t<e.length;t++)if(e[t].isIntersecting){var n=this.collection.get(e[t].target.getAttribute("data-id")),i=this.findByModel(n);i.loadThumb(),this._io.unobserve(i.el)}},addKeyboardHandlers:function(){$("body").off("keydown.diagramSelection"),$("body").on("keydown.diagramSelection",function(e){if((!$(e.target).is("input")||$(e.target).is(".search"))&&!(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey)){var t;return 40==e.keyCode?(t=this.$el.find(".diagram.selected"),t.length?t.removeClass("selected").next().addClass("selected"):this.$el.find(".diagram").first().addClass("selected"),!1):38==e.keyCode?(t=this.$el.find(".diagram.selected"),t.length?t.removeClass("selected").prev().addClass("selected"):this.$el.find(".diagram").last().addClass("selected"),!1):void(13==e.keyCode?this.$el.find(".diagram.selected").find(".title").click():e.which>=41&&e.which<=90&&$(".search-view .search").focus())}}.bind(this)),this.addKeyboardHandlers()},remove:function(){$("body").off("keydown.diagramSelection"),this._io&&(this._io.disconnect(),this._io=null),s.View.prototype.remove.apply(this,arguments)},removeOne:function(e){this.$el.find(".diagram[data-id="+e.id+"]").remove()},sortByOrder:function(){var e=this.$el.find(".diagram-list>.diagram"),t=this.collection;e.sort(function(e,n){var i=t.get($(e).attr("data-id")),o=t.get($(n).attr("data-id"));return t.comparator(i,o)}),e.detach().appendTo(this.$el.find(".diagram-list"))},addOne:function(e){this.$el.removeClass("empty");var t=this.findByModel(e);if(!t){t=new d({model:e,folder:this.options.folder,organisation:this.options.organisation,searchQuery:this.options.searchQuery}),this.addChildView(t);t.render().$el.attr("data-id",e.id)}this.$el.find(".diagram-list").append(t.$el),this._io?this._io.observe(t.el):t.loadThumb()},addAll:function(){0!==this.collection.length&&this.$el.removeClass("empty"),this.collection.toArray().forEach(this.addOne),setTimeout(this.options.onLoaded,0)},addDragging:function(e){this.draggingConfigured||(this.draggingConfigured=!0,this.setupDragging(e),$("body").hasClass("touch")&&(this.disableDragging(),this.$el.find(".diagram-list").on("touchstart",function(e){if(this.$el.find(".diagram-list").sortable("option","disabled")){var t=setTimeout(function(){t=!1,this.enableDragging(),this.$el.find(".diagram-list").trigger(e)}.bind(this),$("body").hasClass("desktop")?0:250);this.$el.find(".diagram-list").one("touchend touchmove",function(e){t&&(clearTimeout(t),t=!1,this.$el.find(".diagram-list").trigger(e),this.disableDragging())}.bind(this))}}.bind(this)),this.$el.on("sortdeactivate",function(e,t){this.disableDragging()}.bind(this))))},disableDragging:function(){this.$el.removeClass("drag-enabled"),this.$el.find(".diagram-list").sortable("disable")},enableDragging:function(){this.$el.addClass("drag-enabled"),this.$el.find(".diagram-list").sortable("enable")},setupDragging:function(e){function t(){$("#page>.home-view").scrollTop($("#page>.home-view").scrollTop()+10*n)}var n=0,i=!1;e=o.extend({connect:!0},e);var r=".diagram-list, .folders .folder:not(.disable-drop), .organisation";e.connect||(r="");this.$el.find(".diagram-list").sortable({connectWith:r,dropOnEmpty:!0,items:".diagram",delay:0,distance:$("body").hasClass("desktop")?3:0,tolerance:"pointer",placeholder:"diagram-placeholder col-sm-6 col-md-4",helper:"clone",revert:200,scrollSensitivity:40,scrollSpeed:10,handle:".handle",appendTo:"#page>.home-view",scroll:!1,start:function(e,o){$("body").addClass("dragging"),i=setInterval(t,20),$("#page>.home-view").on("mousemove",function(e){n=0,e.clientY<40&&(n=-1),$(window).innerHeight()-e.clientY<40&&(n=1)}),o.item[0].model.get("owner_id")!==getCoggleUser().id?$('.folders .folder[data-id="root"]').addClass("disable-drop"):$('.folders .folder[data-id="shared"]').addClass("disable-drop"),$(this).sortable("refresh")},stop:function(){$("body").removeClass("dragging"),$("#page>.home-view").off("mousemove"),clearInterval(i),$('.folders .folder[data-id="root"]').removeClass("disable-drop"),$('.folders .folder[data-id="shared"]').removeClass("disable-drop")},update:function(e,t){var n=t.item[0].model,i=!!$(t.item).prev()[0]&&$(t.item).prev()[0].model,o=!!$(t.item).next()[0]&&$(t.item).next()[0].model;i&&o?(i.get("order")==o.get("order")&&(console.log("diagrams have duplicate order, updating..."),this.collection.fixDuplicateOrders()),n.set("order",(i.get("order")+o.get("order"))/2)):i?n.set("order",i.get("order")/2):o&&n.set("order",o.get("order")+20),this.sortByOrder(),n.hasChanged()&&n.save()}.bind(this)})}});n.exports.DiagramView=d,n.exports.DiagramList=p}),define("views/SearchResultsView",["require","exports","module","underscore","backbone","plugins/Backbone.childViews","views/DiagramViews","views/GlobalSearchView"],function(e,t,n){var i=e("underscore"),o=e("backbone");e("plugins/Backbone.childViews");var r=e("views/DiagramViews").DiagramList,s=(e("views/GlobalSearchView"),o.View.extend({tagName:"div",className:"search-results",template:i.template(""),events:{},initialize:function(e){i.bindAll(this,"render","renderError"),this.options=e,this.listenTo(this.collection,"search-failed",this.renderError),this.diagramList=new r({collection:this.collection,emptyContent:!1,searchQuery:e.query}),this.addChildView(this.diagramList)},renderError:function(e){return this.$el.html($("<error/>").text(e&&e.responseJSON&&e.responseJSON.description||"Sorry, loading search results failed, please try again.")),this},render:function(){return this.$el.html(this.template()),this.$el.append(this.diagramList.render().$el),this}}));n.exports=s}),function(e){"function"==typeof define&&define.amd?define("plugins/jquery.clockify",["jquery"],e):e(jQuery)}(function(e){function t(e){return{transform:e,"-ms-transform":e,"-webkit-transform":e,"-moz-transform":e,"-o-transform":e}}function n(){var e=new Date;return e.setHours(e.getHours()-12),e}var i=11,o=100;e.fn.clockify=function(r){function s(e,n,i){return function(){y[e].css(t("rotate("+i.h+"deg)")),b[e].css(t("rotate("+i.m+"deg)")),r.seconds&&w[e].css(t("rotate("+i.s+"deg)")),Math.abs(i.h-n.h)>30&&y[e].addClass("transitioning"),Math.abs(i.m-n.m)>30&&b[e].addClass("transitioning"),r.seconds&&Math.abs(i.s-n.s)>30&&w[e].addClass("transitioning")}}function l(e){return function(){y[e].removeClass("transitioning"),b[e].removeClass("transitioning"),r.seconds&&w[e].removeClass("transitioning")}}function a(e){for(var t=e-_,n=e.getHours(),r=e.getMinutes(),a=e.getSeconds(),u=Math.floor(t/6e4),d=Math.floor(t/36e5),c=Math.floor(t/432e5),h={s:6*a+360*u,m:6*r+.1*a+360*d,h:n%12*30+.5*r+360*c},p=0;p<i;p++)window.setTimeout(s(p,x,h),p*o/i),window.setTimeout(l(p),1e3+p*o/i);x=h}function u(){E||a(new Date)}function d(e,t){E=!0,a(t||n())}function c(){E=!1,u()}function h(){e.contains(document,f[0])||p(),u()}function p(){g&&(window.clearInterval(g),g=null),e(window).off("clockify-timetravel",d),e(window).off("clockify-timetravel-end",c),e(window).off("clockify-start",h)}r=r||{};var f=e(this);f.addClass("clockified");var g,m,v,y=[],b=[],w=[];for(m=0;m<i;m++)v=e("<div/>").addClass("hand").addClass("hour"),0===m&&v.addClass("first"),y.push(v.appendTo(f));for(m=0;m<i;m++)v=e("<div/>").addClass("hand").addClass("minute"),0===m&&v.addClass("first"),b.push(v.appendTo(f));if(r.seconds)for(m=0;m<i;m++)v=e("<div/>").addClass("hand").addClass("second"),0===m&&v.addClass("first"),w.push(v.appendTo(f));var _=new Date;_.setHours(0,0,0,0);var x={h:0,m:0,s:0},E=!1;e(window).on("clockify-timetravel",d),e(window).on("clockify-timetravel-end",c),e(window).on("clockify-start",h),g=r.seconds?window.setInterval(u,1e3):window.setInterval(u,6e4)}});var saveAs=saveAs||function(e){"use strict";if(!(void 0===e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=e.document,n=function(){return e.URL||e.webkitURL||e},i=t.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in i,r=function(e){var t=new MouseEvent("click");e.dispatchEvent(t)},s=/constructor/i.test(e.HTMLElement),l=/CriOS\/[\d]+/.test(navigator.userAgent),a=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},u=function(e){var t=function(){"string"==typeof e?n().revokeObjectURL(e):e.remove()};setTimeout(t,4e4)},d=function(e,t,n){t=[].concat(t);for(var i=t.length;i--;){var o=e["on"+t[i]];if("function"==typeof o)try{o.call(e,n||e)}catch(e){a(e)}}},c=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},h=function(t,a,h){h||(t=c(t));var p,f=this,g=t.type,m="application/octet-stream"===g,v=function(){d(f,"writestart progress write writeend".split(" "))};if(f.readyState=f.INIT,o)return p=n().createObjectURL(t),void setTimeout(function(){i.href=p,i.download=a,r(i),v(),u(p),f.readyState=f.DONE});!function(){if((l||m&&s)&&e.FileReader){var i=new FileReader;return i.onloadend=function(){var t=l?i.result:i.result.replace(/^data:[^;]*;/,"data:attachment/file;");e.open(t,"_blank")||(e.location.href=t),t=void 0,f.readyState=f.DONE,v()},i.readAsDataURL(t),void(f.readyState=f.INIT)}if(p||(p=n().createObjectURL(t)),m)e.location.href=p;else{e.open(p,"_blank")||(e.location.href=p)}f.readyState=f.DONE,v(),u(p)}()},p=h.prototype,f=function(e,t,n){return new h(e,t||e.name||"download",n)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return t=t||e.name||"download",n||(e=c(e)),navigator.msSaveOrOpenBlob(e,t)}:(p.abort=function(){},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,f)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);if("undefined"!=typeof module&&module.exports?module.exports.saveAs=saveAs:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define("file-saver",[],function(){return saveAs}),define("starc/starc.coggleexport",["require","exports","module","BrowserDetect","file-saver"],function(e,t){function n(e,t){var n="application/octet-stream;charset=utf-8";i.browser.match(/webkit|safari/i)&&(n="text/plain;charset=utf-8"),o(new Blob([e],{type:n}),t)}var i=e("BrowserDetect"),o=e("file-saver");t.doExport=function(e,t,i){var r=e.name,s=e.extension,l=e.start;ga("send","event","Download",r),console.log("do "+r+" export"),getCoggleUser().getActions().perform("diagram:download:"+s.toLowerCase().replace(".",""));var a=function(){var e=l(t);if(void 0===e.generate||"undefined"==e.finish)throw new Error("export start() must return both generate and finish methods");t.visitDepthFirst(e.generate).always(function(){var t=window.document.title+s,i=e.finish(function(e,i,r){if(e)return console.error(e);r?o(i,t):n(i,t)});i&&n(i,t)})};e.init?e.init(function(){a()}):a()}}),function(e){define("xmlwriter",[],function(){return function(){function t(e,t){e&&(this.encoding=e),t&&(this.version=t)}return function(){function e(e){return e.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;").split('"').join("&quot;")}function n(e){for(var t=e.c.length;t--;)"object"==typeof e.c[t]&&n(e.c[t]);e.n=e.a=e.c=null}function i(e,t,n,o){var r,s,l=t+"<"+e.n,a=e.c.length,u=0;for(r in e.a)l+=" "+r+'="'+e.a[r]+'"';if(l+=a?">":"/>",o.push(l),a){do{if("string"==typeof(s=e.c[u++])){if(1==a)return o.push(o.pop()+s+"</"+e.n+">");o.push(t+n+s)}else"object"==typeof s&&i(s,t+n,n,o)}while(u<a);o.push(t+"</"+e.n+">")}}t.prototype={encoding:"ISO-8859-1",version:"1.0",formatting:"indented",indentChar:"\t",indentation:1,newLine:"\n",writeStartDocument:function(e){this.close(),this.stack=[],this.standalone=e},writeEndDocument:function(){this.active=this.root,this.stack=[]},writeDocType:function(e){this.doctype=e},writeStartElement:function(e,t){t&&(e=t+":"+e);var n={n:e,a:{},c:[]};this.active?(this.active.c.push(n),this.stack.push(this.active)):this.root=n,this.active=n},deleteEndElement:function(){this.stack.pop(),this.active.c.pop()},writeEndElement:function(){this.active=this.stack.pop()||this.root},writeAttributeString:function(t,n){this.active&&(this.active.a[t]=e(n))},writeString:function(t){this.active&&this.active.c.push(e(t))},writeElementString:function(t,n,i){this.writeStartElement(t,i),this.writeString(e(n)),this.writeEndElement()},writeCDATA:function(e){e=e.replace(/>>]/g,"]]><![CDATA[>"),this.writeString("<![CDATA["+e+"]]>")},writeComment:function(e){this.writeString("\x3c!-- "+e+" --\x3e")},flush:function(e){void 0===e&&(e={}),this.stack&&this.stack[0]&&this.writeEndDocument();var t="",n=this.indentation,o="indented"==this.formatting.toLowerCase(),r="";if(e.suppress_xml_tag||(r+='<?xml version="'+this.version+'" encoding="'+this.encoding+'"',void 0!==this.standalone&&(r+=' standalone="'+(this.standalone?"yes":"no")+'"'),r+="?>"),r=[r],this.doctype&&this.root&&r.push("<!DOCTYPE "+this.root.n+" "+this.doctype+">"),o)for(;n--;)t+=this.indentChar;return this.root&&i(this.root,"",t,r),r.join(o?this.newLine:"")},close:function(){this.root&&n(this.root),this.active=this.root=this.stack=null},getDocument:window.ActiveXObject?function(){var e=new ActiveXObject("Microsoft.XMLDOM");return e.async=!1,e.loadXML(this.flush()),e}:function(){return(new DOMParser).parseFromString(this.flush(),"text/xml")}}}(),e.XMLWriter=t}.apply(e,arguments)})}(this),define("starc/starc.coggleexport.mm",["require","exports","module","starc/starc.coggleexport","xmlwriter"],function(e,t){function n(){var e=new XMLWriter,t=-1;return e.indentChar=" ",e.indentation=4,e.writeStartDocument(),e.writeStartElement("map"),e.writeAttributeString("version","0.9.0"),{generate:function(n){var i=0;for(i=n.level();i<=t;i++)e.writeEndElement();n.isRoot()&&!n.isTitle()?e.writeStartElement("x-coggle-rootnode"):e.writeStartElement("node"),e.writeAttributeString("TEXT",n.text()),e.writeAttributeString("FOLDED","false"),e.writeAttributeString("POSITION",1===n.ltr()?"right":"left"),e.writeAttributeString("ID",n.id),n.joinedNode()&&e.writeAttributeString("X_COGGLE_JOINEDTO",n.get("join")),n.isRoot()&&(e.writeAttributeString("X_COGGLE_POSX",""+n.x()),e.writeAttributeString("X_COGGLE_POSY",""+n.y())),e.writeStartElement("edge"),e.writeAttributeString("COLOR",n.colour()),e.writeEndElement(),e.writeStartElement("font"),e.writeAttributeString("NAME","Helvetica"),e.writeAttributeString("SIZE",""+Math.round(n.textSize())),e.writeEndElement(),t=n.level()},finish:function(){return e.flush({suppress_xml_tag:!0})}}}e("starc/starc.coggleexport"),e("xmlwriter"),t.start=n,t.id="mm",t.name=".mm File",t.extension=".mm"}),define("starc/starc.coggleexport.plaintext",["require","exports","module","starc/starc.coggleexport"],function(e,t){function n(e,t){return new Array(t+1).join(e)}function i(e,t){var i=n(r,t);return i+e.split(/\r?\n/).join("\n"+i)}function o(){console.log("plaintext export");var e=[];return{generate:function(t){e.push(i(t.text(),t.level()))},finish:function(){return e.join("\n")}}}e("starc/starc.coggleexport");var r="\t";t.start=o,t.id="txt",t.name="Plain-Text Outline",t.extension=".txt"}),define("utils/opc.js",["require","exports","module"],function(e,t,n){var i="http://schemas.openxmlformats.org/package/2006/relationships";t.contentTypes=function(e){var t=new XMLWriter("UTF-8");t.indentChar=" ",t.indentation=4,t.writeStartDocument(!0),t.writeStartElement("Types"),t.writeAttributeString("xmlns","http://schemas.openxmlformats.org/package/2006/content-types");var n=function(e,n){t.writeStartElement("Default"),t.writeAttributeString("Extension",e),t.writeAttributeString("ContentType",n),t.writeEndElement()},i=function(e,n){t.writeStartElement("Override"),t.writeAttributeString("PartName",e),t.writeAttributeString("ContentType",n),t.writeEndElement()};return[["xml","application/xml"],["rels","application/vnd.openxmlformats-package.relationships+xml"]].forEach(function(e){n(e[0],e[1])}),e.forEach(function(e){i(e[0],e[1])}),t.flush()};var o=function(e,t,n,i){e.writeStartElement("Relationship"),e.writeAttributeString("Id",t),e.writeAttributeString("Type",n),e.writeAttributeString("Target",i),e.writeEndElement()};t.generateRels=function(e){var t=new XMLWriter("UTF-8");t.indentChar=" ",t.indentation=4,t.writeStartDocument(!0),t.writeStartElement("Relationships"),t.writeAttributeString("xmlns",i);for(var n=0;n<e.length;n++)o(t,e[n].id,e[n].type,e[n].target);return t.writeEndElement(),t.flush()},t.xmlns={rels:i,docrels:"http://schemas.openxmlformats.org/officeDocument/2006/relationships"}}),define("starc/starc.coggleexport.vsdx",["require","exports","module","starc/starc.coggleexport","xmlwriter","utils/controlPoints","views/shapes","underscore","utils/opc.js","utils/loaddeferred"],function(e,t){function n(e){console.log("vsdx export");var t=new s,n=e.getSVGContentsBoundingRect(30),i={},o=function(e){return d*(e-n.xmin)},r=function(e){return d*(n.ymax-e)};t.file("[Content_Types].xml",a.contentTypes([["/visio/document.xml","application/vnd.ms-visio.drawing.main+xml"],["/visio/pages/page1.xml","application/vnd.ms-visio.page+xml"],["/visio/pages/pages.xml","application/vnd.ms-visio.pages+xml"],["/docProps/app.xml","application/vnd.openxmlformats-officedocument.extended-properties+xml"],["/docProps/core.xml","application/vnd.openxmlformats-officedocument.core-properties+xml"],["/docProps/custom.xml","application/vnd.openxmlformats-officedocument.custom-properties+xml"],["/visio/windows.xml","application/vnd.ms-visio.windows+xml"],["/visio/masters/masters.xml","application/vnd.ms-visio.masters+xml"],["/visio/masters/master1.xml","application/vnd.ms-visio.master+xml"],["/visio/masters/master2.xml","application/vnd.ms-visio.master+xml"],["/visio/masters/master3.xml","application/vnd.ms-visio.master+xml"]]),f),t.file("visio/document.xml",E(),f),t.file("visio/_rels/document.xml.rels",S(),f),t.file("_rels/.rels",C(),f),t.file("visio/masters/masters.xml",T(),f),t.file("visio/masters/master1.xml",O(),f),t.file("visio/masters/master2.xml",N(),f),t.file("visio/masters/master3.xml",I(),f),t.file("visio/masters/_rels/masters.xml.rels",L(),f),t.file("docProps/app.xml",$(),f),t.file("docProps/core.xml",B(),f),t.file("docProps/custom.xml",j(),f),t.file("visio/windows.xml",R(),f),t.file("visio/pages/pages.xml",P(n),f),t.file("visio/pages/_rels/pages.xml.rels",M(),f),t.file("visio/pages/_rels/page1.xml.rels",D(),f);var l=new XMLWriter(p);l.formatting="none",l.writeStartDocument(!0),l.writeStartElement("PageContents"),l.writeAttributeString("xmlns",c),l.writeAttributeString("xmlns:r",h),l.writeAttributeString("xml:space","preserve"),l.writeStartElement("Shapes");var u=[];return{generate:function(t){if(t.joinedNode())return void u.push(e.getNodeForId(t.id));te(l,t,e.getNodeForId(t.id),o,r,i),ne(l,t,e.getNodeForId(t.id),o,r,i)},finish:function(e){return ie(l,u,o,r,i),l.writeEndElement(),oe(l,i),l.writeEndElement(),t.file("visio/pages/page1.xml",l.flush(),f),t.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:1},mimeType:"application/x-vsd"}).then(function(t){e(null,t,!0)}),null}}}var i=Object.prototype.hasOwnProperty;e("starc/starc.coggleexport"),e("xmlwriter");var o=e("utils/controlPoints"),r=e("views/shapes"),s=null,l=e("underscore"),a=e("utils/opc.js"),u=e("utils/loaddeferred"),d=1/72,c="http://schemas.microsoft.com/office/visio/2012/main",h=a.xmlns.docrels,p="UTF-8",f={createFolders:!1},g={LangID:"en-US",Font:"Arial",Style:"0",FontScale:"1",Letterspace:"0",Pos:"0",Case:"0"},m={IndFirst:0,IndLeft:0,IndRight:0,SpLine:12*d,SpBefore:0,SpAfter:0,Flags:0,Bullet:0,BulletStr:"",BulletFont:0,BulletFontSize:"-1",TextPosAfterBullet:0,HorzAlign:0},v=function(){var e=new Uint8Array(16);(window.crypto||window.msCrypto).getRandomValues(e),e[6]=15&e[6]|64,e[8]=191&e[8]|128;var t=l.map(e,function(e){var t=e.toString(16);return("00"+t).substring(t.length,t.length+2)}).join("").toUpperCase();return"{"+t.substr(0,8)+"-"+t.substr(8,4)+"-"+t.substr(12,4)+"-"+t.substr(16,4)+"-"+t.substr(20)+"}"},y=function(e,t,n,i,o){var r=Math.sqrt((n-e)*(n-e)+(i-t)*(i-t)),s={x:(e+n)/2,y:(t+i)/2},l=Math.sqrt(o*o-r*r/4),a={x:(i-t)/r,y:(e-n)/r};return{x:s.x+a.x*(o-l),y:s.y+a.y*(o-l)}},b=function(e,t,n,i){e.writeStartElement("Cell"),e.writeAttributeString("N",""+t),e.writeAttributeString("V",""+n),void 0!==i&&e.writeAttributeString("F",""+i),e.writeEndElement()},w=function(e,t){for(var n in t)i.call(t,n)&&b(e,n,t[n])},_=function(e,t,n){e.writeStartElement("Row"),e.writeAttributeString("IX",""+t);for(var o in n)i.call(n,o)&&b(e,o,n[o]);e.writeEndElement()},x=function(e,t,n,o,r,s,l){e.writeStartElement("StyleSheet"),e.writeAttributeString("ID",""+t),e.writeAttributeString("NameU",n),e.writeAttributeString("Name",n),e.writeAttributeString("IsCustomName","1"),e.writeAttributeString("IsCustomNameU","1"),null!==o&&(e.writeAttributeString("LineStyle",""+o),e.writeAttributeString("FillStyle",""+o),e.writeAttributeString("TextStyle",""+o));for(var a in r)i.call(r,a)&&b(e,a,r[a]);s&&(e.writeStartElement("Section"),e.writeAttributeString("N","Character"),_(e,0,s),e.writeEndElement()),l&&(e.writeStartElement("Section"),e.writeAttributeString("N","Paragraph"),_(e,0,l),e.writeEndElement()),e.writeEndElement()},E=function(){var e=new XMLWriter(p);return e.indentChar=" ",e.indentation=4,e.writeStartDocument(),e.writeStartElement("VisioDocument"),e.writeAttributeString("xmlns",c),e.writeAttributeString("xmlns:r",h),e.writeAttributeString("xml:space","preserve"),e.writeStartElement("DocumentSettings"),e.writeAttributeString("DefaultFillStyle","0"),e.writeAttributeString("DefaultGuideStyle","0"),e.writeAttributeString("DefaultLineStyle","0"),e.writeAttributeString("DefaultTextStyle","0"),e.writeAttributeString("TopPage","0"),e.writeElementString("SnapSettings","32"),e.writeEndElement(),e.writeStartElement("FaceNames"),e.writeStartElement("FaceName"),e.writeAttributeString("NameU","Arial"),e.writeAttributeString("UnicodeRanges","-536858881 -1073711037 9 0"),e.writeAttributeString("CharSets","1073742335 -65536"),e.writeAttributeString("Panose","2 11 6 4 2 2 2 2 2 4"),e.writeAttributeString("Flags","325"),e.writeEndElement(),e.writeEndElement(),e.writeStartElement("StyleSheets"),x(e,0,"No Style",null,{EnableLineProps:1,EnableFillProps:1,EnableTextProps:1,FillPattern:0,LinePattern:0,FillForegnd:0,FillBkgnd:0,ShdwForegnd:0,FillForegndTrans:0,FillBkgndTrans:0,LineWeight:1,LineColor:0},g,m),e.writeEndElement(),e.writeStartElement("DocumentSheet"),e.writeAttributeString("NameU","CoggleDoc"),e.writeAttributeString("Name","CoggleDoc"),e.writeAttributeString("IsCustomName","1"),e.writeAttributeString("IsCustomNameU","1"),e.writeAttributeString("LineStyle","0"),e.writeAttributeString("FillStyle","0"),e.writeAttributeString("TextStyle","0"),b(e,"OutputFormat",0),b(e,"LockPreview",0),b(e,"AddMarkup",0),b(e,"ViewMarkup",0),b(e,"DocLockReplace",0),b(e,"NoCoauth",0),b(e,"DocLockDuplicatePage",0),b(e,"PreviewQuality",0),b(e,"PreviewScope",0),e.writeStartElement(),e.writeEndElement(),e.flush()},A=function(e,t){e.writeStartElement("Rel"),e.writeAttributeString("r:id",t),e.writeEndElement()},S=function(){return a.generateRels([{id:"rId1",type:"http://schemas.microsoft.com/visio/2010/relationships/masters",target:"masters/masters.xml"},{id:"rId2",type:"http://schemas.microsoft.com/visio/2010/relationships/pages",target:"pages/pages.xml"},{id:"rId3",type:"http://schemas.microsoft.com/visio/2010/relationships/windows",target:"windows.xml"}])},C=function(){return a.generateRels([{id:"rId1",type:"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties",target:"docProps/core.xml"},{id:"rId2",type:"http://schemas.microsoft.com/visio/2010/relationships/document",target:"visio/document.xml"},{id:"rId3",type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties",target:"docProps/custom.xml"},{id:"rId4",type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties",target:"docProps/app.xml"}])},F=function(e,t,n,i){e.writeAttributeString("ID",""+t),e.writeAttributeString("NameU",n),e.writeAttributeString("Name",n),e.writeAttributeString("IsCustomName","1"),e.writeAttributeString("IsCustomNameU","1"),e.writeAttributeString("UniqueID",v()),e.writeAttributeString("BaseID",v()),e.writeAttributeString("Hidden","0"),e.writeAttributeString("Prompt",i),e.writeAttributeString("MasterType","1")},k=function(e){e.writeStartElement("PageSheet"),e.writeAttributeString("LineStyle","1"),e.writeAttributeString("FillStyle","1"),e.writeAttributeString("TextStyle","1"),b(e,"PageWidth",1),b(e,"PageHeight",1),b(e,"PageScale",1),b(e,"DrawingScale",1),b(e,"ShapeKeywords","Coggle"),e.writeEndElement()},T=function(){var e=new XMLWriter(p);return e.indentChar=" ",e.indentation=4,e.writeStartDocument(),e.writeStartElement("Masters"),e.writeAttributeString("xmlns",c),e.writeAttributeString("xmlns:r",h),e.writeAttributeString("xml:space","preserve"),e.writeStartElement("Master"),F(e,1,"CoggleNode","Coggle Node Master used in exported Coggle Documents"),k(e),A(e,"rId1"),e.writeEndElement(),e.writeStartElement("Master"),F(e,2,"CoggleShape","Coggle Shape Master used in exported Coggle Documents"),k(e),A(e,"rId2"),e.writeEndElement(),e.writeStartElement("Master"),F(e,3,"CoggleShape","Coggle Connection Master used in exported Coggle Documents"),k(e),A(e,"rId3"),e.writeEndElement(),e.writeEndElement(),e.flush()},O=function(){var e=new XMLWriter(p);return e.indentChar=" ",e.indentation=4,e.writeStartDocument(),e.writeStartElement("MasterContents"),e.writeAttributeString("xmlns",c),e.writeAttributeString("xmlns:r",h),e.writeAttributeString("xml:space","preserve"),e.writeStartElement("Shapes"),e.writeStartElement("Shape"),e.writeAttributeString("ID","5"),e.writeAttributeString("Type","Shape"),e.writeAttributeString("UniqueID",v()),b(e,"PinX",.5),b(e,"PinY",.5),b(e,"LocPinX",.5,"Width*0.5"),b(e,"LocPinY",.5,"Height*0.5"),b(e,"Width",1),b(e,"Height",1),b(e,"Angle",0),b(e,"FlipX",0),b(e,"FlipY",0),b(e,"TxtPinX",.5,"Width*0.5"),b(e,"TxtPinY",.5,"Height*0.5"),b(e,"TxtLocPinX",.5,"TxtWidth*0.5"),b(e,"TxtLocPinY",.5,"TxtHeight*0.5"),b(e,"TxtAngle",0),b(e,"ResizeMode",0),b(e,"ObjType",1),b(e,"LayerMember",0),w(e,{EnableLineProps:1,EnableFillProps:1,EnableTextProps:1,FillPattern:0,LinePattern:0,FillForegnd:0,FillBkgnd:0,ShdwForegnd:0,FillForegndTrans:0,FillBkgndTrans:0,LineColor:0,IsTextEditTarget:1,LineWeight:2*d}),e.writeStartElement("Section"),e.writeAttributeString("N","Geometry"),e.writeAttributeString("IX","0"),z(e,"RelMoveTo",1,{X:0,Y:0}),z(e,"RelLineTo",2,{X:1,Y:0}),z(e,"RelLineTo",3,{X:1,Y:1}),z(e,"RelLineTo",4,{X:0,Y:1}),z(e,"RelLineTo",5,{X:0,Y:0}),b(e,"NoFill","0"),b(e,"NoLine","0"),b(e,"NoShow","0"),b(e,"NoSnap","0"),b(e,"NoQuickDrag","0"),e.writeEndElement(),e.writeEndElement(),e.writeEndElement(),e.writeEndElement(),e.flush()},N=function(){var e=new XMLWriter(p);return e.indentChar=" ",e.indentation=4,e.writeStartDocument(),e.writeStartElement("MasterContents"),e.writeAttributeString("xmlns",c),e.writeAttributeString("xmlns:r",h),e.writeAttributeString("xml:space","preserve"),e.writeStartElement("Shapes"),e.writeStartElement("Shape"),e.writeAttributeString("ID","6"),e.writeAttributeString("Type","Shape"),e.writeAttributeString("UniqueID",v()),b(e,"PinX",.5),b(e,"PinY",.5),b(e,"LocPinX",.5,"Width*0.5"),b(e,"LocPinY",.5,"Height*0.5"),b(e,"Width",1),b(e,"Height",1),b(e,"Angle",0),b(e,"FlipX",0),b(e,"FlipY",0),b(e,"TxtPinX",.5,"Width*0.5"),b(e,"TxtPinY",.5,"Height*0.5"),b(e,"TxtLocPinX",.5,"TxtWidth*0.5"),b(e,"TxtLocPinY",.5,"TxtHeight*0.5"),b(e,"TxtAngle",0),b(e,"ResizeMode",0),b(e,"ObjType",1),b(e,"LayerMember",0),
w(e,{EnableLineProps:1,EnableFillProps:1,EnableTextProps:1,FillPattern:1,LinePattern:0,FillForegnd:1,FillBkgnd:0,ShdwForegnd:0,FillForegndTrans:0,FillBkgndTrans:0,LineColor:0,IsTextEditTarget:1,LineWeight:2*d}),e.writeStartElement("Section"),e.writeAttributeString("N","Geometry"),e.writeAttributeString("IX","0"),z(e,"RelMoveTo",1,{X:0,Y:0}),z(e,"RelLineTo",2,{X:1,Y:0}),z(e,"RelLineTo",3,{X:1,Y:1}),z(e,"RelLineTo",4,{X:0,Y:1}),z(e,"RelLineTo",5,{X:0,Y:0}),b(e,"NoFill","0"),b(e,"NoLine","0"),b(e,"NoShow","0"),b(e,"NoSnap","0"),b(e,"NoQuickDrag","0"),e.writeEndElement(),e.writeEndElement(),e.writeEndElement(),e.writeEndElement(),e.flush()},I=function(){var e=new XMLWriter(p);return e.indentChar=" ",e.indentation=4,e.writeStartDocument(),e.writeStartElement("MasterContents"),e.writeAttributeString("xmlns",c),e.writeAttributeString("xmlns:r",h),e.writeAttributeString("xml:space","preserve"),e.writeStartElement("Shapes"),e.writeStartElement("Shape"),e.writeAttributeString("ID","7"),e.writeAttributeString("Type","Shape"),e.writeAttributeString("UniqueID",v()),b(e,"BeginX",0),b(e,"BeginY",0),b(e,"EndX",1),b(e,"EndY",1),b(e,"PinX",0,"GUARD((BeginX+EndX)/2)"),b(e,"PinY",0,"GUARD((BeginY+EndY)/2)"),b(e,"Width",1,"GUARD(EndX-BeginX)"),b(e,"Height",1,"GUARD(EndY-BeginY)"),b(e,"LocPinX",.5,"GUARD(Width/2)"),b(e,"LocPinY",.5,"GUARD(Height/2)"),b(e,"Angle",0,"GUARD(0DA)"),b(e,"FlipX",0,"GUARD(FALSE)"),b(e,"FlipY",0,"GUARD(FALSE)"),b(e,"ResizeMode",0),b(e,"ObjType",1),b(e,"GlueType",2),b(e,"NoAlignBox",1),b(e,"NoObjHandles",1),b(e,"UpdateAlignBox",1),b(e,"LayerMember",0),w(e,{EnableLineProps:1,EnableFillProps:1,EnableTextProps:1,FillPattern:0,LinePattern:1,FillForegnd:0,FillBkgnd:0,ShdwForegnd:0,FillForegndTrans:0,FillBkgndTrans:0,LineColor:0,IsTextEditTarget:0,LineWeight:12*d}),e.writeStartElement("Section"),e.writeAttributeString("N","Geometry"),e.writeAttributeString("IX","0"),z(e,"RelMoveTo",1,{X:0,Y:0}),z(e,"RelLineTo",5,{X:1,Y:1}),b(e,"NoFill","1"),b(e,"NoLine","0"),b(e,"NoShow","0"),b(e,"NoSnap","0"),b(e,"NoQuickDrag","0"),e.writeEndElement(),e.writeEndElement(),e.writeEndElement(),e.writeEndElement(),e.flush()},L=function(){return a.generateRels([{id:"rId1",type:"http://schemas.microsoft.com/visio/2010/relationships/master",target:"master1.xml"},{id:"rId2",type:"http://schemas.microsoft.com/visio/2010/relationships/master",target:"master2.xml"},{id:"rId3",type:"http://schemas.microsoft.com/visio/2010/relationships/master",target:"master3.xml"}])},R=function(){var e=new XMLWriter(p);return e.indentChar=" ",e.indentation=4,e.writeStartDocument(!0),e.writeStartElement("Windows"),e.writeAttributeString("xmlns",c),e.writeAttributeString("xmlns:r",h),e.writeAttributeString("ClientWidth","0"),e.writeAttributeString("ClientHeight","0"),e.writeEndElement(),e.flush()},P=function(e){var t=new XMLWriter(p);return t.indentChar=" ",t.indentation=4,t.writeStartDocument(!0),t.writeStartElement("Pages"),t.writeAttributeString("xmlns",c),t.writeAttributeString("xmlns:r",h),t.writeAttributeString("xml:space","preserve"),t.writeStartElement("Page"),t.writeAttributeString("ID","0"),t.writeAttributeString("Name","Page 1"),t.writeAttributeString("NameU","Page-1"),t.writeStartElement("PageSheet"),b(t,"PageWidth",d*Math.abs(e.xmax-e.xmin)),b(t,"PageHeight",d*Math.abs(e.ymax-e.ymin)),b(t,"PageScale",1),b(t,"DrawingScale",1),t.writeEndElement(),A(t,"rId1"),t.writeEndElement(),t.writeEndElement(),t.flush()},D=function(){return a.generateRels([{id:"rId1",type:"http://schemas.microsoft.com/visio/2010/relationships/master",target:"../masters/master1.xml"},{id:"rId2",type:"http://schemas.microsoft.com/visio/2010/relationships/master",target:"../masters/master2.xml"},{id:"rId3",type:"http://schemas.microsoft.com/visio/2010/relationships/master",target:"../masters/master3.xml"}])},M=function(){return a.generateRels([{id:"rId1",type:"http://schemas.microsoft.com/visio/2010/relationships/page",target:"page1.xml"}])},$=function(){var e=new XMLWriter(p);return e.indentChar=" ",e.indentation=4,e.writeStartDocument(!0),e.writeStartElement("Properties"),e.writeAttributeString("xmlns:cp","http://schemas.openxmlformats.org/officeDocument/2006/extended-properties"),e.writeElementString("Application","Coggle"),e.writeElementString("AppVersion","201809"),e.writeElementString("Template",""),e.writeElementString("Manager",""),e.writeElementString("Company",""),e.writeElementString("HyperlinkBase",""),e.writeEndElement(),e.flush()},B=function(){var e=new XMLWriter(p);return e.indentChar=" ",e.indentation=4,e.writeStartDocument(!0),e.writeStartElement("cp:coreProperties"),e.writeAttributeString("xmlns:cp","http://schemas.openxmlformats.org/package/2006/metadata/core-properties"),e.flush()},j=function(){var e=new XMLWriter(p);return e.indentChar=" ",e.indentation=4,e.writeStartDocument(!0),e.writeStartElement("Properties"),e.writeAttributeString("xmlns","http://schemas.openxmlformats.org/officeDocument/2006/custom-properties"),e.flush()},H=0,G=function(){return""+(H+=1)},z=function(e,t,n,o,r){if(e.writeStartElement("Row"),e.writeAttributeString("T",t),e.writeAttributeString("IX",""+n),void 0!==r)for(var s in r)i.call(r,s)&&e.writeAttributeString(s,""+r[s]);for(var l in o)i.call(o,l)&&b(e,l,o[l]);e.writeEndElement()},V=function(e,t,n,i){e.writeStartElement(t),e.writeAttributeString(n,i),e.writeEndElement()},U=function(e,t){V(e,"cp","IX",""+t)},q=function(e,t){V(e,"pp","IX",""+t)},W=function(e){return/^ *([0-9.eE-]+)[, ] *([0-9.eE-]+)[, ] */.exec(e)},Y=function(e){return/^ *([01])[, ] *([01])[, ] *([01])[, ] */.exec(e)},K=function(e,t,n){for(var i,o,r,s,l,a,u,c=0,h=1;t&&c<t.length;){var p=t[c];if(c+=1,"m"===p.toLowerCase()||"l"===p.toLowerCase())for(i=W(t.substr(c));i;)o=parseFloat(i[1]),r=parseFloat(i[2]),void 0===a&&(a=o,u=r),"m"===p.toLowerCase()?z(e,"MoveTo",h,{X:d*o+n.x,Y:n.y-d*r}):z(e,"LineTo",h,{X:d*o+n.x,Y:n.y-d*r}),h++,p="l",c+=i[0].length,i=W(t.substr(c));else if("a"===p.toLowerCase()){var f=W(t.substr(c));if(f){c+=f[0].length;var g=Y(t.substr(c));if(g&&(c+=g[0].length,i=W(t.substr(c)))){c+=i[0].length,s=o||0,l=r||0,o=parseFloat(i[1]),r=parseFloat(i[2]);var m=y(s,l,o,r,f[1]);z(e,"EllipticalArcTo",h,{A:n.x+d*m.x,B:n.y-d*m.y,C:0,D:1,X:n.x+d*o,Y:n.y-d*r}),h++}}}}void 0!==a&&z(e,"LineTo",h,{X:d*a+n.x,Y:n.y-d*u})},X=function(e){if("number"==typeof e)return d*e*.9;var t=/^([0-9.]*)px/.exec(e);return t?d*parseFloat(t[1])*.9:12*d},J=function(e,t){var n=0;return("bold"===e||parseFloat(e)&&parseFloat(e)>600)&&(n|=1),"italic"===t&&(n|=2),n},Q=function(e){var t=e.textAlignment()||e.hAnchor(),n=l.extend({},m,{SpLine:d*e.textSize()});switch(t){default:case"center":n.HorzAlign=1;break;case"left":n.HorzAlign=0;break;case"right":n.HorzAlign=2}return n},Z=function(e){return l.extend({},g,{Color:e.textColour(),Size:X(e.textSize())})},ee=function(e,t){this.node=e,this.view=t;var n=[],i=Q(e),o=Z(e),r={Description:"",Address:"",SubAddress:"",ExtraInfo:"",Frame:"",NewWindow:"0",Default:"0",Invisible:"0",SortKey:""},s=0,a=0,u=function(e){n.push({ix:s,character:l.extend({},o,e)}),s+=1},d=function(e){n.push({ix:a,paragraph:l.extend({},i,e)}),a+=1},c=function(e){n.push({text:e})},h=function(e){n.push({link:l.extend({},r,e)})},p=function(e,t){if(3===e.nodeType){var n=window.getComputedStyle(e.parentNode),i=e.textContent.replace(/\s+/gm," ");(/\S/.exec(i)||"span"===e.parentNode.nodeName.toLowerCase())&&(u({Size:X(n.getPropertyValue("font-size")),Style:J(n.getPropertyValue("font-weight"),n.getPropertyValue("font-style"))}),c(i))}else if(1===e.nodeType)if("p"!==e.nodeName.toLowerCase()||t||d({}),"br"===e.nodeName.toLowerCase())c("\n");else if("img"===e.nodeName.toLowerCase())e.classList.contains("twemoji")?c(e.getAttribute("alt")):(console.log("unhandled image in visio export:"+e.getAttribute("src")),c(e.getAttribute("alt")));else if(e.classList.contains("MathJax"))c("\\("+e.nextSibling.innerHTML+"\\)");else if(e.classList.contains("MathJax_Display"))c("\\["+e.nextSibling.innerHTML+"\\]");else{if("script"===e.nodeName.toLowerCase())return;"a"===e.nodeName.toLowerCase()&&h({Address:e.getAttribute("href"),Description:e.textContent});var o="ul"===e.nodeName.toLowerCase()||"ol"===e.nodeName.toLowerCase();o&&d({Bullet:1,HorzAlign:0});for(var r=0;r<e.childNodes.length;r++)p(e.childNodes[r],o||t);-1!==["p","h1","h2","h3","h4","h5","h6","li"].indexOf(e.nodeName.toLowerCase())&&c("\n")}else console.log("unhandled node type: "+e.nodeType,e)};p(t.getLabel().contentContainer[0]);var f;for(f=n.length-1;f>=0&&(!n[f].text||!/\S/.exec(n[f].text));f--);this.sections=n.slice(0,f+1);for(var g=0;g<this.sections.length-1;g++)if(this.sections[g].paragraph&&this.sections[g+1].character){var m=this.sections[g];this.sections[g]=this.sections[g+1],this.sections[g+1]=m}};ee.prototype.writeCharacterSection=function(e){e.writeStartElement("Section"),e.writeAttributeString("N","Character"),this.sections.forEach(function(t){t.character&&_(e,t.ix,t.character)}),e.writeEndElement()},ee.prototype.writeParagraphSection=function(e){e.writeStartElement("Section"),e.writeAttributeString("N","Paragraph"),this.sections.forEach(function(t){t.paragraph&&_(e,t.ix,t.paragraph)}),e.writeEndElement()},ee.prototype.writeHyperlinkSection=function(e){e.writeStartElement("Section"),e.writeAttributeString("N","Hyperlink");var t=0;this.sections.forEach(function(n){if(n.link){t+=1,e.writeStartElement("Row"),e.writeAttributeString("N","Row_"+t);for(var o in n.link)i.call(n.link,o)&&b(e,o,n.link[o]);e.writeEndElement()}}),e.writeEndElement()},ee.prototype.writeTextSection=function(e){e.writeStartElement("Text"),this.sections.forEach(function(t){t.text?e.writeString(t.text.replace(/(\r\n|\r|\n)/g,"\r\n")):t.paragraph?q(e,t.ix):t.character&&U(e,t.ix)}),e.writeEndElement()};var te=function(e,t,n,i,o,s){e.writeStartElement("Shape");var l=G();e.writeAttributeString("Type","Shape"),e.writeAttributeString("ID",l),e.writeAttributeString("NameU","Node"+l),e.writeAttributeString("Name","Node"+l),t.shape()?e.writeAttributeString("Master","2"):e.writeAttributeString("Master","1");var a=n.boundingBox(),u=t.x(),c=t.y(),h=d*(a.x2-a.x),p=d*(a.y2-a.y);b(e,"PinX",i(u)),b(e,"PinY",o(c));var f={x:0,y:0};switch(t.hAnchor()){default:case"center":f.x=h/2;break;case"left":f.x=0;break;case"right":f.x=h}switch(t.vAnchor()){default:case"center":f.y=p/2,b(e,"VerticalAlign",1);break;case"top":f.y=p,b(e,"VerticalAlign",0);break;case"bottom":f.y=0,b(e,"VerticalAlign",2)}b(e,"LocPinX",f.x),b(e,"LocPinY",f.y),b(e,"Width",h),b(e,"Height",p),b(e,"TxtPinX",h/2),b(e,"TxtPinY",p/2),b(e,"TxtLocPinX",h/2),b(e,"TxtLocPinY",p/2),b(e,"TxtWidth",h),b(e,"TxtHeight",p),b(e,"LineColor","#000000"),t.shape()&&(b(e,"FillForegnd",t.colour()),"label"!==t.shape()&&("root"!==t.shape()||t.isTitle()||t.hasChildren())||b(e,"FillPattern",0));var g=new ee(t,n);g.writeCharacterSection(e),g.writeParagraphSection(e),g.writeHyperlinkSection(e),e.writeStartElement("Section"),e.writeAttributeString("N","Connection"),e.writeStartElement("Row"),e.writeAttributeString("IX","1"),b(e,"X",f.x),b(e,"Y",f.y),b(e,"DirX",0),b(e,"DirY",0),e.writeEndElement();var m;if(t.shape()){m=n.getSize();var v=2;r.connectionsForSize(t.shape(),m).forEach(function(t){e.writeStartElement("Row"),e.writeAttributeString("IX",""+v),b(e,"X",f.x+t.x*d),b(e,"Y",f.y-t.y*d),b(e,"DirX",0),b(e,"DirY",0),e.writeEndElement(),v+=1})}if(e.writeEndElement(),e.writeStartElement("Section"),e.writeAttributeString("N","Geometry"),e.writeAttributeString("IX","0"),t.shape()){var y=r.path(t.shape(),m.w,m.h);K(e,y,f)}else z(e,"MoveTo",1,{X:d*(a.x-u)+f.x,Y:d*(c-a.y)+f.y}),z(e,"LineTo",2,{X:d*(a.x2-u)+f.x,Y:d*(c-a.y)+f.y}),z(e,"LineTo",3,{X:d*(a.x2-u)+f.x,Y:d*(c-a.y2)+f.y}),z(e,"LineTo",4,{X:d*(a.x-u)+f.x,Y:d*(c-a.y2)+f.y}),z(e,"LineTo",5,{X:d*(a.x-u)+f.x,Y:d*(c-a.y)+f.y});b(e,"NoFill","0"),b(e,"NoLine","0"),b(e,"NoShow","0"),b(e,"NoSnap","0"),b(e,"NoQuickDrag","0"),e.writeEndElement(),g.writeTextSection(e),e.writeEndElement(),s[t.id]={to_shape:{id:l}}},ne=function(e,t,n,i,r,s){var l=t.parent();if(l){var a=o.connectionParameters(n.diagram,l,t),u=G();s[t.id].from_shape={id:s[l.id].to_shape.id},s[t.id].connection={id:u,from_connection_id:a.idf,to_connection_id:a.idt},e.writeStartElement("Shape"),e.writeAttributeString("Type","Shape"),e.writeAttributeString("ID",u),e.writeAttributeString("NameU","Connection"+u),e.writeAttributeString("Name","Connection"+u),e.writeAttributeString("Master","3");var c=l.x(),h=l.y(),p=i(c+a.xf),f=r(h+a.yf),g=i(c+a.xt),m=r(h+a.yt),v=s[t.id].from_shape.id,y=s[t.id].to_shape.id,w=1+s[t.id].connection.from_connection_id,_=1+s[t.id].connection.to_connection_id;b(e,"BeginX",p,"GUARD(PAR(PNT(Sheet."+v+"!Connections.X"+w+",Sheet."+v+"!Connections.Y"+w+")))"),b(e,"BeginY",f,"GUARD(PAR(PNT(Sheet."+v+"!Connections.X"+w+",Sheet."+v+"!Connections.Y"+w+")))"),b(e,"EndX",g,"GUARD(PAR(PNT(Sheet."+y+"!Connections.X"+_+",Sheet."+y+"!Connections.Y"+_+")))"),b(e,"EndY",m,"GUARD(PAR(PNT(Sheet."+y+"!Connections.X"+_+",Sheet."+y+"!Connections.Y"+_+")))"),b(e,"BegTrigger","2","_XFTRIGGER(Sheet."+v+"!EventXFMod)"),b(e,"EndTrigger","2","_XFTRIGGER(Sheet."+y+"!EventXFMod)"),b(e,"PinX",(p+g)/2,"GUARD((BeginX+EndX)/2)"),b(e,"PinY",(f+m)/2,"GUARD((BeginY+EndY)/2)"),b(e,"Width",g-p,"GUARD(EndX-BeginX)"),b(e,"Height",m-f,"GUARD(EndY-BeginY)"),b(e,"LocPinX",(g-p)/2,"GUARD(Width/2)"),b(e,"LocPinY",(m-f)/2,"GUARD(Height/2)"),b(e,"Angle",0,"GUARD(0DA)"),b(e,"FlipX",0,"GUARD(FALSE)"),b(e,"FlipY",0,"GUARD(FALSE)"),b(e,"ResizeMode",0),b(e,"ObjType",1),b(e,"NoAlignBox",1),b(e,"NoObjHandles",1),b(e,"UpdateAlignBox",1);var x=(a.xt-a.xf)*d,E=(a.yt-a.yf)*d;Math.abs(x)<.001&&(x=.001),Math.abs(E)<.001&&(E=.001),b(e,"LineColor",t.colour()),b(e,"LineWeight",t.lineWeight()*d),e.writeStartElement("Section"),e.writeAttributeString("N","Geometry"),e.writeAttributeString("IX","0");var A,S=1;if("straight"===t.lineShape()){A=o.straightCPForConnection(n.diagram,l,t,a,void 0);var C=!0;A.forEach(function(t){C?(C=!1,z(e,"RelMoveTo",S,{X:d*(t.x-a.xf)/x,Y:d*(t.y-a.yf)/E})):z(e,"RelLineTo",S,{X:d*(t.x-a.xf)/x,Y:d*(t.y-a.yf)/E}),S+=1})}else{A=o.bezierCPForConnection(n.diagram,l,t,a,void 0);for(var F=0;F<A.length;F+=3){var k=A[F];0===F?z(e,"RelMoveTo",S,{X:d*(k.x-a.xf)/x,Y:d*(k.y-a.yf)/E}):z(e,"RelCubBezTo",S,{A:d*(A[F-2].x-a.xf)/x,B:d*(A[F-2].y-a.yf)/E,C:d*(A[F-1].x-a.xf)/x,D:d*(A[F-1].y-a.yf)/E,X:d*(k.x-a.xf)/x,Y:d*(k.y-a.yf)/E}),S+=1}}b(e,"NoFill","1"),b(e,"NoLine","0"),b(e,"NoShow","0"),e.writeEndElement(),e.writeEndElement()}},ie=function(e,t,n,i,o){t.forEach(function(t){var r=t.model;if(!o[r.joinedNode().id])return void console.error("invalid join for export "+r.id+" "+r.joinedNode().id);o[r.id]={to_shape:{id:o[r.joinedNode().id].to_shape.id}},ne(e,r,t,n,i,o)})},oe=function(e,t){e.writeStartElement("Connects");for(var n in t)i.call(t,n)&&t[n].from_shape&&t[n].to_shape&&(e.writeStartElement("Connect"),e.writeAttributeString("FromSheet",t[n].connection.id),e.writeAttributeString("FromCell","EndX"),e.writeAttributeString("FromPart","12"),e.writeAttributeString("ToSheet",t[n].to_shape.id),e.writeAttributeString("ToCell","Connections.X"+(1+t[n].connection.to_connection_id)),e.writeAttributeString("ToPart",""+(100+t[n].connection.to_connection_id)),e.writeEndElement(),e.writeStartElement("Connect"),e.writeAttributeString("FromSheet",t[n].connection.id),e.writeAttributeString("FromCell","BeginX"),e.writeAttributeString("FromPart","9"),e.writeAttributeString("ToSheet",t[n].from_shape.id),e.writeAttributeString("ToCell","Connections.X"+(1+t[n].connection.from_connection_id)),e.writeAttributeString("ToPart",""+(100+t[n].connection.from_connection_id)),e.writeEndElement());e.writeEndElement()};t.init=function(e){u(function(t,n){if(t)return e(t);s=n.jszip,e()})},t.start=n,t.id="vsdx",t.name="Visio 2013 File",t.extension=".vsdx"}),define("starc/docx.js",["require","exports","module","starc/starc.coggleexport","xmlwriter","utils/loaddeferred","utils/opc.js"],function(e,t){function n(e){return{0:"Title",1:"Heading1",2:"Heading2",3:"Heading3",4:"Heading4"}[e]}function i(e){[["xmlns:ve","http://schemas.openxmlformats.org/markup-compatibility/2006"],["xmlns:o","urn:schemas-microsoft-com:office:office"],["xmlns:r",m],["xmlns:w10","urn:schemas-microsoft-com:office:word"],["xmlns:w","http://schemas.openxmlformats.org/wordprocessingml/2006/main"],["xmlns:wne","http://schemas.microsoft.com/office/word/2006/wordml"]].forEach(function(t){e.writeAttributeString(t[0],t[1])})}function o(e,t,i){e.writeStartElement("w:p");var o=n(t.level());o&&(e.writeStartElement("w:pPr"),e.writeStartElement("w:pStyle"),e.writeAttributeString("w:val",o),e.writeEndElement(),e.writeEndElement()),e.writeStartElement("w:r"),e.writeStartElement("w:t"),e.writeAttributeString("xml:space","preserve"),e.writeString(t.text().replace(/(\r\n|\r|\n)/g,"\r\n")),e.writeEndElement(),e.writeEndElement(),e.writeEndElement()}function r(){var e=new XMLWriter(v);return e.writeStartDocument(!0),e.writeStartElement("w:fonts"),i(e),e.writeStartElement("w:font"),e.writeAttributeString("w:name","Arial"),e.writeEndElement(),e.writeEndElement(),e.flush()}function s(){var e=new XMLWriter(v);return e.writeStartDocument(!0),e.writeStartElement("w:settings"),i(e),e.writeStartElement("w:compat"),e.writeStartElement("w:compatSetting"),e.writeAttributeString("w:val","15"),e.writeAttributeString("w:name","compatibilityMode"),e.writeAttributeString("w:uri","http://schemas.microsoft.com/office/word"),e.writeEndElement(),e.writeEndElement(),e.writeEndElement(),e.flush()}function l(){return g.generateRels([{id:"rId1",type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",target:"word/document.xml"}])}function a(e,t,n){e.writeStartElement(t),e.writeAttributeString("w:val",n),e.writeEndElement()}function u(e,t,n,i){e.writeStartElement("w:style"),e.writeAttributeString("w:type","paragraph"),e.writeAttributeString("w:styleId",t),a(e,"w:name",n),a(e,"w:basedOn","Normal"),a(e,"w:next","Normal"),e.writeStartElement("w:pPr"),a(e,"w:keepNext","1"),a(e,"w:keepLines","1"),e.writeStartElement("w:spacing"),e.writeAttributeString("w:after","80"),e.writeAttributeString("w:before","240"),e.writeAttributeString("w:lineRule","auto"),e.writeEndElement(),e.writeEndElement(),e.writeStartElement("w:rPr"),a(e,"w:sz",""+2*i),a(e,"w:szCs",""+2*i),e.writeEndElement(),e.writeEndElement()}function d(){var e=new XMLWriter(v);return e.writeStartDocument(!0),e.writeStartElement("w:styles"),i(e),e.writeStartElement("w:docDefaults"),e.writeStartElement("w:rPrDefault"),e.writeStartElement("w:rPr"),e.writeStartElement("w:rFonts"),e.writeAttributeString("w:ascii","Arial"),e.writeAttributeString("w:cs","Arial"),e.writeAttributeString("w:eastAsia","Arial"),e.writeAttributeString("w:hAnsi","Arial"),a(e,"w:sz","22"),a(e,"w:szCs","22"),e.writeEndElement(),e.writeEndElement(),e.writeEndElement(),e.writeEndElement(),e.writeStartElement("w:style"),e.writeAttributeString("w:type","paragraph"),e.writeAttributeString("w:styleId","Normal"),e.writeAttributeString("w:default","1"),e.writeEndElement(),u(e,"Heading1","Heading 1",20),u(e,"Heading2","Heading 2",16),u(e,"Heading3","Heading 3",14),u(e,"Heading4","Heading 4",12),u(e,"Heading5","Heading 5",11),u(e,"Title","Title",25),e.writeEndElement(),e.flush()}function c(){return g.generateRels([{id:"rId1",type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/settings",target:"settings.xml"},{id:"rId2",type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/fontTable",target:"fontTable.xml"},{id:"rId3",type:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",target:"styles.xml"}])}function h(e){console.log("vsdx export");var t=new f;t.file("[Content_Types].xml",g.contentTypes([["/word/settings.xml","application/vnd.openxmlformats-officedocument.wordprocessingml.settings+xml"],["/word/styles.xml","application/vnd.openxmlformats-officedocument.wordprocessingml.styles+xml"],["/word/fontTable.xml","application/vnd.openxmlformats-officedocument.wordprocessingml.fontTable+xml"],["/word/document.xml","application/vnd.openxmlformats-officedocument.wordprocessingml.document.main+xml"]]),y),t.file("_rels/.rels",l(),y),t.file("word/_rels/document.xml.rels",c(),y),t.file("word/settings.xml",s(),y),t.file("word/styles.xml",d(),y),t.file("word/fontTable.xml",r(),y);var n=new XMLWriter(v);return n.writeStartDocument(!0),n.writeStartElement("w:document"),i(n),n.writeAttributeString("xml:space","preserve"),n.writeStartElement("w:body"),{generate:function(t){o(n,t,e.getNodeForId(t.id))},finish:function(e){return n.writeEndElement(),t.file("word/document.xml",n.flush(),y),t.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:1},mimeType:"application/x-vsd"}).then(function(t){e(null,t,!0)}),null}}}e("starc/starc.coggleexport"),e("xmlwriter");var p=e("utils/loaddeferred"),f=null,g=e("utils/opc.js"),m=g.xmlns.docrels,v="UTF-8",y={createFolders:!1};t.init=function(e){p(function(t,n){if(t)return e(t);f=n.jszip,e()})},t.start=h,t.id="docx",t.name="Microsoft Word",t.extension=".docx"}),define("views/DownloadDialogView",["require","exports","module","underscore","backbone","js-cookie","utils/queryString","starc/starc.coggleexport","starc/starc.coggleexport.mm","starc/starc.coggleexport.plaintext","starc/starc.coggleexport.vsdx","starc/docx.js"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=e("js-cookie"),s=e("utils/queryString"),l=e("starc/starc.coggleexport"),a=e("starc/starc.coggleexport.mm"),u=e("starc/starc.coggleexport.plaintext"),d=e("starc/starc.coggleexport.vsdx"),c=e("starc/docx.js");s().docx&&r.set("docx","1",{path:"/",expires:7});var h=o.View.extend({tagName:"div",className:"downloads",template:i.template('<div><ul class="cogglelist download-types"><li class="pdf-export"><a><span class="label" data-l10n-id="download-pdf">Download PDF</span><span class="download-icon"></span></a></li><li class="png-export"><a><span class="label" data-l10n-id="download-png">Download Image</span><span class="download-icon"></span></a></li><li class="vsdx-export"><a><span class="label" data-l10n-id="download-visio">Visio Flowchart (.vsdx)</span><span class="download-icon"></span></a></li><li class="mm-export"><a><span class="label" data-l10n-id="download-mm">.mm File</span><span class="download-icon"></span></a></li><li class="txt-export"><a><span class="label" data-l10n-id="download-txt">Plain-Text Outline</span><span class="download-icon"></span></a></li><li class="docx-export"><a><span class="label" data-l10n-id="download-word">Word Headings (.docx)</span><span class="download-icon"></span></a></li></ul><div data-l10n-id="download-import-tip" class="upload-tip"><b>Looking for imports?</b> Drag a .mm or .txt file onto a diagram to import it! <a data-l10n-name="import-link" href="https://coggle.help/article/34-import-files-into-coggle" target="_blank" rel="noopener noreferrer">Read more.</a></div></div>'),events:{"click .pdf-export":"pdfClicked","click .png-export":"pngClicked","click .mm-export":"mmClicked","click .txt-export":"txtClicked","click .vsdx-export":"vsdxClicked","click .docx-export":"docxClicked"},initialize:function(e){i.bindAll(this,"render","resetDownload","pdfClicked","pngClicked","mmClicked","vsdxClicked","docxClicked","txtClicked"),this.options=e,this.diagram=this.options.starcDiagram,this.listenTo(this.diagram.model.getNodes(),"change",i.debounce(this.resetDownload,200)),(r.get("docx")||"staging.coggle.it"===window.location.hostname)&&this.$el.addClass("docx-enabled")},render:function(){return this.$el.html(this.template()),this.prepareDownloadAsync("png"),this.prepareDownloadAsync("pdf"),this},refresh:function(){this.$el.find(".preparing").length||this.$el.find(".available").length||(this.prepareDownloadAsync("png"),this.prepareDownloadAsync("pdf"))},resetDownload:function(){var e=this.$el.find("li");e.attr("href",null),e.removeClass("available"),e.removeClass("failed")},pdfClicked:function(){this.$el.find(".pdf-export.preparing").length||this.$el.find(".pdf-export.available").length||this.prepareDownloadAsync("pdf")},pngClicked:function(){this.$el.find(".png-export.preparing").length||this.$el.find(".png-export.available").length||this.prepareDownloadAsync("png")},txtClicked:function(e){l.doExport(u,this.diagram,e)},mmClicked:function(e){l.doExport(a,this.diagram,e)},vsdxClicked:function(e){l.doExport(d,this.diagram,e)},docxClicked:function(e){l.doExport(c,this.diagram,e)},prepareDownloadAsync:function(e){var t=this.$el.find("."+e+"-export");t.removeClass("failed").addClass("preparing").find(".error").remove();var n=window.location.pathname.replace(/\/t\/[^\/]*/,"").replace("/diagram/","/api/1/diagrams/")+"/render";"static.coggle.it"==window.location.hostname&&(n="https://coggle.it"+n);var i=this.diagram.getSVGContentsBoundingRect(30),o=Math.abs(i.xmax-i.xmin),r=Math.abs(i.ymax-i.ymin),s=1.4;"png"===e&&s*s*o*r>24375e4&&(s=Math.sqrt(24375e4/(o*r)));var l=this.diagram.model.lastSavedModified();n=n+"?type="+e+"&width="+o+"&height="+r+"&scale="+s+"&mtime="+l.toISOString(),$.ajax(n,{method:"GET",timeout:3e5,dataType:"json",xhrFields:{withCredentials:!0}}).done(function(n){console.log("done "+e+": "+(n&&n.url)),t.removeClass("preparing").removeClass("failed").addClass("available"),t.find("a").attr({href:n.url,download:document.title,target:"_blank"})}).fail(function(n,i){console.warn("failed "+e+": "+(n&&n.responseText)+", "+i),t.removeClass("preparing").addClass("failed").removeClass("available"),t.find(".label").after("<span class='error' title='Click to retry' data-l10n-id='download-failed'>File Generation Failed</span>"),t.find("a").removeAttr("href")})}});n.exports=h}),define("views/HistoryView",["require","exports","module","underscore","backbone","utils/coggle-timeago","l10n","env","env"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=e("utils/coggle-timeago"),s=e("l10n"),l=o.View.extend({tagName:"ul",className:"dates discrete-slider",from:null,events:{},initialize:function(e){i.bindAll(this,"reset","addTimes","render"),this.options=e},shouldDisplayLabel:function(e,t){return(new Date).getTime()-t.getTime()<216e5||t.toDateString()!=e.toDateString()},reset:function(e,t){this.pending_request&&(this.resetting=!0,this.pending_request.abort()),this.revisionSelected(e,t)},revisionSelected:function(e,t){return e&&this.from?(console.log("selected date: "+e.toISOString()+" from: "+this.from.toISOString()),this.from.getTime()===e.getTime()?void(t&&t(!1)):(this.slider.working(!0),void(this.pending_request=$.ajax({url:this.model.url()+"/changes",data:{from_date:this.from.toJSON(),to_date:e.toJSON()}}).done(function(n){this.slider.working(!1),this.pending_request=null,$(window).trigger("clockify-timetravel",[e]),n.error?t&&t(n.error):(this.from=e,$.each(n,function(e,t){try{this.model.getNodes().onDelta(t,this.model)}catch(e){console.log("failed to apply:",e,t)}}.bind(this)),t&&t())}.bind(this)).fail(function(){this.slider.working(!1),this.pending_request=null,this.resetting||$(window).trigger("notify-error","Could not load this version, please try again."),t(new Error("Loading failed."))}.bind(this))))):t()},addTimes:function(e){var t=this.slider;if(this.$el.find("li").remove(),e.length<=1)return t.addStop({label:"no history yet",data:(new Date).toJSON()});e=e.map(function(e){return new Date(e)});var n=e[0];t.addStop({label:$.timeago(n),data:n.toJSON()});for(var i=1;i<e.length-1;i++){var o=e[i];this.shouldDisplayLabel(n,o)?(t.addStop({label:$.timeago(o),data:o.toJSON()}),n=o):t.addStop({label:$.timeago(o),class:"stop",data:o.toJSON()})}var r=e[e.length-1];this.current=t.addStop({label:$.timeago(r)+" ("+(s.getSync("current-version")||"current")+")",data:r.toJSON()}),t.slideTo(this.current,0),this.from=e[e.length-1];var l=0,a=null;this.$el.off("positionchange"),this.$el.on("positionchange",function(e,t){this.removeCloning(),this.$el.attr("disabled","disabled"),window.setTimeout(function(){this.$el.attr("disabled",!1)}.bind(this),l>=3e3?3e3:l+=500);var n=new Date($(t).attr("data"));ga("send","event","History","Change"),getCoggleUser().getActions().unique("diagram:history:seek"),this.revisionSelected(n,function(e){if(e)return void console.log(e);n!=a&&(this.model.canClone()&&this.addCloning(t),a=n)}.bind(this))}.bind(this))},removeCloning:function(){this.$el.find(".clonelink").remove()},addCloning:function(t){var n='<img src="'+e("env").cdn.url+'/img/clone.png" class="cloneimg"/>',i=(e("env").cdn.url,this.model.url(),$(t).attr("data"));$("<a>",{href:"/clone/"+this.model.id+"?clone[]=content&clone[]=folder&clone[]=title&date="+encodeURIComponent(i),html:n,title:"Create a copy of this version.",class:"clonelink"}).prependTo(t)},render:function(e){this.$el.empty();var t=this.slider=this.$el.discreteSlider();t.addSlider(),t.working(!0);var n=t.addStop({label:"loading history...",data:(new Date).toJSON()});t.slideTo(n,0);var o=Math.floor(($(window).height()-140)/22),s=this.model.url()+"/dates";return $.ajax({url:s,data:{limit:o}}).fail(function(){this.slider.working(!1),$(window).trigger("notify-error","Could not load history, please try again.")}.bind(this)).done(function(t){this.slider.working(!1);var n=2500+Date.parse(this.options.diagram.model.get("timestamp"));t=i.filter(t,function(e){return Date.parse(e)>n}),r.loadLanguages(function(){this.addTimes(t),e&&e(t)}.bind(this))}.bind(this)),this}});n.exports=l}),define("views/NotificationSearchView",["require","exports","module","underscore","backbone","jquery-ui/widgets/autocomplete"],function(e,t,n){var i=e("underscore"),o=e("backbone");e("jquery-ui/widgets/autocomplete");var r=o.View.extend({tagName:"div",className:"search-box",events:{"keyup input":"search","keydown input":"updateClear","keypress input":"addAutocomplete","click .clear":"clear","click .node-filter":"clearNodes"},template:i.template("<div class='filter'>    <input data-l10n-id='messages-search' placeholder='Search' value='<%- query %>'/>    <div class='overlays'>        <div class='clear' style='display:none'></div>    </div>    <% if(nodes.length >= 1) { %>        <div class='filter-details'>            Commenting on            \"<a href='<%-nodes[0].link%>' class='short-content'><%- nodes[0].text %></a>\"<% if(nodes.length == 1) { %>.            <% } else if(nodes.length == 2) { %>                and <a href='<%-nodes[1].link%>' class='short-content'>\"<%- nodes[1].text %>\".</a>            <% } else if(nodes.length > 2) { %>                and <%- nodes.length-1 %> other items.</span>            <% } %>            <div class='node-filter'>                <span data-l10n-id='messages-node-clear'>Clear</span>                <a class='clear-nodes'></a>            </div>        </div>    <% } %></div>"),initialize:function(e){i.bindAll(this,"render","search","clear","updateClear","addAutocomplete"),this.options=e,this.listenTo(this.model,"change",function(){this.$el.find("input").is(":focus")||this.render(),this.updateClear()}.bind(this)),this.updateClear()},render:function(){var e=this.model.getNodes().map(function(e){var t=e.text().trim();return t.length>=15&&(t=t.substr(0,15).trim()+"..."),t.length||(t="empty item"),{text:t,link:"#"+e.shortId()}});return this.$el.html(this.template({query:this.model.getQuery(),nodes:e})),this},clear:function(){this.model.setQuery(""),this.$el.find("input").val(this.model.getQuery()),this.updateClear()},clearNodes:function(){this.model.setNodes([])},updateClear:function(){this.$el.find("input").val()&&0!==this.$el.find("input").val().trim().length?this.$el.find(".clear").show():this.$el.find(".clear").hide()},search:i.debounce(function(e){if(e&&27==e.keyCode)return this.clear();this.model.setQuery(this.$el.find("input").val().trim())},250),addAutocomplete:function(){}});n.exports=r}),define("views/NotificationCreationView",["require","exports","module","underscore","backbone","plugins/jquery.markdownButtons","plugins/jquery.markdownShortcuts","models/NotificationSearch","models/Notification"],function(e,t,n){var i=e("underscore"),o=e("backbone");e("plugins/jquery.markdownButtons"),
e("plugins/jquery.markdownShortcuts");var r=e("models/NotificationSearch"),s=e("models/Notification").NotificationModel,l=o.View.extend({tagName:"div",className:"notification-creation",possiblyTaggedUsers:[],events:{"keydown textarea":"handleEnter","picked-user textarea":"userTagged","focus textarea":"showButtons","blur textarea":"hideButtons","click .cancel":"cancelEdit","click .save":"submit","click .remove":"delete","import:image:done":"onImageUpload"},template:i.template("<div class='editor'><textarea data-l10n-id='messages-comments-notes' placeholder='Enter comments, discussion and notes.' rows='2'></textarea></div><div class='save-buttons'>    <div class='button compact danger remove'>Delete</div>    <div class='button compact secondary cancel'>Cancel</div>    <div class='button compact save'>Save</div></div>"),initialize:function(e){i.bindAll(this,"render","submit","growHeight","userTagged","cancelEdit","onImageUpload"),this.diagram=e.diagram},showButtons:function(){this.$el.find(".editor").addClass("focused")},hideButtons:function(){setTimeout(function(){this.$el.find("textarea").is(":focus")||this.$el.find(".editor").removeClass("focused")}.bind(this),500)},onImageUpload:function(e,t,n,i,o,r,s){return this.$el.find("textarea").val(this.$el.find("textarea").val()+"!["+r+"](attached://"+s+" "+o.width+"x"+o.height+")"),this.growHeight(),e.stopPropagation(),!1},userTagged:function(e,t){this.possiblyTaggedUsers.push(t)},growHeight:function(){var e=this.$el.find("textarea")[0].scrollHeight;this.$el.find("textarea").innerHeight()<e&&(this.$el.find("textarea").innerHeight(e+22),this.trigger("resize"))},resetHeight:function(){this.$el.find("textarea").css({height:""}),this.trigger("resize")},cancelEdit:function(){this.remove()},delete:function(){this.model&&this.model.destroy()},handleEnter:function(e){return(!e||!e.isDefaultPrevented())&&(e&&(13!==e.keyCode||e.altKey||e.shiftKey||e.ctrlKey)?this.growHeight():void this.submit())},submit:function(){this.resetHeight();var e=this.$el.find("textarea").val();if(0!==e.trim().length){var t=this.possiblyTaggedUsers.map(function(t){return-1!==e.indexOf("@"+t.displayName().replace(/\s/g,""))&&t.id});t=i.uniq(i.compact(t)),this.$el.find("textarea").prop("disabled",!0);var n=function(){this.$el.find("textarea").prop("disabled",!1),this.$el.find("textarea").val(""),this.possiblyTaggedUsers=[],this.$el.find("textarea").focus()}.bind(this),o=function(){this.$el.find("textarea").prop("disabled",!1),this.$el.find("textarea").focus(),this.$el.find("textarea").val(this.$el.find("textarea").val())}.bind(this),l=i.uniq(i.compact(i.union(s.extractTags(e),r.instance().activeTags())));this.model?this.model.save({message:e,tagged:t,tags:i.union(l,this.model.get("tags"))},{wait:!0,success:n,error:o}):this.collection.create({type:"chat",message:e,tagged:t,tags:l},{wait:!0,success:n,error:o}),ga("send","event","Notification","Chat"),getCoggleUser().getActions().perform("diagram:notifications:create")}else this.model&&this.model.save({message:""},{wait:!0})},render:function(){return this.$el.html(this.template()),this.$el.find("textarea").markdownButtons(this.diagram),this.$el.find("textarea").markdownShortcuts({}),this.$el.find("textarea").val(this.model?this.model.get("message"):""),this}});n.exports=l}),define("models/Fact",["require","exports","module","backbone"],function(e,t,n){var i=e("backbone"),o=[{id:"math",text:"Did you know you can write math in Coggles? (Yeah, geeky!) Use \\\\( LaTeX here \\\\) to try it out!",weight:1,more:"https://coggle.help/article/38-add-math-formulae-with-latex"},{id:"collaborate",text:"Did you know that you can collaborate in real-time with others? You can! Use the (+) button in the top right to invite others.",weight:1,more:"https://coggle.help/article/35-edit-collaboratively-with-others"},{id:"share",text:"Did you know that you can edit a Coggle at the same time as someone else? You can! Look for the (+) button in the top right to invite others.",weight:1,more:"https://coggle.help/article/35-edit-collaboratively-with-others"},{id:"font",text:"Did you know you can use a fixed-width code font in Coggles? You can!<br>Just use `backticks` around the text, it also stops other special syntax from being interpreted.",weight:1,more:"https://coggle.help/article/30-using-markdown-formatting-in-coggle"},{id:"bold",text:"Did you know you can use **bold text** in Coggles?<br>Just use **double asterisks** where you want the emphasis!",weight:1,more:"https://coggle.help/article/30-using-markdown-formatting-in-coggle"},{id:"italic",text:"Did you know you can use *italic text* in Coggles?<br>Just use *asterisks* where you want the emphasis!",weight:1,more:"https://coggle.help/article/30-using-markdown-formatting-in-coggle"},{id:"links",text:"Did you know you can put links in Coggles? You can!<br>They work like this:<br>[description](http://example.com)",weight:1,more:"https://coggle.help/article/30-using-markdown-formatting-in-coggle"},{id:"download",text:"Did you know that you can download your Coggle as a PDF or an image. You can! Look for the download button in the top right of the screen",weight:1,more:"https://coggle.help/article/105-supported-export-formats"},{id:"markdown",text:'Did you know that Coggle uses <a data-l10n-name="link" href="http://daringfireball.net/projects/markdown/">markdown syntax</a>? It does!<br>Try out links like this: &lt;http://example.com&gt;',weight:1,more:"https://coggle.help/article/30-using-markdown-formatting-in-coggle"},{id:"latex",text:'Did you know Coggle supports LaTeX formulae? It does!<br>Use \\\\( LaTeX here \\\\) to try it out! Check out <a data-l10n-name="link" href="http://en.wikibooks.org/wiki/LaTeX/Mathematics">this link</a> for syntax help.',weight:1,more:"https://coggle.help/article/38-add-math-formulae-with-latex"},{id:"move",text:"Want that item on a different part of the Coggle? No problem! Hold shift while dragging the (+) button of an item to reattach it somewhere else.",weight:1,more:""},{id:"fontsize",text:"Text too big? Too small? You can zoom!<br> use [ctrl] [+] / [ctrl] [-]",weight:1,more:"https://coggle.help/article/68-zoom-a-coggle-diagram"},{id:"zoomin",text:"Did you know you can zoom in for a closer look? You can!<br> use [ctrl] [+], or right click and drag the zoom icon!",weight:1,more:""},{id:"zoomout",text:"Did you know you can zoom out to see the big picture? You can!<br> use [ctrl] [-], or right click and drag the zoom icon!",weight:1,more:""},{id:"markdown2",text:'Did you know that <a data-l10n-name="link" href="http://daringfireball.net/projects/markdown/">Markdown</a> is awesome? It is, and Coggle supports it!',weight:1,more:"https://coggle.help/article/30-using-markdown-formatting-in-coggle"},{id:"pdf",text:"You can download your Coggle as a PDF! Look for the download button in the top right of the screen.",weight:1,more:"https://coggle.help/article/105-supported-export-formats"},{id:"png",text:"You can download your Coggle as an Image! Look for the download button in the top right of the screen.",weight:1,more:"https://coggle.help/article/105-supported-export-formats"},{id:"latex2",text:'Did you know Coggle supports LaTeX for math? It does!<br>Use \\\\( \\LaTeX here \\\\) to try it out! Here\'s <a data-l10n-name="link" href="http://en.wikibooks.org/wiki/LaTeX/Mathematics">a syntax guide</a>.',weight:1,more:"https://coggle.help/article/38-add-math-formulae-with-latex"},{id:"history",text:"Did you know you can view the history of who changed what, when in your Coggle? You can! Click the clock icon in the top right.",weight:1,more:"https://coggle.help/article/59-use-history-mode-to-see-who-made-changes"},{id:"images",text:"Did you know you can put images in your Coggle? You can!<br>Just drag and drop an image from your computer to wherever you want it.",weight:1,more:""},{id:"images2",text:"Did you know you can use images in Coggles? You can!<br>Drag and drop an image from your computer to wherever you want it. A mini version of the image is uploaded and saved!",weight:1,more:"https://coggle.help/article/36-add-images-to-your-coggle-diagram"},{id:"plaintext-in",text:"Did you know you can drag & drop plain text files onto Coggle to import them? You can!<br>If your file has indentation, Coggle will even add structure to the imported text.",weight:1,more:"https://coggle.help/article/34-import-files-into-coggle"},{id:"freemind-in",text:"Did you know you can drag & drop Freemind .mm files onto Coggle to import them? You can!",weight:1,more:""},{id:"link-drag",text:"Did you know you can drag a URL from your address bar onto a Coggle to make a link to that site? You can!",weight:1,more:""},{id:"text-size",text:"Did you know you can change the font? You can!<br>Use #, ##, or ### at the start of a line to make the text bigger.",weight:1,more:""},{id:"text-size2",text:"Did you know you can change the font? You can!<br>Drag the corner of the text editing area up or down to change the text size.",weight:1,more:""},{id:"text-size3",text:"Did you know you can change the text size? You can!<br>Drag the corner of the text editing area.",weight:1,more:""},{id:"md-reference",text:'Did you know you can use Markdown in Coggles to add links, images and more? You can!<br>Here\'s the <a data-l10n-name="link" href="https://coggle.help/article/30-using-markdown-formatting-in-coggle">complete reference</a>.',weight:1,more:""},{id:"multiline-keys",text:"Did you know you can break text over multiple lines? You can! Hold [ctrl] while pressing [return] to insert a newline. You can also drag the corner of the text editing area, and then use [return] normally.",weight:1,more:"https://coggle.help/article/56-add-a-line-break-in-text"},{id:"multiline-drag",text:"Did you know you can break text over multiple lines? You can! Drag the corner of the text editing area, then [return] will insert a newline instead of saving your edits. You can also hold [ctrl] while pressing [return] to insert a newline while typing.",weight:1,more:"https://coggle.help/article/56-add-a-line-break-in-text"},{id:"multiline-wrap",text:"Did you know you can break text over multiple lines? You can! Drag the corner of the text editing area left/right to wrap text onto multiple lines.",more:"",weight:1},{id:"resize-images",text:"Did you know you can resize images? you can! Drag an image onto your Coggle from anywhere on the internet (provided you have permission to use it), and then drag the lower right corner of the image to resize it.",weight:1,more:""},{id:"image-size",text:'Did you know we support a Markdown extension to specify image size? We do! Specify a 200 by 100 pixel image like this: ![image description](http://url.to.image "optional title" 200x100)',weight:1,more:""},{id:"bold-kbshort",text:"Did you know you can use keyboard shortcuts to add **bold text** in Coggles? You can! Just press [ctrl]+[b] (or [cmd]+[b] on macs) with the text you want bold selected.",weight:1,more:""},{id:"shortcuts-1",text:"Did you know you can edit your Coggle using only the keyboard? You can, here's how:<br>[tab] to add a child node<br>[shift]+[tab] to move to the parent<br>[shift]+[return] to add a sibling",weight:1,more:""},{id:"shortcuts-2",text:"Did you know you can select which branch to edit using keyboard shortcuts? You can!<br>Use [alt]+[shift]+arrow keys to move along branches.",weight:1,more:""},{id:"task-lists",text:'Did you know you can <a data-l10n-name="link" href="https://help.github.com/articles/github-flavored-markdown">Markdown</a> to add checklists to Coggles? You can, here\'s an example:<br>- [ ] unchecked checkbox<br>- [X] checked checkbox<br>Clicking on a checkbox automatically changes the markdown, too.',weight:1,more:""},{id:"api-1",text:"Did you know we have an API? We do! Programs can use it to create, examine and manipulate Coggles automatically.",more:"https://coggle.help/article/75-develop-applications-using-the-coggle-api",weight:1},{id:"organisation",text:"Using Coggle in Business? You can create a Coggle Organisation to manage your Company's Coggles.",more:"https://coggle.it/organisations",weight:1},{id:"organisation2",text:"Did you know Coggle Organisations can put their logo on their Coggles? They can!",more:"https://coggle.it/organisations",weight:1},{id:"organisation3",text:"Did you know you can create a Coggle Organisation to organise your businesses Coggles? You can!",more:"https://coggle.it/organisations",weight:1}],r=i.Model.extend({idAttribute:"id"}),s=i.Collection.extend({model:r,url:"#facts"}),l=new s(o);n.exports.CoggleFacts=l,n.exports.FactModel=r,n.exports.FactCollection=s}),define("views/FactViews",["require","exports","module","underscore","backbone","models/Fact"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=e("models/Fact").CoggleFacts,s=o.View.extend({tagName:"li",className:"fact",template:i.template("<span class='text' data-l10n-id='fact-<%-id%>'><%=text%></span><span class='more'><%=more%></span>"),events:{},initialize:function(e){i.bindAll(this,"render"),this.options=e},render:function(){var e=this.model.toJSON();return e.more&&e.more.length>0&&(e.more='<div><a target="_blank" href="'+e.more+'" data-l10n-id="cogglefacts-more">read more...</a></div>'),$(this.el).html(this.template(e)),this}}),l=o.View.extend({tagName:"div",className:"random-fact",index:0,template:i.template("<ul class='fact-list'></ul><a data-l10n-id='another-fact' class='next'>another!</a>"),events:{"click .next":"random"},initialize:function(e){i.bindAll(this,"render","display","random","next"),this.collection=r,this.options=e},render:function(){return $(this.el).html(this.template()),this.random(),this},display:function(e){this.index=e;var t=this.collection.at(this.index),n=new s({model:t});$(this.el).find(".fact-list").empty(),$(this.el).find(".fact-list").append(n.render().el)},random:function(){var e=this.collection.length,t=Math.floor(Math.random()*e);this.display(t)},next:function(){var e=++this.index%this.collection.length;this.display(e)}});n.exports.FactView=s,n.exports.RandomFactView=l}),define("views/NotificationView",["require","exports","module","underscore","utils/marked","backbone","utils/lightbox","utils/coggle-timeago","plugins/Backbone.childViews","models/NotificationSearch","views/NotificationCreationView","views/FactViews","views/AttachmentView","utils/coggle-encodeji","env"],function(e,t,n){var i=e("underscore"),o=e("utils/marked"),r=e("backbone"),s=e("utils/lightbox").addLightbox,l=e("utils/coggle-timeago");e("plugins/Backbone.childViews");var a=e("models/NotificationSearch"),u=e("views/NotificationCreationView"),d=e("views/FactViews").RandomFactView,c=e("views/AttachmentView").attachmentNotificationTemplate,h=e("utils/coggle-encodeji"),p=r.View.extend({tagName:"div",className:"notifications-end",template:i.template("<div data-l10n-id='messages-start' class='end'>You've reached the start!</div>"),render:function(){return this.$el.html(this.template()),this.$el.attr("timestamp","1970-01-01T00:00:00.000Z"),this}}),f=r.View.extend({tagName:"li",className:"notification",templates:{chat:i.template("<div class='message' style='border-color:<%-user.avatar.colour%>' ><%=message%> <% _.each(tagsNotInText, function(t) { %>  <a class='hashlink messagetag' href='#<%- t %>'>#<%- t %></a> <% }); %></div>"),tag:i.template("<div class='tag'><%=message%></div>"),newChatter:i.template("<div class='user'><div class='icon' style='background-color:<%-user.avatar.colour%>; background-image:url(<%-user.avatar.url%>);'/><span class='name' style='color:<%-user.avatar.colour%>'><%-user.name?user.name:'Guest'%></span><span class='time'><%-new Date(timestamp).getHours()%>:<%-('0'+(new Date(timestamp).getMinutes())).slice(-2)%></span></div>"),dateChange:i.template("<div class='date timeago'><time datetime='<%-timestamp%>'></time></div>"),attachment:c},events:{"click .edit":"edit"},initialize:function(e){i.bindAll(this,"render"),this.access=e.access,this.diagram=e.diagram,this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove),this.$el.attr("data-id",this.model.id),this.$el.attr("timestamp",this.model.get("timestamp")),this.options=e},render:function(){this.$el.empty();var t=this.model.toJSON();if(t.tagsNotInText=t.tags||[],"widget"===this.model.get("type"))return this.$el.html(this.model.get("view").render().$el),this.model.get("view").delegateEvents(),this;t.user||(t.user=this.access.get(t.owner)?this.access.get(t.owner).toJSON():{}),t.user.avatar||(t.user.avatar={}),this.options.previousModel&&(t.previous=this.options.previousModel.toJSON());var n=!t.previous||new Date(t.previous.timestamp).getDate()!=new Date(t.timestamp).getDate(),i=!t.previous||t.previous.owner!=t.owner;if(n){var r=this.templates.dateChange(t);this.$el.append(r),l.loadLanguages(function(){this.$el.find("time").timeago()}.bind(this))}"chat"!==t.type&&"attachment"!==t.type||!(t.previous&&"chat"!==t.previous.type&&"attachment"!==t.previous.type||n||i)||this.$el.append(this.templates.newChatter(t));var a=this.templates[t.type];if(t.message){var u=this.model.messageAndTags();t.message=o(u.message),t.tagsNotInText=u.tagsNotInText}var d=$(a(t));return a&&this.$el.append(d),"chat"!==t.type||!t.owner||getCoggleUser().id!==t.owner._id&&getCoggleUser().id!==t.owner||d.append($("<div class='edit'></div>")),"chat"===t.type&&h.replaceAndRender(this.$el.find(".message")[0]),this.diagram.getAttachments(function(t,n){if(t)return console.error(t);this.$el.find("img").each(function(){var t=$(this).attr("data-attachment-id");if(t){var i=n.getByLocalId(t);i?this.src=i.get("url"):(console.warn("image referenced unknown attachment: "+t),this.src=e("env").cdn.url+"/img/missing.png",$(this).addClass("missing"))}})}.bind(this)),this.$el.find("img").on("load",function(e){s($(e.target),!1,this.diagram)}.bind(this)),this},edit:function(){var e=new u({model:this.model,diagram:this.diagram});this.addChildView(e),this.$el.find(".message").prepend(e.render().$el),e.delegateEvents(),e.growHeight()}}),g=r.View.extend({tagName:"ul",className:"notifications",events:{scroll:"onScroll"},initialize:function(e){i.bindAll(this,"addOne","addAll","render"),this.options=e,this.attachments=e.attachments,this.endView=new p,this.addChildView(this.endView),this.access=e.access,this.diagram=e.diagram,this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"remove reset",this.addAll),this.listenTo(this.attachments,"add",function(e){this.collection.addAttachment(e)}.bind(this)),this.listenTo(this.attachments,"remove reset",this.addAll),this.listenTo(a.instance(),"change",this.addAll),this.listenTo(this.collection,"ended",function(){this.$el.addClass("ended")}.bind(this)),this.collection.more(),this.addAll(),this.scrollToBottom(),setTimeout(function(){this.collection.length||this.collection.addWidget(new d)}.bind(this),5e3)},render:function(){return this.addAll(),this},onScroll:function(e){this.lastScrolled=new Date,this.$el.prop("scrollHeight")>this.$el.innerHeight()&&this.$el.prop("scrollTop")<100&&this.collection.more()},scrollToBottom:function(e){(e||!this.$el.is(":hover")||!this.lastScrolled||Date.now()-this.lastScrolled.getTime()>5e3)&&setTimeout(function(){this.$el.prop({scrollTop:this.$el.prop("scrollHeight")})}.bind(this),0)},addOne:function(e){var t=this.collection.indexOf(e),n=t>0?this.collection.at(t-1):void 0,o=this.collection.at(t+1),r=new f({model:e,previousModel:n,access:this.access,diagram:this.diagram});this.addChildView(r);var s=r.render().$el,l=this.$el.prop("scrollHeight"),a=this.$el.prop("scrollTop"),u=this.$el.children().toArray(),d=i.sortedIndex(u,s,function(e){return new Date($(e).attr("timestamp")).getTime()});0===d&&this.$el.prepend(s),$(u[d-1]).after(s);var c=function(){if(o){var t=this.$el.prop("scrollHeight")-l;this.$el.prop("scrollTop",t+a)}else this.scrollToBottom(e.get("owner")===getCoggleUser().id)}.bind(this);c(),r.$el.find("img").one("load",c)},addAll:function(){this.$el.empty(),this.$el.prepend(this.endView.render().$el),a.instance().apply(this.collection).map(this.addOne),this.scrollToBottom()}});n.exports.NotificationView=f,n.exports.NotificationListView=g}),define("views/NotificationsPanelView",["require","exports","module","underscore","backbone","js-cookie","plugins/Backbone.childViews","models/NotificationSearch","views/NotificationSearchView","views/NotificationCreationView","views/NotificationView","views/FactViews","utils/coggle-encodeji"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=e("js-cookie");e("plugins/Backbone.childViews");var s=e("models/NotificationSearch"),l=e("views/NotificationSearchView"),a=e("views/NotificationCreationView"),u=e("views/NotificationView").NotificationListView,d=(e("views/FactViews").RandomFactView,e("utils/coggle-encodeji"),o.View.extend({tagName:"div",className:"notification-panel",events:{"click .close":"close","click .hashlink":"hashlink",mousemove:"resetPending"},template:i.template("<div class='control'>    <button class='close'></button>    <div class='title' data-l10n-id='messages-title'>Messages</div></div>"),unseenMessages:0,disconnectionTimeout:!1,initialize:function(e){i.bindAll(this,"render","isClosed","close","layout","resetPending","setLastViewed","hashlink"),this.options=e,this.access=e.access,this.diagram=e.diagram,this.notificationList=new u({collection:this.collection,attachments:e.diagram.getAttachments(),access:this.access,diagram:e.diagram}),this.searchView=new l({model:s.instance()}),this.addChildView(this.notificationList),this.addChildView(this.searchView),this.listenTo(s.instance(),"change",function(){$("body").addClass("notifications-open")}.bind(this)),this.creationView=new a({collection:this.collection,diagram:this.diagram}),this.addChildView(this.creationView),this.listenTo(this.creationView,"resize",this.layout),this.listenTo(this.collection,"add",function(e){"widget"!=e.get("type")&&e.get("owner")!=getCoggleUser().id&&this.isClosed()&&this.lastViewed&&new Date(e.get("timestamp")).getTime()>new Date(this.lastViewed).getTime()&&(this.unseenMessages=this.unseenMessages+1,this.trigger("unseen",this.unseenMessages))}.bind(this))},hashlink:function(e){var t=$(e.target).attr("href").replace(/^#/,""),n=this.diagram.getNodes().filter(function(e){return e.matchesLink(t,!0)});s.instance().setNodes(n),n.length||s.instance().setQuery("#"+t)},remove:function(){o.View.prototype.remove.apply(this),$("body").removeClass("notifications-open")},open:function(){$("body").addClass("notifications-open"),this.$el.trigger("notifications-state-changed"),this.notificationList.scrollToBottom(!0)},isClosed:function(){return!$("body").hasClass("notifications-open")},close:function(e){return s.instance().setQuery(""),s.instance().setNodes([]),$("body").removeClass("notifications-open"),r.set("messages-state","0",{path:"/"}),this.$el.trigger("notifications-state-changed"),ga("send","event","Notifications","Close"),e&&e.stopPropagation(),!1},setLastViewed:function(e){this.lastViewed=e},resetPending:i.throttle(function(){this.unseenMessages=0,this.trigger("unseen",this.unseenMessages)},100),layout:function(){if(this.notificationList){var e=parseInt(this.notificationList.$el.css("padding-bottom")),t=this.creationView.$el.outerHeight();this.notificationList.$el.css({bottom:t});var n=this.notificationList.$el.scrollTop(),i=n+(t-e);i>n&&this.notificationList.$el.scrollTop(i)}},render:function(){return this.$el.html(this.template()),this.$el.append(this.searchView.render().$el),this.$el.append(this.notificationList.render().$el),this.$el.append(this.creationView.render().$el),this}}));n.exports=d}),define("views/Bookmark",["require","exports","module","backbone","underscore","models/Diagram","starc/starc","env","plugins/jquery.callout"],function(e,t,n){var i=e("backbone"),o=e("underscore"),r=e("models/Diagram").DiagramModel,s=e("starc/starc"),l=e("env").cdn.url;e("plugins/jquery.callout");var a=function(e,t,n){return new Error(e&&e.responseJSON&&e.responseJSON.description||e&&e.status&&e.statusText||"request failed")},u="<div class='content'><a href='<%- path %>?present=1' class='preview' style='background-image: url(<%- thumbnailUrl %>)'></a><div class='title<%- error? ' error' : '' %>'><%- error %><%- title %></div></div><div class='diagram-icons'><img src='"+l+"/img/dots.png' title='Options' class='icon more' /><img src='"+l+"/img/bin.png' title='Remove bookmark' class='icon delete' /></div>",d=i.View.extend({tagName:"div",className:"diagram bookmark col-sm-6 col-md-4",template:o.template(u),events:{"click .delete":"removeBookmark","click .more":"more",mouseleave:"less"},initialize:function(e){o.bindAll(this,"render","removeBookmark","more","less"),this.$el.attr("data-id",this.model.id),this.options=e,this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.remove);var t=this.diagram=new r({short_id:this.model.get("diagram")},{token:this.model.get("token")});t.setToken(this.model.get("token")),t.fetch().fail(function(e,t,n){this.error=a(e),e&&e.status>=400&&e.status<500&&(this.accessDenied=!0,this.error="Your access has been revoked."),this.render()}.bind(this)).done(function(){this.error="",this.render()}.bind(this))},render:function(){var e=this.model.get("path"),t=this.diagram.get("last_modified")||"unknown",n=l+e+"/thumbnail?cachebust=3&mtime="+encodeURIComponent(t);(this.accessDenied||this.errpr)&&(n="");var i=o.extend({path:e,thumbnailUrl:n,last_modified:t,token:this.model.get("token"),accessDenied:this.accessDenied,error:this.error},this.diagram.toJSON());return i.title=s.toTitleText(this.diagram.get("title")),$(this.el).html(this.template(i)),this},more:function(e){return e.stopPropagation(),this.$el.addClass("expanded"),!1},less:function(e){return e.stopPropagation(),this.$el.removeClass("expanded"),!1},removeBookmark:function(){this.model.destroy()}}),c=i.View.extend({tagName:"div",className:"bookmarks row",events:{},initialize:function(e){this.options=e,o.bindAll(this,"render","addOne","addAll"),this.listenTo(this.collection,"sync",this.addAll),this.$el.html($("<div class='diagram-list-notice diagram-list-bookmarks' data-l10n-id='doclist-bookmarks'><b>Bookmarked for Review</b> – Coggles that <a href='https://coggle.help/search?query=add+bookmark+TODO_ARTICLE'>you bookmark</a> will be here.<br>You can bookmark any diagram that's been shared with you to review it later, even if the author does not allow copies.</div>")),this.addAll()},render:function(){return this},addOne:function(e){var t=new d({model:e});this.addChildView(t),this.$el.append(t.render().$el)},addAll:function(){this.collection.each(this.addOne)}}),h=i.View.extend({tagName:"div",className:"bookmark-callout",template:o.template("<error><%-error%></error><div><% if(guest) { %><p>You are not signed in. Sign in to bookmark Coggle diagrams for later study or review.</p><a class='green button compact' data-bypass href='/login?redirectTo=<%-encodeURIComponent(redirectTo)%>'><p>Sign in</p></a><% } else { %><% if(my_bookmark) { %><p>This Coggle is saved in your bookmarks. <a href='/bookmarks'>View your bookmarks.</a></p><a class='secondary button compact removebookmark'><p>Remove bookmark</p></a><% } else { %><p>You can bookmark this Coggle to quickly return and review it later. <a href='/bookmarks'>View your bookmarks.</a></p><a class='button compact savebookmark'><p>Bookmark this Coggle</p></a><% } %><% } %></div>"),events:{"click .savebookmark":"saveBookmark","click .removebookmark":"removeBookmark"},initialize:function(e){o.bindAll(this,"render","saveBookmark","removeBookmark"),this.options=e,this.user=e.user,this.listenTo(this.model,"change:my_bookmark",function(){this.render()})},render:function(){var e=window.location;return this.$el.html(this.template({guest:this.user.isGuest(),redirectTo:e.pathname+e.search,my_bookmark:this.model.get("my_bookmark"),error:this.error})),this},working:function(e){this.$el.toggleClass("working",e)},saveBookmark:function(){this.error="",this.working(!0),this.model.setBookmark(function(e){this.error=e&&e.message||"",this.working(!1),this.render()}.bind(this))},removeBookmark:function(){this.error="",this.working(!0),this.model.removeBookmark(function(e){this.error=e&&e.message||"",this.working(!1),this.render()}.bind(this))}}),p=i.View.extend({tagName:"li",className:"action bookmark",events:{click:"clicked"},template:o.template("<% if(my_bookmark) { %><div class='icon' role='button' data-l10n-id='diagram-toolbar-bookmarked' title='This Coggle is Saved in your Bookmarks.'></div><% } else { %><div class='icon' role='button' data-l10n-id='diagram-toolbar-bookmark' title='Bookmark this Coggle.'></div><% } %>"),initialize:function(e){o.bindAll(this,"render","clicked"),this.options=e,this.user=e.user,this.listenTo(this.model,"change:my_bookmark",function(){this.render()}),this.$el.html("<div class='icon'></div>")},render:function(){var e={my_bookmark:this.model.get("my_bookmark")};return this.$el.find(".icon").replaceWith(this.template(e)),this.$el.toggleClass("bookmarked",!!e.my_bookmark),this.$el.toggleClass("alwaysvisible",!this.model.canClone()),this},clicked:function(){this.calloutView||(this.calloutView=new h({model:this.model,user:this.options.user}).render(),this.addChildView(this.calloutView)),this.callout||(this.callout=this.$el.callout(this.calloutView.$el,{my:"right top",at:"center bottom"})),this.callout.open(),this.calloutView.delegateEvents(),this.render()}});n.exports={Icon:p,Bookmarks:c}}),define("views/DiagramToolbar",["require","exports","module","underscore","backbone","js-cookie","l10n","plugins/jquery.callout","plugins/jquery.clockify","BrowserDetect","views/AccessListView","views/AccessSliderView","views/ShareViews","views/ShareViews","views/DownloadDialogView","views/HistoryView","views/NotificationsPanelView","utils/queryString","models/User","views/Bookmark"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=e("js-cookie"),s=e("l10n");e("plugins/jquery.callout"),e("plugins/jquery.clockify");var l=e("BrowserDetect"),a=e("views/AccessListView"),u=e("views/AccessSliderView"),d=e("views/ShareViews").DiagramShareView,c=e("views/ShareViews").ShareView,h=e("views/DownloadDialogView"),p=e("views/HistoryView"),f=e("views/NotificationsPanelView"),g=e("utils/queryString"),m=e("models/User"),v=e("views/Bookmark").Icon,y=o.View.extend({tagName:"div",className:"toolbar",template:i.template("<ul class='actions large'><li class='action history'><div class='icon' role='button' data-l10n-id='diagram-toolbar-history' title='View and copy previous versions.'></div></li><li class='action chat'><div class='icon' role='button' data-l10n-id='diagram-toolbar-messages' title='Comments and chat.'></div></li></ul><ul class='actions small'><li class='action present'><div class='icon' role='button' data-l10n-id='diagram-toolbar-present' title='Present and Review.'></div></li><li class='action social'><div class='icon' role='button' <% if(canShare){ %> data-l10n-id='diagram-toolbar-share' title='Share this Coggle.' <% }else{ %> title='Sharing has been disabled by your administrator' <% } %> ></div></li><li class='action download'><div class='icon' role='button' data-l10n-id='diagram-toolbar-download' title='Download this Coggle.'></div></li><% if(accessEphemeral){ %><li class='action clone-public'><div class='icon' role='button' data-l10n-id='diagram-toolbar-pubcopy' title='Create your own copy of this diagram.'>Use as Template</div></li><% }else{ %><li class='action clone'><div class='icon' role='button' data-l10n-id='diagram-toolbar-copy' title='Create a copy of this Coggle.'></div></li><% } %></ul><div class='public-tag' data-l10n-id='diagram-toolbar-public-detail' title='This diagram may appear in the Coggle Gallery and search results.'>Public Diagram</div>"),events:{"click .member.invite":"openSharing","click .action.history":"toggleHistory","click .action.chat":"openNotifications","click .action.present":"togglePresent","click .action.download":"openDownload","click .action.social":"openSocial",
"click .action.clone":"performClone","click .action.clone-public":"performClone","click .public-tag":"publicTagClicked"},initialize:function(e){i.bindAll(this,"render","renderMemberList","renderNotificationsView","error","openSharing","openDownload","openPermissions","updatePublicTag"),this.options=e,this.diagram=this.options.diagram,this.workspace=this.options.workspace,this.starcDiagram=this.options.workspace.getStarcView(),this.notifications=null,this.listenTo(this.diagram,"change",function(){this.updatePublicTag(),this.updateSocial()}),this.listenTo(this.starcDiagram,"node:editor:opened",function(){this.$el.addClass("toolbar-hidden")}.bind(this)),this.listenTo(this.starcDiagram,"node:editor:closed",function(){this.$el.removeClass("toolbar-hidden")}.bind(this)),$(document).on("keydown.toolbarContext",function(e){27==e.keyCode&&$("body").hasClass("presentation-mode")&&this.togglePresent()}.bind(this))},remove:function(){o.View.prototype.remove.apply(this),$(document).off("keydown.toolbarContext")},error:function(e){this.$el.trigger("notify-warning",e)},renderMemberList:function(){this.diagram.canWrite()&&!this.diagram.accessViaToken()&&(this.memberList||(this.memberList=new a({collections:[this.diagram.getAccess(function(){}),this.diagram.getInvites(function(){})]}),this.addChildView(this.memberList),this.memberList.$el.addClass("collapses"),this.listenTo(this.memberList,"selected",this.openPermissions),this.diagram.canWrite()&&this.memberList.addSharing()),this.$el.find(".actions.large").after(this.memberList.render().$el),this.memberList.delegateEvents())},renderNotificationsView:function(){if(this.workspace.isRealtime()&&!m.me().isGuest()&&(this.diagram.canWrite()||!this.diagram.accessViaToken())&&!this.notificationsView){this.notificationsView=new f({collection:this.diagram.getNotifications(),access:this.diagram.getAccess(),diagram:this.diagram}),this.addChildView(this.notificationsView),this.listenTo(this.notificationsView,"unseen",function(e){this.setPendingNotifications(e)}.bind(this));var e=function(){this.notificationsView.setLastViewed(this.diagram.get("last_viewed"))}.bind(this);this.listenTo(this.diagram,"change",e),this.listenTo(this.diagram,"sync",e),e(),(this.workspace.readOnly()||m.me().isGuest())&&this.notificationsView.$el.addClass("readonly"),this.workspace.$el.find(".diagram-container").append(this.notificationsView.render().$el)}},getNotificationsView:function(){return this.notificationsView},render:function(){this.$el.html(this.template({accessEphemeral:this.diagram.accessIsEphemeral(),accessViaToken:this.diagram.accessViaToken(),canShare:this.diagram.canShare()})),this.$el[0].setAttribute("role","toolbar"),this.$el.find(".action.history").clockify(),this.updatePublicTag(),this.renderMemberList(),this.renderNotificationsView();var e=m.me();return e.getActiveOrg()==e.getOwnOrg()&&e.bookmarksSupported()&&(this.$el.find(".actions.small").prepend(this.bookmarkIcon().render().$el),this.bookmarkIcon().delegateEvents()),this.updateSocial(),!this.diagram.accessViaToken()&&!m.me().isGuest()&&this.diagram.canWrite()||this.diagram.canShare()||this.$el.find(".action.social").remove(),(this.diagram.canWrite()&&!this.diagram.accessViaToken()||!this.diagram.canClone())&&(this.$el.find(".action.clone").remove(),this.$el.find(".action.clone-public").remove()),(m.me().isGuest()||this.diagram.accessViaToken()||this.diagram.accessIsEphemeral())&&this.$el.find(".action.chat").remove(),this.diagram.canWrite()||this.$el.find(".action.history").remove(),!this.diagram.get("deletedForEveryone")&&this.diagram.canClone()||this.$el.find(".action.download").remove(),"1"==r.get("messages-state")&&(m.me().isGuest()||$("body").hasClass("touch")||this.openNotifications()),this},bookmarkIcon:function(){return this._bookmarkIcon||(this._bookmarkIcon=new v({model:this.diagram,user:m.me()}),this.addChildView(this._bookmarkIcon)),this._bookmarkIcon},publicTagClicked:function(){this.trigger("item-clicked"),this.openSocial(),this.socialCallout&&m.me().getActions().unique("pitch:privatediagrams")},updatePublicTag:function(){this.diagram.get("public")&&!this.diagram.get("deletedForEveryone")?this.$el.find(".public-tag").show():this.$el.find(".public-tag").hide()},updateSocial:function(){this.diagram.canShare()?this.$el.find(".action.social").removeClass("disabled"):this.$el.find(".action.social").addClass("disabled")},openSharing:function(){if(this.trigger("item-clicked"),this.shareView||(this.shareView=new c({model:this.diagram}).render(),this.addChildView(this.shareView),this.listenTo(this.shareView,"error",this.error)),m.me().getActions().perform("diagram:invites:open"),!this.sharingCallout){this.sharingCallout=this.$el.find(".member.invite").callout(this.shareView.$el,{my:"right top",at:"center+15 bottom",closeOn:""});var e=this.sharingCallout;e.bind("mousedownoutside focusoutside",function(){e.find(".callout.is-open").length||(e.close(),this.trigger("sharing-closed"))}.bind(this))}this.sharingCallout.open(),this.shareView.delegateEvents(),"Explorer"===l.browser&&10==l.version||this.shareView.render().$el.find("input").focus(),this.sharingCallout.reposition(),m.me().getActions(function(e,t){!e&&t&&this.sharingCallout.find(".share-view").contextualHelp({actions:t,content:$("<div data-l10n-id='help-toolbar-invitemulti'/>").html("To save time, you can invite multiple people at once: type (or paste) email addresses separated by spaces, commas<b>,</b> or semicolons<b>;</b>"),position:{my:"center center",at:"left+20 bottom+6"},title:s.getSync("help-toolbar-invitemulti-title","Invite Multiple People"),after:"invited multiple to diagram",action:"help:invitemultiple",showOk:!0,on_complete:function(){this.sharingCallout.find("input").focus()}.bind(this)})}.bind(this))},openSocial:function(e){this.diagram.canShare()&&(this.socialView||(this.socialView=new d({model:this.diagram}).render(),this.addChildView(this.socialView)),m.me().getActions().unique("diagram:sharing:open"),ga("send","event","Social","Open"),this.socialCallout||(this.socialCallout=this.$el.find(".action.social").callout(this.socialView.$el,{my:"right top",at:"center bottom"})),this.socialCallout.open(),this.socialView.delegateEvents())},toggleHistory:function(){if(this.trigger("item-clicked"),$("body").hasClass("presentation-mode"))return void $(window).trigger("notify-info",["Close presentation mode first!"]);if(this.historyCallout||(this.historyView=new p({model:this.diagram,diagram:this.starcDiagram}),this.historyView.$el.addClass("right-align"),this.historyCallout=this.$el.find(".history").callout(this.historyView.$el,{closeOn:!1,my:"center top",at:"center bottom"}),this.addChildView(this.historyView)),$("body").hasClass("history-mode"))$("body").removeClass("history-mode"),this.historyView.reset(this.history_start.ts,function(){this.starcDiagram.stopHistoryMode(),this.historyCallout.close(),$(window).trigger("clockify-timetravel-end")}.bind(this));else{$("body").addClass("history-mode"),this.$el.find(".action.history").addClass("opening");var e=this.diagram.getDeltas(),t=e.lastDeltaWithServerId();this.history_start={id:t?t.get("_id"):void 0,ts:new Date(t&&t.get("action_ts")||Date.now())},this.historyCallout.open(),this.historyView.render(function(){this.$el.find(".action.history").removeClass("opening"),this.historyView.current&&this.historyView.slider.slideTo(this.historyView.current,0),this.starcDiagram.startHistoryMode(),this.historyView.delegateEvents()}.bind(this)),ga("send","event","History","View"),$(window).trigger("clockify-timetravel"),m.me().getActions().perform("diagram:history:open")}},openNotifications:function(){this.trigger("item-clicked"),this.getNotificationsView()&&(r.set("messages-state","1",{path:"/"}),this.getNotificationsView().open())},setPendingNotifications:function(e){e?(this.$el.find(".action.chat").addClass("pending"),this.$el.find(".action.chat").text(e)):(this.$el.find(".action.chat").removeClass("pending"),this.$el.find(".action.chat").empty())},startPresenting:function(e){$("body").addClass("presentation-mode");var t=g();e||(e={}),t.hide&&!e.hide&&(e.hide=t.hide.split(",")||[]),this.starcDiagram.startPresentationMode(e),ga("send","event","PresentationMode","Open"),e.showCallout&&this.$el.find(".action.present").callout("<div class='present-review-tip'><p><b>You are viewing this diagram in presentation and review mode.</b></p> <p>Branches can be expanded, collapsed, and highlighted, or click this icon to switch back to normal mode.</p></div>",{my:"right top",at:"center bottom"}).open()},togglePresent:function(e){this.trigger("item-clicked"),$("body").hasClass("presentation-mode")?($("body").removeClass("presentation-mode"),this.starcDiagram.stopPresentationMode()):this.startPresenting({fullscreen:!e.shiftKey,expandLevel:0})},openPermissions:function(e,t){if(-1!=this.diagram.get("my_access").indexOf("write")){var n=new u({model:e,removable:!0}).render();n.$el.find(".discrete-slider").addClass("right-align"),n.$el.find('li[data="admin"]').remove(),t.$el.callout(n.$el.addClass("right-align"),{my:"right top",at:"center bottom",onClose:function(){n.remove()}}).open()}},openDownload:function(e){this.trigger("item-clicked"),this.downloadView||(this.downloadView=new h({starcDiagram:this.starcDiagram}).render(),this.addChildView(this.downloadView)),this.$el.find(".download").callout(this.downloadView.$el,{my:"right top",at:"center bottom"}).open(),this.downloadView.refresh(),this.downloadView.delegateEvents()},performClone:function(){this.trigger("item-clicked");var e="/clone/"+window.location.pathname.replace(/\/t\/[^\/]*/,"").replace(/^\/diagram\//,""),t=!1;"static.coggle.it"===window.location.host&&(e="https://coggle.it"+e,t=!0),top.location!=location||t?top.location=e:o.history.navigate(e,!0)}},o.Events);n.exports=y}),define("views/DiagramNodeMenu",["require","exports","module","underscore","backbone","controllers/MarkdownTextareaController","starc/starc.copypaste","views/ColourMenu","views/NodeEditView","views/PitchView","utils/trackModifiers","env"],function(e,t,n){function i(t){return e("env").cdn.url+"/img/"+t}var o=e("underscore"),r=e("backbone"),s=e("controllers/MarkdownTextareaController"),l=e("starc/starc.copypaste").copy,a=e("views/ColourMenu"),u=e("views/NodeEditView"),d=(e("views/PitchView"),e("utils/trackModifiers")),c=function(e){return'<img src="'+i(e)+'"/>'},h=" <div class='diagram-node-menu-button menu-bold' title='Bold (Ctrl-B)'>"+c("bold.png")+"</div><div class='diagram-node-menu-button menu-italics' title='Italics (Ctrl-I)'>"+c("italics.png")+"</div><div class='diagram-node-menu-button menu-link' title='Link to a website'>"+c("linkicon.png")+"</div><div class='diagram-node-menu-button menu-image' title='Add Image'>"+c("picture.png")+"</div><div class='diagram-node-menu-button menu-icon' title='Add Icon (:)'>"+c("zap.png")+"</div><div class='diagram-node-menu-button menu-colour' title='Pick Colour'>"+c("sage/paint.png")+"</div><div class='diagram-node-menu-spacer'></div><div class='diagram-node-menu-button menu-add-child' title='Create a New Child (Tab)'>+Child</div><div class='diagram-node-menu-button menu-add-sibling<%=root?' disabled':''%>' title='Create a new sibling (Shift+Return)'>+Sibling</div><div class='diagram-node-menu-button menu-arrange' title='Arrange Children'>"+c("rearrange-w.png")+"</div><div class='diagram-node-menu-button menu-copy' title='Copy Node'>"+c("dup-w.png")+"</div><div class='diagram-node-menu-button menu-remove<%=title?' disabled':''%>' title='Remove Node (Bksp)'>"+c("cross-w.png")+"</div><div class='diagram-node-menu-button menu-move-to-diagram' title='Move to a New Diagram'>"+c("cogglify-w.png")+"</div>",p=r.View.extend({tagName:"div",className:"diagram-node-menu",template:o.template(h),events:{"click .menu-bold":"bold","click .menu-italics":"italics","click .menu-link":"link","click .menu-image":"image","click .menu-icon":"icon","click .menu-add-child":"addChild","click .menu-add-sibling":"addSibling","click .menu-remove":"removeNode","click .menu-arrange":"arrange","click .menu-colour":"pickColour","click .menu-copy":"copy","click .menu-move-to-diagram":"moveToDiagram"},initialize:function(e){o.bindAll(this,"render","remove"),this.options=e,this.diagram=this.options.diagram,this.hide(),this.listenTo(this.diagram,"node:editor:opened",function(e){this.configureFor(e)}.bind(this)),this.listenTo(this.diagram,"node:editor:closed",function(e){this.hide()}.bind(this))},render:function(){var e={root:!!this.node&&this.node.isRoot(),title:!!this.node&&this.node.isTitle()};return this.$el.html(this.template(e)),this},configureFor:function(e){this.node&&this.stopListening(e),this.listenTo(e,"change",this.onNodeChange),this.node=e,this.updateColour(),this.render(),this.$el.removeClass("menu-hidden")},updateColour:function(){this.$el.css({"background-color":this.node.colour()})},onNodeChange:function(){this.node.changedAttributes().colour&&this.updateColour()},hide:function(){this.$el.addClass("menu-hidden")},bold:function(){u.activeEdit()&&s.bold(u.activeEdit().$el.find("textarea"))},italics:function(){u.activeEdit()&&s.italics(u.activeEdit().$el.find("textarea"))},link:function(){u.activeEdit()&&s.link(u.activeEdit().$el.find("textarea"))},image:function(){u.activeEdit()&&u.activeEdit().$el.find("input").trigger("click")},icon:function(){u.activeEdit()&&s.icon(u.activeEdit().$el.find("textarea"))},addChild:function(){this.diagram.getNodeForId(this.node.id).getNavigationController().activateEmptyChildOrCreateNew()},addSibling:function(){this.diagram.getNodeForId(this.node.id).getNavigationController().activateEmptySiblingOrCreateNew()},removeNode:function(){this.diagram.getNodeForId(this.node.id).deleteNode()},arrange:function(){this.diagram.getNodeForId(this.node.id).arrange()},pickColour:function(e){var t=this.node,n=this.diagram,i=n.getNodeForId(this.node.id),o=this.diagram.documentCoordsFromEvent(e);o.y-=80;a.instance().show($("body"),o.x,o.y,function(e,n){!e&&n&&(void 0!==n.colour&&i.setColour(n.colour,!t.isRoot()&&!d.shift_key_pressed),void 0!==n.weight&&i.setLineWeight(n.weight,!d.shift_key_pressed),void 0!==n.style&&i.setLineStyle(n.style,d.shift_key_pressed),void 0!==n.shape&&i.setLineShape(n.shape,d.shift_key_pressed))}).extended("free"!==n.model.myEditing())},copy:function(){l({node:this.node,diagram:this.diagram})},moveToDiagram:function(){u.activeEdit()&&u.activeEdit().commit(),this.diagram.cogglify(this.diagram.getNodeForId(this.node.id),!0)}});n.exports=p}),define("starc/starc.print",["require","exports","module","underscore","utils/loadmathjax","utils/queryString"],function(e,t,n){var i=e("underscore"),o=e("utils/loadmathjax"),r=e("utils/queryString");n.exports=function(e){function t(){console.log("Clean up page for printing..."),$("link[media=print]").attr("media",""),r().printtype&&-1!==["pdf","png"].indexOf(r().printtype)&&$("body").addClass("printtype-"+r().printtype),e.diagram.setScale(1),i.each(i.values(e.diagram.allNodes()),function(e){e.updateCrosslinks()}),e.diagram.setViewBoxToContent(30),setTimeout(function(){console.log("printing..."),$("body").addClass("printready"),window.print()},50)}console.log("wait for attachments..."),window.setTimeout(function(){e.diagram.model.onAllAttachments(function(){console.log("attachments ready"),window.setTimeout(function(){o.onMathJaxComplete(t)},10)})},10)}}),define("controllers/DeltaGenerator",["require","exports","module","underscore","utils/randomhex"],function(e,t,n){function i(e,t,n){o.bindAll(this,"generatePatch","generateNodeAdded","generateNodeRemoved","resume","pause"),this.emitDelta=n,this.nodes=e,this.diagram=t,e.on("node_added",this.generateNodeAdded,this),e.on("delta",this.generatePatch,this),e.on("node_deleted",this.generateNodeRemoved,this),this.paused=!1}var o=e("underscore"),r=e("utils/randomhex");i.prototype.destroy=function(){this.nodes.off(void 0,void 0,this),delete this.emitDelta},i.prototype.pause=function(){this.paused=!0},i.prototype.resume=function(){this.paused=!1},i.prototype.generatePatch=function(e,t,n){if(!this.paused){if(!e.collection)return console.error("updated node not in collection!");console.log("SAVING update",t,n);var i={type:"patch",version:2,node_id:e.id,_cid:r(24),data:o.clone(t||{})};e.isTitle()&&(i.root=!0),n&&(i.old_data=o.clone(n)),this.emitDelta(i)}},i.prototype.generateNodeAdded=function(e){if(!this.paused){console.log("SAVING node added",arguments);var t={type:"node added",version:2,node_id:e.id,_cid:r(24),data:{parent_id:e.isRoot()?"root parent":e.parent().id,text:e.get("text"),join:e.get("join"),colour:e.colour(),pos:e.pos(),width:e.get("width")||void 0,scale:e.get("scale")||1,text_size:e.get("text_size")||void 0,line_weight:e.get("line_weight")||void 0,line_style:e.get("line_style")||void 0,line_shape:e.get("line_shape")||void 0,direction:e.get("direction")||void 0,control_points:e.get("control_points")||void 0,text_alignment:e.get("text_alignment")||void 0,shape:e.get("shape")||void 0,attachments:e.get("attachments")||void 0}};this.emitDelta(t)}},i.prototype.generateNodeRemoved=function(e){if(!this.paused){console.log("SAVING node removed",arguments);var t={type:"node removed",version:2,node_id:e.id,_cid:r(24)};this.emitDelta(t),e.off(void 0,void 0,this)}},n.exports=i}),define("controllers/localqueue",["require","exports","module","underscore"],function(e,t,n){function i(e){var t=[];return r.each(e,function(e){var n={};r.each(r.filter(r.keys(e),function(e){return"_"!=e[0]||"_cid"===e||"_id"===e}),function(t){n[t]=e[t]}),t.push(n)}),t}function o(){if(null===s){var e="testforlocalstorage";try{var t=window.localStorage;t.setItem(e,e),t.removeItem(e),s=!0}catch(e){s=!1}}return s}var r=e("underscore"),s=null,l=function(e){var t=location.protocol+"//"+location.host+location.pathname.replace(/\/t\/[^/]*/,"");this.storage_name=("localqueue.v1.["+t+"]."+e).toLowerCase(),this.load_count_name=this.storage_name+".load_count",this.in_memory=null,this.load_count=null,this.saved=!1};l.prototype.ensureLoaded=function(){null===this.in_memory&&(o()&&(this.in_memory=JSON.parse(localStorage.getItem(this.storage_name))),this.in_memory||(this.in_memory=[]),this.in_memory.length?(this.load_count=JSON.parse(localStorage.getItem(this.load_count_name))||0,this.load_count+=1):this.load_count=0)},l.prototype.save=function(){o()&&(0===this.in_memory.length?localStorage.removeItem(this.storage_name):localStorage.setItem(this.storage_name,JSON.stringify(i(this.in_memory))),this.saved||(0===this.load_count?localStorage.removeItem(this.load_count_name):localStorage.setItem(this.load_count_name,JSON.stringify(this.load_count))),this.saved=!0)},l.prototype.checkSaved=function(){if(localStorage.getItem(this.storage_name)!==JSON.stringify(i(this.in_memory)))throw console.log("stored:",localStorage.getItem(this.storage_name)),console.log("memory:",JSON.stringify(this.in_memory)),new Error("local storage round-trip failed!")},l.prototype.push=function(e){this.ensureLoaded(),this.in_memory.push(JSON.parse(JSON.stringify(e))),o()&&(this.save(),this.checkSaved())},l.prototype.pop=function(){this.ensureLoaded();var e=this.in_memory.shift();return this.save(),e},l.prototype.peek=function(){return this.ensureLoaded(),this.in_memory.length?this.in_memory[0]:null},l.prototype.remove=function(e){this.in_memory.splice(e,1),this.save()},l.prototype.any=function(e){return this.ensureLoaded(),r.some(this.in_memory,e)},l.prototype.filter=function(e){this.in_memory=r.filter(this.in_memory,e),this.save()},l.prototype.length=function(){return this.ensureLoaded(),this.in_memory.length},l.prototype.clear=function(){this.in_memory=[],this.save()},l.prototype.getArray=function(){return this.ensureLoaded(),this.in_memory},l.prototype.loadCount=function(){return this.ensureLoaded(),this.save(),this.load_count},l.prototype.supported=function(){return o()},setTimeout(function(){o()&&r.filter(r.keys(localStorage),function(e){return 0===e.indexOf("localqueue.v1.")}).forEach(function(e){var t=localStorage.getItem(e);"0"!==t&&"[]"!==t||window.localStorage.removeItem(e)})},5e3),n.exports=l}),define("controllers/Reconciler",["require","exports","module","controllers/localqueue","utils/randomhex","underscore","models/Message","utils/queryString"],function(e,t,n){function i(e){this.unreconciled=new o("starc.unreconciled"),this.unreconciled.supported()||a().print||l.get("local-storage-unavailable").activate(),this.send=e,this.evaluationInterval=setInterval(function(){this.evaluateReconilationState()}.bind(this),3e3),this.debouncedSync=s.debounce(this.syncOfflineChanges.bind(this),10),this.unreconciled.getArray().forEach(function(e){e._cid||(e._cid=r(24))})}var o=e("controllers/localqueue"),r=e("utils/randomhex"),s=e("underscore"),l=e("models/Message").Messages,a=e("utils/queryString");s.extend(i.prototype,Backbone.Events),i.prototype.destroy=function(){clearTimeout(this.errorTimeout),clearInterval(this.evaluationInterval),this.off(),this.wasRemoved=!0},i.prototype.evaluateReconilationState=function(){if(this.wasRemoved)return console.error("evaluateReconilationState called after removal!");var e=this.oldest_unreconciled;this.oldest_unreconciled=this.unreconciled.peek(),null!==this.oldest_unreconciled&&this.oldest_unreconciled==e?this.unreconciled_at||(this.unreconciled_at=Date.now()):this.unreconciled_at=!1},i.prototype.unreconciledDuration=function(){return this.unreconciled_at?Date.now()-this.unreconciled_at:0},i.prototype.reconciliationAttempts=function(){return this.unreconciled.loadCount()},i.prototype.sync=function(){console.log("reconciler: attempting sync"),this.syncOfflineChanges()},i.prototype.hasChanges=function(){return 0!==this.unreconciled.length()},i.prototype.queueDelta=function(e){if(this.wasRemoved)return console.error("queueDelta called after removal!");var t=s.clone(e);try{this.unreconciled.push(t)}catch(e){l.get("local-storage-full").activate()}this.debouncedSync()},i.prototype.removeSavedChange=function(e){this.unreconciled.filter(function(t){return t._cid!==e._cid})},i.prototype.discardChanges=function(){console.log("Discarding unsynchronised changes:",this.unreconciled.getArray()),this.unreconciled.clear()},i.prototype.syncOfflineChanges=function(){if(!this.wasRemoved){var e=this;if(e.syncAttemptsSinceSuccess||(e.syncAttemptsSinceSuccess=0),!e.syncing){clearTimeout(e.errorTimeout);var t=e.unreconciled.getArray();if(0===t.length)return void(e.syncAttemptsSinceSuccess=0);e.syncAttemptsSinceSuccess+=1;var n=function(t,n){e.send(t,function(t,i){return e.wasRemoved?n(new Error("removed")):t?n(t):(i.map(function(t){e.removeSavedChange(t)}),console.log(e.unreconciled.length()+" unreconciled changes remain"),n(null),void 0)})},i=function(e){var o=t.slice(0,100);if(t=t.slice(100),!o.length)return e();n(o,function(t){return t?e(t):i(e)})};console.log("starting sync..."),e.syncing=!0,i(function(t){e.syncing=!1,t?(console.log("sync attempt failed"),clearTimeout(e.errorTimeout),e.errorTimeout=setTimeout(function(){e.wasRemoved||e.syncOfflineChanges()},1e4)):(console.log("sync attempt complete"),e.syncAttemptsSinceSuccess>1?setTimeout(function(){e.wasRemoved||e.syncOfflineChanges()},1e3*Math.pow(1.5,e.syncAttemptsSinceSuccess)):e.wasRemoved||e.syncOfflineChanges())})}}},i.prototype.getDeltas=function(){return this.unreconciled.getArray()},n.exports=i}),define("controllers/ReconnectingWebsocket",["require","exports","module"],function(e,t,n){function i(e,t,n){var i={automaticOpen:!0,reconnectInterval:1e3,maxReconnectInterval:3e5,reconnectDecay:2,timeoutInterval:2e3};n||(n={});for(var o in i)void 0!==n[o]?this[o]=n[o]:this[o]=i[o];this.url=e,this.reconnectAttempts=0,this.readyState=WebSocket.CONNECTING;var r,s=this,l=!1,a=!1;this.open=function(e){if(!r){e||clearTimeout(a),r=new WebSocket(s.url,t||[]);var n=setTimeout(function(){r&&r.close()},s.timeoutInterval);r.onopen=function(e){console.log("ws onopen"),clearTimeout(a),clearTimeout(n),s.readyState=WebSocket.OPEN,s.onopen(e),s.reconnectAttempts=0},r.onclose=function(e){if(console.log("ws onclose"),clearTimeout(a),clearTimeout(n),r.onmessage=null,r.onclose=null,r.onopen=null,r.onerror=null,r=null,l)s.readyState=WebSocket.CLOSED,s.onclose(e);else{s.readyState=WebSocket.CONNECTING,s.onclose(e),s.reconnectAttempts=s.reconnectAttempts+1;var t=s.reconnectInterval*Math.pow(s.reconnectDecay,s.reconnectAttempts)*(1+Math.random());a=setTimeout(function(){s.open(!0)},t>s.maxReconnectInterval?s.maxReconnectInterval:t)}},r.onmessage=function(e){s.onmessage(e)},r.onerror=function(e){console.log("ws onerror"),s.onerror(e)}}},this.automaticOpen&&this.open(!1),this.send=function(e){if(r)return r.send(e);throw"INVALID_STATE_ERR : Pausing to reconnect websocket"},this.close=function(e,t){void 0===e&&(e=1e3),l=!0,r&&r.close(e,t)},this.refresh=function(){s.reconnectAttempts=0,r&&r.close()}}if(!("WebSocket"in window))return void(n.exports={});i.prototype.onopen=function(){},i.prototype.onclose=function(){},i.prototype.onconnecting=function(){},i.prototype.onmessage=function(){},i.prototype.onerror=function(){},i.CONNECTING=WebSocket.CONNECTING,i.OPEN=WebSocket.OPEN,i.CLOSING=WebSocket.CLOSING,i.CLOSED=WebSocket.CLOSED,n.exports=i}),define("controllers/RealtimeUpdateController",["require","exports","module","underscore","backbone","controllers/ReconnectingWebsocket"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=e("controllers/ReconnectingWebsocket"),s=function(e){var t=e.socketUrl();return window.CoggleAccessToken&&(t+="&access_token="+window.CoggleAccessToken),t},l=function(e){var t=new r(s(e),[],{automaticOpen:!1,timeoutInterval:1e4,reconnectInterval:45e3,maxReconnectInterval:48e4});return t=i.extend(t,o.Events),t.emit=function(e,n){t.send(JSON.stringify({event:e,data:n}))},t.onopen=function(){t.trigger("connect")},t.onerror=function(){t.trigger("error")},t.onclose=function(){t.trigger("disconnect")},t},a=3e3*(Math.random()+2),u=function(e){return Math.min(9e5,a*Math.pow(1.6,e)*(Math.random()/4+1)+5*Math.random()*1e3)},d=function(e){i.bindAll(this,"poll","destroy","getChangesOnConnect"),this.startedAt=Date.now(),this.disconnectedAt=!1,this.connectedAt=!1,this.subscribedSince=!1,this.upToDateAt=!1,this.upToDateFailures=0,this.queuedDeltas=[],this.pollFailures=0,this.diagram=e,setTimeout(this.poll,5e3);try{this.socket=l(e),this.socket.onmessage=this.onSocketMsg.bind(this),this.socket.on("connect",function(){this.connectedAt=Date.now(),this.subscribedSince=this.connectedAt+5e3,this.disconnectedAt=!1,this.upToDateAt=!1,setTimeout(this.getChangesOnConnect,2e3)}.bind(this)),this.socket.on("disconnect error",function(){this.disconnectedAt||(this.disconnectedAt=Date.now(),this.pollFailures=3,this.reschedulePoll()),this.connectedAt=!1,this.upToDateAt=!1}.bind(this)),this.socket.open()}catch(e){console.warn(e)}};d.prototype.onSocketMsg=function(e){var t=this.diagram;try{var n=JSON.parse(e.data);"delta"==n.event?(this.upToDateAt?t.getDeltas().addIfNotLocalDuplicate(n.data):this.queuedDeltas.push(n.data),this.socket.url=s(t)):"notification"==n.event?n.data.removed?t.getNotifications().remove([n.data]):n.data.updated?t.getNotifications().set([n.data],{add:!1,merge:!0,remove:!1}):t.getNotifications().add([n.data]):"connected-at"===n.event?this.subscribedSince=n.data:"active"===n.event?t.getActivity().active(n.data):"idle"===n.event&&t.getActivity().idle(n.data)}catch(e){console.warn("uncaught error handling socket message:",e)}},d.prototype.getChangesOnConnect=function(){if(this.wasDestroyed)return this.destroy();console.log("get changes on connect..."),this.diagram.getDeltas().poll(function(e,t,n){if(console.log("got changes on connect",e),this.wasDestroyed)return this.destroy();if(e)this.socket.close();else{if(t&&t<this.subscribedSince){this.upToDateFailures+=1;var i=u(this.upToDateFailures);console.log("new changes are not sufficiently up to date yet, retrying in "+i);var o;if(o=n||Date.now(),t<o-6e4){var r=(o-t)/6e4;$(window).trigger("notify-warning",["Recent data for this diagram (the last "+Math.round(r+.5)+" minutes) could not be loaded yet, it may be out of date.",!1,i])}return void setTimeout(this.getChangesOnConnect,i)}console.log("socket connected OK, releaseing "+this.queuedDeltas.length+" queued deltas"),this.upToDateAt=Date.now(),this.upToDateFailures=0;var s=this.queuedDeltas;this.queuedDeltas=[];var l=this.diagram.getDeltas();s.forEach(l.addIfNotLocalDuplicate.bind(l))}}.bind(this))},d.prototype.destroy=function(){clearTimeout(this.pollLoop),this.socket&&this.socket.close(),this.wasDestroyed=!0},d.prototype.socketIsConnected=function(){return!!this.connectedAt&&this.connectedAt>this.disconnectedAt},d.prototype.disconnectedDuration=function(){return this.socketIsConnected()?0:this.disconnectedAt?Date.now()-this.disconnectedAt:Date.now()-this.startedAt},d.prototype.waitingForConnect=function(){return!(this.connectedAt||this.disconnectedAt)},d.prototype.reschedulePoll=function(){this.pollLoop&&(clearTimeout(this.pollLoop),this.pollLoop=!1);var e=u(this.pollFailures);this.pollLoop=setTimeout(function(){this.pollLoop=!1,this.poll()}.bind(this),e)},d.prototype.poll=function(){return this.wasDestroyed?this.destroy():this.socketIsConnected()?this.reschedulePoll():void this.diagram.getDeltas().poll(function(e){e?this.pollFailures++:(this.pollFailures=0,this.diagram.accessViaToken()||this.diagram.getNotifications().loadAllNew()),this.reschedulePoll()}.bind(this))},d.prototype.send=function(e,t){if(this.socketIsConnected()&&this.socket)return this.socket.send(JSON.stringify({event:e,data:t}))},n.exports=d}),define("controllers/Activity",["require","exports","module","utils/randomhex","underscore"],function(e,t,n){var i=e("utils/randomhex"),o=e("underscore"),r=function(e){return e.length&&e.codePointAt&&String&&String.fromCodePoint?String.fromCodePoint(e.codePointAt(0)):e.length?e[0]:""},s=function(e){var t=e.split(" ");return 1==t.length?r(t[0]):t.length>=2?r(t[0])+r(t[t.length-1]):""},l=function(e,t,n){o.bindAll(this,"onNodeActivity","onNodeActivityEnded","sendIdle","onMenu","onMenuClose","onCPActivityOnce","onDrag","onDragEnd"),this.diagram=e,this.rtc=t,this.session=i(24),n.isGuest()?(this.userid="guest",this.initials=""):(this.userid=n.id,this.initials=s(n.get("name"))),this.scheduled_idle=null,this.current_node_id=null,this.current_menu=null,this.interval=null,this.diagram.on("node:editor:opened node:editor:typing node:move:start",this.onNodeActivity),this.diagram.on("node:editor:closed node:move:end",this.onNodeActivityEnded),this.diagram.on("cp:create",this.onCPActivityOnce),this.diagram.on("cp:remove",this.onCPActivityOnce),this.diagram.on("cp:drag:start",this.onDrag),this.diagram.on("cp:drag:end",this.onDragEnd),this.diagram.on("menu:open",this.onMenu),this.diagram.on("menu:close",this.onMenuClose)};l.prototype.dataWith=function(e){return o.extendOwn({user:this.userid,session:this.session,initials:this.initials},e)},l.prototype.send=function(e,t){this.diagram.editingPrevented()||this.rtc.send(e,t)},l.prototype.sendIdle=function(){this.clearInterval(),this.send("idle",{user:this.userid,session:this.session})},l.prototype.onNodeActivity=function(e,t){this.current_node_id=e.id;var n=this.dataWith({pos:{x:Math.round(e.x()),y:Math.round(e.y())},typing:!!t,object:{type:"node",id:e.id}});this.send("active",n),this.setInterval(function(){this.send("active",n)}.bind(this))},l.prototype.onNodeActivityEnded=function(e){e&&e.id===this.current_node_id&&(this.current_node_id=null,this.setIdleTimeout())},l.prototype.onDrag=function(e){var t=this.dataWith({pos:{x:Math.round(e.x),y:Math.round(e.y)}});this.send("active",t),this.setInterval(function(){this.send("active",t)}.bind(this))},l.prototype.onDragEnd=function(e,t){this.onDrag(e,t),this.setIdleTimeout()},l.prototype.onCPActivityOnce=function(e,t){var n=(e.get("control_points")||{})[t]||{x:e.relX(),y:e.relY()},i=e.parent(),o=this.dataWith({pos:{x:Math.round(i.x()+n.x),y:Math.round(i.y()+n.y)}});this.send("active",o),this.setIdleTimeout()},l.prototype.onMenu=function(e){if(!this.current_node_id){var t=this.diagram.diagramCoordsFromEvent({
pageX:e.x,pageY:e.y}),n=this.dataWith({pos:t});this.current_menu=e.type,this.send("active",n),this.setInterval(function(){this.send("active",n)}.bind(this))}},l.prototype.onMenuClose=function(e){this.current_node_id||e.type!==this.current_menu||(this.current_menu=null,this.setIdleTimeout())},l.prototype.setIdleTimeout=function(){this.idle_timeout&&clearTimeout(this.idle_timeout),this.idle_timeout=setTimeout(this.sendIdle,2e3)},l.prototype.setInterval=function(e){this.clearInterval(),this.idle_timeout&&(clearTimeout(this.idle_timeout),this.idle_timeout=null),this.interval=setInterval(e,3e4)},l.prototype.clearInterval=function(){this.interval&&clearInterval(this.interval),this.interval=null},n.exports=l}),define("views/Activity",["require","exports","module","backbone","plugins/Backbone.childViews","underscore","../utils/colours","env"],function(e,t,n){var i=e("backbone");e("plugins/Backbone.childViews");var o=e("underscore"),r=e("../utils/colours"),s=e("env").cdn.url,l=o.template("<div class='content' style='background: <%- user.avatar.colour %>'><div class='icon' <% if (user.avatar.url) { %> style='background-image: url(<%-user.avatar.url%>);' <% } %> ><% if(user.initials) { %><div class='initials'><%- user.initials %></div><% } %></div><% if(user.name) { %><div class='text'><div class='name'><%- user.name %></div></div><% } %><div class='bubble'/></div>"),a=function(e){var t=r.defaults(!1);return t[parseInt(e.substr(0,6),16)%t.length]},u=i.View.extend({tagName:"div",className:"blamecallout sessionactivity",initialize:function(){this.listenTo(this.model,"change:node_model",this.listenToNodeModelChanges),this.listenTo(this.model,"change",this.render),this.listenToNodeModelChanges()},listenToNodeModelChanges:function(){this._listening_to_node&&this.stopListening(this._listening_to_node,"change:pos");var e=this.model.get("node_model");e?(this.listenTo(e,"change:pos",this.render),this._listening_to_node=e):this._listening_to_node=null},render:function(){var e=this.model.get("user_model")&&this.model.get("user_model").toJSON();if(!e){var t=this.model.get("initials");e=t?{name:"",initials:t,avatar:{colour:a(this.model.get("session"))}}:{name:"Guest",avatar:{url:s+"/img/anon-member-2x.png",colour:a(this.model.get("session"))}}}this.$el.html(l({user:e}));var n,i=this.model.get("node_model");return n=i?i.absolutePosition():this.model.get("pos"),void 0!==n&&this.$el.css({top:n.y,left:n.x}),this.$el.toggleClass("typing",!!this.model.get("typing")),requestAnimationFrame(function(){this.$el.addClass("added")}.bind(this)),this}}),d=i.View.extend({initialize:function(e){this.appendTo=e.appendTo,this.ownSession=e.ownSession,this.listenTo(this.collection,"add",function(e){if(e.get("session")!==this.ownSession){var t=new u({model:e});this.addChildView(t),this.appendTo.append(t.render().$el)}}.bind(this)),this.listenTo(this.collection,"remove",function(e){var t=this.findByModel(e);t&&(t.remove(),this.removeChildView(t))}.bind(this))}});n.exports=d}),define("views/WorkspaceView",["require","exports","module","underscore","async","backbone","utils/queryString","models/Message","views/BannerViews","views/DiagramToolbar","views/DiagramNodeMenu","starc/starc.print","starc/starc","controllers/DeltaGenerator","controllers/Reconciler","controllers/RealtimeUpdateController","controllers/Activity","views/Activity","models/User","env","env","env"],function(e,t,n){var i=e("underscore"),o=e("async"),r=e("backbone"),s=e("utils/queryString"),l=e("models/Message").Messages,a=e("views/BannerViews").BannerStack,u=e("views/DiagramToolbar"),d=e("views/DiagramNodeMenu"),c=e("starc/starc.print"),h=e("starc/starc"),p=e("controllers/DeltaGenerator"),f=e("controllers/Reconciler"),g=e("controllers/RealtimeUpdateController"),m=e("controllers/Activity"),v=e("views/Activity"),y=e("models/User"),b="    <div class='diagram-container'>        <div id='diagram-header'>            <a href='<%-back%>' tabindex='2' class='home'>                <% if(!printing) { %><img class='back-chevron' width='8' height='14' src='"+e("env").cdn.url+"/img/chevron.png' alt='back arrow'/><% } %>                <% if(picture) { %><img class='org-logo' width='30' height='30' src='<%-picture%>' style='background-color: <%-colour%>'/><% } %>                <img id='logo' width='48' height='23' src='"+e("env").cdn.url+"/img/coggle.png' alt='Coggle'/>                <div class='made-with-coggle'>made for free at coggle.it</div>            </a>        </div>        <div role='status' class='save-indicator'></div>        <div class='diagram-editor-scroll' lang=''></div>        <div id='loadingbackground'>            <div id='loading'><% if(!printing) { %><div class='loadspinner'><% } %></div><p></p></div>        </div>    </div>",w=function(e,t){if("URLSearchParams"in window&&!window.Coggle_App_Main){var n=new URLSearchParams(window.location.search);""===t?n.delete(e):n.set(e,t);var i=window.location.pathname+(n.toString().length?"?":"")+n.toString()+window.location.hash;r.history.navigate(i,{replace:!0,trigger:!1})}},_=r.View.extend({tagName:"div",className:"coggle-workspace",template:i.template(b),initialize:function(e){this.options=e,this.updateURL(this.model.get("url_title")),this.renderTemplate(),this.starcView=new h({model:this.model,readOnly:this.readOnly(),scroll_target:this.$el.find(".diagram-editor-scroll")}),this.bannerView=new a({collection:l}),this.addChildView(this.bannerView),this.toolbarView=new u({diagram:this.model,workspace:this}),this.addChildView(this.toolbarView),this.deltaReconciler=new f(this.sendDeltas.bind(this)),this.model.version()>2&&($(window).trigger("notify-error","This diagram was created with a newer version of Coggle! You must reload the page to edit."),this.version_outdated=!0,this.starcView.setReadOnly(!0)),this.deltaGenerator=new p(this.model.getNodes(),this.model,function(e){this.deltaReconciler.queueDelta(e),this.model.getDeltas().add(e,{silent:!0})}.bind(this)),$("body").addClass("workspace-open"),window._workspace=this},backLink:function(){var t=y.me(),n="/";if(!t.isGuest()){var i=t.getActiveOrg().get("slug"),o=this.model.get("folder");o?o._id&&(o=o._id):o||this.model.get("owner_id")===t.id||(o="shared"),n=i?"/"+i:"",n+=o?"/folder/"+o:"/",n+="#"+this.model.get("short_id")}return e("env").api.url+n},renderTemplate:function(){var e=y.me(),t=e.getActiveOrg().toJSON();t.back=this.backLink(),t.printing=!!s().print,this.$el.html(this.template(t))},render:function(){return this.wasRemoved?this:(this.$el.find(".diagram-editor-scroll").prepend(this.starcView.$el),this.$el.find(".diagram-container").prepend(this.toolbarView.render().$el.addClass("diagram-toolbar")),this.$el.prepend(this.bannerView.render().$el),y.me().menuExperiment()&&(this._node_menu||(this._node_menu=new d({diagram:this.getStarcView()}),this.addChildView(this._node_menu)),this.$el.append(this._node_menu.render().$el),this._node_menu.delegateEvents()),("0"===s().logo||this.isEmbedded())&&this.$el.find("#diagram-header").remove(),this)},load:function(){if(!this.wasRemoved){if(this.setupStarcView(),this.windowTitleSyncing(),this.markModified(),this.toolbarView.render(),this.$el.find("a.home").attr("href",this.backLink()),s().print)this.print();else{if(this.model.accessViaToken()||this.trackActivity(),this.disconnectionMessages(),this.isEmbedded()?this.showEmbedded():y.me().isGuest()&&this.model.accessIsEphemeral()&&this.showEphemeral(),this.model.canWrite()){this.setupActions();this.$el[0].getElementsByClassName("diagram-editor-scroll")[0].setAttribute("translate","no")}this.model.get("deletedForEveryone")?l.get("deleted-recovery").activate():this.model.get("deleted")&&!this.model.accessViaToken()&&l.get("deleted-for-you").activate(),this.showOverageWarning(),this.presentUrlSyncing()}this.applyAndWatchDeltas(),this.isRealtime()&&(this.realtimeController=new g(this.model),this.activity=new m(this.starcView,this.realtimeController,y.me()),this.activityView=new v({collection:this.model.getActivity(),appendTo:this.starcView.nodesContainer(),ownSession:this.activity.session})),ga("send","event","Load",window===window.top?"Normal":"Frame",{nonInteraction:1})}},remove:function(){y.me().getActions().unique("workspace-close"),this.trigger("close"),this.wasRemoved=!0,this.model.getNodes().off(void 0,void 0,this),this.model.getDeltas().off(void 0,void 0,this),this.model.off(void 0,void 0,this),this.getStarcView().remove(),this.realtimeController&&this.realtimeController.destroy(),delete this.realtimeController,this.deltaGenerator&&this.deltaGenerator.destroy(),delete this.deltaGenerator,this.deltaReconciler&&this.deltaReconciler.destroy(),delete this.deltaReconciler,l.get("degraded")&&l.get("degraded").deactivate(),l.get("disconnected")&&l.get("disconnected").deactivate(),l.get("sync-warning")&&l.get("sync-warning").deactivate(),l.get("embedded")&&l.get("embedded").deactivate(),l.get("private-overage")&&l.get("private-overage").deactivate(),l.get("deleted-recovery")&&l.get("deleted-recovery").deactivate(),l.get("deleted-for-you")&&l.get("deleted-for-you").deactivate(),$(window).off("beforeunload.workspaceContext"),$(window).off("mousemove.workspaceContext"),this.model.resetState(),r.View.prototype.remove.apply(this),$("body").removeClass("history-mode"),$("body").removeClass("presentation-mode"),$("body").removeClass("workspace-open"),delete window._workspace,delete window._diagram},readOnly:function(){return this.version_outdated||this.model.get("deleted")||this.model.get("overage_disable")||!this.model.canWrite()||"Explorer"===BrowserDetect.browser},getStarcView:function(){return this.starcView},setupStarcView:function(){if(this.wasRemoved)return this;s().print||(window.Coggle_App_main||(this.starcView.enableZoomShortcuts(),this.starcView.enableBoundaryDragScrolling(),this.starcView.enableScrollBounding()),$("body").hasClass("touch")||(this.starcView.enableNodeButtons(),this.starcView.enableTabFocus()),this.readOnly()||this.starcView.enableKeyboardShortcuts()),this.listenTo(this.starcView,"mode",function(e){$(window).trigger("coggle-mode-changed",e),e.indexOf("presentationmode")>=0?w("present","1"):s().present&&(w("present",""),w("hide",""))}),this.listenToOnce(this.getStarcView(),"loaded",function(){s().present&&this.toolbarView.startPresenting({expandLevel:s().expand_level||0,showCallout:!0})}.bind(this))},presentUrlSyncing:function(){this.listenTo(this.getStarcView(),"present:collapse present:expand",i.debounce(function(){this.starcView&&this.starcView.presentationMode()&&w("hide",this.model.getNodes().filter(function(e){return e.get("hidden")&&!(e.parent()&&e.parent().get("hidden"))}).map(function(e){return e.shortId()}).join(","))}.bind(this),200))},trackActivity:function(){if(this.model.canWrite()){var e=function(){this.wasRemoved||this.model.save({last_viewed:new Date,nonempty_nodes:this.model.getNodes().nonEmpty().length,total_nodes:this.model.getNodes().length},{patch:!0})}.bind(this);this.listenToOnce(this.getStarcView(),"loaded",e),this.listenToOnce(this,"close",e),this.$el.on("mousemove.workspaceContext",i.throttle(e,3e5,{leading:!1})),$(window).on("beforeunload.workspaceContext",e)}},windowTitleSyncing:function(){this.listenTo(this.model.getNodes(),"change:text",function(e){e.isTitle()&&this.model.set("title",h.toTitleText(e.text()))}.bind(this));var e=function(){window.document.title=h.toTitleText(this.model.get("title")||"")}.bind(this);this.listenTo(this.model,"change",e),this.listenTo(this.model,"sync",e),e()},updateURL:function(e){if(!s().print&&!window.App_Main){e||(e="-");var t=/^\/diagram\/[^\/?#]*\/t\/([^\/]*).*$/.exec(window.location.pathname);if(window.location.pathname.lastIndexOf("/")===window.location.pathname.length-1||!t||t[1]!==e){var n=/(\/diagram\/[^\/?#]*)(\/t\/[^\/]*)?(.*)(?:[\/]*)/.exec(window.location.pathname),i=n[1]+"/t/"+e+n[3];r.history.navigate(i+(window.location.search||"")+(window.location.hash||""),{replace:!0,trigger:!1})}}},markModified:function(){this.listenToOnce(this.model.getNodes(),"delta",function(){var e=(new Date).toISOString();e>this.model.get("last_modified")&&this.model.set("last_modified",e)}.bind(this))},disconnectionMessages:function(){if(!s().print)var e=function(){if(this.wasRemoved)return clearTimeout(t);if(this.realtimeController&&this.deltaReconciler){if(this.accessRevoked)return l.get("access-revoked").activate(),l.get("degraded").deactivate(),l.get("disconnected").deactivate(),void(l.get("sync-warning")&&l.get("sync-warning").deactivate());if(l.get("access-revoked").deactivate(),this.deltaReconciler.unreconciledDuration()>2e4){l.get("degraded").deactivate(),l.get("disconnected").activate();this.deltaReconciler.reconciliationAttempts()>=2&&this.showSyncWarning()}else this.realtimeController.disconnectedDuration()>6e4||this.realtimeController.waitingForConnect()&&this.realtimeController.disconnectedDuration()>2e4?(l.get("degraded").activate(),l.get("disconnected").deactivate(),l.get("sync-warning")&&l.get("sync-warning").deactivate(),this.getStarcView().setReadOnly(this.readOnly())):(l.get("degraded").deactivate(),l.get("disconnected").deactivate(),l.get("sync-warning")&&l.get("sync-warning").deactivate(),this.getStarcView().setReadOnly(this.readOnly()))}}.bind(this),t=setInterval(e,5e3)},showAccessRevokedWarning:function(){l.get("access-revoked").activate()},showSyncWarning:function(){if(this.deltaReconciler){var e=this.deltaReconciler.reconciliationAttempts(),t=this.deltaReconciler.unreconciled.length();this.getStarcView().setReadOnly(!0);var n="Changes made while disconnected have not been saved after "+e+" attempts! If you continue to edit it may not be possible to save the changes.<br>You can <a onclick='location.reload()'>reload the page</a> to try again, or <a id=syncdiscardrefresh>discard "+t+" change"+(t>1?"s":"")+"</a>";l.warning(n,"sync-warning"),$("#syncdiscardrefresh").on("click",function(){this.deltaReconciler.discardChanges(),window.location.reload()}.bind(this))}},showOverageWarning:function(){this.model.get("overage_disable")?(l.get("private-overage").activate(),y.me().getActions().perform("overage:private_diagrams")):l.get("private-overage").deactivate(),this.off(this.model,"change:overage_disable",this),this.listenTo(this.model,"change:overage_disable",function(){this.getStarcView().setReadOnly(this.readOnly()),this.showOverageWarning()}.bind(this))},showEmbedded:function(){$("body").addClass("embedded"),$("#logo").parent().attr("target","_blank"),l.get("embedded").activate()},showEphemeral:function(){l.get("publicdiagram").activate()},loadingAnimation:function(){var e=this.$el.find("#loading"),t=e.find("p");setTimeout(function(){t.text("This is taking longer than expected...")},4e3),this.listenToOnce(this.getStarcView(),"loaded",function(){s().print?($("#loadingbackground").remove(),this.getStarcView().$el.addClass("lod-1")):y.me().isGuest()?($("#loadingbackground").remove(),$(window).trigger("clockify-start")):($("#loadingbackground").addClass("fadeout"),setTimeout(function(){$("#loadingbackground").remove(),$(window).trigger("clockify-start")},200)),_.trigger("loaded",this)}.bind(this),this)},print:function(){"1"==s().madeWith&&$("#diagram-header .made-with-coggle").show(),this.listenToOnce(this.getStarcView(),"loaded",function(){c({diagram:this.getStarcView()})}.bind(this))},setupActions:function(){var e=function(e){y.me().getActions().unique(e)},t=this.getStarcView();this.listenTo(t,"node_added",e.bind(this,"added-node")),this.listenTo(t,"node_deleted",e.bind(this,"removed-node")),this.listenTo(t,"node_squashed",e.bind(this,"squashed-node")),this.listenTo(t,"node_inserted",e.bind(this,"inserted-node")),this.listenTo(t,"node_edited",function(t){e(t.isTitle()?"edited-title":"edited-node")}),this.listenTo(t,"node_moved",e.bind(this,"moved-node")),this.listenTo(t,"undo",e.bind(this,"undid")),this.listenTo(t,"redo",e.bind(this,"redid"))},isRealtime:function(){return!s().print&&(!this.isEmbedded()&&(-1===window.location.hostname.indexOf("static.")&&!this.model.accessIsEphemeral()))},isEmbedded:function(){return-1!==window.location.hostname.indexOf("embed.")},sendDeltas:function(e,t){this.$el.addClass("edited"),this.$el.addClass("saving"),this.$el.find(".save-indicator").text("Saving"),$.ajax({method:"POST",url:this.model.url()+"/changes",data:JSON.stringify(e),contentType:"application/json"}).done(function(e){this.$el.removeClass("saving"),this.$el.find(".save-indicator").text("All changes saved"),t(!1,e)}.bind(this)).fail(function(e,n,i){e&&e.status>400&&e.status<404&&(this.accessRevoked=!0,this.getStarcView().setReadOnly(!0),this.showAccessRevokedWarning()),t(!0)}.bind(this))},getDeltaQueue:function(e){if(!this.delta_queue){var t=this.getStarcView(),n=this.model,i=n.getNodes();this.delta_queue=o.queue(function(e,t){return i.onDelta(e,n),t()},1),this.delta_queue.drain=function(){this.delta_queue.drain=function(){},i.trigger("loaded")}.bind(this),this.listenToOnce(i,"loaded",function(){this.deltaGenerator&&this.deltaGenerator.resume()}.bind(this)),this.listenTo(t,"mode",function(){this.getStarcView().historyMode()?(console.log("pausing incoming delta queue"),this.delta_queue.pause(),this.deltaGenerator&&this.deltaGenerator.pause()):(console.log("resuming incoming delta queue"),this.delta_queue.resume(),this.deltaGenerator&&this.deltaGenerator.resume())}.bind(this)),i.on("must-update",function(){t.setReadOnly(!0),this.version_outdated=!0,l.get("must-update").activate()}.bind(this))}return this.delta_queue},applyAndWatchDeltas:function(){var e=this.deltaReconciler;if(e){if(this.getDeltaQueue().push(this.model.getDeltas().toJSON()),this.model.canWrite()){var t=e.getDeltas();this.getDeltaQueue().push(t),t.forEach(function(e){this.model.getDeltas().addIfNotLocalDuplicate(e)}.bind(this)),e.sync()}var n=[];this.listenTo(this.model.getDeltas(),"add",function(e){n.push(e.toJSON())}.bind(this)),this.listenTo(this.model.getDeltas(),"update",i.debounce(function(){this.wasRemoved||this.getDeltaQueue().push(n),n=[]},10))}}});i.extend(_,r.Events),n.exports=_}),define("views/Gallery",["require","exports","module","underscore","backbone","utils/queryString","starc/starc","env","env","env","env"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=e("utils/queryString"),s=e("starc/starc"),l=Object.prototype.hasOwnProperty,a="<div class='content'><a href='"+e("env").cdn.url+"/diagram/<%- short_id %>/t/<%- url_title %>' target='_blank' rel='noopener' data-bypass class='preview' style='background-image: url("+e("env").cdn.url+"/diagram/<%- short_id %>/thumbnail?cachebust=3&mtime=<%- last_modified %>)'></a><% if (typeof show_in_gallery !== 'undefined'){%><div class='buttons'><div class='status'><%-statusText%></div><% if(!show_in_gallery) { %><div class='button compact toggle'>Add to Gallery</div><% } else { %><div class='button compact toggle danger'>Remove from Gallery</div><% } %><div class='button compact notspam'>not spam</div><div class='button compact secondary unsure'>unsure</div><div class='button compact spam danger'>spam</div><div class='button compact ban danger'>spam+ban</div></div><% } %><a target='_blank' rel='noopener noreferrer' href='https://www.facebook.com/sharer/sharer.php?u=<%- encodeURIComponent('"+e("env").cdn.url+"/diagram/'+ short_id + '/t/'+ url_title) %>' class='facebook'>Share</a><a target='_blank' rel='noopener noreferrer' href='https://twitter.com/intent/tweet?text=<%- encodeURIComponent(title) %>&url=<%- encodeURIComponent('"+e("env").cdn.url+"/diagram/'+ short_id + '/t/'+ url_title) %>&related=coggleit' class='twitter'>Tweet</a><div class='title'><%- title %></div></div>",u=o.View.extend({tagName:"div",className:"diagram gallery-item col-md-6 col-lg-6",template:i.template(a),events:{"click .toggle":"toggleGallery","click .spam":function(){this.setScore(1)},"click .ban":function(){$.ajax({url:"/api/1/users/"+this.model.get("owner_id")+"/spamban",type:"POST"}).done(function(e,t){this.$el.find(".status").text("success: "+JSON.stringify(e))}.bind(this)).fail(function(e,t,n){this.$el.find(".status").text(t+": "+n)}.bind(this))},"click .notspam":function(){this.setScore(0)},"click .unsure":function(){this.setScore(null)}},initialize:function(e){i.bindAll(this,"render","toggleGallery"),this.options=e,this.listenTo(this.model,"change",this.render)},render:function(){var e=this.model.toJSON();e.title=s.toTitleText(this.model.get("title"));var t=e.spam,n="";return t&&(l.call(t,"review_score")&&(n+="review: "+t.review_score),t.reviewed_at&&(n+=" on "+new Date(t.reviewed_at).toLocaleDateString()),l.call(t,"score")&&("number"==typeof t.score?n+=" score:"+t.score.toFixed(2):n+=" score:"+t.score,t.model_version&&(n+=" v:"+t.model_version))),e.statusText=n,$(this.el).html(this.template(e)),this},toggleGallery:function(){this.model.save({show_in_gallery:!this.model.get("show_in_gallery")},{wait:!0})},setScore:function(e){this.model.save({spam:{review_score:e}},{wait:!0})}}),d=o.View.extend({tagName:"div",className:"gallery row",events:{},initialize:function(e){this.options=e,i.bindAll(this,"render","addOne","addAll","more","handleScroll"),this.listenTo(this.collection,"add",this.addOne),this.limit=e.limit||4,this.skip=e.skip||this.limit,$(window).on("scroll",this.handleScroll),$(".home-view").on("scroll",this.handleScroll),e.galleryInFolder?this.$el.html($("<div class='diagram-list-notice' data-l10n-id='gallery-folder-blurb3'><b>The Coggle Gallery</b> - A selection of the best diagrams made with Coggle!</div>")):this.$el.html("<div></div>"),this.addAll()},render:function(){return this},addOne:function(e){var t=new u({model:e});this.addChildView(t),this.$el.append(t.render().$el),this.updatePagination()},addAll:function(){this.collection.each(this.addOne)},updatePagination:function(){this.options.galleryInFolder||(this.$el.find(".gallery-pagination").remove(),this.ended||this.$el.append($('<a class="gallery-pagination" href="?skip='+this.skip+'">Next Page</a>')))},handleScroll:function(){this.ended||$(document).height()-($(window).scrollTop()+$(window).height())<2e3&&this.more()},more:i.throttle(function(){this.collection.fetch({add:!0,remove:!1,update:!1,data:i.defaults({skip:this.skip,limit:this.limit},i.omit(r(),"review")),success:function(e,t){console.log("loaded items:",t.length),0===t.length&&(this.ended=!0,this.updatePagination())}.bind(this)}),this.skip+=this.limit},500,{trailing:!1})});n.exports=d}),define("views/LoggedoutGallery",["require","exports","module","views/Gallery","views/GlobalSearchView","models/Diagram","underscore"],function(e,t,n){var i=e("views/Gallery"),o=e("views/GlobalSearchView"),r=(e("models/Diagram").DiagramCollection,e("underscore")),s=Backbone.View.extend({tagName:"div",className:"gallery-page",template:r.template("<div class='gallery-splash zwoosh'><div class='nav-bar'><a class='nav-item' href='/' data-l10n-id='index-nav-home'>Home</a><a class='nav-item' data-bypass href='/login' data-l10n-id='index-nav-login'>Login</a><a class='nav-item' data-bypass href=<% if(loggedIn) { %>'/plans'<% } else {%>'/#pricing'<% } %> data-l10n-id='index-nav-pricing'>Pricing</a><a class='nav-item' data-bypass href=<% if(loggedIn) { %>'/home#features'<% } else {%>'/#features'<% } %> data-l10n-id='index-nav-features'>Features</a><a class='nav-item active' href='/gallery' data-l10n-id='index-nav-gallery'>Gallery</a></div><h1 data-l10n-id='gallery-title'>The Coggle Gallery</h1><p class='gallery-description' data-l10n-id='gallery-blurb3'>Find inspiration, templates and examples from our selection of the best public diagrams and mind maps made with Coggle.</p><br/></div>"),events:{},initialize:function(e){this.options=e,this.galleryView=new i({collection:this.collection,galleryInFolder:!1,skip:e.skip}),this.addChildView(this.galleryView),this.searchView=new o({model:this.user,query:this.options.search,publicSearch:!0}),this.addChildView(this.searchView),this.$el.html(this.template({loggedIn:!getCoggleUser().isGuest()})),this.$el.find(".gallery-splash").append(this.searchView.render().$el),this.$el.append(this.galleryView.render().$el),this.searchView.delegateEvents(),this.galleryView.delegateEvents()},render:function(){return this}});n.exports=s}),define("views/CloneView",["require","exports","module","underscore","backbone","utils/queryString","views/BannerViews","models/Message","utils/randomhex","env"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=e("utils/queryString"),s=e("views/BannerViews").BannerStack,l=e("models/Message").Messages,a=e("utils/randomhex"),u=i.template("    <div class='banner-container'></div>    <div class='cloning-messages'>        <error></error>        <% if(userIsGuest) { %>            <div>                <p>You need to sign in to create your own copy of this diagram.</p>                <a class='green button' data-bypass href='/login?redirectTo=<%-redirectTo%>'><p>Sign in</p></a>            </div>        <% } else if(publicCopyOfPrivate) { %>            <div>                <p><strong>Warning:</strong> This diagram is private, but the copy you are making will be public, as you do not have any more private diagrams available.</p>                <a class='secondary button goback'><p>Cancel and go back</p></a>                <a class='green button doclone'><p>Create a public copy</p></a>            </div>        <% } %>        </div>    </div>"),d=function(e){var t=[];return Object.keys(e).forEach(function(n){"object"!=typeof e[n]?t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n])):e[n].length&&e[n].forEach(function(e){t.push(encodeURIComponent(n)+"[]="+encodeURIComponent(e))})}),t.join("&")},c=o.View.extend({tagName:"div",className:"clone-interstitial",events:{"touchstart .doclone":"doClone","click .doclone":"doClone","click .goback":"goBack"},initialize:function(e){i.bindAll(this,"render","error"),this.token=e.token,this.diagramId=e.diagramId,this.diagram=e.diagram,this.bannerView=new s({collection:l}),this.addChildView(this.bannerView)},copyWillBeMadePublic:function(){return!(this.diagram&&this.diagram.get&&this.diagram.get("public"))&&getCoggleUser().reachedPrivateLimit()},render:function(){var e="/clone/"+this.diagramId;this.token&&(e+="/"+this.token);var t={publicCopyOfPrivate:this.copyWillBeMadePublic(),userIsGuest:getCoggleUser().isGuest(),diagramTitle:this.diagram&&this.diagram.get&&this.diagram.get("title")||"",redirectTo:encodeURIComponent(e)};return this.$el.html(u(t)),this.$el.find(".banner-container").prepend(this.bannerView.render().$el),this},error:function(e){this.$el.find("error").first().text(e)},cloneIfPossible:function(){getCoggleUser().isGuest()||this.copyWillBeMadePublic()||this.doClone()},doClone:function(){var t=e("env").api.url+"/api/1/",n=i.pick(r(),"clone","date");n.clone||(n.clone=["content","title"]),this.token&&(n.token=this.token);var o={};n.date&&(o.date=n.date,delete n.date),n.c=a(16),$.post(t+"diagrams/"+this.diagramId+"?"+d(n),o).fail(function(e,t,n){this.error("Failed to copy diagram: "+(e&&e.responseJSON&&e.responseJSON.description||n||t))}.bind(this)).done(function(e,t,n){window.location="/diagram/"+e.short_id+(e.url_title?"/t/"+e.url_title:"")})},goBack:function(){window.history.back()}});n.exports=c}),define("views/SettingsView",["require","exports","module","underscore","backbone","views/OrganisationPicker"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=e("views/OrganisationPicker").OrganisationPicker,s=i.template("<div>    <div class='settings-view-header'>        <h2><%- heading %></h2>        <% if(close) { %><a class='close' href='<%- close %>'>✕</a><% } %>    </div>    <div class='container-fluid'>        <div class='row'>            <div class='col-sm-4 col-md-3'>                <ul class='settings-view-menu'>                    <% _.each(settings, function(setting, key){ %>                        <li class='entry <%-key%> <% if(key === selected) { %>selected<% } %>'>                            <a href='<%-base_url%>/<%-key%>' data-l10n-id='settings-<%-key%>-title'><%- setting.title %></a>                        </li>                    <% }) %>                </ul>            </div>            <div class='col-sm-8 col-md-9 settings-view-content'>                <div class='settings-content'></div>            </div>        </div>    </div></div>");n.exports=o.View.extend({tagName:"div",className:"settings-view",template:s,initialize:function(e){i.bindAll(this,"render"),this.options=e},render:function(){var e=this.options.selected,t=this.options.settings[e];if(!t&&i.values(this.options.settings).length&&(t=i.values(this.options.settings)[0],e=i.keys(this.options.settings)[0]),this.$el.html(this.template({base_url:this.options.base_url||"/me",settings:this.options.settings,selected:e,close:this.options.close,heading:this.options.heading})),this.options.hero&&(this.$el.find(".container-fluid").first().prepend(this.options.hero.render().$el),this.options.hero.delegateEvents()),this.options.organisations){this.$el.addClass("has-organisation");var n=new r({collection:this.options.organisations,melink:"/me",path_suffix:"/dashboard/"+e});this.$el.prepend(n.render().$el)}return t&&(this.$el.find(".settings-content").html(t.view.render().$el),t.view.delegateEvents()),this}})}),define("views/OrganisationSignupView",["require","exports","module","underscore","backbone"],function(e,t,n){var i=e("underscore"),o=e("backbone");n.exports=o.View.extend({tagName:"div",className:"organisation-signup",
template:i.template("<div class='signup'><h1 data-l10n-id='orgcreate-title2' class='title'>Create a <a data-l10n-name='orgs' href='/organisations' data-bypass>Coggle Organization</a></h1><error></error><div class='org-name' ><input data-l10n-id='orgcreate-nameinput' type='text' placeholder='Choose Your Organization Name' class='orgname' /><span data-l10n-id='orgcreate-namehint' class='description flash-error'>Pick something short and recognisable!</span><div style='text-align:right'><a data-l10n-id='orgcreate-createbutton' class='create-org button green'>Create</a></div></div><div class='faqs container-fluid'><div class='row'><div class='faq col-md-6'><div class='question' data-l10n-id='faq-orgs-whatare-q'>What are Coggle Organizations?</div><div class='answer' data-l10n-id='faq-orgs-whatare-a'><p data-l10n-name='p1'>Coggle Organizations create a separation between your personal diagrams and those owned by your company. By separating what's personal from what's professional you gain greater control over your businesses data that's stored in Coggle, including when and how it's shared by your employees.</p></div></div><div class='faq col-md-6'><div class='question' data-l10n-id='faq-orgs-whofor-q'>Who are Coggle Organizations for?</div><div class='answer' data-l10n-id='faq-orgs-whofor-a'><p data-l10n-name='p1'>Coggle Organizations have been designed for teams that require greater control over the data they enter into Coggle, or need to keep personal data separate. They're being successfully used by private companies, public bodies, schools and universities to help groups collaborate securely.</p><p data-l10n-name='p2'>Any group that need more control over sharing of diagrams, whether for regulatory or internal policy compliance will find Coggle Organizations useful.</p></div></div><div class='faq col-md-6'><div class='question' data-l10n-id='faq-orgs-features-q'>What are the main features of a Coggle Organization?</div><div class='answer' data-l10n-id='faq-orgs-features-a'><p data-l10n-name='p1'><b>Administrators dashboard</b>: complete control over diagrams created by members of your organization, including restoration of deleted diagrams.</p><p data-l10n-name='p2'><b>Data control</b>: choose to limit sharing of data to within your organization only.</p><p data-l10n-name='p3'><b>Bulk export</b>: export all diagrams in your organization for backup or regulatory purposes.</p><p data-l10n-name='p4'><b>Centralised billing</b>: pay for multiple Awesome subscriptions in one place, and revoke subscriptions when members come and go from your organsiation.</p></div></div><div class='faq col-md-6'><div class='question' data-l10n-id='faq-orgs-awesome-q'>How do Coggle Organizations relate to Coggle Awesome?</div><div class='answer' data-l10n-id='faq-orgs-awesome-a'><p data-l10n-name='p1'>Coggle Organizations centralise billing and license management for multiple Coggle Awesome subscriptions.</p><p data-l10n-name='p2'>Every user in your Organization will automatically get Coggle Awesome when they're working on diagrams in your organization workspace. This means all the great features including private diagrams, presentation mode, extended colour palette and high resolution image uploads.</p></div></div><div class='faq col-md-6'><div class='question' data-l10n-id='faq-orgs-billing-q'>How does billing work for Coggle Organizations?</div><div class='answer' data-l10n-id='faq-orgs-billing-a' data-l10n-args='{\"pricePerMemberPerMonth\":8}'>Coggle Organizations are charged at $8 per member per month. You can add and remove members at any time from the dashboard for your organization.</div></div><div class='faq col-md-6'><div class='question' data-l10n-id='faq-orgs-edu-q'>Are there any education pricing options?</div><div class='answer' data-l10n-id='faq-orgs-edu-a'>Yes! Contact us at education@coggle.it to find out more.</div></div><div class='faq col-md-6'><div class='question' data-l10n-id='faq-orgs-more-q'>I've still got some questions...</div><div class='answer' data-l10n-id='faq-orgs-more-a'>Ask us! Send us an email to orgs@coggle.it and we'll be happy to help :)</div></div></div></div></div>"),events:{"keyup .orgname":"validateName","notify-warning":"error","click .faq .question":"openFAQ","click .create-org":"createOrganisation"},initialize:function(e){i.bindAll(this,"render","createOrganisation","validateName","error"),this.options=e,$(this.el).html(this.template()),ga("send","event","Organisation","Signup","Opened"),getCoggleUser().getActions().perform("orgs:opensignup")},validateName:function(){var e=["about","press","diagrams","diagram","terms","tos","error","unsupported","admin","login","login_error","help","administrator","auth","organisation","organisations","me","api","mobile","invite","metrics","developer","privacy","folders","plans"],t=this.$el.find(".orgname").val();if(0===t.length)this.$el.find(".flash-error").addClass("error").text("Organisation name is required");else if(t.length<2)this.$el.find(".flash-error").addClass("error").text("Organisation name must be two or more characters.");else if(/^[a-z]/i.test(t)){if(-1==e.indexOf(t.toLowerCase()))return this.$el.find(".flash-error").removeClass("error").text("Okay!"),!0;this.$el.find(".flash-error").addClass("error").text("Names like that are reserved, please try a different one.")}else this.$el.find(".flash-error").addClass("error").text("Organisation name must begin with a letter.");return!1},createOrganisation:function(){ga("send","event","Organisation","Signup","StripeCompleted");var e=window.getCoggleUser(),t={wait:!0,success:function(e){e.createCheckoutSession({plan:"organisation:standard"}).redirect(function(e){if(e)return this.error(e.message||"Creating organisation checkout failed.")}.bind(this))}.bind(this),error:function(e,t){this.error(t.responseJSON.description||"Creating organisation failed.")}.bind(this)},n={name:this.$el.find(".orgname").val()};this.org?this.org.save(n,t):this.org=e.getOrganisations().create(n,t)},onSignupCancel:function(){o.history.navigate("/",!0)},error:function(e){ga("send","event","Organisation","Signup","Error"),this.$el.find("error").text(e),this.$el.find("button.signup").prop("disabled",!1),this.$el.find("input").prop("disabled",!1)},render:function(){return this}})}),define("views/OrganisationLoginView",["require","exports","module","underscore","backbone","utils/queryString","jquery"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=e("utils/queryString");e("jquery");var s=i.template("<div class='org-icon' style=' background-color: <%- colour %>; background-image: url(<%- picture %>)'></div><h2><%- name %></h1><a class='button green' data-bypass href='<%- login_url %>'>Login</a>");n.exports=o.View.extend({tagName:"div",className:"organisation-login",initialize:function(e){i.bindAll(this,"render"),this.options=e},render:function(){var e=this.model.toJSON();return e.login_url=this.model.loginUrl(),r().redirectTo&&(e.login_url+="?redirectTo="+r().redirectTo),$(this.el).html(s(e)),this}})}),define("views/VerifyEmailView",["require","exports","module","underscore","backbone","env"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=e("env").api.url+"/api/1/",s=i.template("<div class='content-box container'><% if (errmsg) { %><error><%-errmsg%></error><% } else { %><p>One moment please... We've just sent an email to <b><%-address%></b> to verify your addess. Click on the link in the email to complete verification.</p><p>People use your email address to invite you to their diagrams in Coggle, and to reply to your invites.</p><p><a class='button resend-verification'>Resend Verification Email</a></p><% } %></div>"),l=function(){window.location.replace("/verify/done")},a=o.View.extend({events:{"click .resend-verification":"resendVerification"},tagName:"div",className:"verify-email-view",initialize:function(e){i.bindAll(this,"resendVerification"),this.options=e,this.errmsg=null},render:function(){if(this.model.get("emails").length)l();else{var e=this.model.get("emails_needing_verification");this.$el.html(s({address:e&&e[0],errmsg:this.errmsg}))}return this},resendVerification:function(){if(!this.$el.find(".button").hasClass("disabled")){if(!this.model.get("emails_needing_verification").length)return console.error("no email to verify!");this.$el.find(".button").addClass("disabled"),this.$el.find(".button").text("Sending..."),$.ajax({url:r+"me/emails/"+this.model.get("emails_needing_verification")[0],type:"PUT",contentType:"application/json"}).done(function(){this.$el.find(".button").text("Sent!")}.bind(this)).fail(function(){this.$el.find(".button").text("Sending failed.")}.bind(this))}}}),u=i.template("<div class='content-box container'><% if (errmsg) { %><error><%-errmsg%></error><p>Return to the <a href='/' data-bypass>Coggle home page</a>.</p><% } else { %><p>Verifying...</p><% } %></div>"),d=o.View.extend({tagName:"div",className:"verify-email-view",initialize:function(e){this.options=e,this.errmsg=null},render:function(){return this.$el.html(u({verifying:!0,errmsg:this.errmsg})),this},checkSignature:function(){this.options.sig&&$.ajax({url:r+"me/emails/"+this.options.email+"/verify?ts="+this.options.ts+"&user="+this.options.user+"&sig="+this.options.sig,type:"PUT"}).done(function(){console.log("verify sig OK"),l()}.bind(this)).fail(function(e){this.errmsg=e&&e.responseJSON&&e.responseJSON.description||"Invalid verification link! Please check the address and try again.",this.render()}.bind(this))}}),c=i.template("<div class='content-box container'><p>Thank you. Your address has been verified.</p><% if (!isGuest) { %><p><a href='/welcome'>Start using Coggle.</a></p><% } else {%><p>You can now close this browser window, or <a href='/login'>log in</a> to get started</p><% }%></div>"),h=o.View.extend({tagName:"div",className:"verify-complete-view",initialize:function(e){i.bindAll(this,"render"),this.options=e},render:function(){return this.$el.html(c({isGuest:getCoggleUser().isGuest()})),this}});n.exports={VerifyEmailView:d,VerifyCompleteView:h,MustVerifyEmailView:a}}),define("views/InvoiceViews",["require","exports","module","underscore","backbone"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=o.View.extend({tagName:"div",className:"invoice",template:i.template("<div style='padding: 30px'><p style='text-align:center'><img src='/img/coggle-2x.png' width='150px'/></p><div class='coggle-address' style='padding: 10px; float:left; vertical-align: top; margin-top: 50px'><p>CoggleIt Limited</p><p>Suite 9, 266 Banbury Rd,</p><p>Summertown,</p><p>Oxford</p><p>OX2 7DL</p></div><div class='customer-address'  style='padding: 10px; float:right; vertical-align: top; margin-top: 50px'><p><%- receipt_email %></p><p><%- address_name %></p><p><%- address_line1 %></p><p><%- address_line2 %></p><p><%- address_city %></p><p><%- address_state %></p><p><%- address_zip %></p><p><%- address_country %></p></div><div class='date' style='clear: both; margin: 10px;'><p><b>Invoice date</b> <%-new Date(date*1000).toDateString()%></p></div><% if(invoice_number) { %><div class='receipt-number'><p><b>Invoice Number</b> <%- invoice_number %></p></div><% } %><% if(receipt_number) { %><div class='receipt-number'><p><b>Receipt Number</b> <%- receipt_number %></p></div><% } %><% if(!(receipt_number || invoice_number)) { %><div class='receipt-number'><p><b>Invoice ID</b> <%- id %></p></div><% } %><ul class='cogglelist' style='padding: 15px;'><% _.each(lines, function(line){ %><li class='line'><span class='item' style='display:inline-block; width: 75%'><%- line.description %></span><span class='price' style='display:inline-block; width: 24%'><%- (line.amount/100).toFixed(2) %> (<%- line.currency.toUpperCase() %>)</span></li><% }); %></ul><% if(discount_total > 0) { %><p class='tax' style='float:right; clear: both'>Discount Applied:<b> <%- -(discount_total/100).toFixed(2) %> (<%- currency.toUpperCase() %>)</b></p><% } %><p class='tax' style='float:right; clear: both'>Including VAT at <%- vat ? vat : 0 %>%: <b><%- (vat? (total / 100 - total / (Number(vat) + 100)).toFixed(2) : 0) %> (<%- currency.toUpperCase() %>)</b></p><p class='tax' style='float:right; clear: both'>Total:<b> <%- (total/100).toFixed(2) %> (<%- currency.toUpperCase() %>)</b></p><div class='invoice-footer'><p class='company-info'>CoggleIt Limited: Registered in England and Wales. No. 9030487.</p><% if(date*1000 > (new Date('2021-01-01')).getTime()) { %><p class='vat-info'>EU VAT MOSS Ref, where applicable: <span class='vat-no'>EU 372 017 827</span></p><% } %><p class='vat-info'>UK VAT Number: <span class='vat-no'>203 7881 12</span></p><p class='company-address'>Registered office: Suite 9, 266 Banbury Rd, Summertown, Oxford OX2 7DL, UK</p><p class='company-address'>Trading address: Ideaspace (Coggleit), 3 Laundress Lane, Cambridge CB2 1SD, UK</p></div></div>"),events:{},initialize:function(e){i.bindAll(this,"render")},render:function(){var e=this.model.toJSON();return e.discount_total||(e.discount_total=0),e.invoice_number||(e.invoice_number=null),e.receipt_number||(e.receipt_number=null),e.id||(e.id=null),this.$el.html(this.template(e)),this}}),s=o.View.extend({tagName:"ul",className:"cogglelist invoice-list",events:{},template:i.template("<li class='invoice-link'><a target='_blank' data-bypass target='_blank' href='<%- slug %>/invoices/<%- id %>'>Invoice for <%- statement_descriptor %> on <%-new Date(date*1000).toDateString()%></a><span class='amount'><%- total/100 %> (<%- currency.toUpperCase() %>)</span></li>"),initialize:function(e){i.bindAll(this,"addOne","addAll","render"),this.options=e,this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"reset",this.addAll),this.addAll()},render:function(){return this.addAll(),this},addOne:function(e){var t=e.toJSON(),n=getCoggleUser().getActiveOrg().get("slug");t.slug=n?"/"+n:"",this.$el.append(this.template(t))},addAll:function(){this.$el.empty(),this.collection.each(this.addOne)}});n.exports.InvoiceView=r,n.exports.InvoiceList=s}),define("views/CheatView",["require","exports","module","underscore","backbone","BrowserDetect"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=e("BrowserDetect"),s=i.template('<div class="group context-desktop"><div class="cheat-tip" data-l10n-id="sidebar-bgmenu2"><b>Zoom</b>, add <b>text labels</b>, <b>undo</b>, and <b>paste copied items</b> by right clicking the background.</div><div><h4 data-l10n-id="sidebar-whentyping">When typing:</h4></div> <ul><li><div class="helpitem" data-l10n-id="sidebar-sc-newitem">New Item: </div> <div class="helpvalue"> <span class="keyboardkey" data-l10n-id="sc-shift">shift</span> <span>+</span> <span class="keyboardkey" data-l10n-id="sc-ret">return</span> </div> </li><li><div class="helpitem" data-l10n-id="sidebar-sc-newchild">New Child Item: </div> <div class="helpvalue"> <span class="keyboardkey" data-l10n-id="sc-tab">tab</span> </div> </li><li><div class="helpitem" data-l10n-id="sidebar-sc-parent">Jump to Parent: </div> <div class="helpvalue"> <span class="keyboardkey" data-l10n-id="sc-shift">shift</span> <span>+</span> <span class="keyboardkey" data-l10n-id="sc-tab">tab</span> </div> </li><li><div class="helpitem" data-l10n-id="sidebar-sc-markdown-title">Format text: </div> <div class="helpvalue" data-l10n-id="sidebar-sc-markdown">use <a data-l10n-name="link" href="https://coggle.help/article/30-using-markdown-formatting-in-coggle" target="_blank" rel="noopener">Markdown</a></div> </li></ul></div><div class="group shortcuts"><div><h4 data-l10n-id="sidebar-shortcuts">Shortcuts</h4></div> <ul><li><div class="helpitem" data-l10n-id="sidebar-removebranch">Remove Branch:</div> <div class="helpvalue"> <% if(os === "Mac") { %><span class="keyboardkey">⌥</span> <% } else { %><span class="keyboardkey" data-l10n-id="sc-ctrl">ctrl</span> <% } %><span data-l10n-id="sc-and-click">+ click </span> <span class="diagram-button cross"></span> </div> </li><li><div class="helpitem" data-l10n-id="sidebar-insertbranch">Insert Branch:</div> <div class="helpvalue"> <span class="keyboardkey" data-l10n-id="sc-shift">shift</span> <span data-l10n-id="sc-and-click">+ click </span> <span class="diagram-button arrow"></span> </div> </li><li><div class="helpitem" data-l10n-id="sidebar-transplantbranch">Transplant Branch: </div> <div class="helpvalue"> <span class="keyboardkey" data-l10n-id="sc-shift">shift</span> <span data-l10n-id="sc-and-drag">+ drag </span> <span class="diagram-button arrow"></span> </div> </li><li><div class="helpitem" data-l10n-id="sidebar-addimages-title">Add <a target="_blank" rel="noopener" data-l10n-name="images" href="https://coggle.help/article/36-add-images-to-your-coggle-diagram">Images</a>: </div> <div class="helpvalue"> <div data-l10n-id="sc-dragdrop">drag and drop</div> </div> </li><li><div class="helpitem" data-l10n-id="sidebar-zoom">Zoom: </div> <div class="helpvalue"> <span class="keyboardkey" data-l10n-id="sc-ctrl">ctrl</span> <span data-l10n-id="sc-and-mousewheel">+ mousewheel </span> </div> </li><li><div class="helpitem" data-l10n-id="sidebar-undo">Undo: </div> <div class="helpvalue"> <% if(os === "Mac") { %><span class="keyboardkey">⌘</span> <% } else { %><span class="keyboardkey" data-l10n-id="sc-ctrl">ctrl</span> <% } %><span>+ </span> <span class="keyboardkey">Z </span> </div> </li><li><div class="helpitem" data-l10n-id="sidebar-redo">Redo:</div> <div class="helpvalue"> <% if(os === "Mac") { %><span class="keyboardkey">⌘</span> <% } else { %><span class="keyboardkey" data-l10n-id="sc-ctrl">ctrl</span> <% } %><span>+</span> <span class="keyboardkey" data-l10n-id="sc-shift">shift</span> <span>+</span> <span class="keyboardkey">Z</span> </div> </li></ul></div><div class="group context-touch"><div class="cheat-tip" data-l10n-id="touch-pressitem"><b>Long-press</b> on an <b>item</b> to <b>remove</b> items, change <b>colour</b>, <b>auto-arrange</b>, cross-link, copy, and more.</div><div class="cheat-tip" data-l10n-id="touch-pressbackground"><b>Long-press</b> on the <b>background</b> to add <b>labels</b>, <b>undo</b>, and paste.</div></div><div class="group"><div><h4 data-l10n-id="sidebar-markdown">Markdown</h4></div> <div class="cheat-tip" data-l10n-id="markdown-checkbox"><code>- [X]</code> to create a <input data-l10n-name="checkbox" type="checkbox"/> checkbox</div><div class="cheat-tip" data-l10n-id="markdown-code"><code>`text`</code> to use a <code>fixed width</code> font</div></div><div class="group"><div><h4 data-l10n-id="sidebar-icons">Icons</h4></div> <div class="cheat-tip" data-l10n-id="markdown-icons">Type <code>:</code> while editing or use the button along the top of the item editor.</div></div>'),l=o.View.extend({tagName:"div",className:"cheats",initialize:function(){i.bindAll(this,"render")},render:function(){return $(this.el).html(s({os:r.OS})),this}});n.exports=l}),define("views/GlobalHelpView",["require","exports","module","underscore","backbone","js-cookie","models/User"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=e("js-cookie"),s=e("models/User"),l=o.View.extend({tagName:"div",className:"global-help-view",template:i.template("<div class='global-help-content'>    <div class='contextual-help'></div>    <div class='search-box'>        <input data-l10n-id='help-search' type='text' class='search' placeholder='Help me to...'/>    </div></div><div class='global-help-button' role='button' aria-label='help'></div>"),events:{"keydown .search":"handleSearchKeypress","click .global-help-button":"toggle"},initialize:function(e){i.bindAll(this,"render","handleSearchKeypress","setContextualHelp","toggle"),this.options=e,this.readonly=e&&e.readonly},render:function(){return this.$el.html(this.template()),this.$el[0].setAttribute("role","complementary"),this.$el[0].setAttribute("aria-label","help and shortcuts"),this.readonly||r.get("globalHelpOpen")&&"false"===r.get("globalHelpOpen")?!this.readonly||r.get("globalHelpOpen")&&"true"===r.get("globalHelpOpen")||this.close():(this.resize(),this.open()),this.contextView?(this.$el.find(".contextual-help").html(this.contextView.render().$el),this.contextView.delegateEvents()):this.$el.find(".contextual-help").empty(),$(window).one("coggle-mode-changed",function(){this.$el.removeClass("open")}.bind(this)),this},setReadonly:function(e){this.readonly=e,this.render()},setContextualHelp:function(e){this.contextView=e,this.render()},handleSearchKeypress:function(e){if(13===e.keyCode){var t=this.$el.find(".search").val();window.open("https://coggle.help/search?query="+encodeURIComponent(t)),ga("send","event","GlobalHelp","Search",t)}27===e.keyCode&&(""===this.$el.find(".search").val()?this.toggle():this.$el.find(".search").val("")),e.stopPropagation()},resize:function(){this.$el.find(".global-help-content .contextual-help").css({"max-height":$(window).innerHeight()-200})},close:function(){this.$el.hasClass("open")&&(this.$el.removeClass("open"),this.trigger("close"))},open:function(){this.$el.hasClass("open")||(this.$el.addClass("open"),this.trigger("open"))},isOpen:function(){return this.$el.hasClass("open")},toggle:function(e){this.$el.hasClass("open")||!1===e?(this.close(),r.set("globalHelpOpen","false",{expires:3600,path:"/"})):(s.me().getActions().unique("globalhelp:open"),this.resize(),this.open(),this.$el.addClass("open"),r.set("globalHelpOpen","true",{expires:3600,path:"/"}))}},o.Events);l.instance=function(){return l._instance||(l._instance=new l),l._instance},n.exports=l}),define("models/APIClients",["require","exports","module","backbone","env"],function(e,t,n){var i=e("backbone"),o=i.Model.extend({idAttribute:"_id"}),r=i.Collection.extend({model:o,url:e("env").api.url+"/api/1/clients",comparator:"_id"});n.exports.APIClientModel=o,n.exports.APIClientCollection=r}),define("views/APIClientViews",["require","exports","module","underscore","backbone","env"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=i.template("<error></error><div class='field'><div class='about'>The name of the application. This will be displayed to your users when Coggle asks them to authorize your application.</div><span class='input-label'>Application Name</span><input class='name' value='<%-name%>' /></div><div class='field'><div class='about'>The ID of your client application. You'll need this when you're using the Coggle OAuth2 APIs.</div><span class='input-label'>Client ID</span><input class='clientsecret selects' value='<%-_id%>' readonly/></div><div class='field clientsecret'><div class='about'>This is your client secret. You'll need this to use the OAuth2 APIs. Keep it safe and <b>don't share it with anyone</b>.</div><span class='input-label'>Client Secret</span><div class='wrap'><a class='refresh'><img src='"+e("env").cdn.url+"/img/refresh.png'></a><input class='clientsecret selects' value='<%-clientSecret%>' readonly/></div></div><div class='field'><div class='about'>Users get redirected back here after the authentication process. It should handle the access codes and error codes from Coggle.</div><span class='input-label'>Redirect URL</span><input class='redirecturi' value='<%-redirectURI%>' placeholder='Redirect URL' /></div><a class=' button danger delete'>    <span class='action'>Delete</span>    <span class='sure'>I&#39;m sure</span></a><div class='save-message'></div>"),s=o.View.extend({tagName:"div",className:"client-details",events:{"keypress input":"updateOnEnter","blur input:not([readonly])":"close","click .refresh":"generateSecret","click .selects":"select","click .delete":"deleteAreYouSure","click .sure":"removeClient"},initialize:function(e){i.bindAll(this,"render","close","edit","updateOnEnter","removeClient"),this.options=e,this.listenTo(this.model,"change",this.render),this.listenTo(this,"selected",function(){this.$el.parent().find(".selected").removeClass("selected"),this.$el.addClass("selected")}.bind(this))},render:function(){var e=this.model.toJSON();return $(this.el).html(r(e)),this},generateSecret:function(){this.model.save({clientSecret:null},{wait:!0})},select:function(e){$(e.target).select()},edit:function(e){$(this.el).addClass("editing"),this.input.focus()},message:function(e){this.saveMessageTimer&&clearTimeout(this.saveMessageTimer),this.$el.find(".save-message").html(e),this.$el.find(".save-message").show(),this.saveMessageTimer=setTimeout(function(){this.$el.find(".save-message").fadeOut()}.bind(this),2e3)},close:function(){this.message("Saving..."),this.model.save({name:this.$el.find("input.name").val(),redirectURI:this.$el.find("input.redirecturi").val(),appUrl:this.$el.find("input.appUrl").val(),repoUrl:this.$el.find("input.repoUrl").val()},{wait:!0,success:function(){this.message("Saved")}.bind(this),error:function(){this.message("Save failed!")}.bind(this)}),$(this.el).removeClass("editing")},updateOnEnter:function(e){13==e.keyCode&&$(e.target).blur()},deleteAreYouSure:function(){this.$el.find(".delete").addClass("disabled").addClass("areyousure"),window.setTimeout(function(){this.$el.find(".delete").removeClass("disabled")}.bind(this),1e3),window.setTimeout(function(){this.$el.find(".delete").removeClass("areyousure")}.bind(this),6e3)},removeClient:function(e){this.$el.find(".delete").hasClass("disabled")||(this.model.destroy({wait:!0}),this.$el.slideUp(function(){this.$el.remove()}.bind(this)))}}),l=i.template("<div class='name'><%-name%></div><div class='tags'></div>"),a=o.View.extend({tagName:"li",className:"client panel",events:{click:"selected"},initialize:function(e){i.bindAll(this,"render","selected","onRemoved"),this.options=e,this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"destroy",this.onRemoved)},render:function(){return $(this.el).html(l(this.model.toJSON())),this},onRemoved:function(){this.$el.slideUp(function(){this.$el.remove()}.bind(this))},selected:function(){this.clientDetails||(this.clientDetails=new s({model:this.model})),$(this.options.details).html(this.clientDetails.render().el),this.clientDetails.delegateEvents(),this.clientDetails.trigger("selected")}}),u=i.template("<ul class='col-sm-3 clients cogglelist'>    <li class='create-client selected'>Add Client</li></ul><div class='col-sm-9 paneldetails'></div>"),d=i.template("<div class='choose-type'>    <div class='field'>        <h3>Create Client</h3>        <p class='description'>Create a new Coggle API client.</p>        <div class='button green create'>Create</div>    </div></div>"),c=o.View.extend({tagName:"div",className:"client-list",events:{"click .create-client":"showChoose","click .create":"createClient","click li":"select"},initialize:function(e){i.bindAll(this,"addOne","addAll","render","select"),this.options=e,this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"reset",this.addAll),this.listenTo(this.collection,"all",this.render),this.listenToOnce(this,"added",function(e){e.$el.click()}),$(this.el).html(u()),this.showChoose()},showChoose:function(){this.$el.find(".selected").removeClass("selected"),this.$el.find(".paneldetails").html(d()),this.$el.find(".create-client").addClass("selected")},createClient:function(){this.collection.create({failure:[0,0],success:[0,0],users:[0,0]},{wait:!0}),this.once("added",function(e,t){e.selected()})},select:function(e){var t=$(e.target).closest("li"),n=this.$el.find(".paneldetails"),i=n.position().top+n.height(),o=t.position().top+t.height(),r=o-i;r<0&&(r=0),n.css("margin-top",r),this.$el.find(".selected").removeClass("selected"),t.addClass("selected")},render:function(){return this},addOne:function(e){var t=new a({model:e,details:this.$el.find(".paneldetails")});$(this.el).find(".clients .create-client").before(t.render().el),this.trigger("added",t,e),t.trigger("added")},addAll:function(){this.collection.sort(),this.collection.each(this.addOne)}});n.exports.APIClientDetailsView=s,n.exports.APIClientView=a,n.exports.APIClientList=c}),define("views/DeveloperView",["require","exports","module","underscore","backbone","models/APIClients","views/APIClientViews","models/User"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=e("models/APIClients").APIClientCollection,s=e("views/APIClientViews").APIClientList,l=(e("models/User"),o.View.extend({tagName:"div",className:"developer-page",template:i.template("<div class='gallery-splash zwoosh'><div class='nav-bar'><a class='nav-item' href='/' data-l10n-id='index-nav-home'>Home</a><a class='nav-item' data-bypass href='/login' data-l10n-id='index-nav-login'>Login</a><a class='nav-item' data-bypass href=<% if(loggedIn) { %>'/plans'<% } else {%>'/#pricing'<% } %> data-l10n-id='index-nav-pricing'>Pricing</a><a class='nav-item' data-bypass href=<% if(loggedIn) { %>'/home#features'<% } else {%>'/#features'<% } %> data-l10n-id='index-nav-features'>Features</a><a class='nav-item' href='/gallery' data-l10n-id='index-nav-gallery'>Gallery</a></div><br/><br/><h1>Develop Using the Coggle API</h1><p>The Coggle API lets you make requests to create and manipulate Coggles, to visualise your data, integrate Coggle with an existing process, import and export to different file types, and anything else that you can imagine!</p></div><h1 class='clientsheading'>Your API Clients</h1><br><h1>Resources</h1><p>These resources may be useful for developing API applications.<p><ul class='apiresources'><li>A <a href='https://github.com/Coggle/coggle-js'> client library</a> for node.js</li><li>A <a href='https://github.com/Coggle/coggle-issue-importer'> GitHub issue importer</a> with <a href='http://github2coggle.herokuapp.com'>running demo</a></li><li>A <a href='https://github.com/Coggle/coggle-opml-importer'> OPML importer</a> with <a href='http://opmloggle.herokuapp.com'>running demo</a></li><li>and the <a href='https://embed.coggle.it/diagram/532f2f5007eb88f857000976/06b3a62e14eb54cf7e99086f3cf7dd0398af0ecca4476a8778cad4a67eba53bb'>API documentation</a></li></ul>"),initialize:function(){if(!getCoggleUser().isGuest()){var e=new r;this.clientListView=new s({collection:e}),e.fetch()}},render:function(){return this.$el.html(this.template({loggedIn:!getCoggleUser().isGuest()})),this.clientListView?(this.$el.find(".clientsheading").after(this.clientListView.render().$el),this.clientListView.delegateEvents()):this.$el.find(".clientsheading").after("<span>You are not logged in: <a href='/login?redirectTo=%2fdeveloper'>log in</a> to view and create API clients.</span>"),this}}));n.exports=l}),define("views/MarketSurveyView",["require","exports","module","underscore","backbone","utils/cogglitude"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=(e("utils/cogglitude").onAmplitude,
i.template("<div class='container-fluid'>    <error></error>    <h3>Hello! Welcome to Coggle</h3>    <div class='question row'></div>    <a class='button green disabled done'>Done</a>    <span class='progress'><%- progress %></span></div>")),s=i.template("<p>One moment before you get started. To help us improve, which best describes you?</p><div class='segment col-xs-4' data-segment='education'>    <div class='segment-title'>Education</div>    <div class='role' data-role='student'>Student</div>    <div class='role' data-role='teacher'>Teacher</div>    <div class='role' data-role='edu-administrator'>Administrator</div></div><div class='segment col-xs-4' data-segment='it-or-engineering'>    <div class='segment-title'>IT / Engineering</div>    <div class='role' data-role='software-engineer'>Software Engineer</div>    <div class='role' data-role='network-engineer'>Network Engineer</div>    <div class='role' data-role='management'>Management</div>    <div class='role' data-role='other-engineering'>Other</div></div><div class='segment col-xs-4' data-segment='operations'>    <div class='segment-title'>Operations</div>    <div class='role' data-role='operations-manager'>Operations Manager</div>    <div class='role' data-role='project-manager'>Project Manager</div>    <div class='role' data-role='human-resources'>Human Resources</div>    <div class='role' data-role='other-operations'>Other</div></div><div class='segment col-xs-4' data-segment='product-or-design'>    <div class='segment-title'>Product / Design</div>    <div class='role' data-role='product-manager'>Product Manager</div>    <div class='role' data-role='ux-designer'>UX Designer</div>    <div class='role' data-role='other-design'>Other</div></div><div class='segment col-xs-4' data-segment='business'>    <div class='segment-title'>Business</div>    <div class='role' data-role='finance'>Finance</div>    <div class='role' data-role='marketing'>Marketing</div>    <div class='role' data-role='sales'>Sales</div>    <div class='role' data-role='management'>Management</div></div><div class='segment col-xs-4' data-segment='other'>    <div class='segment-title'>Other</div>    <div class='role' data-role='other'>Other</div></div>");n.exports=o.View.extend({events:{"click .role":"selectRole","click .button.done:not(.disabled)":"remove"},tagName:"div",className:"market-survey-view",initialize:function(e){i.bindAll(this,"render","selectRole","save","remove"),this.options=e},render:function(){return this.$el.html(r({progress:"1 of 1"})),this.renderSegments(),this.segment&&(this.$el.find(".button.done").removeClass("disabled"),this.thanks()),this.delegateEvents(),this},renderSegments:function(){this.$el.find(".question").first().html(s())},thanks:function(){this.$el.find(".question").append("<div class='thanks col-xs-12'><h3>Thanks!</h3></div>"),this.$el.addClass("closing")},selectRole:function(e){var t=$(e.target);this.segment=t.closest(".segment").attr("data-segment"),this.role=t.attr("data-role"),this.save()},save:function(){var e={survey_segment:this.segment,survey_role:this.role};this.model.save({segmentation:e}),this.model.getActions().setExternalUserProperties(e),this.model.getActions().perform("survey:market:complete"),this.render(),setTimeout(this.remove,800)}})}),function(e){"function"==typeof define&&define.amd?define("plugins/jquery.booleanSlider",["jquery"],e):e(jQuery)}(function(e){e.fn.booleanSlider=function(t){this.each(function(){var t=this;e(t).on("mousedown touchstart",function(n){n.preventDefault(),e(t).hasClass("on")?t.toNo():t.toYes()}),this.toNo=function(n){e(t).removeClass("on").html("NO"),e(t).parent().next('input[type="checkbox"]').removeAttr("checked"),e(t).attr("data-l10n-id","slider-no"),(void 0===n||n)&&setTimeout(function(){e(t).trigger("changed",{state:!1})},100)},this.toYes=function(n){e(t).addClass("on").html("YES"),e(t).parent().next('input[type="checkbox"]').prop("checked","checked"),e(t).attr("data-l10n-id","slider-yes"),(void 0===n||n)&&setTimeout(function(){e(t).trigger("changed",{state:!0})},100)},e(t).hasClass("on")?t.toYes(!1):t.toNo(!1)})}}),define("views/PersonalCommunicationView",["require","exports","module","underscore","backbone","plugins/jquery.booleanSlider","env"],function(e,t,n){var i=e("underscore"),o=e("backbone");e("plugins/jquery.booleanSlider");var r="<error></error><div class='settings-section'><h3 data-l10n-id='me-emails-title'>Email Addresses</h3><p data-l10n-id='me-emailstip'>We'll only email your primary address, but you can receive invites to any of the others.</p><ul class='cogglelist emails'><% _.each(emails, function(email) {%>    <li><%-email%>    <% if(email == emails[0]) {%>        <b data-l10n-id='me-emails-primary'> (primary)</b>    <%} else { %>        <div class='icons'>            <img src='"+e("env").cdn.url+"/img/bin.png' class='delete icon' data-id='<%-email%>' />        </div>    <% } %>    </li><%})%></ul><h3 data-l10n-id='me-communication-title'>Communication</h3><span data-l10n-id='me-talktome'>Talk to me:</span><div class='checkbox-slider-frame'>    <span class='allow_communication slider-button <%-allow_communication?'on':''%>'><%-allow_communication?'YES':'NO'%></span></div><input type='checkbox' name='allow_communication'/><span data-l10n-id='me-diagram-notifications'>Diagram notifications:</span><div class='checkbox-slider-frame'>    <span class='allow_transactional_communication slider-button <%-allow_transactional_communication?'on':''%>'><%-allow_transactional_communication?'YES':'NO'%></span></div><input type='checkbox' name='allow_transactional_communication'/></div>";n.exports=o.View.extend({tagName:"div",className:"personal-communication",template:i.template(r),events:{"changed .slider-button.allow_communication":"toggleCommunication","changed .slider-button.allow_transactional_communication":"toggleTransactionalCommunications","click .emails .delete":"removeEmail"},initialize:function(e){i.bindAll(this,"render","error","toggleCommunication","toggleTransactionalCommunications"),this.options=e,this.listenTo(this.model,"changed",this.render)},removeEmail:function(e){var t=$(e.target).attr("data-id");return $.ajax({url:"/api/1/me/emails/"+t,type:"delete"}).done(function(t){t.error?this.$el.find("error").text(t.msg):$(e.currentTarget).parent().parent().remove()}),e.preventDefault(),!1},toggleCommunication:function(e,t){this.model.set("allow_communication",t.state),this.model.save(void 0,{success:function(){this.error(null)}.bind(this),error:function(){this.error("Saving communication settings failed.")}.bind(this)})},toggleTransactionalCommunications:function(e,t){this.model.set("allow_transactional_communication",t.state),this.model.save(void 0,{success:function(){this.error(null)}.bind(this),error:function(){this.error("Saving transactional communication settings failed.")}.bind(this)})},render:function(){var e=this.model.toJSON();return $(this.el).html(this.template(e)),this.$el.find(".slider-button").booleanSlider(),this},error:function(e){this.$el.find("error").first().text(e)}})}),define("views/Profile",["require","exports","module","underscore","backbone","./MemberIconView","utils/colours","env"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=(e("./MemberIconView"),e("utils/colours")),s=e("env").cdn.url,l="<div class='settings-section'><error></error><h3 data-l10n-id='profile-title'>Your Appearance in Coggle</h3><div class='profile-preview'><div class='user-icon' style='background-image:url(<%- avatar.url %>); background-color: <%- avatar.colour %>;'></div><div class='choose-icon float-menu' style='display:none;'><div class='iconrow'><div class='icon-choice default' data-iconid='default' style='background-image:url(<%- avatar.provider_url || fallback_url %>); background-color: <%- colour %>;'></div><div class='icon-choice' data-iconid='1' data-colour='<%- colours[1] %>' style='background-image:url("+s+"/img/usericons/1.svg); background-color: <%- colours[1] %>;'></div><div class='icon-choice' data-iconid='2' data-colour='<%- colours[2] %>' style='background-image:url("+s+"/img/usericons/2.svg); background-color: <%- colours[2] %>;'></div></div><div class='iconrow'><div class='icon-choice' data-iconid='3' data-colour='<%- colours[3] %>' style='background-image:url("+s+"/img/usericons/3.svg); background-color: <%- colours[3] %>;'></div><div class='icon-choice' data-iconid='4' data-colour='<%- colours[4] %>' style='background-image:url("+s+"/img/usericons/4.svg); background-color: <%- colours[4] %>;'></div><div class='icon-choice' data-iconid='5' data-colour='<%- colours[5] %>' style='background-image:url("+s+"/img/usericons/5.svg); background-color: <%- colours[5] %>;'></div></div><div class='iconrow'><div class='icon-choice' data-iconid='6' data-colour='<%- colours[6] %>' style='background-image:url("+s+"/img/usericons/6.svg); background-color: <%- colours[6] %>;'></div><div class='icon-choice' data-iconid='7' data-colour='<%- colours[7] %>' style='background-image:url("+s+"/img/usericons/7.svg); background-color: <%- colours[7] %>;'></div><div class='icon-choice' data-iconid='8' data-colour='<%- colours[8] %>' style='background-image:url("+s+"/img/usericons/8.svg); background-color: <%- colours[8] %>;'></div></div></div><div class='user-name'> <%- name %> </div></div><p>Your name and default profile icon are from the account you use to sign in. Changing your icon here will only change it in Coggle.</p></div>",a=function(e){for(var t,n=e.length,i=0;i<n;i++){var o=n-Math.ceil(Math.random()*(n-i));t=e[i],e[i]=e[o],e[o]=t}return e};n.exports=o.View.extend({tagName:"div",className:"personal-profile",template:i.template(l),events:{"click .user-icon":"openIconChooser","click .icon-choice":"chooseIcon"},initialize:function(e){i.bindAll(this,"openIconChooser","chooseIcon"),this.options=e},render:function(){var e=this.model.toJSON();e.fallback_url=s+"/img/anon-member-2x.png";var t=r.defaults(!1);if(e.colours=["#bbbbbb"].concat(a(t)),"coggle"===e.avatar.source){var n=e.colours.indexOf(e.avatar.colour),i=parseInt((/usericons\/(\d)/.exec(e.avatar.url)||{1:0})[1]);if(i){var o=e.colours[i];e.colours[i]=e.colours[n],e.colours[n]=o}}return $(this.el).html(this.template(e)),this},openIconChooser:function(){this.$el.find(".choose-icon").css("display","block")},chooseIcon:function(e){this.$el.find(".choose-icon").css("display","none");var t=e.target.getAttribute("data-iconid");this.model.set("chosen_picture","default"===t?"":t),this.model.set("chosen_colour","default"===t?"":e.target.getAttribute("data-colour"));var n=this.model.get("avatar");"default"===t?(n.url=n.provider_url||s+"/img/anon-member-2x.png",n.provider="provider",n.colour=n.default_colour):(n.url=s+"/img/usericons/"+t+".svg",n.provider="coggle",n.colour=this.model.get("chosen_colour")),this.model.set("avatar",n),this.model.save(void 0,{success:function(){this.error(null)}.bind(this),error:function(){this.error("Saving profile image failed.")}.bind(this)}),this.render()},error:function(e){this.$el.find("error").first().text(e)}})}),define("views/PersonalLanguageView",["require","exports","module","underscore","backbone"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=i.template("<error></error><div class='settings-section'><h3 data-l10n-id='me-language-title'>Choose Your Preferred Language</h3><select class='select_language' name='select_language'>    <option value='default'>(Browser Default)</option>    <option value='en-GB'>English (UK)</option>    <option value='en-US'>English (US)</option>    <option value='es'>Español</option>    <option value='fr'>Français</option>    <option value='ja'>日本語</option>    <option value='ko'>한국어</option>    <option value='pt-BR'>Português (do Brasil)</option>    <option value='uk'>Українська</option>    <option value='zh-TW'>中文 (正體字, 臺灣)</option></select><p data-l10n-id='me-language-tip'>Help us provide Coggle in your native language, or add something that's missing by contributing to our <a data-l10n-name='translate-link' href='https://github.com/coggle/coggle-translations'>translations project</a> on Github!</p><p data-l10n-id='me-language-questions'>If you have any questions about translations – or you have corrections or improvements and you're not sure how to help out, just drop us an email at <a data-l10n-name='translate-email' href='mailto:translate@coggle.it'>translate@coggle.it</a>.</p></div>");n.exports=o.View.extend({tagName:"div",className:"personal-language",events:{"change .select_language":"selectionChanged"},initialize:function(e){i.bindAll(this,"render","error","selectionChanged"),this.options=e,this.listenTo(this.model,"changed",this.render)},selectionChanged:function(e,t){this.model.set("preferred_locale",this.$el.find(".select_language").val()),this.model.save(void 0,{success:function(){location.reload()},error:function(){this.error("Failed to update language settings.")}.bind(this)})},render:function(){var e=this.model.toJSON();return $(this.el).html(r(e)),$(this.el).find(".select_language").val(e.preferred_locale),this},error:function(e){this.$el.find("error").first().text(e)}})}),define("views/ManageAttachedFiles",["require","exports","module","underscore","backbone","views/AttachmentView","models/User"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=e("views/AttachmentView").AttachmentsListView,s=e("models/User"),l=i.template("<error></error><div class='settings-section'><h3>Attached Files</h3><p><span class='size-used calculating'>Calculating...</span> used of <%-limits.attachment_quota>=1e9? ((Math.round(limits.attachment_quota/1e8))/10 + ' GB') : (Math.round(limits.attachment_quota/1e6) + ' MB')%> available for file attachments.</p><p>These are the files attached to all of the diagrams in your documents list, including diagrams shared with you with editing access.</p><p>Files you remove here will be <b>removed permenantly</b> for everyone who has access to the diagram, and no longer accessible from the current version of diagrams, or from history mode.</p></div><div class='settings-section'><div class='manage-attachments'></div></div>"),a=i.template("<error></error><div class='settings-section'><h3>Attached Files</h3><p><span class='size-used calculating'>Calculating...</span> used by all organisation members for file attachments.</p><p>These are the files attached to all of the diagrams in your Organisation.</p><p>Files you remove here will be <b>removed permenantly</b> for everyone who has access to the diagram. They will no longer be accessible from the current version of diagrams, or from history mode. Only remove files which you are sure are no longer needed.</p></div><div class='settings-section'><div class='manage-attachments'></div></div>");n.exports=o.View.extend({tagName:"div",className:"manage-attached-files",events:{},initialize:function(e){this.options=e},render:function(){var e=this.model.toJSON();this.model instanceof s?(e.limits=e.limits||{},$(this.el).html(l(e))):$(this.el).html(a(e));var t=new r({collection:this.model.getAllAttachments(function(e,t){e&&this.error("Loading attachments failed."),this.updateSizeUsed(t)}.bind(this))});return this.addChildView(t),this.$el.find(".manage-attachments").html(t.render().$el),this},updateSizeUsed:function(e){var t=0;e.forEach(function(e){var n=e.get("size");"number"==typeof n?t+=n:console.log("attachment "+e.get("_id")+" has no known size")});var n=Math.round(t/1e6);this.$el.find(".size-used").removeClass("calculating").text(n+" MB")},error:function(e){this.$el.find("error").first().text(e)}})}),define("views/CancelPlanView",["require","exports","module","underscore","backbone","env"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=i.template("<error></error><div class='row'>    <div class='col-md-5'>        <img style='width: 100%' src='"+e("env").cdn.url+"/img/features/straight-lines-2.gif'/>    </div>    <div class='col-md-7'>        <h3>Are you sure?</h3>        <p>            If you have more than 3 private diagrams, you won't be able to edit them while using the free version.            You'll also miss out on <b>controlling line paths</b>, <b>customisable line styles</b>,            and all the other <a href='/awesome' data-bypass>Awesome features</a>!        </p>        <div class='button danger im-sure'>Cancel Subscription</div>        <a class='back'>Back</a>    </div></div>"),s=i.template("<div class='loadspinner'></div></div>");n.exports=o.View.extend({tagName:"div",className:"cancel-plan",events:{"click .im-sure":"cancelSubscription","click .back":"back"},initialize:function(e){i.bindAll(this,"render","cancelSubscription","error"),this.options=e},render:function(){return this.model.getPlans(function(e,t){return e?this.error("Something went wrong loading your plans! Please try again later"):t.getActivePlan()?void this.$el.html(r()):o.history.navigate("/me/billing",!0)}.bind(this)),this},error:function(e){this.$el.text(e)},think:function(){this.$el.html(s())},back:function(){this.trigger("back")},cancelSubscription:function(){this.think(),getCoggleUser().getActions().perform("cancellation:"+this.model.getPlans().getActivePlan().id),this.model.getPlans().getActivePlan().destroy({wait:!0,success:function(){window.location="/me/billing/survey"},error:function(){this.error("Something went wrong while canceling your subscription, please try again or contact Coggle support!")}.bind(this)})}})}),define("views/PlanSummaryView",["require","exports","module","underscore","backbone","views/CancelPlanView"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=e("views/CancelPlanView"),s=i.template("<p data-l10n-id='summary-free-plan' class='free'>You don't have a subscription yet. <a data-l10n-name='subscribe' href='/plans?src=me-upgrade-now' class='show-plans'>Upgrade now!</a></p>"),l=i.template("<p data-l10n-id='summary-active-plan' data-l10n-args='{\"planName\":\"<%- plan %>\"}' class='active'>You're on the <code><%- plan %></code> plan. <a data-l10n-name='cancel' class='cancel'>Cancel subscription</a> or <a data-l10n-name='compare' href='/plans?src=me-compare-plans'>compare plans</a>.</p>"),a=i.template("<div><p data-l10n-id='summary-uy-1' class='upgrade'>Get two months free (<b>save 15%</b>) by paying annually. <a data-l10n-name='upgrade' class='button green upgrade-yearly'>Upgrade (<b>$50</b>)</a></p><p data-l10n-id='summary-uy-2'>Time remaining on your current plan will be automatically deducted from the cost of the upgrade.</p></div>"),u=i.template("<div><p data-l10n-id='summary-uy-c1' class='upgrade'>Confirm upgrade? We'll charge your card on file between $45 and $50 based on the remaining time on your monthly plan. Your new subscription renewal date will be in one year.</p><a data-l10n-id='summary-confirm' class='button green upgrade-yearly-confirm'>Confirm Upgrade</a></div>"),d=i.template("<p data-l10n-id='summary-ending-2' data-l10n-args='{\"planName\":\"<%- plan %>\"}' class='active'><b>You have cancelled your <code><%- plan %></code> subscription</b>, and will not be billed again. You can continue to use the paid features until the end of the period you've already paid for.<br> <a data-l10n-name='resub' class='button green resubscribe'>Resubscribe</a></p>"),c=i.template("<p data-l10n-id='summary-overdue-plan3' data-l10n-args='{\"planName\":\"<%- plan %>\"}'  class='overdue'>Your <code><%- plan %></code> subscription is inactive due to an overdue payment.</p>"),h=i.template("<p><div data-l10n-id='cancel-subscription' class='cancel button danger'>Cancel Subscription</div></p>"),p=i.template("<p data-l10n-id='complete-payment'>You can <a data-l10n-name='invoice-link' href='<%- hosted_invoice_url %>'>view and complete</a> the outstanding payment, or <a data-l10n-name='cancel' class='cancel'>cancel subscription</a>.</p>"),f=o.View.extend({tagName:"div",className:"plan-summary",events:{"click .resubscribe":"resubscribe","click .cancel":"confirmCancel","click .upgrade-yearly":"upgradeToYearly","click .upgrade-yearly-confirm":"doYearlyUpgrade","click .upgrade-yearly-cancel":"cancelUpgrade"},template:i.template("<h3>Subscription</h3><error></error><div class='plan-details'><div class='loadspinner'></div></div></div>"),initialize:function(e){i.bindAll(this,"render","error"),this.options=e,this.working(!0),this.model.getPlans(function(e,t){if(e)return this.error("Something went wrong loading your plans! Please try again.");var n=t.getActivePlan();n&&(n.get("overdue")||n.get("incomplete"))?n.overduePaymentLink(function(e,t){this.hosted_invoice_url=t&&t.hosted_invoice_url||"",this.working(!1),this.render()}.bind(this)):(this.working(!1),this.render())}.bind(this)),this.cancelView=new r({model:this.model}),this.addChildView(this.cancelView),this.listenTo(this.cancelView,"back",function(){this.showCancel=!1,this.render()}.bind(this))},render:function(){if(this.$el.html(this.template()),this.showCancel)return this.$el.find(".plan-details").html(this.cancelView.render().$el),this.cancelView.delegateEvents(),this;if(this.isWorking)return this;if(this.showUpgradeConfirmation)return this.$el.find(".plan-details").html(u()),this;var e=this.model.getPlans(),t=e.getActivePlan();t&&(t=t.toJSON());var n=t?t.plan:"free";return this.model.isTriallingAwesome()&&(n="free"),!t||"free"===n||t.ending&&t.overdue?this.$el.find(".plan-details").html(s()):t.ending?this.$el.find(".plan-details").html(d(t)):t.overdue||t.incomplete?(this.$el.find(".plan-details").html(c(t)),this.hosted_invoice_url?(t.hosted_invoice_url=this.hosted_invoice_url,this.$el.find(".plan-details").append(p(t))):this.$el.find(".plan-details").append(h(t))):(this.$el.find(".plan-details").html(l(t)),"awesome"===n&&this.$el.find(".plan-details").append(a(t)),this.$el.find(".plan-details").append(h(t))),this},error:function(e){this.$el.find("error").first().text(e)},working:function(e){this.isWorking=e,this.render()},confirmCancel:function(){this.showCancel=!0,this.render()},resubscribe:function(){this.working(!0),this.model.getPlans().getActivePlan().save({active:!0},{success:function(){this.working(!1)}.bind(this),error:function(){this.working(!1),this.error("Resubscribe failed - please try again!")}.bind(this)})},cancelUpgrade:function(){this.showUpgradeConfirmation=!1,this.render()},upgradeToYearly:function(){this.showUpgradeConfirmation=!0,this.render()},doYearlyUpgrade:function(){this.working(!0),this.showUpgradeConfirmation=!1,this.model.getPlans().switchTo("awesome:yearly",function(e){e?(this.working(!1),e&&e.description?this.error(e.description):this.error("Upgrade failed - please try again or contact support!")):window.location.reload()}.bind(this))}});n.exports=f}),define("views/CustomerView",["require","exports","module","underscore","backbone"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=o.View.extend({tagName:"div",className:"customer",customerTemplate:i.template("<div class='card'>    <error></error>    <div class='card-details'>        <div class='save-overlay'>            <div class='loadspinner'></div></div>        </div>        <div class='main'></div>    </div></div>"),billingPreviewTemplate:i.template("<div>    <div>        <p data-l10n-id='billing-card' class='card-on-file' data-l10n-args='{\"cardEndsIn\":\"<%-last4%>\",\"cardExpires\":\"<%-exp_month%>/<%-exp_year%>\"}'>The card we have on file for you ends in <b><%-last4%></b>, it expires on <b><%-exp_month%>/<%-exp_year%></b>.</p>        <p data-l10n-id='billing-addr' class='address-on-file' data-l10n-args='{\"addressZip\":\"<%-address_zip%>\"}'>The billing zipcode we have for you is <b><%-address_zip%></b>. <a data-l10n-name='edit' class='billing-edit'>Edit card details</a></p>    </div>    <div data-l10n-id='billing-remove' class='billing-remove button danger'>Remove</div></div>"),noCardTemplate:i.template("<p data-l10n-id='billing-nocard'>There are no billing methods saved on your account. <a data-l10n-name='setup-card' class='billing-edit'>Setup card details</a></p>"),events:{"click .billing-edit":"edit","click .billing-remove":"removeCard"},initialize:function(e){i.bindAll(this,"render","error"),this.listenTo(this.model,"change",this.render),this.options=e,this.loaded=!1,this.model.fetchOrQueue(function(){this.loaded=!0,this.render()}.bind(this))},working:function(e){this.$el.toggleClass("working",e)},render:function(){return this.working(!this.loaded),this.$el.html(this.customerTemplate()),this.model.get("last4")?this.$el.find(".main").html(this.billingPreviewTemplate(this.model.toJSON())):this.$el.find(".main").html(this.noCardTemplate()),this.options.disable_card_update&&this.$el.find(".billing-edit").remove(),this},edit:function(e){this.options.checkout.redirect(this.error)},error:function(e){this.$el.find("error").text(e.message)},removeCard:function(){this.working(!0),this.model.destroy({wait:!0,success:function(){this.model.clear(),this.render(),this.working(!1)}.bind(this)})}});n.exports=r}),define("views/PersonalBillingView",["require","exports","module","underscore","backbone","views/PlanSummaryView","views/PlanSelectionView","views/CustomerView","views/InvoiceViews","../models/CheckoutSession"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=e("views/PlanSummaryView"),s=e("views/PlanSelectionView"),l=e("views/CustomerView"),a=e("views/InvoiceViews").InvoiceList,u=e("../models/CheckoutSession"),d=function(){return'<a class="typeform-share" href="https://coggleit.typeform.com/to/GONu8b?followup='+getCoggleUser().id+'" data-mode="popup" data-auto-open=true target="_blank" rel="noopener"></a><script>(function(){var qs,js,q,s,d=document,gi=d.getElementById,ce=d.createElement,gt=d.getElementsByTagName,id="typef_orm_share",b="https://s3-eu-west-1.amazonaws.com/share.typeform.com/";if(!gi.call(d,id)){js=ce.call(d,"script");js.id=id;js.src=b+"share.js";q=gt.call(d,"script")[0];q.parentNode.insertBefore(js,q)}})()<\/script>'};n.exports=o.View.extend({tagName:"div",className:"personal-billing",template:i.template("<error></error><div class='plans'></div><div class='subscription settings-section'></div><div class='stripe'></div><div class='invoices'></div></div>"),initialize:function(e){i.bindAll(this,"render"),this.options=e,$(this.el).html(this.template(this.model.toJSON())),this.options.survey&&this.$el.prepend(d()),this.planView=new r({model:getCoggleUser()}),this.$el.find(".subscription").append(this.planView.render().$el),this.addChildView(this.planView),this.customerView=new l({checkout:new u,model:this.model.getCustomer(function(){getCoggleUser().getPlans(function(e,t){e&&console.error("error fetching plans:",e),this.model.getCustomer().id?(!e&&t.getActivePlan()||(this.customerView.options.disable_card_update=!0),this.$el.find(".stripe").append(this.customerView.render().$el)):!e&&t.getActivePlan()||(this.planSelection=new s({model:getCoggleUser(),src:"me-billing"}),this.$el.find(".plans").append(this.planSelection.render().$el),this.$el.find(".subscription").hide())}.bind(this))}.bind(this))}),this.addChildView(this.customerView),this.invoiceList=new a({collection:getCoggleUser().getInvoices(function(){})}),this.$el.find(".invoices").html(this.invoiceList.render().$el),this.addChildView(this.invoiceList)},render:function(){return this}})}),define("views/RecommendCoggleView",["require","exports","module","underscore","backbone","views/RecommendProgressView","env"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=e("views/RecommendProgressView");n.exports=o.View.extend({tagName:"div",className:"recommend-coggle",template:i.template("<div class='settings-section'>    <h3 data-l10n-id='recommend-coggle'>Recommend Coggle</h3>    <div class='progress-view'></div>     <div>        <p data-l10n-id='recommend-share-link'>Either invite collaborators to your diagrams, or share your referral link via             <a data-l10n-name='email' target='_blank' rel='noopener noreferrer' href='mailto:friend@example.com?subject=Check out Coggle!&amp;body=This is my referral link for Coggle: <%-encodeURIComponent(link+'?utm_medium=email&utm_campaign=recommend')%>'>email</a>.        </p>        <input class='link' value='<%-link%>' readonly/>    </div></div>"),claimTemplate:i.template("<div class='settings-section'>    <h3>Recommend Coggle</h3>    <div>        <p data-l10n-id='claim-free-month'>Claim your free month of Coggle Awesome!</p>        <div data-l10n-id='claim-redeem' class='button redeem'>Redeem Now</div>    </div></div>"),alreadyAwesomeTemplate:i.template("<div class='settings-section'>    <h3>Recommend Coggle</h3>    <p data-l10n-id='recommend-already-awesome'>You're already Awesome - help the rest of the world discover Coggle!</p>    <input class='link' value='<%-link%>' readonly/></div>"),events:{"mouseup input":"select","click .redeem":"redeem"},initialize:function(e){i.bindAll(this,"render","select"),this.options=e,this.progressView=new r({model:this.model}),this.progressView.$el.addClass("progress-dark")},select:function(){this.$el.find("input").select()},render:function(){var t=e("env").api.url+"/recommend/"+this.model.id;return this.model.referralTrialEligiblilityState(function(e,n,i,o){if(e)return this.$el.html("Sorry, something went wrong loading your invites. Please try again later!");this.model.isAwesome()?this.$el.html(this.alreadyAwesomeTemplate({link:t})):n?this.$el.html(this.claimTemplate({link:t})):(this.$el.html(this.template({link:t})),this.$el.find(".progress-view").first().prepend(this.progressView.render().$el))}.bind(this)),this},redeem:function(){this.model.referralTrialEligiblilityState(function(e,t){if(e)return this.$el.html("Sorry, something went wrong starting your trial. Please contact Coggle support!");t&&this.model.getPlans().create({plan:"awesome",trialling_until:new Date(Date.now()+2592e6)},{wait:!0,success:function(){this.$el.html("Hold on, we're making things Awesome..."),this.model.getActions().unique("coupon:recommend-3"),setTimeout(function(){window.location="/"},2e3)}.bind(this),error:function(){this.$el.html("Sorry, something went wrong starting your trial. Please contact Coggle support!")}.bind(this)})}.bind(this))}})}),define("views/PersonalAccountView",["require","exports","module","underscore","backbone"],function(e,t,n){var i=e("underscore"),o=e("backbone");n.exports=o.View.extend({tagName:"div",className:"personal-account",template:i.template("<div class='settings-section'><error></error><h3 data-l10n-id='close-account-title'>Close Your Coggle Account</h3><p data-l10n-id='close-account'>Permanently close your free Coggle account.</p><p data-l10n-id='close-account-clarification'>You must cancel any paid subscriptions first, which you can do from your <a href='/me/billing'>billing settings</a> for personal Awesome plans, or your Organisation's settings dashboard for Organisation plans.</p><p data-l10n-id='close-account-description'>This process is <b>irreversible</b> and will take effect immediately. You will lose access to all your diagrams, so make sure you have exported any you want to keep.</p><button data-l10n-id='close-account-button' class='danger button delete-account'>Close my Account</button><div ' class='confirmation' style='display:none'><input data-l10n-id='close-account-enteremail' placeholder='Type your email address' class='email-confirm'/><button data-l10n-id='close-account-confirm' class='danger button confirm-delete-account'>CONFIRM</button></div></div>"),events:{"click .delete-account":"confirmDelete","click .confirm-delete-account":"deleteNow"},initialize:function(e){i.bindAll(this,"render","confirmDelete","deleteNow"),this.options=e},confirmDelete:function(){this.$el.find(".delete-account").hide(),this.$el.find(".confirmation").show(),this.$el.find(".confirmation .email-confirm").focus()},deleteNow:function(){this.model.get("emails")[0]==this.$el.find(".confirmation .email-confirm").val()?(this.$el.find("error").empty(),getCoggleUser().getActions().perform("delete-account"),this.$el.find(".button, input").attr("disabled",!0).addClass("disabled"),this.model.destroy({data:{
confirm_email:this.$el.find(".confirmation .email-confirm").val()},processData:!0,wait:!0,success:function(){window.location="https://coggleit.typeform.com/to/eoPCdC"}.bind(this),error:function(){this.$el.find(".button, input").attr("disabled",!1).removeClass("disabled"),this.$el.find("error").text("Your account could not be removed. Make sure any paid subscriptions are cancelled first!")}.bind(this)})):this.$el.find("error").text("Email does not match.")},render:function(){var e=this.model.toJSON();return $(this.el).html(this.template(e)),this}})}),define("views/FilterableListView",["require","exports","module","underscore","backbone"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=i.template("<div class='search-box'>    <input class='search' placeholder='Filter'/></div><ul class='cogglelist list-items'></ul>");n.exports=o.View.extend({tagName:"div",className:"filterable-list-view",events:{"keyup input.search":"updateFilter"},initialize:function(e){i.bindAll(this,"addOne","addAll","render","updateFilter"),this.options=e,this.collections=e.collections,this.collections.map(function(e){this.listenTo(e,"add",this.addAll)}.bind(this))},updateFilter:function(){var e=this.$el.find("input.search").val();e.length?this.filterText=e:this.filterText=!1,this.$el.find(".list-items").empty(),this.addAll()},render:function(){return this.$el.html(r()),this.addAll(),this},addOne:function(e){var t=this.options.item_class,n=i.clone(this.options.item_options);n.model||(n.model=e);var o=new t(n);this.addChildView(o),this.$el.find(".list-items").append(o.render().$el)},addAll:function(){this.$el.find(".list-items").empty(),this.collections.map(function(e){this.filterText&&e.search&&(e=e.sort().search(this.filterText)),e.map(this.addOne)}.bind(this))}})}),define("views/OrganisationMemberView",["require","exports","module","underscore","backbone","views/MemberIconView","views/AccessSliderView"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=e("views/MemberIconView"),s=e("views/AccessSliderView"),l=i.template("<b class='name hidden-xs' title='<%- email %>'><%- name || email %></b><% if (name && email) { %><span class='email hidden-sm hidden-xs'> (<%- email %>)</span><% } %><span class='tags'></span><div class='icons'>    <% if ((!is_self) && (!is_invite)) { %>        <a class='button orange compact view-diagrams' href='/<%- slug %>?member=<%- user %>'>View As</a>    <% } %>    <% if (!is_self) { %>        <div class='button gray compact change-permissions'>Edit</div>        <div class='button danger compact remove'>Remove</div>    <% } %></div>"),a=i.template("<span class='tag <%- colour %>'><%- tag %></span>");n.exports=o.View.extend({tagName:"li",className:"org-member",events:{"click .change-permissions":"openPermissions","click .user-icon":"openPermissions","click .tags .tag":"openPermissions","click .remove":"removeMember"},initialize:function(e){i.bindAll(this,"render"),this.options=e,this.listenTo(this.model,"remove",this.remove),this.listenTo(this.model,"change:permissions",this.renderTags)},renderTags:function(){var e=-1!==this.model.get("permissions").indexOf("admin"),t=[e?"administrator":"member"];this.model.get("org_only")&&t.push("sso"),this.model.get("name")||t.push("invite pending"),this.model.isMe()&&(t=["you"]),this.$el.find(".tags").html(t.map(function(e){var t="";return"you"===e&&(t="green"),"administrator"===e&&(t="red"),a({tag:e,colour:t})}).join(""))},render:function(){var e=this.model.toJSON();e.is_self=this.model.isMe(),e.is_invite=!this.model.get("name"),e.slug=this.options.organisation.get("slug"),e.email||(e.email="<no email address>"),this.$el.html(l(e)),this.renderTags();var t=new r({model:this.model});return this.$el.prepend(t.render().$el),this},openPermissions:function(){if(!this.model.isMe()){if(!this.accessSlider){var e=[{label:'Member<br/><span data-l10n-name="tip" class="tip">Allow creating documents</span>',data:"write"},{label:'Administer<br/><span data-l10n-name="tip" class="tip">Manage people, billing and sharing</span>',data:"admin"}];this.accessSlider=new s({model:this.model,roles:e,removable:!1}),this.addChildView(this.accessSlider)}this.$el.find(".member").callout(this.accessSlider.render().$el,{my:"left top",at:"center bottom"}).open(),this.accessSlider.delegateEvents()}},removeMember:function(){this.model.destroy({wait:!0,error:function(e,t){console.error(t)}})}})}),define("views/OrganisationGuestMemberView",["require","exports","module","underscore","backbone","views/MemberIconView"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=e("views/MemberIconView"),s=i.template("<b class='name hidden-xs' title='<%- email %>'><%- name || email %></b><% if (name && email) { %><span class='email hidden-sm hidden-xs'> (<%- email %>)</span><% } %><span class='tags'><span class='tag'>guest</span></span><div class='icons'>    <a class='button orange compact view-diagrams'href='/<%- slug %>/folder/shared?member=<%- _id %>'>View As</a>    <a class='button green compact make-full-member'>Upgrade</a>    <div class='button danger compact remove'>Remove All Access</div></div><error></error>");n.exports=o.View.extend({tagName:"li",className:"org-member org-guest-member",events:{"click .remove":"removeMember","click .make-full-member":"makeFullMember"},initialize:function(e){i.bindAll(this,"render","removeMember","makeFullMember"),this.options=e,this.listenTo(this.model,"remove",this.remove)},render:function(){var e=this.model.toJSON();e.slug=this.options.organisation.get("slug"),e.email=e.email||"unknown",e.name=e.name||"Unknown Guest",this.$el.html(s(e));var t=new r({model:this.model});return this.$el.prepend(t.render().$el),this},error:function(e){this.$el.find("error").first().text(e)},removeMember:function(){window.confirm("Are you sure you want to remove all access to your organsiation for this user? This cannot be undone.")&&this.model.destroy({wait:!0,success:function(){console.log("Removed all access for user")},error:function(){console.log(arguments),this.error("Failed to remove user!")}.bind(this)})},makeFullMember:function(){var e=this.options.organisation.getAccess(),t=this.options.organisation.getGuestMembers();e.create({user:this.model.get("_id"),permissions:["read","write"]},{wait:!0,success:function(){this.error(null),t.fetch()}.bind(this),error:function(){this.error("Failed to upgrade user to full organisation member.")}.bind(this)})}})}),define("views/OrganisationMembersView",["require","exports","module","underscore","backbone","plugins/jquery.callout","views/FilterableListView","views/AccessListView","views/ShareViews","views/OrganisationMemberView","views/OrganisationGuestMemberView"],function(e,t,n){var i=e("underscore"),o=e("backbone");e("plugins/jquery.callout");var r=e("views/FilterableListView"),s=(e("views/AccessListView"),e("views/ShareViews").ShareView),l=i.template("<error></error><div class='settings-section'>    <h3 style='float:left'>Organisation Members</h3>    <div class='org-members members'></div>    <div class='field'>      <div class='addmembers'></div>    </div>    <p><b>Tip:</b> You can enter more than one email address at once!</p></div><div class='settings-section'>    <h3>Guest Members</h3>    <p>Guest members are people outside of your organisation that have access to one or more resources within your organisation. This means they have been granted permission to view or edit a diagram or folder owned by your Coggle Organisation.</p>    <p> Disabling guest members will also disable all external access (including public diagrams and private links) to your Organisation's diagrams.</p>    <span>Allow guest members and external sharing:</span>    <p class='checkbox-slider-frame'>      <span class='allow_sharing slider-button <%-allow_sharing?'on':''%>'><%-allow_sharing?'YES':'NO'%></span>    </p>    <p><b>Guest members are not charged for, they do not form part of your bill. They cannot create diagrams or use all of the paid features.</b></p>    <div class='guest-members members'></div></div>");n.exports=o.View.extend({tagName:"div",className:"organisation-members",events:{"changed .slider-button.allow_sharing":"toggleSharing"},initialize:function(t){i.bindAll(this,"render","error","toggleSharing","updateGuests"),this.options=t,this.memberList=new r({item_class:e("views/OrganisationMemberView"),item_options:{organisation:this.model},collections:[this.model.getAccess(),this.model.getInvites()]}),this.addChildView(this.memberList),this.model.getAccess(function(e){e&&this.error("Loading Organisation members failed.")}.bind(this)),this.model.getInvites(function(e){e&&this.error("Loading Organisation invites failed.")}.bind(this)),this.shareView=new s({model:this.model}),this.addChildView(this.shareView),this.listenTo(this.shareView,"error",this.error),this.guestMemberList=new r({item_class:e("views/OrganisationGuestMemberView"),item_options:{organisation:this.model},collections:[this.model.getGuestMembers()]}),this.model.getAccess().on("add remove",this.updateGuests)},updateGuests:i.debounce(function(){this.model.getGuestMembers(function(e){e&&this.error("Loading Organisation guest members failed.")}.bind(this))},200),error:function(e){this.$el.find("error").first().text(e)},render:function(){return $(this.el).html(l(this.model.toJSON())),this.$el.find(".slider-button").booleanSlider(),this.$el.find(".org-members").append(this.memberList.render().$el),this.$el.find(".addmembers").append(this.shareView.render().$el),this.$el.find(".guest-members").append(this.guestMemberList.render().$el),this},toggleSharing:function(e,t){this.model.set("allow_sharing",t.state),this.model.save(void 0,{success:function(){this.error(null)}.bind(this),error:function(){this.error("Failed to update sharing settings.")}.bind(this)})}})}),define("views/OrganisationProfileView",["require","exports","module","underscore","backbone","utils/getDroppedFiles","utils/imageFromFile","utils/resizeImage","env"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=e("utils/getDroppedFiles").getDroppedFiles,s=e("utils/imageFromFile"),l=e("utils/resizeImage").resizeImage;n.exports=o.View.extend({tagName:"div",className:"organisation-profile",template:i.template("<error></error><div class='settings-section'>    <h3>Organisation Name</h3>    <input class='name' required placeholder='Organisation Name' value='<%-name%>' />    <span>A recognisable name for your organisation.</span></div><div class='settings-section'>    <h3>Icon <img style='float:right; width: 20px; margin-top: -3px' src='/img/favicon64.png'/></h3>    <div class='upload'>        <img class='org-icon' src='<%-picture%>' style='background-color: <%- colour %>'/>        <p>Drag an image here to upload</p>        <a href='#' class='tip revert'>or revert to default icon</a>        <p>Must be a square image, recommended size is 128px by 128px.</p>        <p class='tip'>For best results use a colourful, recognisable image.</p>    </div></div>"),events:{"blur .name":"saveName","keyup .name":"saveNameOnEnter","click .revert":"clearIcon",drop:"onImageDropped",dragover:function(e){e.preventDefault()}},initialize:function(e){i.bindAll(this,"render","error","saveName","saveNameOnEnter"),this.options=e,this.listenTo(this.model,"change",this.render)},clearIcon:function(){this.model.set("picture",null),this.model.save()},onImageDropped:function(e){var t=e.dataTransfer=e.originalEvent.dataTransfer;t&&t.files&&t.files.length&&r(t).always(function(e){var t=e[0];t&&t.type.startsWith("image/")&&s(t,function(e,n){if(e)return this.error("Could not read image: was that an image file?");l(n,{maxWidth:256,maxHeight:256},function(e){var n=new FormData;n.append("files[]",e,t.name),$.ajax({type:"POST",url:this.model.url()+"/icon",data:n,processData:!1,contentType:!1}).fail(function(){this.error("Image upload failed.")}.bind(this)).done(function(e){this.model.save({picture:JSON.parse(e).path},{success:function(){this.error(null)}.bind(this),error:function(){this.error("Image saving failed.")}.bind(this)})}.bind(this))}.bind(this))}.bind(this))}.bind(this)),e.preventDefault()},saveName:function(e){this.$el.find(".name").val()!=this.model.get("name")&&(this.model.set("name",this.$el.find(".name").val()),this.model.save(void 0,{success:function(){this.error(null)}.bind(this),error:function(){this.error("Failed to save name update.")}.bind(this)}))},saveNameOnEnter:function(e){13==e.keyCode&&this.saveName(e)},render:function(){var t=this.model.toJSON();return t.picture||(t.picture=e("env").cdn.url+"/img/anon.png"),$(this.el).html(this.template(t)),this},error:function(e){this.$el.find("error").first().text(e)}})}),define("views/OrganisationDiagramsView",["require","exports","module","underscore","backbone","views/DiagramViews"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=e("views/DiagramViews").DiagramList,s=i.template("<error></error><div class='settings-section'>    <h3>Bulk Export</h3>    <a class='button green' data-bypass href='/api/1/organisations/<%-_id%>/export'>EXPORT as JSON</a></div><div class='settings-section'>    <h3>Diagrams</h3>    <p><a class='viewall'>View all diagrams</a>.</p>    <div class='members'></div></div><div class='userview'></div>");n.exports=o.View.extend({tagName:"div",className:"organisation-sharing",events:{"click .viewall":"showAllDiagrams"},initialize:function(e){i.bindAll(this,"render","error","showAllDiagrams"),this.options=e,this.listenTo(this.model,"change",this.render)},render:function(){var e=this.model.toJSON();return $(this.el).html(s(e)),this},error:function(e){this.$el.find("error").first().text(e)},showAllDiagrams:function(){var e=new r({emptyContent:!1,collection:this.model.getDiagrams(function(e){e&&this.error("Loading Organisation diagrams failed.")}.bind(this),{data:{includeDeleted:1}})});this.addChildView(e),this.$el.find(".userview").html(e.render().$el)}})}),define("views/OrganisationBillingView",["require","exports","module","underscore","backbone","views/CustomerView","views/InvoiceViews"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=e("views/CustomerView"),s=e("views/InvoiceViews").InvoiceList,l=i.template("<p class='overdue'>A payment for your Organisation is past due. You must <a href='<%- hosted_invoice_url %>'>view and complete</a> the outstanding payment, or update your billing details to continue using your Organisation.</p>");n.exports=o.View.extend({tagName:"div",className:"organisation-billing",template:i.template("<error></error><div class='settings-section billing-estimate'>    <p><%=next_bill ? 'Your next bill will be on <b>'+next_bill+'</b>.' : 'No more bills are scheduled!' %> You will be billed for <span class='billing-count'>calculating...</span> Organisation members <span class='invites'> (There are also <span class='pending'></span> pending invites which have not been accepted yet)</span></p></div><div class='payment'></div><div class='invoices'></div><div class='settings-section'>    <h3>Dangerzone</h3>    <p>Close this organisation and stop billing - <b>this will make Coggles your organisation owns inaccessible</b>!</p>    <p>This process is <b>irreversible</b> and will take effect immediately so use with caution.</p>    <button class='danger button close'>DELETE</button>    <div class='confirmation' style='display:none'>        <input placeholder='Type the organisation name' class='name'/>        <button class='danger button confirm'>CONFIRM</button>    </div></div>"),events:{"click .close":"confirmClose","click .complete-signup":"completeSignup","click .confirm":"close"},initialize:function(e){i.bindAll(this,"render","renderBillingEstimate"),this.options=e,this.customerView=new r({checkout:this.model.createCheckoutSession(),model:this.model.getCustomer(function(e){e&&this.$el.find("error").first().text("Loading customer failed")}.bind(this))}),this.addChildView(this.customerView),this.invoiceList=new s({collection:this.model.getInvoices(function(e){e&&console.warn("failed to fetch invoices!",e)}.bind(this))}),this.addChildView(this.invoiceList),this.model.getPlans(function(e,t){if(e)return this.error("Something went wrong loading your plan! Please try again.");var n=t.getActivePlan();n&&(n.get("overdue")||n.get("incomplete"))&&n.overduePaymentLink(function(e,t){if(e||!t||!t.hosted_invoice_url)return this.error("Failed to load payment link! Please try again.");this.hosted_invoice_url=t&&t.hosted_invoice_url||"",this.render()}.bind(this))}.bind(this)),this.listenTo(this.model.getInvites(),"add remove",this.renderBillingEstimate),this.listenTo(this.model.getAccess(),"add remove",this.renderBillingEstimate),this.listenTo(this.model.getPlans(),"add remove",this.renderBillingEstimate)},render:function(){var e=this.model.toJSON(),t=new Date(e.next_bill);return e.next_bill&&(e.next_bill=t.getDate()+"/"+(t.getMonth()+1)+"/"+t.getFullYear()),$(this.el).html(this.template(e)),this.model.setupIncomplete()?(this.$el.find(".payment").append("<div class='settings-section'><error>Your Organisation is not active because billing signup has not been completed. Please provide billing information to activate your Organisation.</error><div class='complete-signup button'>Setup Billing Details</div></div>"),this.$el.find(".billing-estimate").remove()):(this.$el.find(".invoices").html(this.invoiceList.render().$el),this.$el.find(".payment").append(this.customerView.render().$el),this.renderBillingEstimate(),this.model.hasActivePlan()||(this.error("Your Coggle Organisation payment is overdue. Please update your billing details!"),this.hosted_invoice_url&&this.$el.find(".billing-estimate").append(l({hosted_invoice_url:this.hosted_invoice_url})))),this},completeSignup:function(){this.model.createCheckoutSession({plan:"organisation:standard"}).redirect(function(e){if(e)return this.error(e.message||"Creating organisation checkout failed.")}.bind(this))},renderBillingEstimate:function(){this.$el.find(".invites .pending").text(this.model.getInvites().length),this.$el.find(".billing-count").text(this.model.getAccess().length),0===this.model.getInvites().length?this.$el.find(".invites").hide():this.$el.find(".invites").show()},confirmClose:function(){this.$el.find(".close").hide(),this.$el.find(".confirmation").show(),this.$el.find(".confirmation .name").focus()},error:function(e){this.$el.find("error").first().text(e)},close:function(){this.model.get("name").length>0&&this.model.get("name").trim()==this.$el.find(".confirmation .name").val().trim()?(getCoggleUser().getActions().perform("cancellation:organisation"),this.model.destroy({wait:!0,success:function(){window.location="/"},error:function(){this.error("Failed to close Organisation, please reload and try again.")}.bind(this)})):this.error("Name does not match.")}})}),define("views/DomainViews",["require","exports","module","underscore","backbone","env"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r="<div class='icons'><img src='"+e("env").cdn.url+"/img/bin.png' class='icon delete'></div><div class='name'><b><%-id%></b></div>",s=o.View.extend({tagName:"li",className:"domain",template:i.template(r),events:{"click .delete":"removeDomain"},initialize:function(){i.bindAll(this,"render","removeDomain"),this.listenTo(this.model,"change",this.render)},render:function(){return $(this.el).html(this.template(this.model.toJSON())),this},removeDomain:function(){this.model.destroy({success:function(){$(this.el).remove()}.bind(this)})}}),l=o.View.extend({tagName:"div",className:"domain-list",events:{"keyup input":"submitOnEnter","click .add":"add","notify-warning":"error"},initialize:function(e){i.bindAll(this,"addOne","addAll","render","add","error","submitOnEnter"),this.$el.html(i.template("<ul class='cogglelist'></ul><error></error><div class='field danger'>    <div class='button hasInput green add'>ADD</div>    <div class='inputs'>        <input type='text' class='domain hasButton' placeholder='Domain, e.g. coggle.it'>    </div></div>")()),this.options=e,this.listenTo(this.collection,"add",this.addOne),this.listenTo(this.collection,"reset",this.addAll),this.listenTo(this.collection,"all",this.render),this.addAll()},add:function(){this.$el.find("error").empty();var e=this.$el.find("input").val();e&&0!==e.length&&this.collection.create({id:e},{wait:!0,error:function(e,t){this.error(t.responseJSON.description)}.bind(this),success:function(){this.$el.find("input").val("")}.bind(this)})},submitOnEnter:function(e){13==e.keyCode&&this.add()},error:function(e){return this.$el.find("error").text(e),!1},render:function(){return this},addOne:function(e){var t=new s({model:e});$(this.el).find("ul").append(t.render().$el)},addAll:function(){this.collection.each(this.addOne)}});n.exports.DomainView=s,n.exports.DomainList=l}),define("views/OrganisationAuthProvidersView",["require","exports","module","underscore","backbone","views/DomainViews","env"],function(e,t,n){var i=e("underscore"),o=e("backbone"),r=e("views/DomainViews").DomainList,s=i.template("<error></error><div class='settings-section'>    <h3>SAML Integration</h3>    <% if (edit_saml) { %>        <p>SAML allows you to use your own SSO provider to authenticate your Organisation members. When your users log in they will automatically be added to your organisation.</p>        <h4>Entrypoint (ID Provider SSO URL)</h4>        <input class='entrypoint' placeholder='Entrypoint, e.g. https://example.com/sso/saml' value='<%- sso && sso.saml && sso.saml.entryPoint %>'>        <h4>Certificate</h4>        <textarea class='certificate' placeholder='Paste the X.509 certificate from your ID provider here'><%- sso && sso.saml && sso.saml.cert %></textarea>        <div style='text-align:right; margin-top: 10px'>            <error class='saml-error'></error>            <a class='button danger remove-saml-config'>Remove Config</a>            <a class='button green save-saml-config'>Save</a>        </div>    <% } else { %>        <p>You have configured SAML login for your Organisation. This is the login page to direct your users to:</p>        <pre><b><%- login_url %></b></pre>        <div style='text-align:right'>            <div class='button green edit-saml-config'>Edit SAML Config</div>        </div>    <% } %></div><div class='settings-section'>    <h3>Domain Access</h3>    <p>Automatically add all members of your domain based on their email address domain. First, you will need to validate the ownership of your domain so we can be sure that you are the real owner. To do this add the code below to the TXT DNS record for your domain:</p>    <pre><b>coggle-verification=<%-verification_code%></b></pre>    <div class='domainaccess'></div></div>");n.exports=o.View.extend({tagName:"div",className:"organisation-auth-providers-view",events:{"notify-warning":"error","click .save-saml-config":"saveSamlConfig","click .remove-saml-config":"removeSamlConfig","click .edit-saml-config":"editSamlConfig"},initialize:function(e){i.bindAll(this,"render","saveSamlConfig","editSamlConfig","removeSamlConfig","persistSamlConfig"),this.options=e;var t=this.model.getDomains(function(e){e&&this.error("Failed to load domains.")});this.domainList=new r({collection:t}),this.addChildView(this.domainList),this.model.on("change",this.render),this.edit_saml=!this.model.hasSamlConfig()},error:function(e){this.$el.find("error").first().text(e)},render:function(){var t=this.model.toJSON();return t.login_url=e("env").api.url+"/"+this.model.get("slug")+"/login",t.sso||(t.sso={}),t.edit_saml=this.edit_saml,this.$el.html(s(t)),this.$el.find(".domainaccess").append(this.domainList.render().$el),this.domainList.delegateEvents(),this},samlError:function(e){this.$el.find("error.saml-error").first().text(e)},editSamlConfig:function(){this.edit_saml=!0,this.render()},removeSamlConfig:function(){this.model.set({sso:{saml:{entryPoint:null,cert:null}}}),this.persistSamlConfig()},saveSamlConfig:function(){var e=this.$el.find("input.entrypoint").val(),t=this.$el.find("textarea.certificate").val();return e?t?(this.model.set({sso:{saml:{entryPoint:e,cert:t}}}),void this.persistSamlConfig()):this.samlError("Certificate is required"):this.samlError("Entrypoint is required")},persistSamlConfig:function(){this.model.save({},{wait:!0,success:function(){this.samlError(null),this.edit_saml=!this.model.hasSamlConfig(),this.render()}.bind(this),error:function(e,t){console.log(arguments),this.samlError(t&&t.responseJSON&&t.responseJSON.description||"Failed to update SAML config")}.bind(this)})}})}),define("controllers/Router",["require","exports","module","utils/queryString","underscore","l10n","models/Diagram","models/Diagram","models/User","models/Folder","views/ErrorView","views/HomeView","views/DiagramViews","views/SearchResultsView","views/WorkspaceView","views/Gallery","views/Bookmark","views/LoggedoutGallery","views/CloneView","views/SettingsView","views/OrganisationPicker","views/PlanSelectionView","views/OrganisationSignupView","views/OrganisationLoginView","views/VerifyEmailView","views/VerifyEmailView","views/VerifyEmailView","models/Invoice","views/InvoiceViews","views/CheatView","views/GlobalHelpView","views/DeveloperView","views/MarketSurveyView","models/Message","env","views/PersonalCommunicationView","views/Profile","views/PersonalLanguageView","views/ManageAttachedFiles","views/PersonalBillingView","views/RecommendCoggleView","views/PersonalAccountView","views/OrganisationMembersView","views/OrganisationProfileView","views/OrganisationDiagramsView","views/OrganisationBillingView","views/OrganisationAuthProvidersView","views/ManageAttachedFiles"],function(e,t,n){var i=e("utils/queryString"),o=e("underscore"),r=e("l10n"),s=e("models/Diagram").DiagramModel,l=e("models/Diagram").DiagramCollection,a=e("models/User"),u=e("models/Folder").FolderCollection,d=e("views/ErrorView"),c=e("views/HomeView"),h=e("views/DiagramViews").DiagramList,p=e("views/SearchResultsView"),f=e("views/WorkspaceView"),g=e("views/Gallery"),m=e("views/Bookmark").Bookmarks,v=e("views/LoggedoutGallery"),y=e("views/CloneView"),b=e("views/SettingsView"),w=e("views/OrganisationPicker").OrganisationPicker,_=e("views/PlanSelectionView"),x=e("views/OrganisationSignupView"),E=e("views/OrganisationLoginView"),A=e("views/VerifyEmailView").VerifyEmailView,S=e("views/VerifyEmailView").MustVerifyEmailView,C=e("views/VerifyEmailView").VerifyCompleteView,F=e("models/Invoice").InvoiceModel,k=e("views/InvoiceViews").InvoiceView,T=e("views/CheatView"),O=e("views/GlobalHelpView"),N=e("views/DeveloperView"),I=e("views/MarketSurveyView"),L=e("models/Message").Messages,R=Backbone.Router.extend({routes:{"me(/:view)":"my_settings","me/billing/survey":"my_billing_survey",verify:"verify_email","verify/done":"verify_complete","organisations/new":"createOrganisation",":orgslug/dashboard(/:view)":"org_settings",developer:"developer",plans:"plans","plans/(:plan)":"signup",welcome:"welcome","diagram/:diagram(/t/:title)(/:token)(/)(?:queryString*)":"diagram","clone/:diagram(/:token)":"clone",gallery:"gallery","folder/:folder(/*)":"folder",":orgslug/folder/:folder(/*)":"org_folder",bookmarks:"bookmarks",":orgslug/bookmarks":"org_bookmarks","invoices/:invoice":"invoice",":orgslug/invoices/:invoice":"invoice","search/(*stuff)":"search",":orgslug/search/:query*":"search",":orgslug/login":"org_login","(:orgslug)(/)":"home"},initialize:function(){this.on("route:before",function(){O.instance().setContextualHelp(null)}),$("body").append(O.instance().render().$el),window._router=this},setKeyView:function(){this._keyView=window.location.href.substr(window.location.origin.length)},getKeyView:function(){return this._keyView},execute:function(){this.trigger("route:before");var e=Backbone.Router.prototype.execute.apply(this,arguments);return this.trigger("route:after"),e},switchToOrg:function(e){var t=a.me().getOwnOrg();return e?(t=a.me().getOrganisations().forSlug(e),$("body").addClass("viewing-organisation")):$("body").removeClass("viewing-organisation"),t&&a.me().setActiveOrg(t),t},home:function(e){!e&&this.showPlans?(this.setKeyView(),this.plans(),this.showPlans=!1):this.org_folder(e,"root")},org_bookmarks:function(e){if(!this.switchToOrg(e))return this.organsiationNotFound();this.bookmarks()},org_folder:function(e,t){var n=this.switchToOrg(e);if(!n)return this.organsiationNotFound();L.get("org-incomplete-admin").deactivate(),L.get("org-overdue-admin").deactivate(),L.get("org-incomplete").deactivate(),L.get("org-overdue").deactivate(),n.id&&!n.hasActivePlan()&&(n.isAdmin()?n.setupIncomplete()?L.get("org-incomplete-admin").activate():L.get("org-overdue-admin").activate():n.setupIncomplete()?L.get("org-incomplete").activate():L.get("org-overdue").activate()),this.folder(t)},bookmarks:function(){if(a.me().isGuest())return void("/"!==window.location.pathname&&(window.location="/"));var e=a.me().getActiveOrg();if(!e.id&&!a.me().hasOwnOrg())return e=a.me().getOrganisations().at(0),e?Backbone.history.navigate("/"+e.get("slug"),!0):this.error("We can't find an Organisation associated with your account.");var t=i().member,n=t?new u:e.getFolders(),o=new c({user:a.me(),organisation:e,member:t,folders:n,folder:"bookmarks"});n.fetchOrQueue(function(t,n){if(t||!n)return this.error("Failed to load folders. Are you online?");a.me().getActions().perform("bookmarks:viewed"),document.title="Bookmarked for Review - Coggle",o.setContentView(new m({collection:e.getBookmarks(function(e){if(e)return this.error("Failed to load bookmarks. Are you online?")}.bind(this))}))}.bind(this)),$("#page").html(o.render().$el),t||this.setKeyView(),this.once("route:before",function(){o.$el.addClass("transition-out"),setTimeout(function(){o.remove()},300)})},folder:function(e){if(a.me().fetch(),a.me().isGuest())return void("/"!==window.location.pathname&&(window.location="/"));var t=a.me().getActiveOrg();if(!t.id&&!a.me().hasOwnOrg())return t=a.me().getOrganisations().at(0),t?Backbone.history.navigate("/"+t.get("slug"),!0):this.error("We can't find an Organisation associated with your account.");if("root"===e&&!t.id&&"0"!==i().org&&window._first_route&&a.me().getOrganisations().length>0)t=a.me().getOrganisations().at(0),Backbone.history.navigate("/"+t.get("slug"),!0);else if(!window._first_route&&!t.id&&!i().org){var n=window.location.search?window.location.pathname+window.location.search+"&org=0":window.location.pathname+"?org=0";n+=window.location.hash,Backbone.history.navigate(n,{trigger:!1})}var o=i().member,r=i().includeDeleted,s={data:{includeDeleted:r,member:o}},d=o?new u:t.getFolders(),p=new c({user:a.me(),organisation:t,member:o,folders:d,folder:e});d.fetchOrQueue(function(n,i){if(n||!i)return n&&-1!==n.toString().indexOf("subscription has expired")?this.error("Your organisation subscription has expired. Please contact your organisation administrator to update the payment details."):this.error("Failed to load folders. Are you online?");if("gallery"==e)a.me().getActions().perform("gallery:viewed"),document.title="Gallery - Coggle",p.setContentView(new g({collection:l.getPublicGallery(function(){}),galleryInFolder:!0}));else{var o=i.get(e);if(!o)return Backbone.history.navigate("/"+(t.get("slug")?t.get("slug"):""),!0);document.title=o.get("name")+" - Coggle",p.setContentView(new h({organisation:t,collection:o.getDiagrams(function(e){if(e)return this.error("Failed to load diagrams. Are you online?")}.bind(this),s),folder:o,onLoaded:function(){var e=window.location.hash&&window.location.hash.slice(1);if(e&&/[a-z0-9_-]/i.exec(e)){var t=p.$el.find("[data-id='"+e+"']");t.length&&p.$el.scrollTop(t.offset().top-60)}}.bind(this)}))}}.bind(this),s),this.market_survey(),$("#page").html(p.render().$el),o||this.setKeyView(),this.once("route:before",function(){p.$el.addClass("transition-out"),setTimeout(function(){p.remove()},300)})},invoice:function(t,n){if(O.instance().$el.hide(),a.me().isGuest())return void(window.location="/");var i=this.switchToOrg(t);i||(n=t,t=void 0);var o=new F({id:n});i&&i.id&&(o.url=e("env").api.url+"/api/1/organisations/"+i.get("slug")+"/invoices/"+n),o.fetchOrQueue(function(e){
if(e)return void $("body").html("<error>Error loading invoice</error>");var t=new k({model:o});$("body").html(t.render().$el)})},diagram:function(e,t,n){!n&&i().access_token&&(n=i().access_token),"t"===n&&(n=void 0),O.instance().setContextualHelp(new T),this.setKeyView();var o=a.me().getActiveOrg().findDiagramById(e);o||(o=new s({short_id:e},{token:n})),o.setToken(n);var r=new f({model:o});$("#page").append(r.render().$el),r.loadingAnimation(),this.once("route:before",function(){r.remove(),o.setToken(null)}),o.getDeltas().length?(r.load(),O.instance().setReadonly(!o.canWrite())):i().print?r.load():o.fetch({success:function(){o.getDeltas().poll(function(){r.load()}.bind(this))}.bind(this),error:function(){return this.error("Sorry - we couldn't load your diagram. Are you online?")}.bind(this)})},clone:function(e,t){var n=a.me().getActiveOrg().findDiagramById(e);n||(n=new s({short_id:e},{token:t}));var i=new y({token:t,diagramId:e,diagram:n});$("#page").html(i.render().$el),i.cloneIfPossible()},gallery:function(){document.title="Mind Map Examples Gallery - Coggle";var e=parseInt(i().skip)||0,t=parseInt(i().limit)||4,n=Math.max(t,10),r=new v({collection:i().review?l.getPublicReviewCollection({data:o.omit(i(),"review")},function(){}):l.getPublicGallery({data:{limit:n,skip:e}},function(){}),limit:t,skip:e+n});$("#page").html(r.render().$el),this.once("route:before",function(){r.remove()})},search:function(e,t){t||(t=e,e=void 0),document.title=t+" - Coggle";var n=this.switchToOrg(e);if(!n)return this.organsiationNotFound();if(!t||0===t.length)return Backbone.history.navigate(e,!0);var i=a.me().getActiveOrg().search(t),o=new c({user:a.me(),organisation:n,folders:n.getFolders(function(){}),search:t});o.setContentView(new p({collection:i,query:t})),$("#page").html(o.render().$el),this.once("route:before",function(){o.remove()})},error:function(e,t){document.title="Error - Coggle",console.warn("error:",e);var n=new d({message:e,link:t}),i=new w({collection:a.me().getOrganisations(),hide_own_org:!a.me().hasOwnOrg()});$("#page").html(n.render().$el),$("#page").prepend(i.render().$el),this.once("route:before",function(){n.remove(),i.remove()})},organsiationNotFound:function(){return this.error("We can't find the organisation you're looking for.","/")},notFound:function(){return this.error("We can't find the thing you're looking for","/")},welcome:function(){Backbone.history.navigate("/",!0),a.me().isOrgOrAwesome()&&!a.me().isTriallingAwesome()||(this.showPlans="true"===a.me().science("show-plans",["true","false"]))},signup:function(e){this.renderPlans(e)},plans:function(){this.renderPlans()},renderPlans:function(e){document.title="Plans - Coggle",a.me().getActions().perform("view:plans");var t=new _({model:a.me(),src:i().src,coupon:i().coupon,plan:e,close:this.getKeyView()});i().coupon||Backbone.history.navigate("/plans",{trigger:!1,replace:!0}),$("#page").html(t.render().$el.addClass("modal")),this.once("route:before",function(){t.remove()})},my_settings:function(t,n,i){if(!this.switchToOrg())return this.organsiationNotFound();i||(i={}),i.model=a.me();var o={billing:{},communication:{title:"Communication",view:new(e("views/PersonalCommunicationView"))(i)},profile:{title:"Profile",view:new(e("views/Profile"))(i)},language:{title:"Language",view:new(e("views/PersonalLanguageView"))(i)},recommend:{},attachments:{},account:{}};a.me().attachmentsSupported()?o.attachments={title:"Attached Files",view:new(e("views/ManageAttachedFiles"))(i)}:delete o.attachments,a.me().hasOwnOrg()?(o.billing={title:"Billing & Invoices",view:new(e("views/PersonalBillingView"))(i)},o.recommend={title:"Recommend",view:new(e("views/RecommendCoggleView"))(i)},o.account={title:"Close Account",view:new(e("views/PersonalAccountView"))(i)}):(delete o.billing,delete o.recommend,delete o.account);var s=new b({settings:o,selected:t||"billing",base_url:"/me",close:this.getKeyView()||"/",heading:r.getSync("settings","Settings"),organisations:a.me().getOrganisations()});$("#page").append(s.render().$el),this.once("route:before",function(){s.remove()})},my_billing_survey:function(){this.my_settings("billing",void 0,{survey:!0}),Backbone.history.navigate("/me/billing",{replace:!0})},verify_email:function(){document.title="Verify Your Email Address - Coggle";var e;if(i().sig)e=new A({model:a.me(),sig:i().sig,email:i().email,user:i().user,ts:i().ts}),e.checkSignature();else{if(a.me().isGuest())return Backbone.history.navigate("/",!0);e=new S({model:a.me()})}$("#page").html(e.render().$el),this.once("route:before",function(){e.remove()})},verify_complete:function(){document.title="Email Address Verified - Coggle";var e=new C({model:a.me()});$("#page").html(e.render().$el),this.once("route:before",function(){e.remove()})},org_login:function(e){var t=this.switchToOrg(e),n=new E({model:t});$("#page").html(n.render().$el),this.once("route:before",function(){n.remove()})},org_settings:function(t,n){var i=this.switchToOrg(t);if(!i)return this.organsiationNotFound();var o={},r={model:i},s=null;i.isAdmin()?(o={membership:{title:"Members",view:new(e("views/OrganisationMembersView"))(r)},profile:{title:"Profile",view:new(e("views/OrganisationProfileView"))(r)},exports:{title:"Exports",view:new(e("views/OrganisationDiagramsView"))(r)},billing:{title:"Billing & Invoices",view:new(e("views/OrganisationBillingView"))(r)},authentication:{title:"Authentication",view:new(e("views/OrganisationAuthProvidersView"))(r)}},a.me().attachmentsSupported()&&(o.attachments={title:"Attached Files",view:new(e("views/ManageAttachedFiles"))(r)})):s=new d({message:"These are not the settings you are looking for!",link:"/me"});var l=new b({hero:s,settings:o,selected:n||"membership",close:this.getKeyView()||"/"+t,base_url:"/"+t+"/dashboard",heading:i.get("name")+" Settings Dashboard",organisations:a.me().getOrganisations()});$("#page").append(l.render().$el),this.once("route:before",function(){l.remove()})},createOrganisation:function(){this.switchToOrg();var e=new x({model:a.me()});$("#page").html(e.render().$el),this.once("route:before",function(){e.remove()})},developer:function(){var e=new N;$("#page").html(e.render().$el),this.once("route:before",function(){e.remove()})},market_survey:function(){$("body").hasClass("touch")||a.me().isGuest()||a.me().isOlderThan("9/11/17")||a.me().getActions(function(e,t){if(!e){var n=$("#page");if(!t.get("survey:market:complete")&&!n.find(".market-survey-view").length){var i=new I({model:a.me()});n.append(i.render().$el)}}}.bind(this))}});n.exports=R}),define("controllers/MessagePollController",["require","exports","module","utils/queryString"],function(e,t,n){var i=e("utils/queryString");n.exports=function(){if(!i().print){var e=function(){Messages.fetch({global:!1,data:{version:Coggle_JS_Version},remove:!1}),setTimeout(e,6e5+5*Math.random()*60*1e3)};setTimeout(function(){e()},15e3+10*Math.random()*1e3),window._fetchMessages=e}}}),define("controllers/AutoUpdate",["require","exports","module","underscore","utils/queryString","models/Message"],function(e,t,n){var i=e("underscore"),o=e("utils/queryString"),r=e("models/Message").Messages;n.exports=function(){if(!o().print){var e=!1;$("body").on("keypress mousemove touchmove pointermove",i.throttle(function(){clearTimeout(e)},1e3));var t=function(){Backbone.Router.disableCaptureLinks(),setTimeout(function(){r.get("update").activate()},72e5),e||(e=setTimeout(function(){window.location.reload(!0)},108e5+60*Math.random()*60*1e3))},n=function(){$.getJSON("/assets/version.json",function(e){e.version!==window.Coggle_JS_Version?(console.log("js is out of date: \n","latest = ( js:",e.version," )\n","loaded = ( js:",window.Coggle_JS_Version," )\n"),t()):console.log("js is up to date")}),setTimeout(n,6e5+5*Math.random()*60*1e3)};setTimeout(function(){n()},3e4+10*Math.random()*1e3),window._checkUpdate=n}}}),function(e){"function"==typeof define&&define.amd?define("jquery-ui/widgets/tooltip",["jquery","../keycode","../position","../unique-id","../version","../widget"],e):e(jQuery)}(function(e){return e.widget("ui.tooltip",{version:"1.12.1",options:{classes:{"ui-tooltip":"ui-corner-all ui-widget-shadow"},content:function(){var t=e(this).attr("title")||"";return e("<a>").text(t).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,track:!1,close:null,open:null},_addDescribedBy:function(t,n){var i=(t.attr("aria-describedby")||"").split(/\s+/);i.push(n),t.data("ui-tooltip-id",n).attr("aria-describedby",e.trim(i.join(" ")))},_removeDescribedBy:function(t){var n=t.data("ui-tooltip-id"),i=(t.attr("aria-describedby")||"").split(/\s+/),o=e.inArray(n,i);-1!==o&&i.splice(o,1),t.removeData("ui-tooltip-id"),i=e.trim(i.join(" ")),i?t.attr("aria-describedby",i):t.removeAttr("aria-describedby")},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.liveRegion=e("<div>").attr({role:"log","aria-live":"assertive","aria-relevant":"additions"}).appendTo(this.document[0].body),this._addClass(this.liveRegion,null,"ui-helper-hidden-accessible"),this.disabledTitles=e([])},_setOption:function(t,n){var i=this;this._super(t,n),"content"===t&&e.each(this.tooltips,function(e,t){i._updateContent(t.element)})},_setOptionDisabled:function(e){this[e?"_disable":"_enable"]()},_disable:function(){var t=this;e.each(this.tooltips,function(n,i){var o=e.Event("blur");o.target=o.currentTarget=i.element[0],t.close(o,!0)}),this.disabledTitles=this.disabledTitles.add(this.element.find(this.options.items).addBack().filter(function(){var t=e(this);if(t.is("[title]"))return t.data("ui-tooltip-title",t.attr("title")).removeAttr("title")}))},_enable:function(){this.disabledTitles.each(function(){var t=e(this);t.data("ui-tooltip-title")&&t.attr("title",t.data("ui-tooltip-title"))}),this.disabledTitles=e([])},open:function(t){var n=this,i=e(t?t.target:this.element).closest(this.options.items);i.length&&!i.data("ui-tooltip-id")&&(i.attr("title")&&i.data("ui-tooltip-title",i.attr("title")),i.data("ui-tooltip-open",!0),t&&"mouseover"===t.type&&i.parents().each(function(){var t,i=e(this);i.data("ui-tooltip-open")&&(t=e.Event("blur"),t.target=t.currentTarget=this,n.close(t,!0)),i.attr("title")&&(i.uniqueId(),n.parents[this.id]={element:this,title:i.attr("title")},i.attr("title",""))}),this._registerCloseHandlers(t,i),this._updateContent(i,t))},_updateContent:function(e,t){var n,i=this.options.content,o=this,r=t?t.type:null;if("string"==typeof i||i.nodeType||i.jquery)return this._open(t,e,i);(n=i.call(e[0],function(n){o._delay(function(){e.data("ui-tooltip-open")&&(t&&(t.type=r),this._open(t,e,n))})}))&&this._open(t,e,n)},_open:function(t,n,i){function o(e){u.of=e,s.is(":hidden")||s.position(u)}var r,s,l,a,u=e.extend({},this.options.position);if(i){if(r=this._find(n))return void r.tooltip.find(".ui-tooltip-content").html(i);n.is("[title]")&&(t&&"mouseover"===t.type?n.attr("title",""):n.removeAttr("title")),r=this._tooltip(n),s=r.tooltip,this._addDescribedBy(n,s.attr("id")),s.find(".ui-tooltip-content").html(i),this.liveRegion.children().hide(),a=e("<div>").html(s.find(".ui-tooltip-content").html()),a.removeAttr("name").find("[name]").removeAttr("name"),a.removeAttr("id").find("[id]").removeAttr("id"),a.appendTo(this.liveRegion),this.options.track&&t&&/^mouse/.test(t.type)?(this._on(this.document,{mousemove:o}),o(t)):s.position(e.extend({of:n},this.options.position)),s.hide(),this._show(s,this.options.show),this.options.track&&this.options.show&&this.options.show.delay&&(l=this.delayedShow=setInterval(function(){s.is(":visible")&&(o(u.of),clearInterval(l))},e.fx.interval)),this._trigger("open",t,{tooltip:s})}},_registerCloseHandlers:function(t,n){var i={keyup:function(t){if(t.keyCode===e.ui.keyCode.ESCAPE){var i=e.Event(t);i.currentTarget=n[0],this.close(i,!0)}}};n[0]!==this.element[0]&&(i.remove=function(){this._removeTooltip(this._find(n).tooltip)}),t&&"mouseover"!==t.type||(i.mouseleave="close"),t&&"focusin"!==t.type||(i.focusout="close"),this._on(!0,n,i)},close:function(t){var n,i=this,o=e(t?t.currentTarget:this.element),r=this._find(o);if(!r)return void o.removeData("ui-tooltip-open");n=r.tooltip,r.closing||(clearInterval(this.delayedShow),o.data("ui-tooltip-title")&&!o.attr("title")&&o.attr("title",o.data("ui-tooltip-title")),this._removeDescribedBy(o),r.hiding=!0,n.stop(!0),this._hide(n,this.options.hide,function(){i._removeTooltip(e(this))}),o.removeData("ui-tooltip-open"),this._off(o,"mouseleave focusout keyup"),o[0]!==this.element[0]&&this._off(o,"remove"),this._off(this.document,"mousemove"),t&&"mouseleave"===t.type&&e.each(this.parents,function(t,n){e(n.element).attr("title",n.title),delete i.parents[t]}),r.closing=!0,this._trigger("close",t,{tooltip:n}),r.hiding||(r.closing=!1))},_tooltip:function(t){var n=e("<div>").attr("role","tooltip"),i=e("<div>").appendTo(n),o=n.uniqueId().attr("id");return this._addClass(i,"ui-tooltip-content"),this._addClass(n,"ui-tooltip","ui-widget ui-widget-content"),n.appendTo(this._appendTo(t)),this.tooltips[o]={element:t,tooltip:n}},_find:function(e){var t=e.data("ui-tooltip-id");return t?this.tooltips[t]:null},_removeTooltip:function(e){e.remove(),delete this.tooltips[e.attr("id")]},_appendTo:function(e){var t=e.closest(".ui-front, dialog");return t.length||(t=this.document[0].body),t},_destroy:function(){var t=this;e.each(this.tooltips,function(n,i){var o=e.Event("blur"),r=i.element;o.target=o.currentTarget=r[0],t.close(o,!0),e("#"+n).remove(),r.data("ui-tooltip-title")&&(r.attr("title")||r.attr("title",r.data("ui-tooltip-title")),r.removeData("ui-tooltip-title"))}),this.liveRegion.remove()}}),!1!==e.uiBackCompat&&e.widget("ui.tooltip",e.ui.tooltip,{options:{tooltipClass:null},_tooltip:function(){var e=this._superApply(arguments);return this.options.tooltipClass&&e.tooltip.addClass(this.options.tooltipClass),e}}),e.ui.tooltip}),define("views/Tooltips",["require","exports","module","jquery-ui/widgets/tooltip"],function(e,t,n){e("jquery-ui/widgets/tooltip");var i,o,r,s=!1,l=function(){var e=r.offset().left+r.width()/2;o.toggleClass("top",r.offset().top>o.offset().top),o.find(".arrow").css({left:e-o.offset().left})};n.exports=function(){$(document).tooltip({position:{my:"center top+12",at:"center bottom",collision:"flipfit"},show:{delay:400,duration:0},hide:200,open:function(e,t){if(o=t.tooltip,r=$(e.toElement||e.originalEvent&&e.originalEvent.target),s)return void o.remove();0===o.find(".arrow").length&&o.append('<div class="arrow">'),l(),clearInterval(i),i=setInterval(l,50)},close:function(){o.find(".arrow").remove(),clearInterval(i)}})},window.addEventListener("mousedown",function(){o&&o.remove(),s=!0},{capture:!0,passive:!0}),window.addEventListener("mouseup",function(){s=!1},{capture:!0,passive:!0})}),function(e){"function"==typeof define&&define.amd?define("plugins/jquery.proportionalPosition",["jquery"],e):e(jQuery)}(function(e){e.fn.proportionalPosition=function(){var t=e(this),n=t.offset(),i=n.left+t.width()/2,o=n.top+t.height()/2;return{left:i/(window.innerWidth||document.documentElement.clientWidth),top:o/(window.innerHeight||document.documentElement.clientHeight)}}}),function(e){"function"==typeof define&&define.amd?define("plugins/jquery.contextualHelp",["jquery","underscore","plugins/jquery.proportionalPosition","jquery.outsideEvents"],e):e(jQuery,_)}(function(e,t,n,i){function o(n){function i(e){return n.on_ignore&&n.on_ignore(),n.ignore_action&&(b.unique(n.ignore_action),s(n.ignore_action)),a(n.action),l(),n.on_ignore&&n.on_ignore(),e&&e.stopPropagation(),!1}function o(e){return n.action&&(b.unique(n.action),s(n.action)),n.on_complete&&n.on_complete(),e&&e.stopPropagation(),h(),!1}function l(){y&&y.fadeOut(100,function(){y.remove(),y=null}),n.on_hide&&n.on_hide()}function d(){if(!y){n.on_open&&n.on_open();var s=r(v.of.proportionalPosition());n.callout_opts&&(s=t.extend(s,n.callout_opts));var l=e("<div/>").addClass("helpholder");n.title&&l.append(e("<div/>").html(n.title).addClass("helptitle")),l.append(e("<div/>").html(n.content).addClass("helpcontent")),n.showOk&&l.append(e("<div data-l10n-id='help-ok-got-it'/>").text("OK, got it!").addClass("okgotit button")),n.showIgnore&&l.append(e("<div data-l10n-id='help-hide-for-now'/>").text("Hide for now").addClass("hidefornow button secondary")),l.append(e("<div class='clearfix'>")),y=g.callout(l,t.extend(s,{at:v.at,of:v.of,appendTo:g,openOn:"",closeOn:""})).open(),y.find(".okgotit").on("click",o),y.find(".hidefornow").on("click",i)}}function c(e){return!!e&&("string"==typeof e?!!b.get(e):e.$all?t.all(e.$all,c):e.$any?t.any(e.$any,c):t.all(e,c))}function h(){var e=!0;n.after&&(e=c(n.after)),!e||w||n.action&&b.get(n.action)||b.get(n.dismiss_action)||n.suppress_action&&b.get(n.suppress_action)||u(n.action)?l():d()}function p(){y&&y.remove(),y=null,w=!0,b.off("add remove",_)}function f(){y&&y.reposition()}var g=e(this);if(!g.length)return{reposition:function(){}};if(g.data("contextualHelp."+n.action)){var m=g.data("contextualHelp."+n.action);return m.evaluateRules(),m}if(n=e.extend({content:"hello help",position:{},showOk:!1,showIgnore:!1},n),!n.action)throw new Error("action is required");if(!n.actions)throw new Error("actions collection is required");n.ignore_action||(n.ignore_action=n.action+":ignore"),n.dismiss_action||(n.dismiss_action=n.action+":dismiss");var v=n.position;v.my=v.my||"center",v.at=v.at||"left bottom",v.collision=v.collision||"fit",v.of&&e(v.of).length||(v.of=g);var y,b=n.actions,w=!1,_=t.throttle(h,50,{leading:!1});return b.on("add remove",_),n.openImmediately&&!u(n.action)?d():_(),g.data("contextualHelp."+n.action,{open:d,close:close,evaluateRules:h,reposition:f,remove:p}),g.data("contextualHelp."+n.action)}function r(e){var t={my:"center top",callout:"center top"};return e.left<.15?e.top<.3?{my:"left top",callout:"left top"}:e.top>.7?{my:"left bottom",callout:"left bottom"}:{my:"left center",callout:"left middle"}:e.left>.85?e.top<.3?{my:"right top",callout:"right top"}:e.top>.7?{my:"right bottom",callout:"right bottom"}:{my:"right center",callout:"right middle"}:e.top>.7?{my:"center bottom",callout:"center bottom"}:t}function s(e){if(ga){var t=e.split(":");0===t.indexOf("help")&&t.shift(),t.length>2&&(t[1]=t.slice(1).join(":")),ga("send","event","HelpAction",t[0],t[1])}}var l={},a=function(e){l[e]?l[e]=Date.now()+288e5:l[e]=Date.now()+18e5},u=function(e){return l[e]&&Date.now()<l[e]};e.fn.contextualHelp=function(t){var n=null;return e(this).each(function(){n=o.call(this,t)}),n}}),define("views/ContextualHelpFlow",["require","exports","module","underscore","jquery","backbone","l10n","plugins/jquery.contextualHelp","jquery.outsideEvents","views/WorkspaceView","views/GlobalHelpView","views/NodeEditView","models/User"],function(e,t,n){function i(e){s(".coggle-workspace").length||(getCoggleUser().getOrganisations().length>0&&s(".coggle-sidebar").contextualHelp({actions:e,title:a.getSync("help-orgs-switch-title","Switch Between Organisations"),content:s("<div/>").html("<p data-l10n-id='help-orgs-switch-p1'>Click to switch between Organisations.</p><p data-l10n-id='help-orgs-switch-p2'>Organisations let you control sharing of Coggles and work with larger teams.</p>"),position:{my:"left top",at:"left+40 top+60",of:s(".organisations")},callout_opts:{my:"left-4 top+10",callout:"left top"},action:"help:createorganisation",after:["workspace-close"],on_open:function(){s(".home-view").animate({scrollTop:0},50)},showOk:!0}),s(".create-diagram").first().contextualHelp({actions:e,title:a.getSync("help-creatediagram-title","Create a New Diagram"),content:s("<div data-l10n-id='help-creatediagram'/>").html("Create a new Coggle Diagram to get started."),position:{my:"left top",at:"left+23 bottom"},callout_opts:{my:"left top",callout:"left top"},action:"help:creatediagram",suppress_action:"created-diagram"}),s(".search-view").contextualHelp({actions:e,title:a.getSync("help-searchcoggle-title","Search Coggle"),content:s("<div data-l10n-id='help-searchcoggle'/>").html("Type to find your documents &mdash; quickly search for any word in a diagram!"),position:{my:"left top",at:"left+15 bottom-2"},action:"help:search",after:"workspace-close",suppress_action:"searched",showOk:!0}))}function o(e,t){e.model.accessIsEphemeral()||e.model.getAccess(function(n,i){n||1!==i.length||e.getStarcView().readOnly()||A(e,t)})}var r=e("underscore"),s=e("jquery"),l=e("backbone"),a=e("l10n");e("plugins/jquery.contextualHelp"),e("jquery.outsideEvents");var u=e("views/WorkspaceView"),d=e("views/GlobalHelpView"),c=e("views/NodeEditView"),h=e("models/User"),p=function(){};p.start=function(){if(!h.me().isGuest()){var e=null;u.on("loaded",function(t){e=t}),h.me().getActions(function(t,n){if(t||!n)return console.warn("help setup failed",t);e?o(e,n):u.on("loaded",function(t){e=t,o(e,n)}),l.history.on("route",function(){setTimeout(function(){i(n)},400)}),setTimeout(function(){i(n)},400)})}};var f=function(e,t){function n(){e.$el.find(".toolbar").removeClass("modal"),s("body").removeClass("disable-tips"),s(".ui-tooltip").hide()}if(!t.get("diagram:sharing:open")){e.$el.find(".toolbar").addClass("modal"),s("body").addClass("disable-tips");var i=s(".toolbar .action.social").contextualHelp({actions:t,title:a.getSync("help-toolbar-sharing-title","Shareable Links and Publishing"),content:s("<div data-l10n-id='help-toolbar-sharing'/>").html("You can also publish your diagram, or create secret shareable links to give access only to people with that link."),position:{my:"top center",at:"center bottom+2"},action:"help:sharinglinks",openImmediately:!0,suppress_action:"diagram:sharing:open",on_complete:n,on_ignore:n,on_hide:n,showOk:!0});i.open(),e.toolbarView.once("item-clicked",function(){i.remove(),n()})}};window.moreSharingHelp=f;var g=function(e,t){function n(){e.$el.find(".toolbar").removeClass("modal"),s("body").removeClass("disable-tips"),s(".ui-tooltip").hide(),s(".diagram-editor").mousedown(),e.toolbarView.once("sharing-closed",function(){f(e,t)})}e.$el.find(".toolbar").addClass("modal"),e.$el.find(".toolbar .member.invite").click(),s("body").addClass("disable-tips");var i=s(".share-view");i?i.contextualHelp({actions:t,title:a.getSync("help-toolbar-inviteflow-title-2","Invite a Co-worker by Email"),content:s("<div/>").html("<p data-l10n-id='help-toolbar-invitedonefaster-p1'>Now you've been editing for a while, try getting things done faster by collaborating!</p><p data-l10n-id='help-toolbar-invitedonefaster-p2'>Invite people to edit with you, and see their changes instantly.</p>"),position:{my:"top center",at:"center bottom+14"},action:"help:inviteflow",openImmediately:!0,on_complete:n,on_ignore:n,showOk:!0}).open():n()};window.startInviteFlow=g;var m=function(e,t){e.$el.contextualHelp({actions:t,title:a.getSync("help-toolbar-invite-title","Work With Others"),content:s("<div data-l10n-id='help-toolbar-invite'/>").html("Click to invite people to edit or view this Coggle. You can control people's permissions by clicking on their icon."),position:{my:"top right",at:"center bottom+2",of:e.$el.find(".toolbar .member.invite")},action:"help:invitetodiagram",suppress_action:"diagram:invites:open"})},v=function(e,t){s("#diagram-header #logo").length&&e.$el.contextualHelp({actions:t,content:s("<div data-l10n-id='help-gohome-2'/>").html("When you have finished editing, click the logo to go back to the homepage. Your documents are automatically saved."),position:{my:"center center",at:"center+4 bottom+2",of:s("#diagram-header #logo")},action:"help:gohome",after:["node-contextmenu-opened","added-node","edited-node",{$any:["help:inviteflow","invited-someone"]},{$any:["help:sharinglinks","diagram:sharing:open"]}],suppress_action:"workspace-close"})},y=function(e,t,n){var i=s("body").hasClass("touch"),o=n.$el.contextualHelp({actions:t,title:i?a.getSync("help-morehelp-touch-title","Shortcuts and Help"):a.getSync("help-morehelp2-title","Keyboard Shortcuts and Help"),content:i?s("<div data-l10n-id='help-morehelp-touch'/>").html("Open the help sheet to see shortcuts, and quickly search help articles."):s("<div data-l10n-id='help-morehelp2'/>").html("Open the help sheet to see keyboard shortcuts, and quickly search help articles."),position:{my:"bottom right",at:"center top-10",of:s(".global-help-button")},action:"help:morehelp2",suppress_action:"globalhelp:open",after:["added-node","edited-node","moved-node","node-contextmenu-opened"]});n.once("open",function(){o.remove()})},b=function(e,t){s(".node-container.titleroot .node-content").last().contextualHelp({actions:t,title:a.getSync("help-title-title","The Diagram Title"),content:s("<div/>").html('<p data-l10n-id="help-title-p1">This is the center of your diagram, and its title. Your ideas will branch out from here!</p><p data-l10n-id="help-title-p2">Start by editing it - what is your diagram about?</p>'),position:{my:"center center",at:"center bottom+3"},action:"help:diagram-title",suppress_action:"edited-title"})},w=function(e,t){function n(){i.reposition()}var i,o=s("body").hasClass("touch"),r=s(".node-container.titleroot").last();i=o?r.contextualHelp({actions:t,content:s("<div data-l10n-id='help-press-hold-menu-2'/>").html("Press and hold an item to open the menu, and add connected branches with your ideas."),position:{my:"center center",at:"center bottom+10"},action:"help:press-hold-menu",after:["edited-title"],suppress_action:"node-contextmenu-opened",on_complete:function(){e.getStarcView().off("node_edited",n)}}):r.contextualHelp({actions:t,content:s("<div data-l10n-id='help-add-node'/>").html('Use the <div data-l10n-name="plus" class="diagram-button plus">+</div> buttons to add branches.'),position:{my:"center center",at:"right+3 bottom+11"},action:"help:node-added",after:["edited-title"],suppress_action:"added-node",on_complete:function(){e.getStarcView().off("node_edited",n)}}),e.getStarcView().on("node_edited",n)},_=function(e,t){var n=s("body").hasClass("touch");setTimeout(function(){var e=s(".node-container.active:not(.root) .node-content").last();e.length||(e=s(".node-container:not(.sizing-container):not(.root) .node-content").last()),e.contextualHelp({actions:t,content:n?s("<div/>").html('<p data-l10n-id="help-edit-node-touch-p1">Tap any item to edit the text.</p><p data-l10n-id="help-edit-node-touch-p2">Change the text size by dragging the corner of the editing area.</p>'):s("<div/>").html('<p data-l10n-id="help-edit-node-p1">Click any item to edit the text.</p><p data-l10n-id="help-edit-node-p2">Change the text size by dragging the corner of the editing area.</p>'),position:{my:"center top",at:"center bottom+8"},callout_opts:{my:"center top",callout:"center top"},action:"help:node-edited",suppress_action:"edited-node",after:["edited-title","added-node"]})},500)},x=function(e,t){setTimeout(function(){s(".node-container:not(.root):not(.sizing-container) .node-content").last().contextualHelp({actions:t,content:s("<div data-l10n-id='help-node-menu'/>").html("Right click on items to access the menu. Here you can add, remove, copy, and arrange branches."),position:{my:"center top",at:"center bottom+8"},callout_opts:{my:"center top",callout:"center top"},action:"help:node-menu",suppress_action:"node-contextmenu-opened",after:["moved-node","added-node","edited-node"]})},500)},E=function(e,t){var n=!1;BrowserDetect&&"Firefox"!==BrowserDetect.browser&&e.$el.on("pointerover",function(i){i&&i.pointerType&&"pen"===i.pointerType&&e&&e.$el&&!n&&(n=!0,e.$el.contextualHelp({actions:t,content:s("<div data-l10n-id='help-penerase'/>").html("Hey, it looks like you're using a touch-screen pen! If your pen has an eraser, you can use it to delete items and connections."),position:{my:"top left",at:"center+100 top-2",of:s("#diagram-header #logo")},action:"help:penerase",after:["added-node","edited-node","moved-node"],showOk:!0}))})},A=function(e,t){function n(){setTimeout(function(){var i=s(".node-container.active:not(.root) .node-content").last();i.length||(i=s(".node-container:not(.sizing-container):not(.root) .node-content").last()),i.length&&(e.getStarcView().off("node_edited",n),i.contextualHelp({actions:t,content:s("<div data-l10n-id='help-move-node'/>").html("Drag any text to move it."),position:{my:"center center",at:"center bottom+8"},action:"help:node-moved",suppress_action:"moved-node",after:["edited-node","added-node"]}))},500)}var i=d.instance();if(!t.get("help:invitetodiagram")&&!t.get("diagram:invites:open")&&s(window).innerHeight()<800&&i.close(),i.isOpen()||y(0,t,i),e.$el.find(".toolbar .member.invite").length&&m(e,t),!t.get("invited-someone")&&!t.get("help:inviteflow")&&!s("body").hasClass("touch")){var o=0,l=r.debounce(function(){(o+=1)>10&&!(t.get("help:inviteflow")||t.get("invited-someone")||c.activeEdit())&&(g(e,t),e.getStarcView().off("node_edited",l))},1e3);e.getStarcView().on("node_edited",l)}v(e,t),b(0,t),e.getStarcView().once("node_edited",w.bind(this,e,t)),t.get("edited-title")&&!t.get("added-node")&&w(e,t),e.getStarcView().once("node_added",_.bind(this,e,t)),e.getStarcView().on("node_edited",n),s("body").hasClass("touch")||e.getStarcView().once("node_moved",x.bind(this,e,t)),E(e,t)};n.exports=p}),define("utils/unescape",["require","exports","module","underscore"],function(e,t,n){function i(e,t){var n=null,o=null;for(var r in e)if(e.hasOwnProperty(r)){if(o=e[r],n=typeof o,("_id"===r||"id"===r)&&"string"===n)continue;"object"===n&&null!==o?e[r]=i(o,t):"string"===n&&(e[r]=t(o))}return e}function o(e){return i(e,s.unescape)}function r(e){return i(e,s.escape)}var s=e("underscore");n.exports.unescapeRecursive=o,n.exports.escapeRecursive=r}),window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")),"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,i=function(){},o=function(){return n.apply(this instanceof i&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return i.prototype=this.prototype,o.prototype=new i,o}),String.prototype.trim||function(){var e=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;String.prototype.trim=function(){return this.replace(e,"")}}(),Object.create||(Object.create=function(){function e(){}return function(t){if(1!=arguments.length)throw new Error("Object.create implementation only accepts one parameter.");return e.prototype=t,new e}}()),!String.prototype.startsWith){var startsWith=function(e,t){return t=t||0,this.indexOf(e,t)===t};try{Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,configurable:!1,writable:!1,value:startsWith})}catch(e){String.prototype.startsWith=startsWith}}Math.sign=Math.sign||function(e){return e=+e,0===e||isNaN(e)?e:e>0?1:-1},Array.prototype.find||(Array.prototype.find=function(e){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,n=Object(this),i=n.length>>>0,o=arguments[1],r=0;r<i;r++)if(t=n[r],e.call(o,t,r,n))return t}),function(e){e.forEach(function(e){e.hasOwnProperty("remove")||Object.defineProperty(e,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){this.parentNode&&this.parentNode.removeChild(this)}})})}([Element.prototype,CharacterData.prototype,DocumentType.prototype]),function(e){function t(){}e.console&&e.console.log||(e.console={log:t,debug:t,info:t,warn:t,error:t})}(window),Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.matches&&!Element.prototype.closest&&(Element.prototype.closest=function(e){var t=this;do{if(Element.prototype.matches.call(t,e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null}),define("mdn-polyfill",function(){}),
define("backbone.captureLinks",["require","exports","module"],function(e,t,n){Backbone.Router.captureLinks=function(){$(document).on("click","a[href]:not([data-bypass]):not([target=_blank])",function(e){if(!Backbone.Router._disableCaptureLinks&&!(e.metaKey||e.ctrlKey||e.shiftKey)){var t={prop:$(this).prop("href"),attr:$(this).attr("href")},n=location.protocol+"//"+location.host;"#"!==t.attr.slice(0,1)&&t.prop.slice(0,n.length)===n&&(e.preventDefault(),Backbone.history.navigate(t.prop.slice(n.length,t.prop.length),!0))}})},Backbone.Router.disableCaptureLinks=function(){Backbone.Router._disableCaptureLinks=!0}}),function(e){define("jquery-touch-punch",["jquery-ui/widget","jquery-ui/widgets/mouse"],function(){return function(){!function(e){function t(e,t){if(!(e.originalEvent.touches.length>1)){e.preventDefault();var n=e.originalEvent.changedTouches[0],i=document.createEvent("MouseEvents");i.initMouseEvent(t,!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(i)}}if(e.support.touch="ontouchend"in document,e.support.touch){var n,i=e.ui.mouse.prototype,o=i._mouseInit,r=i._mouseDestroy;i._touchStart=function(e){var i=this;!n&&i._mouseCapture(e.originalEvent.changedTouches[0])&&(n=!0,i._touchMoved=!1,t(e,"mouseover"),t(e,"mousemove"),t(e,"mousedown"))},i._touchMove=function(e){n&&(this._touchMoved=!0,t(e,"mousemove"))},i._touchEnd=function(e){n&&(t(e,"mouseup"),t(e,"mouseout"),this._touchMoved||t(e,"click"),n=!1)},i._mouseInit=function(){var t=this;t.element.bind({touchstart:e.proxy(t,"_touchStart"),touchmove:e.proxy(t,"_touchMove"),touchend:e.proxy(t,"_touchEnd")}),o.call(t)},i._mouseDestroy=function(){var t=this;t.element.unbind({touchstart:e.proxy(t,"_touchStart"),touchmove:e.proxy(t,"_touchMove"),touchend:e.proxy(t,"_touchEnd")}),r.call(t)}}}(jQuery)}.apply(e,arguments)})}(this),define("controllers/HeaderInjection",["require","exports","module","env","jquery"],function(e,t,n){var i=e("env"),o=e("jquery");n.exports=function(){o.ajaxPrefilter(function(e,t,n){if(!e.crossDomain||0===e.url.indexOf(i.api.url)){if(void 0!==window.Coggle_JS_Version&&n.setRequestHeader("X-CoggleJS-Version",window.Coggle_JS_Version),void 0!==window.CoggleCSRFToken?n.setRequestHeader("X-CSRF-Token",window.CoggleCSRFToken):void 0!==window.CSRFToken&&n.setRequestHeader("X-CSRF-Token",window.CSRFToken),void 0!==window.CoggleAccessToken&&n.setRequestHeader("Authorization","Bearer "+window.CoggleAccessToken),"function"==typeof window.getCoggleUser){var o=window.getCoggleUser().getActiveOrg().id;o&&-1===e.url.indexOf("organisation=")&&(e.url+=-1===e.url.indexOf("?")?"?":"&",e.url+="organisation="+o)}window._coggle_impersonate&&(console.log("adding impersonate",e.url),e.url+=-1===e.url.indexOf("?")?"?":"&",e.url+="impersonate="+window._coggle_impersonate)}})}}),define("utils/backboneTranslatable",["require","exports","module","utils/queryString"],function(e,t,n){var i=e("utils/queryString");t.addSupport=function(e){var t=e.history,n=e.validator||/.*/;if(/^translate\.googleusercontent\.com$/.exec(document.location.hostname)){console.log("detected google translate");var o=document.createElement("a");if(o.href=i().u,n.exec(o.hostname)){var r={href:o.href,pathname:o.pathname,hash:o.hash,assign:function(){console.log("assign ignored",arguments)},replace:function(){console.log("replace ignored",arguments)}},s={replaceState:function(){console.log("replaceState ignored",arguments)},pushState:function(){console.log("pushState ignored",arguments)}};t.history=s,t.location=r}}}}),define("web-main",["require","exports","module","utils/trackModifiers","js-cookie","jquery","underscore","async","backbone","controllers/Router","models/User","models/Organisation","controllers/MessagePollController","controllers/AutoUpdate","views/APIClientViews","models/APIClients","views/Tooltips","views/ContextualHelpFlow","utils/unescape","utils/queryString","mdn-polyfill","backbone.captureLinks","jquery-touch-punch","controllers/HeaderInjection","utils/backboneTranslatable"],function(e,t,n){function i(){console.log("starting up...");var t=o.get("coggle-pick-homepage-test");t&&0!==t.length&&getCoggleUser().science("homepage",[t]),$.ajaxSetup({cache:!1}),"iOS"==BrowserDetect.OS||"Android"==BrowserDetect.OS?(document.body.classList.add("touch"),document.body.classList.remove("desktop")):(document.body.classList.remove("touch"),document.body.classList.add("desktop")),window.Raygun&&!getCoggleUser().isGuest()&&window.Raygun.setUser(getCoggleUser().id),p().impersonate&&(window._coggle_impersonate=p().impersonate,window.Messages.warning("Impersonating "+window._coggle_impersonate),getCoggleUser().fetch(),getCoggleUser().getOrganisations().fetch());var n=new l;e("utils/backboneTranslatable").addSupport({history:s.history,validator:/^(?:.*\.)?coggle\.it$/}),p().print||getCoggleUser().isGuest()?s.history.start({pushState:!0,hashChange:!1})||n.notFound():(window._first_route=!0,s.history.start({pushState:!0,hashChange:!1})||n.notFound(),window._first_route=!1,u(),d(),h.start(),s.Router.captureLinks()),c()}e("utils/trackModifiers");var o=e("js-cookie");o.defaults.secure="https:"===location.protocol,o.defaults.sameSite="strict",e("jquery");var r=(e("underscore"),e("async")),s=e("backbone"),l=e("controllers/Router"),a=e("models/User"),u=(e("models/Organisation").OrganisationModel,e("controllers/MessagePollController")),d=e("controllers/AutoUpdate"),c=(e("views/APIClientViews"),e("models/APIClients"),e("views/Tooltips")),h=e("views/ContextualHelpFlow"),p=(e("utils/unescape").unescapeRecursive,e("utils/queryString"));return e("mdn-polyfill"),e("backbone.captureLinks"),e("jquery-touch-punch"),"Explorer"===BrowserDetect.browser?window.Messages.error("Sorry, Internet Explorer is no longer supported by Coggle. Please upgrade to Microsoft Edge, Safari, Chrome or Firefox"):"PointerEvent"in window||p().print||window.Messages.error("Sorry, Safari 12 and older are no longer supported by Coggle. Please update to a newer version or use a different browser."),e("controllers/HeaderInjection")(),s.history.on("route",function(){ga&&(ga("set","page",window.location.pathname.replace(/\/t\/[^\/]*/,"")),ga("set","title","Coggle"),ga("send","pageview"))}),function(e){r.parallel([function(t){e&&e.user?(a.me().set(e.user),t()):a.me().fetchOrQueue(t)},function(t){e&&e.organisations?(a.me().getOrganisations().reset(e.organisations),t()):a.me().getOrganisations(t)}],function(){if(e){var t=a.me().getOrganisations().get(e.organisation&&e.organisation._id);if(e.organisation?(t||(t=a.me().getOrganisations().add(e.organisation)),a.me().setActiveOrg(t)):t=a.me().getActiveOrg(),e.diagram){var n=e.diagram.folder;n||(n=e.diagram.owner_id===a.me().id?"root":"shared");t.getFolders().add({_id:n}).getDiagrams().add(e.diagram).getDeltas().reset(e.deltas)}}i()})}});